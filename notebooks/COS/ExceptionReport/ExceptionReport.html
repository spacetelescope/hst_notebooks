

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>What to do when you get an Exception Report for COS &#8212; HST Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/COS/ExceptionReport/ExceptionReport';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="DrizzlePac Notebooks" href="../../DrizzlePac/README.html" />
    <link rel="prev" title="Editing the extraction boxes in a spectral extraction file (XTRACTAB)" href="../Extract/Extract.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="HST Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="HST Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    STScI HST Notebook Repository HQ
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">ACS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../ACS/README.html">ACS Notebooks</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_findsat_mrt/acs_findsat_mrt_example.html">Satellite trail detection in ACS/WFC data using acstools.findsat_mrt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_saturation_trails/acs_saturation_trails.html">ACS Linearity with Saturated Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_cte_forward_model/acs_cte_forward_model_example.html">Pixel-based ACS/WFC CTE Forward Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_subarrays/acs_subarrays.html">ACS Image Reduction for Subarray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_sbc_dark_analysis/acs_sbc_dark_analysis.html">SBC Dark Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_reduction/acs_reduction.html">ACS/WFC Image Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_pixel_area_maps/acs_pixel_area_maps.html">Obtaining Pixel Area Maps for ACS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_polarization_tools/acs_polarization_tools.html">Using ACS Polarization Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_focus_diverse_epsfs/acs_focus_diverse_epsfs.html">Focus Diverse ePSFs for ACS/WFC</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">COS</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../README.html">COS Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Setup/Setup.html">Setting up your computer environment for working with COS data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../DataDl/DataDl.html">Downloading COS Data</a></li>




<li class="toctree-l1"><a class="reference internal" href="../ViewData/ViewData.html">Viewing COS Data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../AsnFile/AsnFile.html">Modifying or Creating an Association File</a></li>





<li class="toctree-l1"><a class="reference internal" href="../CalCOS/CalCOS.html">Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)</a></li>






<li class="toctree-l1"><a class="reference internal" href="../SplitTag/SplitTag.html">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></a></li>







<li class="toctree-l1"><a class="reference internal" href="../DayNight/DayNight.html">Filtering out COS Data taken during the Day or Night</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LSF/LSF.html">Working with the COS Line Spread Function (LSF)</a></li>

<li class="toctree-l1"><a class="reference internal" href="../Extract/Extract.html">Editing the extraction boxes in a spectral extraction file (<code class="docutils literal notranslate"><span class="pre">XTRACTAB</span></code>)</a></li>







<li class="toctree-l1 current active"><a class="current reference internal" href="#">What to do when you get an Exception Report for COS</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">DrizzlePac</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/README.html">DrizzlePac Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/using_updated_astrometry_solutions/using_updated_astrometry_solutions.html">Improving Astrometry Using Alternate WCS Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_to_catalogs/align_to_catalogs.html">Aligning HST images to an Absolute Reference Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_sparse_fields/align_sparse_fields.html">Aligning Deep Exposures of Sparse Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_multiple_visits/align_multiple_visits.html">Optimizing Image Alignment for Multiple HST Visits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/use_ds9_regions_in_tweakreg/use_ds9_regions_in_tweakreg.html">TWEAKREG Tips - Using DS9 Regions for Source Inclusion/Exclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/optimize_image_sampling/optimize_image_sampling.html">Optimizing the Image Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_mosaics/align_mosaics.html">Aligning HST Mosaics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/sky_matching/sky_matching.html">Sky Matching for HST Mosaics <a id="top"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/mask_satellite/mask_satellite.html">Satellite Trail Masking Techniques</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HASP</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../HASP/Setup/Setup.html">Installing the Hubble Advanced Spectral Products Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../HASP/CoaddTutorial/CoaddTutorial.html">Inputting User Data using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/FluxScaleTutorial/FluxScaleTutorial.html">Scaling Flux while using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/DataDiagnostic/DataDiagnostics.html">HASP Data Diagnostic Notebook</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../HASP/WavelengthAdjustment/WavelengthAdjustment.html">Wavelength Adjustments for Running the Hubble Advanced Spectral Products (HASP) Script</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NICMOS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html">Programmatic Replacements for NICMOS Units Conversion Form</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">STIS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../STIS/README.html">STIS-Notebooks</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../STIS/cross-correlation/cross-correlation.html">Correcting for Missing Wavecals with Cross-Correlation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/custom_ccd_darks/custom_ccd_darks.html">Custom CCD Darks <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/drizpac_notebook/STIS_DrizzlePac_Tutorial.html">STIS DrizzlePac Tutorial <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/CoronagraphyViz/STIS_Coronagraphy_Visualization_v2.html">STIS Coronagraphy Visualization Tool (v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/calstis/calstis_2d_ccd.html">Calstis 2-D CCD Data Reduction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/target_acquisition/target_acquisition.html">Evaluating STIS Target Acquisitions <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/view_data/view_data.html">Viewing STIS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/extraction/1D_Extraction.html">1D Spectra Extraction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/low_count_uncertainties/Low_Count_Uncertainties.html">Low Count Uncertainties in STIS <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/contrast_sensitivity/STIS_Coronagraphic_Observation_Feasibility.html">STIS Coronagraphic Observation Feasibility</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">WFC3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../WFC3/README.html">WFC3 Notebooks</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/general_tools.html">General Tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/image_displayer_analyzer/wfc3_image_displayer_analyzer.html">WFC3 Image Displayer &amp; Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/exception_report/wfc3_exception_report.html">Exception Report Checklist - WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/calwf3_v1.0_cte/calwf3_with_v1.0_PCTE.html">Processing WFC3/UVIS Data with <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> Using the v1.0 CTE-Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/persistence/wfc3_ir_persistence.html">Masking Persistence in WFC3/IR Images</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/ir_tvb.html">WFC3/IR Time Variable Background (TVB)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_ima_visualization/IR_IMA_Visualization_with_an_Example_of_Time_Variable_Background.html">WFC3/IR IMA Visualization Tools with An Example of Time Variable Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/calwf3_recalibration/calwf3_recal_tvb.html">Manual Recalibration with calwf3: Turning off the IR Linear Ramp Fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/tvb_flattenramp/TVB_flattenramp_notebook.html">Correcting for Helium Line Emission Background in IR Exposures using the “Flatten-Ramp” Technique</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_scattered_light_calwf3_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_Using_calwf3_to_Mask_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Using <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> to Mask Bad Reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_scattered_light_manual_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_by_Manually_Subtracting_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Manually Subtracting Bad Reads</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/photometry.html">Photometry</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/filter_transformations/filter_transformations.html">WFC3/UVIS Filter Transformations with stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/flux_conversion_tool/flux_conversion_tool.html">Flux Unit Conversions with synphot and stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/photometry_examples/phot_examples.html">Synthetic Photometry Examples for WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_time_dependent_photometry/uvis_timedep_phot.html">WFC3/UVIS Time-dependent Photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/zeropoints/zeropoints.html">Calculating WFC3 Zeropoints with STSynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_pam_corrections/WFC3_UVIS_Pixel_Area_Map_Corrections_for_Subarrays.html">WFC3/UVIS Pixel Area Map Corrections for Subarrays</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/point_spread_function.html">Point Spread Function (PSF)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/point_spread_function/hst_point_spread_function.html">HST WFC3 Point Spread Function Modeling   </a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/mast_api_psf/download_psf_cutouts.html">Downloading WFC3 and WFPC2 PSF Cutouts from MAST</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/spacetelescope/hst_notebooks/blob/main/notebooks/COS/ExceptionReport/ExceptionReport.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/COS/ExceptionReport/ExceptionReport.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/COS/ExceptionReport/ExceptionReport.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>What to do when you get an Exception Report for COS</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">What to do when you get an Exception Report for COS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">0. Introduction</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-download">0.1 Data Download</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#inspecting-the-exposure-time">1. Inspecting the Exposure Time</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#reviewing-the-signal-to-noise-ratio">2. Reviewing the Signal-to-Noise Ratio</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#investigating-the-target-acquisition">3. Investigating the Target Acquisition</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acq-search">3.1 <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acq-image">3.2 <code class="docutils literal notranslate"><span class="pre">ACQ/IMAGE</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acq-peakxd-acq-peakd">3.3 <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code>, <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKD</span></code></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-the-wavelength-scale">4. Evaluating the Wavelength Scale</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-the-jitter">5. Checking the Jitter</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspecting-the-jif-headers-for-guiding-issues">5.1 Inspecting the <code class="docutils literal notranslate"><span class="pre">JIF</span></code> Headers for Guiding Issues</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspecting-the-jit-table">5.2 Inspecting the <code class="docutils literal notranslate"><span class="pre">JIT</span></code> Table</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#congrats-on-completing-the-notebook">Congrats on completing the notebook!</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#there-are-more-tutorial-notebooks-for-cos-in-this-repo-check-them-out">There are more tutorial notebooks for COS in this repo, check them out!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><a id="topER"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="what-to-do-when-you-get-an-exception-report-for-cos">
<h1>What to do when you get an Exception Report for COS<a class="headerlink" href="#what-to-do-when-you-get-an-exception-report-for-cos" title="Permalink to this heading">#</a></h1>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Permalink to this heading">#</a></h2>
<p><font size="4"> This Notebook is designed to walk the user (<em>you</em>) through: <b>investigating the cause of a Hubble Space Telescope (HST) Exception Report</b>. </font></p>
<p>By the end of this tutorial, you will:</p>
<ul class="simple">
<li><p>Learn how to examine <code class="docutils literal notranslate"><span class="pre">FITS</span></code> headers of your data to reveal issues with observations</p></li>
<li><p>Inspect your COS data files to determine whether these were negatively impacted, anomalous, and/or degraded</p></li>
</ul>
</section>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">#</a></h2>
<p><strong><span class="xref myst">0. Introduction</span></strong></p>
<p>- <span class="xref myst">0.1 Data Download</span></p>
<p><strong><span class="xref myst">1. Inspecting the Exposure Time</span></strong></p>
<p><strong><span class="xref myst">2. Reviewing the Signal-to-Noise Ratio</span></strong></p>
<p><strong><span class="xref myst">3. Investigating the Target Acquisition</span></strong></p>
<p>- <span class="xref myst">3.1 <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code></span></p>
<p>- <span class="xref myst">3.2 <code class="docutils literal notranslate"><span class="pre">ACQ/IMAGE</span></code></span></p>
<p>- <span class="xref myst">3.3 <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code>, <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKD</span></code></span></p>
<p><strong><span class="xref myst">4. Evaluating the Wavelength Scale</span></strong></p>
<p><strong><span class="xref myst">5. Checking the Jitter</span></strong></p>
<p>- <span class="xref myst">5.1 Inspecting the <code class="docutils literal notranslate"><span class="pre">JIF</span></code> Headers for Guiding Issues</span></p>
<p>- <span class="xref myst">5.2 Inspecting the <code class="docutils literal notranslate"><span class="pre">JIT</span></code> Table</span></p>
<p><a id = intro></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction">
<h1>0. Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h1>
<p><strong>The Cosmic Origins Spectrograph (<a class="reference external" href="https://www.nasa.gov/content/hubble-space-telescope-cosmic-origins-spectrograph"><em>COS</em></a>) is an ultraviolet spectrograph onboard the Hubble Space Telescope (<a class="reference external" href="https://www.stsci.edu/hst/about"><em>HST</em></a>) with capabilities in the near ultraviolet (<em>NUV</em>) and far-ultraviolet (<em>FUV</em>).</strong></p>
<p><strong>This tutorial aims to help you take the appropriate steps after you have received an exception report on your HST/COS observation.</strong>
An exception report is generated when conditions are present that may have lead to a degredation in data quality, such as an acquisition failure or loss of lock during guiding. When this happens, you receive an email that describes what issues may have occurred during your observations and suggests initial steps to evaluating the quality of your data. The <a class="reference external" href="https://www.stsci.edu/hst/instrumentation/cos/documentation/exception-report-instructions">COS Exception Report Instructions webpage</a> suggests a few steps to evaluating the quality of your data so that you can determine whether to file a Hubble Observation Problem Report (HOPR); this notebook will show you how to perform these steps on a variety of different examples from previous COS observations. Your data does not necessarily need to fail all of these steps before a HOPR is filed, you just need to show that there was an issue with your exposures.</p>
<p><strong>Please note that we cannot offer a complete and definitive guide to every exception report. This notebook is simply a general guide to help you understand your data and its quality. Additionally, just because you receive an exception report does not mean that there’s a problem with your data, only that it should be evaluated for quality.</strong></p>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<p>We will be using multiple libraries to retrieve and analyze data. We will use:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">os</span></code>, <code class="docutils literal notranslate"><span class="pre">shutil</span></code>, <code class="docutils literal notranslate"><span class="pre">Path.pathlib</span></code>, and <code class="docutils literal notranslate"><span class="pre">glob</span></code> to work with our system’s directories and filepaths</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code> to plot our data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code> to perform analysis on our data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astroquery.mast</span></code> to download our COS datasets for the exercises</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.io</span> <span class="pre">fits</span></code> and <code class="docutils literal notranslate"><span class="pre">astropy.table</span> <span class="pre">Table</span></code> to read the corresponding <code class="docutils literal notranslate"><span class="pre">FITS</span></code> files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code> to fit a Gaussian when calculating the radial velocity</p></li>
</ul>
<p>We recommend that you create a new <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment before running this notebook. Check out the <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/tree/main/notebooks/COS/Setup">COS Setup.ipynb</a> notebook to install <code class="docutils literal notranslate"><span class="pre">conda</span></code>. Alternatively, you can download the dependencies required to run this notebook by running the terminal command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>After you download the required dependencies, import them by running the next cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.mast</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observations</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ellipse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">optimize</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">cos_functions</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cf</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.utils.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstropyWarning</span>

<span class="c1"># Ignore Astropy warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">AstropyWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id = download></a></p>
</section>
<section id="data-download">
<h2>0.1 Data Download<a class="headerlink" href="#data-download" title="Permalink to this heading">#</a></h2>
<p>We will begin by downloading all of the data for this notebook using <code class="docutils literal notranslate"><span class="pre">astroquery.mast</span> <span class="pre">Observations</span></code>. Details on how to download COS data can be found in our <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/tree/main/notebooks/COS/DataDl">Data Download Notebook</a>. We will be using examples from many different programs, so we will load in a <code class="docutils literal notranslate"><span class="pre">FITS</span></code> file with an <code class="docutils literal notranslate"><span class="pre">astropy.Table</span></code> of observations. We will also create a directory to store these files in, called <code class="docutils literal notranslate"><span class="pre">datapath</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creating the folder to store our data</span>
<span class="n">datapath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./data/&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Loading in the FITS table with the list of observations</span>
<span class="n">observations</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;./files.fits&quot;</span><span class="p">)</span>

<span class="c1"># Downloading the files to our data directory</span>
<span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span>
    <span class="n">observations</span><span class="p">,</span>
    <span class="n">download_dir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">datapath</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/laaf2agfq_rawacq.fits to data/mastDownload/HST/laaf2agfq/laaf2agfq_rawacq.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lbhx1cn4q_rawacq.fits to data/mastDownload/HST/lbhx1cn4q/lbhx1cn4q_rawacq.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lbs304n1q_rawacq.fits to data/mastDownload/HST/lbs304n1q/lbs304n1q_rawacq.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lda920020_x1dsum.fits to data/mastDownload/HST/lda920020/lda920020_x1dsum.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lda920hyq_x1d.fits to data/mastDownload/HST/lda920hyq/lda920hyq_x1d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lda920i3q_x1d.fits to data/mastDownload/HST/lda920i3q/lda920i3q_x1d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lda920iaq_x1d.fits to data/mastDownload/HST/lda920iaq/lda920iaq_x1d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lda920iwq_x1d.fits to data/mastDownload/HST/lda920iwq/lda920iwq_x1d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ldc0c0k0q_rawacq.fits to data/mastDownload/HST/ldc0c0k0q/ldc0c0k0q_rawacq.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ldi707tcq_rawtag_a.fits to data/mastDownload/HST/ldi707tcq/ldi707tcq_rawtag_a.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ldi707tcq_rawtag_b.fits to data/mastDownload/HST/ldi707tcq/ldi707tcq_rawtag_b.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ldi707tcq_x1d.fits to data/mastDownload/HST/ldi707tcq/ldi707tcq_x1d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ldy305010_x1dsum.fits to data/mastDownload/HST/ldy305010/ldy305010_x1dsum.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ldy305r8q_x1d.fits to data/mastDownload/HST/ldy305r8q/ldy305r8q_x1d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ldy305rbq_x1d.fits to data/mastDownload/HST/ldy305rbq/ldy305rbq_x1d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ldy305rkq_x1d.fits to data/mastDownload/HST/ldy305rkq/ldy305rkq_x1d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ldy305rpq_x1d.fits to data/mastDownload/HST/ldy305rpq/ldy305rpq_x1d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/le2t09010_jif.fits to data/mastDownload/HST/le2t09010/le2t09010_jif.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/le2t09010_jit.fits to data/mastDownload/HST/le2t09010/le2t09010_jit.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/le3a01010_jit.fits to data/mastDownload/HST/le3a01010/le3a01010_jit.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/le4s04d7j_jif.fits to data/mastDownload/HST/le4s04d7q/le4s04d7j_jif.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/le9i4d020_x1dsum.fits to data/mastDownload/HST/le9i4d020/le9i4d020_x1dsum.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/leimacm3q_rawtag_a.fits to data/mastDownload/HST/leimacm3q/leimacm3q_rawtag_a.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/leimacm3q_rawtag_b.fits to data/mastDownload/HST/leimacm3q/leimacm3q_rawtag_b.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/leimacm3q_x1d.fits to data/mastDownload/HST/leimacm3q/leimacm3q_x1d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lekcl2sdq_rawacq.fits to data/mastDownload/HST/lekcl2sdq/lekcl2sdq_rawacq.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lekcl2seq_rawacq.fits to data/mastDownload/HST/lekcl2seq/lekcl2seq_rawacq.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/leo906g4q_rawacq.fits to data/mastDownload/HST/leo906g4q/leo906g4q_rawacq.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/leo906g6q_rawacq.fits to data/mastDownload/HST/leo906g6q/leo906g6q_rawacq.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output text_html"><div><i>Table length=29</i>
<table id="table140273494152976" class="table-striped table-bordered table-condensed">
<thead><tr><th>Local Path</th><th>Status</th><th>Message</th><th>URL</th></tr></thead>
<thead><tr><th>str55</th><th>str8</th><th>object</th><th>object</th></tr></thead>
<tr><td>data/mastDownload/HST/laaf2agfq/laaf2agfq_rawacq.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/lbhx1cn4q/lbhx1cn4q_rawacq.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/lbs304n1q/lbs304n1q_rawacq.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/lda920020/lda920020_x1dsum.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/lda920hyq/lda920hyq_x1d.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/lda920i3q/lda920i3q_x1d.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/lda920iaq/lda920iaq_x1d.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/lda920iwq/lda920iwq_x1d.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/ldc0c0k0q/ldc0c0k0q_rawacq.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>data/mastDownload/HST/le3a01010/le3a01010_jit.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/le4s04d7q/le4s04d7j_jif.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/le9i4d020/le9i4d020_x1dsum.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/leimacm3q/leimacm3q_rawtag_a.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/leimacm3q/leimacm3q_rawtag_b.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/leimacm3q/leimacm3q_x1d.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/lekcl2sdq/lekcl2sdq_rawacq.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/lekcl2seq/lekcl2seq_rawacq.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/leo906g4q/leo906g4q_rawacq.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>data/mastDownload/HST/leo906g6q/leo906g6q_rawacq.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
</table></div></div></div>
</div>
<p>The function, <code class="docutils literal notranslate"><span class="pre">Observations.download_products</span></code> creates the nested directories <code class="docutils literal notranslate"><span class="pre">./data/mastDownload/HST/&lt;ROOTNAME&gt;</span></code>. Run the next cell to move all files from that path to <code class="docutils literal notranslate"><span class="pre">./data</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mast_path</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;mastDownload/HST/&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">obs_id_path</span> <span class="ow">in</span> <span class="n">mast_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">obs_id_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*fits&quot;</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="n">datapath</span> <span class="o">/</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">mast_path</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id = exptime></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="inspecting-the-exposure-time">
<h1>1. Inspecting the Exposure Time<a class="headerlink" href="#inspecting-the-exposure-time" title="Permalink to this heading">#</a></h1>
<p>The actual exposure time can indicate issues that may have happened during the observations. If the shutter is closed, then the exposure time will be zero seconds. Additionally, if the actual exposure time is <code class="docutils literal notranslate"><span class="pre">&lt;80%</span></code> of the planned exposure time, then that is another indicator that there may have been an issue during your observation (see <a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/cos/documentation/instrument-science-reports-isrs/_documents/ISR2024-01.pdf">COS ISR 2024-01</a>).</p>
<p>We will define a function below that can give some brief diagnostic information about the exposure time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">print_exposure_summary</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Print a summary of the observation, including actual/planned exptime.</span>
<span class="sd">    ----------</span>
<span class="sd">    Input: </span>
<span class="sd">    str or Path file : Path to the RAWTAG file</span>
<span class="sd">    ----------</span>
<span class="sd">    Output:</span>
<span class="sd">    Printed exposure summary.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>

        <span class="n">head0</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="n">head1</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;EXPOSURE SUMMARY FOR </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;FILENAME&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Grating: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;OPT_ELEM&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cenwave: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;CENWAVE&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FPPOS: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;FPPOS&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lifetime Position: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;LIFE_ADJ&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Detector: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;DETECTOR&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Aperture: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;APERTURE&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Target Name: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;TARGNAME&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Target Description: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;TARDESCR&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Extended?: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;EXTENDED&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">head0</span><span class="p">[</span><span class="s2">&quot;MTFLAG&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moving Target?: F&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Moving Target?: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;MTFLAG&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Visit: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;OBSET_ID&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ASN ID: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;ASN_ID&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------------&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Actual Exptime: </span><span class="si">{</span><span class="n">head1</span><span class="p">[</span><span class="s2">&quot;EXPTIME&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Planned Exptime: </span><span class="si">{</span><span class="n">head1</span><span class="p">[</span><span class="s2">&quot;PLANTIME&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exposure Flag: </span><span class="si">{</span><span class="n">head1</span><span class="p">[</span><span class="s2">&quot;EXPFLAG&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Shutter: </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;SHUTTER&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Fine guiding lock: </span><span class="si">{</span><span class="n">head1</span><span class="p">[</span><span class="s2">&quot;FGSLOCK&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===============&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You will want to pay attention to the actual exposure time (<code class="docutils literal notranslate"><span class="pre">EXPTIME</span></code> in the secondary header) and the planned exposure time (<code class="docutils literal notranslate"><span class="pre">PLANTIME</span></code>, also in the secondary header). If the actual exposure time is less than <code class="docutils literal notranslate"><span class="pre">80%</span></code> of the planned exposure time, then there was likely an issue with your observations and you may qualify for a repeated observation.</p>
<p>Additional header keywords in the <code class="docutils literal notranslate"><span class="pre">RAWTAG</span></code> or <code class="docutils literal notranslate"><span class="pre">X1D</span></code> files to look for are the exposure flag (<code class="docutils literal notranslate"><span class="pre">EXPFLAG</span></code>, secondary header) which should be <code class="docutils literal notranslate"><span class="pre">NORMAL</span></code>, the shutter status (<code class="docutils literal notranslate"><span class="pre">SHUTTER</span></code> in the primary header) which should be <code class="docutils literal notranslate"><span class="pre">OPEN</span></code>, and the fine-guiding lock keyword (<code class="docutils literal notranslate"><span class="pre">FGSLOCK</span></code> in the secondary header – more information is in the jitter section of this notebook) which should ideally be <code class="docutils literal notranslate"><span class="pre">FINE</span></code> (meaning the guide-star tracking was locked).</p>
<p>Let’s examine the header of a successful exposure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">successful_raw_a</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;ldi707tcq_rawtag_a.fits&quot;</span>
<span class="n">successful_raw_b</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;ldi707tcq_rawtag_b.fits&quot;</span>
<span class="n">successful_x1d</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;ldi707tcq_x1d.fits&quot;</span>

<span class="n">print_exposure_summary</span><span class="p">(</span><span class="n">successful_raw_a</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EXPOSURE SUMMARY FOR ldi707tcq_rawtag_a.fits:
Grating: G130M
Cenwave: 1291
FPPOS: 4
Lifetime Position: 4
Detector: FUV
Aperture: PSA
Target Name: KNOT-A
Target Description: EXT-CLUSTER;EMISSION LINE NEBULA;MULTIPLE NUCLEI;NUCLEUS;STAR FO
Extended?: YES
Moving Target?: F
Visit: 07
ASN ID: LDI707030
---------------
Actual Exptime: 505.0
Planned Exptime: 505.0
Exposure Flag: NORMAL
Shutter: Open
Fine guiding lock: FINE
===============
</pre></div>
</div>
</div>
</div>
<p>We can see that the actual and planned exposure times are the same, the shutter is open, and there weren’t any apparent issues with guide-star tracking. Let’s plot the data below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">successful_x1d</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;FLUX&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="c1"># Plotting flux vs wavelength on top row</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span>
              <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
              <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ \AA^{-1}$]&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Flux vs Wavelength&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Flux vs Wavelength, ZOOMED&quot;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6e-13</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="c1"># Plotting the counts on the detector for bottom row</span>
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">([</span><span class="n">successful_raw_a</span><span class="p">,</span> <span class="n">successful_raw_b</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;RAWX&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;RAWY&quot;</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span>
        <span class="p">)</span>

    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;RAWX&quot;</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;RAWY&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;RAWY vs RAWX, FUVA&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;RAWY vs RAWX, FUVB&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Successful Exposure, </span><span class="si">{</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">successful_x1d</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ROOTNAME&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/4742315bee4f65b9aa9d7fdc7b0958abc2e53d3a960a2343b4cd58e1e8daefda.png" src="../../../_images/4742315bee4f65b9aa9d7fdc7b0958abc2e53d3a960a2343b4cd58e1e8daefda.png" />
</div>
</div>
<p>We can clearly see the spectrum and counts landing on both segments of the detectors.</p>
<p>We will plot another exposure in this visit that failed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">failed_raw_a</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;leimacm3q_rawtag_a.fits&quot;</span>
<span class="n">failed_raw_b</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;leimacm3q_rawtag_b.fits&quot;</span>
<span class="n">failed_x1d</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;leimacm3q_x1d.fits&quot;</span>

<span class="n">print_exposure_summary</span><span class="p">(</span><span class="n">failed_raw_a</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EXPOSURE SUMMARY FOR leimacm3q_rawtag_a.fits:
Grating: G130M
Cenwave: 1291
FPPOS: 4
Lifetime Position: 4
Detector: FUV
Aperture: PSA
Target Name: SZ66
Target Description: STAR;T TAURI STAR;PRE-MAIN SEQUENCE STAR
Extended?: NO
Moving Target?: F
Visit: AC
ASN ID: LEIMAC010
---------------
Actual Exptime: 0.0
Planned Exptime: 2471.0
Exposure Flag: NO DATA
Shutter: Closed
Fine guiding lock: FINE
===============
</pre></div>
</div>
</div>
</div>
<p>We can see that the actual exposure time is zero seconds, the shutter was closed, and the exposure flag has the value <code class="docutils literal notranslate"><span class="pre">NO</span> <span class="pre">DATA</span></code>. We will try to plot the data below, but observations with exposure times of zero cannot carry any actual information, so we will see blank plots:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">failed_x1d</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;FLUX&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="c1"># Plotting flux vs wavelength on top row</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span>
              <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
              <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ \AA^{-1}$]&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Flux vs Wavelength&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Flux vs Wavelength, ZOOMED&quot;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5e-14</span><span class="p">)</span>

<span class="c1"># Plotting the counts on the detector for bottom row</span>
<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">failed_raw_a</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;RAWX&quot;</span><span class="p">],</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;RAWY&quot;</span><span class="p">],</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span>
    <span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="c1"># Plotting the counts on the detector for bottom row</span>
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">([</span><span class="n">failed_raw_a</span><span class="p">,</span> <span class="n">failed_raw_b</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;RAWX&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;RAWY&quot;</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span>
        <span class="p">)</span>

    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;RAWX&quot;</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;RAWY&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;RAWY vs RAWX, FUVA&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;RAWY vs RAWX, FUVB&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed Exposure, </span><span class="si">{</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">failed_x1d</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ROOTNAME&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/b20575bad1f18961dd20202163a38fa18ccce6136e353cf30df58768cb5a8bff.png" src="../../../_images/b20575bad1f18961dd20202163a38fa18ccce6136e353cf30df58768cb5a8bff.png" />
</div>
</div>
<p>As expected, there is no data to plot.</p>
<p><a id = snr></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="reviewing-the-signal-to-noise-ratio">
<h1>2. Reviewing the Signal-to-Noise Ratio<a class="headerlink" href="#reviewing-the-signal-to-noise-ratio" title="Permalink to this heading">#</a></h1>
<p>You will want to review the <code class="docutils literal notranslate"><span class="pre">X1DSUM</span></code> and constituent <code class="docutils literal notranslate"><span class="pre">X1D</span></code> files for your observation to see if any of the <code class="docutils literal notranslate"><span class="pre">X1D</span></code> files have dramatically lower (or zero) counts compared to the other <code class="docutils literal notranslate"><span class="pre">X1D</span></code> files. If the signal-to-noise ratio (SNR) of your <code class="docutils literal notranslate"><span class="pre">X1DSUM</span></code> file is sufficient for your science even with the problematic <code class="docutils literal notranslate"><span class="pre">X1D</span></code>, the COS team recommends that you file a <a class="reference external" href="https://www.stsci.edu/hst/observing/post-observation/reporting-problems">Hubble Observation Problem Report</a> (HOPR) and note that you are not requesting a repeat of the observation. This is so the observation is flagged in MAST for potential future investigators.</p>
<p>COS is a photon-counting instrument, so SNR calculations can be simplified compared to other instruments. Information about calculating the SNR of COS data can be found in <a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-7-exposure-time-calculator-etc/7-3-sensitivity-count-rate-and-signal-to-noise">Chapter 7.3</a> of the COS Instrument Handbook. The SNR is directly proportional to the square-root of the exposure time. In the COS notebook on <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/ViewData/ViewData.ipynb">Viewing COS Data</a>, we use a simplified equation for the SNR:</p>
<div class="math notranslate nohighlight">
\[\dfrac{Signal}{Noise} = \sqrt{C \times t} = \sqrt{Gross\ Counts}\]</div>
<p>This equation is a simplification, and may not be ideal for all datasets. We will plot the SNR for a good observation, and an observation with failed exposures. We will use the <code class="docutils literal notranslate"><span class="pre">cos_functions.py</span></code> file from the <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/ViewData/ViewData.ipynb">Viewing COS Data Notebook</a> to bin the data to a given resolution element (also known as <em>resel</em>).</p>
<p>We will begin by plotting an example of an <code class="docutils literal notranslate"><span class="pre">X1DSUM</span></code> and its constituent <code class="docutils literal notranslate"><span class="pre">X1D</span></code> files with no issues in any of the exposures:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_snr</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plot the SNR of the X1D files and the X1DSUM.</span>
<span class="sd">    SNR is calculated using simplified equation:</span>
<span class="sd">        SNR = sqrt(GCOUNTS)</span>
<span class="sd">    ----------</span>
<span class="sd">    Input:</span>
<span class="sd">    [str] filelist : A list of the x1d/x1dsum filepaths for an observation</span>
<span class="sd">    str quality : Is this a good or bad observation? Just used in title.</span>
<span class="sd">    ----------</span>
<span class="sd">    Output:</span>
<span class="sd">    SNR is plotted.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filelist</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;x1dsum&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">exptime</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;EXPTIME&quot;</span><span class="p">]</span>
                <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;X1DSUM - </span><span class="si">{</span><span class="n">exptime</span><span class="si">}</span><span class="s2"> sec&quot;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">fppos</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;FPPOS&quot;</span><span class="p">]</span>
                <span class="n">exptime</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;EXPTIME&quot;</span><span class="p">]</span>
                <span class="n">rootname</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;ROOTNAME&quot;</span><span class="p">]</span>

                <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rootname</span><span class="si">}</span><span class="s2">, FPPOS </span><span class="si">{</span><span class="n">fppos</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">exptime</span><span class="si">}</span><span class="s2"> sec&quot;</span>

        <span class="n">tab</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">wavelength</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        
        <span class="n">snr_est</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">estimate_snr</span><span class="p">(</span>
            <span class="n">tab</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">bin_data_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">snr_est</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">snr_est</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> 
                 <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">snr_est</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">snr_est</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                 <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                 <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">quality</span> <span class="o">==</span> <span class="s2">&quot;Bad&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">wavelength</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">wavelength</span><span class="p">),</span>
                   <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                   <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Required SNR from Phase II&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;SNR&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SNR vs Wavelength, </span><span class="si">{</span><span class="n">quality</span><span class="si">}</span><span class="s2"> Observation&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filelist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">datapath</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*lda920*&quot;</span><span class="p">)]</span>
<span class="n">plot_snr</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="s2">&quot;Good&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>function `bin_by_resel` is binning by 6
function `bin_by_resel` is binning by 6
function `bin_by_resel` is binning by 6
function `bin_by_resel` is binning by 6
function `bin_by_resel` is binning by 6
</pre></div>
</div>
<img alt="../../../_images/911f70f6fb432ab4e3b98829a7a266638f94801f780f46e1654ec2d314f3a141.png" src="../../../_images/911f70f6fb432ab4e3b98829a7a266638f94801f780f46e1654ec2d314f3a141.png" />
</div>
</div>
<p>The SNR of the combined <code class="docutils literal notranslate"><span class="pre">X1DSUM</span></code> file is roughly twice that of the individual <code class="docutils literal notranslate"><span class="pre">X1D</span></code> files. This is expected because the <code class="docutils literal notranslate"><span class="pre">X1DSUM</span></code> file is the coadd of the four <code class="docutils literal notranslate"><span class="pre">X1D</span></code> files, and SNR scales by <span class="math notranslate nohighlight">\(\sqrt{Counts} \propto \sqrt{Exposure\ Time}\)</span>. This program requires that the combined SNR be greater than <code class="docutils literal notranslate"><span class="pre">30</span></code>, and we can see that this requirement has been satisfied as the <code class="docutils literal notranslate"><span class="pre">X1DSUM</span></code> SNR is <code class="docutils literal notranslate"><span class="pre">~50</span></code>. There likely was not an issue with any of the individual exposures because the SNR of all <code class="docutils literal notranslate"><span class="pre">X1D</span></code> files is roughly the same.</p>
<p>Let’s plot a problematic observation now. This visit suffered from issues with the guide-star acquisition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filelist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">datapath</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*ldy305*&quot;</span><span class="p">)]</span>
<span class="n">plot_snr</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="s2">&quot;Bad&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>function `bin_by_resel` is binning by 6
function `bin_by_resel` is binning by 6
function `bin_by_resel` is binning by 6
function `bin_by_resel` is binning by 6
function `bin_by_resel` is binning by 6
</pre></div>
</div>
<img alt="../../../_images/753f676588d8c24a6f0644a245e708cf42439a0ac48d593015a5f171f6de6e84.png" src="../../../_images/753f676588d8c24a6f0644a245e708cf42439a0ac48d593015a5f171f6de6e84.png" />
</div>
</div>
<p>In their Phase II, the PI requires a SNR of at least <code class="docutils literal notranslate"><span class="pre">8</span></code> at <code class="docutils literal notranslate"><span class="pre">1250Å</span></code> to accurately do their science. We can see that the SNR of the <code class="docutils literal notranslate"><span class="pre">X1DSUM</span></code> is around <code class="docutils literal notranslate"><span class="pre">6</span></code>, therefore not meeting the science requirement. One of the observations taken at <code class="docutils literal notranslate"><span class="pre">FPPOS</span> <span class="pre">4</span></code> (<code class="docutils literal notranslate"><span class="pre">ldy305rkq</span></code>) has a SNR of almost zero, thus that observation does not add much signal (if any) to the SNR of the <code class="docutils literal notranslate"><span class="pre">X1DSUM</span></code> file.</p>
<p><a id = targacq></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="investigating-the-target-acquisition">
<h1>3. Investigating the Target Acquisition<a class="headerlink" href="#investigating-the-target-acquisition" title="Permalink to this heading">#</a></h1>
<p>Proper centering of the target within the COS aperture is essential for high-quality data. The COS team recommends for almost all cases that users utilize at least one form of target acquisitions to center the target; a target acquisition is required at least once per visit. More information on target acquisitions can be found in <a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-8-target-acquisitions/8-1-introduction">Chapter 8.1 of the COS Instrument Handbook</a>.</p>
<p>There are four different target acquisition modes for COS:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Type of Acquisition</p></th>
<th class="head"><p>Steps</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-8-target-acquisitions/8-3-acq-search-acquisition-mode"><code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code></a></p></td>
<td><p>The instrument moves in a spiral pattern to cover a grid from <code class="docutils literal notranslate"><span class="pre">2x2</span></code> steps up to <code class="docutils literal notranslate"><span class="pre">5x5</span></code>steps in size. A 2D array of counts at each step-point is constructed and the Flight Software calculates the centroid of the target using one of three different algorithms that use the flux weight.</p></td>
<td><p>A single <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code> provides a centering accuracy of <code class="docutils literal notranslate"><span class="pre">0.3&quot;</span></code> only <code class="docutils literal notranslate"><span class="pre">75%</span></code> of the time, so there may be additional acquisitions necessary depending on your flux and wavelength requirements.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-8-target-acquisitions/8-4-acq-image-acquisition-mode"><code class="docutils literal notranslate"><span class="pre">ACQ/IMAGE</span></code></a></p></td>
<td><p>The COS NUV detector takes an image of the target field, moves the telescope to center the target, and then takes an additional NUV image to confirm centering. This is the typical means of target acquisition for COS.</p></td>
<td><p>When using the PSA for the acquisition, users should aim for a <code class="docutils literal notranslate"><span class="pre">SNR</span> <span class="pre">&gt;</span> <span class="pre">20</span></code>; for BOA, this should be <code class="docutils literal notranslate"><span class="pre">SNR</span> <span class="pre">&gt;</span> <span class="pre">30</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-8-target-acquisitions/8-5-acq-peakxd-acquisition-mode"><code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code></a></p></td>
<td><p><strong>For NUV <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code>:</strong> The wavecal lamp is flashed and the spectrum is collapsed in the dispersion direction and the centroids of the spectrum and the target aperture are calculated. The target cross-dispersion (XD) location is assumed to be the median of the collapsed wavecal spectrum; the telescope is slewed in the XD direction to center the target to this location. <br><strong>For FUV <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code>:</strong> The FUV algorithm is similar to <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code> but instead of step-points in a spiral shape, the spacecraft is moved linearly in the XD direction. The centroid of the target is calculated using the array of counts for each step-point and the telescope is moved in the XD direction.</p></td>
<td><p>For both NUV and FUV <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code> acquisitions, the COS team recommends <code class="docutils literal notranslate"><span class="pre">SNR</span> <span class="pre">&gt;</span> <span class="pre">40</span></code> for all dispersed-light target acquisition exposures. <br><code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code> <em>always</em> precedes <code class="docutils literal notranslate"><span class="pre">ACQ/PEAK</span></code> acquisitions; one cannot happen without the other.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-8-target-acquisitions/8-6-acq-peakd-acquisition-mode"><code class="docutils literal notranslate"><span class="pre">ACQ/PEAK</span></code></a></p></td>
<td><p>This algorithm works similarly to <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code> but instead of steps in a spiral shape, the spacecraft is moved linearly in the along-dispersion (AD) direction. The centroid of the target is calculated using each step-point array and the telescope is moved to center the target in the aperture in the AD direction.</p></td>
<td><p>This acquisition always happens after <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code>.</p></td>
</tr>
</tbody>
</table>
</div>
<p>We can analyze the quality of the target acquisition for an observation by looking at the <code class="docutils literal notranslate"><span class="pre">RAWACQ</span></code> files. We will go through a few examples of evaluating the acquisition for some of these modes. More information about evaluating target acquisitions can be found in <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-5-cos-data-analysis/5-2-evaluating-target-acquisitions-and-guiding">Chapter 5.2</a> of the COS Data Handbook and in <a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/cos/documentation/instrument-science-reports-isrs/_documents/ISR2010_14.pdf">COS ISR 2010-14</a>.</p>
<p><a id = acq-search></a></p>
<section id="acq-search">
<h2>3.1 <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code><a class="headerlink" href="#acq-search" title="Permalink to this heading">#</a></h2>
<p>As mentioned above, using the <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code> method for centering moves the instrument <code class="docutils literal notranslate"><span class="pre">N</span></code> steps in a spiral pattern and calculates the centroid of the target by analyzing the counts at each of these steps (also known as a dwell-point). The <code class="docutils literal notranslate"><span class="pre">RAWACQ</span></code> file of an <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code> acquisition will contain a header and a binary data table with four different columns, and <code class="docutils literal notranslate"><span class="pre">N*N</span></code> number of rows, one for each dwell point. The columns <code class="docutils literal notranslate"><span class="pre">DISP_OFFSET</span></code> and <code class="docutils literal notranslate"><span class="pre">XDISP_OFFSET</span></code> correspond to the <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code> locations of the specific dwell point, in arcseconds, relative to the initial pointing position. The <code class="docutils literal notranslate"><span class="pre">COUNTS</span></code> column is the number of counts for that dwell point. To check if you have a successful <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code> acquisition, you can plot the counts of each dwell point and compare the dwell point with the maximum number of counts to the commanded slew position. The coordinates for the commanded slew position are in the header of the <code class="docutils literal notranslate"><span class="pre">RAWACQ</span></code> file, in the keywords <code class="docutils literal notranslate"><span class="pre">ACQSLEWX</span></code> and <code class="docutils literal notranslate"><span class="pre">ACQSLEWY</span></code>.</p>
<p>We will define a function to plot the <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code> table, and we will plot the table of a successful and unsuccessful acquisition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_acq_search</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plot the ACQ/SEARCH table, to help assess acquisition data quality.</span>
<span class="sd">    The commanded slew and the dwell point with highest counts should be </span>
<span class="sd">    the same for a successful acquisition.</span>
<span class="sd">    ----------</span>
<span class="sd">    Input: </span>
<span class="sd">    str or Path file : Path to the ACQ/SEARCH exposure.</span>
<span class="sd">    ----------</span>
<span class="sd">    Output:</span>
<span class="sd">    Plot with counts at each dwell point for the exposure.</span>
<span class="sd">    Commanded slew point is also plotted.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Reading in the file&#39;s data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="c1"># The unique dwell points in DISP/XDISP grid</span>
    <span class="n">disp_unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;DISP_OFFSET&quot;</span><span class="p">])</span>
    <span class="n">xdisp_unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;XDISP_OFFSET&quot;</span><span class="p">])</span>

    <span class="c1"># Empty table for dwell points&#39; counts</span>
    <span class="n">dwell_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">disp_unique</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdisp_unique</span><span class="p">)))</span>

    <span class="c1"># Filling the table with count values</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

        <span class="c1"># Getting the index for the grid</span>
        <span class="n">i_disp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">disp_unique</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;DISP_OFFSET&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">i_xdisp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xdisp_unique</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;XDISP_OFFSET&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Adding counts value to grid location</span>
        <span class="n">dwell_table</span><span class="p">[</span><span class="n">i_disp</span><span class="p">,</span> <span class="n">i_xdisp</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;COUNTS&quot;</span><span class="p">]</span>

    <span class="c1"># For the plot:</span>
    <span class="c1"># The &quot;bounding box&quot; of image, plus a little extra so nothing is cut off</span>
    <span class="c1"># In form (LEFT, RIGHT, </span>
    <span class="c1">#          BOTTOM, TOP)</span>
    <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">disp_unique</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">disp_unique</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> 
           <span class="n">xdisp_unique</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">xdisp_unique</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="c1"># Plotting the dwell point grid</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">dwell_table</span><span class="p">,</span>
        <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span>
        <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">extent</span><span class="o">=</span><span class="n">box</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>

    <span class="c1"># Getting coordinates for commanded slew</span>
    <span class="n">xslew</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;ACQSLEWX&quot;</span><span class="p">)</span>
    <span class="n">yslew</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;ACQSLEWY&quot;</span><span class="p">)</span>

    <span class="c1"># Putting commanded slew position on plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">xslew</span><span class="p">,</span>
        <span class="n">yslew</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Commanded Slew Location&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">250</span>
    <span class="p">)</span>

    <span class="c1"># Adding formatting</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;DISP_OFFSET (arcsec)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;XDISP_OFFSET (arcsec)&quot;</span><span class="p">)</span>

    <span class="n">scansize</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;SCANSIZE&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ACQ/SEARCH of </span><span class="si">{</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ROOTNAME&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">, SCAN-SIZE = </span><span class="si">{</span><span class="n">scansize</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
              <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot a successful target acquisition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_acq_search</span><span class="p">(</span><span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;ldc0c0k0q_rawacq.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/1e6f80cf6809b8fb59385695694a4877c4739cf3b51a54acc01b4dee87d2ad0c.png" src="../../../_images/1e6f80cf6809b8fb59385695694a4877c4739cf3b51a54acc01b4dee87d2ad0c.png" />
</div>
</div>
<p>As we can see above, the dwell point with the maximum counts is not at the edge of the scan area, and the commanded slew is consistent with the dwell point with the highest counts.</p>
<p>An example of a failed <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code> acquisition can be seen below. For this observation, there was an issue with the guide-star acquisition, and the COS shutter closed as a result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_acq_search</span><span class="p">(</span><span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;laaf2agfq_rawacq.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/f14efe8ee58efb4f1edc978cb9a2b441701e7c233f86a9abe71d9afbf9cbe12b.png" src="../../../_images/f14efe8ee58efb4f1edc978cb9a2b441701e7c233f86a9abe71d9afbf9cbe12b.png" />
</div>
</div>
<p>We can see in the plot above that the counts across the whole scan are zero, which is expected since the shutter was closed for the acquisition.</p>
<p><a id = acq-image></a></p>
</section>
<section id="acq-image">
<h2>3.2 <code class="docutils literal notranslate"><span class="pre">ACQ/IMAGE</span></code><a class="headerlink" href="#acq-image" title="Permalink to this heading">#</a></h2>
<p>For an <code class="docutils literal notranslate"><span class="pre">ACQ/IMAGE</span></code> acquisition, two images are taken with the NUV detector. The first one is taken after the initial HST pointing. The flight software calculates the movement needed to center the object to the center of the aperture, centers the object, and then takes a confirmation image. The initial and confirmation images can be found in the <code class="docutils literal notranslate"><span class="pre">ACQ/IMAGE</span></code> <code class="docutils literal notranslate"><span class="pre">RAWACQ</span></code> file. There are a total of six images (and one primary header) in the <code class="docutils literal notranslate"><span class="pre">FITS</span></code> file. Three for the initial image (one is the image, another is <code class="docutils literal notranslate"><span class="pre">ERR</span></code> and the third is <code class="docutils literal notranslate"><span class="pre">DQ</span></code> flagged data), and three for the confirmation image (<code class="docutils literal notranslate"><span class="pre">ERR</span></code> and <code class="docutils literal notranslate"><span class="pre">DQ</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_acq_image</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plot the initial and confirmation acquisition image of an ACQ/IMAGE _rawacq</span>
<span class="sd">    file. The expected and measured centroids of the target are also plotted.</span>
<span class="sd">    ----------</span>
<span class="sd">    Input:</span>
<span class="sd">    str or Path peakd : Path to the ACQ/IMAGE exposure.</span>
<span class="sd">    ----------</span>
<span class="sd">    Output:</span>
<span class="sd">    Initial and confirmation image are plotted with a colorbar and expected/measured centroids.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">confirm</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exposure time for initial image: </span><span class="si">{</span><span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;EXPTIME&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exposure time for confirmation image: </span><span class="si">{</span><span class="n">hdul</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;EXPTIME&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>

        <span class="c1"># Plotting the initial image</span>
        <span class="n">initial_im</span> <span class="o">=</span> <span class="n">initial</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> 
                                    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                    <span class="n">vmax</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> 
                                    <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

        <span class="n">initial</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">header</span><span class="p">[</span><span class="s2">&quot;ACQPREFX&quot;</span><span class="p">],</span>
            <span class="n">header</span><span class="p">[</span><span class="s2">&quot;ACQPREFY&quot;</span><span class="p">],</span>
            <span class="s2">&quot;*&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Desired Centroid&quot;</span><span class="p">,</span>
            <span class="n">ms</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
        <span class="p">)</span>

        <span class="n">initial</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">header</span><span class="p">[</span><span class="s2">&quot;ACQCENTX&quot;</span><span class="p">],</span>
            <span class="n">header</span><span class="p">[</span><span class="s2">&quot;ACQCENTY&quot;</span><span class="p">],</span>
            <span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Initial Centroid&quot;</span><span class="p">,</span>
            <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span>
        <span class="p">)</span>

        <span class="n">conf_im</span> <span class="o">=</span> <span class="n">confirm</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hdul</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                 <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                 <span class="n">vmax</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> 
                                 <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

        <span class="n">confirm</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">header</span><span class="p">[</span><span class="s2">&quot;ACQCENTX&quot;</span><span class="p">],</span>
            <span class="n">header</span><span class="p">[</span><span class="s2">&quot;ACQCENTY&quot;</span><span class="p">],</span>
            <span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Measured Center&quot;</span><span class="p">,</span>
            <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span>
        <span class="p">)</span>

    <span class="n">initial</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Initial Acquisition Image&quot;</span><span class="p">)</span>
    <span class="n">confirm</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Confirmation Acquisition Image&quot;</span><span class="p">)</span>

    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Initial and Confirmation Image for </span><span class="si">{</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ROOTNAME&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">, ACQ/IMAGE&#39;</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">initial_im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">conf_im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>

    <span class="n">initial</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">confirm</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We will plot a successful <code class="docutils literal notranslate"><span class="pre">ACQ/IMAGE</span></code> acquisition; we will see the measured flight-software (FSW) centroid in the location of the area of the detector with the highest number of counts (which is the location of the target).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_acq_image</span><span class="p">(</span><span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;lbhx1cn4q_rawacq.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Exposure time for initial image: 76.0 seconds
Exposure time for confirmation image: 76.0 seconds
</pre></div>
</div>
<img alt="../../../_images/7da3c73bc35bd92a01874e36bec86fc47aa22b8f43d09ee956f51cc100807c0e.png" src="../../../_images/7da3c73bc35bd92a01874e36bec86fc47aa22b8f43d09ee956f51cc100807c0e.png" />
</div>
</div>
<p>We will also plot an example of a failed <code class="docutils literal notranslate"><span class="pre">ACQ/IMAGE</span></code> acquisition, where the COS shutter closed before the confirmation acquisition image was taken due to a guide-star acquisition failure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_acq_image</span><span class="p">(</span><span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;lbs304n1q_rawacq.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Exposure time for initial image: 252.0 seconds
Exposure time for confirmation image: 0.0 seconds
</pre></div>
</div>
<img alt="../../../_images/975f072126fd85203fee21da9f701b5f08f45cba578ad6cb3b9af825bbab67ff.png" src="../../../_images/975f072126fd85203fee21da9f701b5f08f45cba578ad6cb3b9af825bbab67ff.png" />
</div>
</div>
<p><a id = acq-peak></a></p>
</section>
<section id="acq-peakxd-acq-peakd">
<h2>3.3 <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code>, <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKD</span></code><a class="headerlink" href="#acq-peakxd-acq-peakd" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code> and <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKD</span></code> exposures can be taken after dispersed light acquisitions to further improve the centering of your target. The <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code> exposure is taken before the <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKD</span></code> exposure. We can check the quality of these acquisitions in a similar manner as to the <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code> example. Similarly to <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code> files, the <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKD</span></code> files have data for the dwell points and their respective counts in the <code class="docutils literal notranslate"><span class="pre">Ext</span> <span class="pre">1</span></code> header. In a successful exposure, the dwell point with the maximum number of counts is in the center of the scan and the slew offset header keyword (<code class="docutils literal notranslate"><span class="pre">ACQSLEWX</span></code>) is in this location as well.</p>
<p>We will define a function to plot a <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code>/<code class="docutils literal notranslate"><span class="pre">ACQ/PEAKD</span></code> exposure, and then plot an example of a successful exposure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_peakdxd</span><span class="p">(</span><span class="n">peakd</span><span class="p">,</span> <span class="n">peakxd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plot the ACQ/PEAKD and ACQ/PEAKXD tables, and mark the zero offset location.</span>
<span class="sd">    In a successful exposure, the dwell point with the max counts will be</span>
<span class="sd">    at an offset of 0.0. </span>

<span class="sd">    ** Note that the vmin and vmax (colorbar scale range) is hardcoded to aid in **</span>
<span class="sd">       visualization of the bad data&#39;s plot.</span>
<span class="sd">    ----------</span>
<span class="sd">    Input: </span>
<span class="sd">    str or Path peakd : Path to the ACQ/PEAKD exposure.</span>
<span class="sd">    str or Path peakxd : Path to the ACQ/PEAKXD exposure.</span>
<span class="sd">    ----------</span>
<span class="sd">    Output:</span>
<span class="sd">    Plot with counts at each dwell point for the exposures.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="c1"># First is the XD acq</span>
    <span class="n">peakxd_table</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">peakxd</span><span class="p">)</span>

    <span class="n">cxd</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">peakxd_table</span><span class="p">[</span><span class="s2">&quot;XDISP_OFFSET&quot;</span><span class="p">],</span>
        <span class="n">peakxd_table</span><span class="p">[</span><span class="s2">&quot;DWELL_POINT&quot;</span><span class="p">],</span>
        <span class="n">c</span><span class="o">=</span><span class="n">peakxd_table</span><span class="p">[</span><span class="s2">&quot;COUNTS&quot;</span><span class="p">],</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">2750</span>
    <span class="p">)</span>

    <span class="c1"># Second is the AD acq</span>
    <span class="n">peakd_table</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">peakd</span><span class="p">)</span>

    <span class="n">cd</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">peakd_table</span><span class="p">[</span><span class="s2">&quot;DISP_OFFSET&quot;</span><span class="p">],</span>
        <span class="n">peakd_table</span><span class="p">[</span><span class="s2">&quot;DWELL_POINT&quot;</span><span class="p">],</span>
        <span class="n">c</span><span class="o">=</span><span class="n">peakd_table</span><span class="p">[</span><span class="s2">&quot;COUNTS&quot;</span><span class="p">],</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">2750</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">subplot</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;XDISP_OFFSET&quot;</span><span class="p">,</span> <span class="s2">&quot;DISP_OFFSET&quot;</span><span class="p">]):</span>

        <span class="n">subplot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">column</span><span class="p">,</span>
                           <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">subplot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;DWELL POINT&quot;</span><span class="p">,</span>
                           <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

        <span class="n">subplot</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Zero Offset&quot;</span><span class="p">)</span>
        
        <span class="n">subplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center right&quot;</span><span class="p">)</span>

    <span class="n">cbxd</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cxd</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cbxd</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">,</span>
                   <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    
    <span class="n">cbd</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cbd</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">,</span>
                  <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PEAKXD for </span><span class="si">{</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">peakxd</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ROOTNAME&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PEAKD for </span><span class="si">{</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">peakd</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ROOTNAME&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now we will plot a successful <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKD</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code> acquisition using the respective <code class="docutils literal notranslate"><span class="pre">RAWACQ</span></code> files. Note how the dwell points with the highest number of counts are in the center for both acquisitions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peakd</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;leo906g6q_rawacq.fits&quot;</span>
<span class="n">peakxd</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;leo906g4q_rawacq.fits&quot;</span>
<span class="n">plot_peakdxd</span><span class="p">(</span><span class="n">peakd</span><span class="p">,</span> <span class="n">peakxd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/6532bdd5eb90044cee21a3f3d54c9a665dbf3f016503492b182e287951d02b1d.png" src="../../../_images/6532bdd5eb90044cee21a3f3d54c9a665dbf3f016503492b182e287951d02b1d.png" />
</div>
</div>
<p>And now we will plot an unsuccessful acquisition, where the shutter was closed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peakd</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;lekcl2seq_rawacq.fits&quot;</span>
<span class="n">peakxd</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;lekcl2sdq_rawacq.fits&quot;</span>
<span class="n">plot_peakdxd</span><span class="p">(</span><span class="n">peakd</span><span class="p">,</span> <span class="n">peakxd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/b5d5b11bbe816e119d270d9d2662abc36cede9404b4733f705d47552108d71b9.png" src="../../../_images/b5d5b11bbe816e119d270d9d2662abc36cede9404b4733f705d47552108d71b9.png" />
</div>
</div>
<p>Similar to the <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code> example, we can see that the counts across the entire scan are zero. Since the shutter was closed, there was an issue with the observation.</p>
<p><a id = wlscale></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="evaluating-the-wavelength-scale">
<h1>4. Evaluating the Wavelength Scale<a class="headerlink" href="#evaluating-the-wavelength-scale" title="Permalink to this heading">#</a></h1>
<p>If your target is not centered well in the aperture, then you can experience issues with the wavelength scale, i.e. there may be an offset in the dispersion direction. The minimum wavelength accuracy for each COS mode is listed in <a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-8-target-acquisitions/8-8-centering-accuracy-and-data-quality">Chapter 8.8</a> of the COS Instrument Handbook. If a large enough offset is apparent between the observed and expected line positions of your target, then you will want to check the target’s centering.</p>
<p>We will go through an example of an observation with a poor wavelength scale. This observation was part of the <a class="reference external" href="https://ullyses.stsci.edu/index.html">ULLYSES</a> project, and observed the <a class="reference external" href="https://en.wikipedia.org/wiki/T_Tauri_star">T-Tauri Star</a> <a class="reference external" href="http://simbad.cds.unistra.fr/simbad/sim-basic?Ident=V510+Ori&amp;submit=SIMBAD+search">V510-Ori</a>. We will calculate the radial velocity of the target using the <code class="docutils literal notranslate"><span class="pre">CIV</span></code> lines at <code class="docutils literal notranslate"><span class="pre">1548.19</span> <span class="pre">Å</span></code>.</p>
<p>To calculate the radial velocity, we will fit a curve to the <code class="docutils literal notranslate"><span class="pre">CIV</span></code> line of the <code class="docutils literal notranslate"><span class="pre">X1DSUM</span></code> <code class="docutils literal notranslate"><span class="pre">G160M</span></code> file, and compare the peak of this curve with the expected location of the <code class="docutils literal notranslate"><span class="pre">CIV</span></code> line. We will then use the equation below to calculate the radial velocity:</p>
<p><span class="math notranslate nohighlight">\( v_r = c \left( \frac{\lambda - \lambda_0}{\lambda_0} \right) \)</span></p>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( v_r \)</span> is the radial velocity,</p></li>
<li><p><span class="math notranslate nohighlight">\( c \)</span> is the speed of light (<span class="math notranslate nohighlight">\( \approx 2.99 * 10^5 \)</span> km/s),</p></li>
<li><p><span class="math notranslate nohighlight">\( \lambda \)</span> is the observed wavelength of the spectral line,</p></li>
<li><p><span class="math notranslate nohighlight">\( \lambda_0 \)</span> is the rest wavelength of the spectral line.</p></li>
</ul>
<p>We will first define a function that will fit a Gaussian to our emission line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fit_gaussian</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">stddev</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Fit a Gaussian to the data.</span>
<span class="sd">    Gaussian is defined as:</span>
<span class="sd">    f(x) = c + amplitude * np.exp(-(((wavelength - mean) / stddev)**2)/2)</span>
<span class="sd">    ----------</span>
<span class="sd">    Input:</span>
<span class="sd">    arr wavelength : Data of the independent variable (wl in our context)</span>
<span class="sd">    float amplitude : Amplitude of Gaussian. Represents the peak of the data</span>
<span class="sd">    float mean : Mean wl of Gaussian. Represents central wavelength of feature</span>
<span class="sd">    float stddev : Standard deviation of Gaussian. Represents function&#39;s width</span>
<span class="sd">    ----------</span>
<span class="sd">    Output:</span>
<span class="sd">    The value of flux at each wavelength using the fit.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># An estimate of the continuum flux value</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">1.1e-15</span>
    <span class="k">return</span> <span class="n">c</span> <span class="o">+</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(((</span><span class="n">wavelength</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">stddev</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will now use <code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code> <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code> to fit this function to the <code class="docutils literal notranslate"><span class="pre">CIV</span></code> line of the <code class="docutils literal notranslate"><span class="pre">X1DSUM</span></code>. We will do our fit between the wavelength range <code class="docutils literal notranslate"><span class="pre">1546</span> <span class="pre">-</span> <span class="pre">1550</span> <span class="pre">Å</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extracting the X1DSUM file&#39;s data</span>
<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;le9i4d020_x1dsum.fits&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
    <span class="n">wavelength</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FLUX&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="c1"># Getting the indicies within the wavelength range</span>
<span class="n">indicies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">wavelength</span> <span class="o">&gt;=</span> <span class="mi">1546</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wavelength</span> <span class="o">&lt;=</span> <span class="mi">1550</span><span class="p">))</span>

<span class="n">trimmed_flux</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="n">indicies</span><span class="p">]</span>
<span class="n">trimmed_wl</span> <span class="o">=</span> <span class="n">wavelength</span><span class="p">[</span><span class="n">indicies</span><span class="p">]</span>

<span class="c1"># We need to make an initial guess for the parameter values</span>
<span class="c1"># The array is in form [PEAK OF GAUSSIAN, CENTRAL WAVELENGTH, WIDTH OF LINE]</span>
<span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.2e-14</span><span class="p">,</span> <span class="mf">1547.6</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">]</span>

<span class="n">popt</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">fit_gaussian</span><span class="p">,</span>
                             <span class="n">trimmed_wl</span><span class="p">,</span>
                             <span class="n">trimmed_flux</span><span class="p">,</span>
                             <span class="n">p0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The CIV peak is fitted to be </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2"> Å&quot;</span><span class="p">)</span>

<span class="c1"># Plotting the emission feature and our fit</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plotting the actual data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">wavelength</span><span class="p">,</span>
    <span class="n">flux</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;X1DSUM&quot;</span>
<span class="p">)</span>

<span class="c1"># Plotting our fit</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">wavelength</span><span class="p">,</span>
    <span class="n">fit_gaussian</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Fit&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span>
<span class="p">)</span>

<span class="c1"># Adding vertical lines to show fitted &quot;peak&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model</span><span class="se">\&#39;</span><span class="s1">s Peak&#39;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dotted&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1546</span><span class="p">,</span> <span class="mi">1550</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ \AA^{-1}$]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;CIV Emission Line with Modeled Fit&quot;</span><span class="p">,</span>
          <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The CIV peak is fitted to be 1547.465 Å
</pre></div>
</div>
<img alt="../../../_images/9118557f79505964ddf2c2ca535aa7c41c295ec982329bf11b4730bfc24f9a25.png" src="../../../_images/9118557f79505964ddf2c2ca535aa7c41c295ec982329bf11b4730bfc24f9a25.png" />
</div>
</div>
<p>We will then use the equation defined earlier to calculate the radial velocity. The rest wavelength for <code class="docutils literal notranslate"><span class="pre">CIV</span></code> is <code class="docutils literal notranslate"><span class="pre">1548.19</span> <span class="pre">Å</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Speed of light (in km/s)</span>
<span class="n">c</span> <span class="o">=</span> <span class="mf">2.99e5</span>

<span class="c1"># Getting the observed wavelength of our HLSP</span>
<span class="n">observed_wavelength</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Rest wavelength of CIV</span>
<span class="n">rest_wavelength</span> <span class="o">=</span> <span class="mf">1548.19</span>

<span class="n">v_r</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="p">((</span><span class="n">observed_wavelength</span> <span class="o">-</span> <span class="n">rest_wavelength</span><span class="p">)</span> <span class="o">/</span> <span class="n">rest_wavelength</span><span class="p">)</span>
<span class="n">v_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">v_r</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The radial velocity of the target is </span><span class="si">{</span><span class="n">v_r</span><span class="si">}</span><span class="s2"> km/s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The radial velocity of the target is -140.11 km/s
</pre></div>
</div>
</div>
</div>
<p>The literature value of the radial velocity for this target is <a class="reference external" href="http://simbad.cds.unistra.fr/simbad/sim-basic?Ident=V510+Ori&amp;submit=SIMBAD+search"><code class="docutils literal notranslate"><span class="pre">~33.3</span> <span class="pre">km/s</span></code></a>. There is a <code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">150</span> <span class="pre">km/s</span></code> difference in the radial velocity, which is far above the minimum accuracy of <code class="docutils literal notranslate"><span class="pre">+/-</span> <span class="pre">15</span> <span class="pre">km/s</span></code>, indicating that there was likely an issue with the target centering during this visit. Since this dataset passed all other data quality checks, the ULLYSES team applied a manual shift which corrected the data.</p>
<p><em>Note: If your observation has a slight shift, and passes other data quality checks, then you can manually apply a shift to correct your data. Details of this are in <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-5-cos-data-analysis/5-3-working-with-extracted-spectra">Chapter 5.3.2</a> of the COS Data Handbook, and there is a tutorial in the <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/tree/main/notebooks/HASP">HASP notebook repository</a> as well.</em></p>
<p><a id = jitter></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="checking-the-jitter">
<h1>5. Checking the Jitter<a class="headerlink" href="#checking-the-jitter" title="Permalink to this heading">#</a></h1>
<p>Jitter is caused by spacecraft motion during the observation. This can be due to a variety of reasons, including micro-meteor impact or a day-night transition. The jitter files contain information about the performance of the Pointing Control System (PCS) and the Fine Guidance Sensors (FGS) during your observation; they are produced by the Engineering Data Processing System (EDPS), which is software that analyzes the HST spacecraft telemetry. There are two relevant jitter files that are produced: one is the <code class="docutils literal notranslate"><span class="pre">JIT</span></code> table, which is a table that contains 3-second average pointing data, and the <code class="docutils literal notranslate"><span class="pre">JIF</span></code> file, which is a 2D histogram of the <code class="docutils literal notranslate"><span class="pre">JIT</span></code> table. These files are produced for all COS science exposures (with the exception of acquisitions). For more information on jitter files, check out <a class="reference external" href="https://hst-docs.stsci.edu/hstdhb/5-observation-logs/5-1-observation-log-files">Chapter 5.1</a> of the HST Data Handbook.</p>
<p>We will walk through analyzing the <code class="docutils literal notranslate"><span class="pre">JIF</span></code> and <code class="docutils literal notranslate"><span class="pre">JIT</span></code> files for two different datasets: one dataset with a low amount of jitter and one with a high amount of jitter.</p>
<p><a id = jif_head></a></p>
<section id="inspecting-the-jif-headers-for-guiding-issues">
<h2>5.1 Inspecting the <code class="docutils literal notranslate"><span class="pre">JIF</span></code> Headers for Guiding Issues<a class="headerlink" href="#inspecting-the-jif-headers-for-guiding-issues" title="Permalink to this heading">#</a></h2>
<p>We can first take a look at the headers of the <code class="docutils literal notranslate"><span class="pre">JIF</span></code> file, which can provide us with information about the guide-star lock; this information is in the primary header, under the <code class="docutils literal notranslate"><span class="pre">Problem</span> <span class="pre">Flags</span> <span class="pre">and</span> <span class="pre">Warnings</span></code> section. Additionally, in the secondary header, there is information about the commanding guiding mode. There are three modes, <code class="docutils literal notranslate"><span class="pre">FINE</span> <span class="pre">LOCK</span></code>, <code class="docutils literal notranslate"><span class="pre">FINE</span> <span class="pre">LOCK/GYRO</span></code>, and <code class="docutils literal notranslate"><span class="pre">GYRO</span></code>. If there was a problem with the observation guiding, then the secondary header keywords, <code class="docutils literal notranslate"><span class="pre">GUIDECMD</span></code> and <code class="docutils literal notranslate"><span class="pre">GUIDEACT</span></code>, will not match. These keywords are the “command guiding mode” and the “actual guiding mode”, respectively. If the <code class="docutils literal notranslate"><span class="pre">GUIDEACT</span></code> keyword value is <code class="docutils literal notranslate"><span class="pre">FINE</span> <span class="pre">LOCK/GYRO</span></code>, or <code class="docutils literal notranslate"><span class="pre">GYRO</span></code>, then there may have been a problem with the guide-star acquisition and the target may have moved out of the aperture. More information about analyzing these logs is in <a class="reference external" href="https://hst-docs.stsci.edu/hstdhb/5-observation-logs/5-2-using-observation-logs">Chapter 5.2</a> of the HST Data Handbook.</p>
<p>Below, we will define a function to quickly read the header keywords from the <code class="docutils literal notranslate"><span class="pre">JIF</span></code> file and determine if there may have been an issue with the guiding. Please note that you will still need to check the jitter table (which we will do later), regardless of any <code class="docutils literal notranslate"><span class="pre">Problem</span> <span class="pre">Flags</span> <span class="pre">and</span> <span class="pre">Warnings</span></code> that are printed because the information we will print is going to be related to guiding rather than indicative of the actual jitter of the instrument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">print_jif_headinfo</span><span class="p">(</span><span class="n">jiffile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Print important keywords from the JIF file for an observation. </span>
<span class="sd">    ----------</span>
<span class="sd">    Input: </span>
<span class="sd">    Pathlib.path jiffile : Path to the JIF file for your observation</span>
<span class="sd">    ----------</span>
<span class="sd">    Output:</span>
<span class="sd">    Will print out relevant JIF header information, as well as print if there are</span>
<span class="sd">    any problem flags or warnings.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># A dict of relevant keywords and their vals during a good obs</span>
    <span class="n">jif_keys</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;T_GDACT&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;T_ACTGSP&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;T_GSFAIL&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;T_SGSTAR&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;T_TLMPRB&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;T_NOTLM&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;T_NTMGAP&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;T_TMGAP&quot;</span><span class="p">:</span> <span class="mf">0.000000</span><span class="p">,</span>
        <span class="s2">&quot;T_GSGAP&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;T_SLEWNG&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;T_TDFDWN&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}</span>

    <span class="c1"># Opening the JIF file to see header info</span>
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">jiffile</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>

        <span class="n">head0</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="n">head1</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>

        <span class="c1"># An empty list of flags, will contain any deviations from jif_keys</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Printing JIF information for </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">jif_keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="n">act_val</span> <span class="o">=</span> <span class="n">head0</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">head0</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Append if there&#39;s a mismatch between the normal val and obs val</span>
            <span class="k">if</span> <span class="n">act_val</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">head0</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Guidings:&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;GUIDECMD = </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;GUIDECMD&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="n">head0</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s2">&quot;GUIDECMD&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;GUIDEACT = </span><span class="si">{</span><span class="n">head1</span><span class="p">[</span><span class="s2">&quot;GUIDEACT&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="n">head1</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s2">&quot;GUIDEACT&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">head0</span><span class="p">[</span><span class="s2">&quot;GUIDECMD&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">head1</span><span class="p">[</span><span class="s2">&quot;GUIDEACT&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">===== Warnings from headers: =====</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">head0</span><span class="p">[</span><span class="s2">&quot;GUIDECMD&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">head1</span><span class="p">[</span><span class="s2">&quot;GUIDEACT&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mismatch between GUIDECMD and GUIDEACT; </span><span class="se">\</span>
<span class="s2">                  GUIDECMD = </span><span class="si">{</span><span class="n">head0</span><span class="p">[</span><span class="s1">&#39;GUIDECMD&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> and GUIDEACT = </span><span class="si">{</span><span class="n">head1</span><span class="p">[</span><span class="s1">&#39;GUIDEACT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s print out the <code class="docutils literal notranslate"><span class="pre">JIF</span></code> header information for a dataset with low jitter. We will see that there are no warnings from the header keyword values, indicating that there was no issue with the guiding during the observation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_jif_headinfo</span><span class="p">(</span><span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;le2t09010_jif.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Printing JIF information for le2t09010_jif.fits:

T_GDACT = True / Actual guiding mode same for all exposures
T_ACTGSP = True / Actual Guide Star Separation same in all exps.
T_GSFAIL = False / Guide star acquisition failure in any exposure
T_SGSTAR = False / Failed to single star fine lock
T_TLMPRB = False / problem with the engineering telemetry in any e
T_NOTLM = False / no engineering telemetry available in all exps.
T_NTMGAP = 0 / total number of telemetry gaps in association
T_TMGAP = 0.0 / total duration of missing telemetry in asn. (s)
T_GSGAP = False / missing telemetry during GS acq. in any exp.
T_SLEWNG = False / Slewing occurred during observations
T_TDFDWN = False / Take Data Flag NOT on throughout observations

Guidings:
GUIDECMD = FINE LOCK / Commanded Guiding mode
GUIDEACT = FINE LOCK / Actual Guiding mode at end of GS acquisition
</pre></div>
</div>
</div>
</div>
<p>We will now print the header information for the failed example observation used in the <code class="docutils literal notranslate"><span class="pre">ACQ/IMAGE</span></code> section, which suffered from guide-star issues during the target acquisition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_jif_headinfo</span><span class="p">(</span><span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;le4s04d7j_jif.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Printing JIF information for le4s04d7j_jif.fits:

T_GDACT = True / Actual guiding mode same for all exposures
T_ACTGSP = True / Actual Guide Star Separation same in all exps.
T_GSFAIL = True / Guide star acquisition failure in any exposure
T_SGSTAR = False / Failed to single star fine lock
T_TLMPRB = False / problem with the engineering telemetry in any e
T_NOTLM = False / no engineering telemetry available in all exps.
T_NTMGAP = 0 / total number of telemetry gaps in association
T_TMGAP = 0.0 / total duration of missing telemetry in asn. (s)
T_GSGAP = False / missing telemetry during GS acq. in any exp.
T_SLEWNG = False / Slewing occurred during observations
T_TDFDWN = True / Take Data Flag NOT on throughout observations

Guidings:
GUIDECMD = FINE LOCK / Commanded Guiding mode
GUIDEACT = GYRO / Actual Guiding mode at end of GS acquisition

===== Warnings from headers: =====

Mismatch between GUIDECMD and GUIDEACT;                   GUIDECMD = FINE LOCK and GUIDEACT = GYRO
T_GSFAIL = True / Guide star acquisition failure in any exposure
T_TDFDWN = True / Take Data Flag NOT on throughout observations
</pre></div>
</div>
</div>
</div>
<p>Since the header keywords <code class="docutils literal notranslate"><span class="pre">GUIDECMD</span></code> and <code class="docutils literal notranslate"><span class="pre">GUIDEACT</span></code> are not identical, there was slewing during the observation, and the <code class="docutils literal notranslate"><span class="pre">TDFFLAG</span></code> went up during the observation, we can conclude that there was an issue with the guiding for this observation.</p>
<p><a id = jit_tab></a></p>
</section>
<section id="inspecting-the-jit-table">
<h2>5.2 Inspecting the <code class="docutils literal notranslate"><span class="pre">JIT</span></code> Table<a class="headerlink" href="#inspecting-the-jit-table" title="Permalink to this heading">#</a></h2>
<p>As mentioned earlier, the <code class="docutils literal notranslate"><span class="pre">JIT</span></code> table contains the pointing data for science observations. For evaluating our jitter, we will look specifically at the <code class="docutils literal notranslate"><span class="pre">SI_V2_AVG</span></code> and <code class="docutils literal notranslate"><span class="pre">SI_V3_AVG</span></code> values, which are the mean jitter for a 3-second average at <code class="docutils literal notranslate"><span class="pre">V2</span></code> and <code class="docutils literal notranslate"><span class="pre">V3</span></code> (two of the HST axes), respectively. The other columns of the <code class="docutils literal notranslate"><span class="pre">JIT</span></code> table can be found in <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-2-cos-data-files/2-4-cos-data-products#id-2.4COSDataProducts-Table2.12">Table 2.12</a> of the COS Data Handbook.</p>
<p>We will define a function to make a plot of the <code class="docutils literal notranslate"><span class="pre">SI_V2_AVG</span></code> and <code class="docutils literal notranslate"><span class="pre">SI_V3_AVG</span></code> and then plot a high and low jitter example datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_jitter</span><span class="p">(</span><span class="n">jit_file</span><span class="p">,</span> <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">rss</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">25</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Pathlib.path jit_file : Path to the jitter file</span>
<span class="sd">    str severity : How bad is the jitter? Just used in plot title</span>
<span class="sd">    bool rss : True if you want to return the RSS. Will not result in plot</span>
<span class="sd">    int n_sigma : How many stdevs do you want to visualize?</span>
<span class="sd">    int n_bins : Number of bins for the 2D histogram</span>
<span class="sd">    ----------</span>
<span class="sd">    Output:</span>
<span class="sd">    float v2_stdev : Stdev of SI_V2_AVG</span>
<span class="sd">    float v3_stdev : Stdev of SI_V3_AVG</span>
<span class="sd">    A 2D histogram of the SI_V2_AVG and SI_V3_AVG with an </span>
<span class="sd">    elliptical contour with spread of n_sigma.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">jit_file</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">v2_avg</span><span class="p">,</span> <span class="n">v3_avg</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;SI_V2_AVG&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;SI_V3_AVG&quot;</span><span class="p">]</span>

    <span class="n">v2_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">v2_avg</span><span class="p">)</span>
    <span class="n">v3_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">v3_avg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rss</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">v2_stdev</span><span class="p">,</span> <span class="n">v3_stdev</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">v2_avg</span><span class="p">,</span> 
        <span class="n">y</span><span class="o">=</span><span class="n">v3_avg</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span>
    <span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">ellipse_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v2_avg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v3_avg</span><span class="p">))</span>

    <span class="n">ellipse</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">ellipse_center</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">n_sigma</span><span class="o">*</span><span class="n">v2_stdev</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">n_sigma</span><span class="o">*</span><span class="n">v3_stdev</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span>
    <span class="p">)</span>

    <span class="n">label_x</span> <span class="o">=</span> <span class="n">ellipse_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">n_sigma</span> <span class="o">*</span> <span class="n">v2_stdev</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">label_y</span> <span class="o">=</span> <span class="n">ellipse_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">n_sigma</span> <span class="o">*</span> <span class="n">v3_stdev</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">label_x</span><span class="p">,</span> <span class="n">label_y</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_sigma</span><span class="si">}</span><span class="s1"> sigma contour&#39;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                      <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2D Histogram of 3 sec Mean Jitter, </span><span class="si">{</span><span class="n">severity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
              <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;SI_V2_AVG [arcsec], $\sigma$=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">v2_stdev</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;SI_V3_AVG [arcsec], $\sigma$=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">v3_stdev</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the observation with a low amount of jitter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low_jit</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;le2t09010_jit.fits&quot;</span>
<span class="n">plot_jitter</span><span class="p">(</span><span class="n">low_jit</span><span class="p">,</span> <span class="s2">&quot;Low Amount of Jitter&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/c40a1aadcb5edd9bca91c51ee9c43d2138f8a4a2a67b34b70dd0470241473938.png" src="../../../_images/c40a1aadcb5edd9bca91c51ee9c43d2138f8a4a2a67b34b70dd0470241473938.png" />
</div>
</div>
<p>The plot above is a 2D histogram of the mean jitter at <code class="docutils literal notranslate"><span class="pre">V2</span></code> and <code class="docutils literal notranslate"><span class="pre">V3</span></code>. An ellipse is plotted on top of the histogram to visualize two standard deviations from the mean contour. On the <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code> axes is the standard deviation value for <code class="docutils literal notranslate"><span class="pre">SI_V2_AVG</span></code> and <code class="docutils literal notranslate"><span class="pre">SI_V3_AVG</span></code>. Ideally, since the throughput of the target’s flux begins to decrease around <code class="docutils literal notranslate"><span class="pre">0.4&quot;</span></code> off the center of the aperture (see <a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-8-target-acquisitions/8-8-centering-accuracy-and-data-quality">Chapter 8.8</a> of the COS Instrument Handbook), the Root-Sum-Square (RSS) of the data should be less than <code class="docutils literal notranslate"><span class="pre">0.4&quot;</span></code>. The RSS is a statistical measure of uncertainty to combine multiple measurements of uncertainty. It can be calculated with the equation:</p>
<p><span class="math notranslate nohighlight">\( \text{RSS} = \sqrt{\sigma_X^2 + \sigma_Y^2} \)</span></p>
<p>Let’s calculate the RSS of the low jitter dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v2_stdev</span><span class="p">,</span> <span class="n">v3_stdev</span> <span class="o">=</span> <span class="n">plot_jitter</span><span class="p">(</span><span class="n">low_jit</span><span class="p">,</span> <span class="n">rss</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">rss_low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v2_stdev</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v3_stdev</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Root-Sum-Square of the low jitter dataset is </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rss_low</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The Root-Sum-Square of the low jitter dataset is 0.0020000000949949026&quot;
</pre></div>
</div>
</div>
</div>
<p>As we can see, the RSS of the low jitter dataset was <code class="docutils literal notranslate"><span class="pre">0.002&quot;</span></code>, well within the <code class="docutils literal notranslate"><span class="pre">0.4&quot;</span></code> centering quality limit.</p>
<p>Let’s take a look at the high jitter dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">high_jit</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;le3a01010_jit.fits&quot;</span>

<span class="n">plot_jitter</span><span class="p">(</span><span class="n">high_jit</span><span class="p">,</span> <span class="s2">&quot;High Amount of Jitter&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/5d17a483e98dc4eba1a6659ce12cc156fed9212f56e0159237a7b50962da8ce7.png" src="../../../_images/5d17a483e98dc4eba1a6659ce12cc156fed9212f56e0159237a7b50962da8ce7.png" />
</div>
</div>
<p>We can see that this dataset looks <em>very</em> different than the low jitter dataset. The spread of the jitter is much greater than our previous example, especially for <code class="docutils literal notranslate"><span class="pre">SI_V3_AVG</span></code>. We are seeing a large contour, indicating a big spread in jitter values throughout the observation. Let’s calculate the RSS of this data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v2_stdev</span><span class="p">,</span> <span class="n">v3_stdev</span> <span class="o">=</span> <span class="n">plot_jitter</span><span class="p">(</span><span class="n">high_jit</span><span class="p">,</span> <span class="n">rss</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">rss_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v2_stdev</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v3_stdev</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Root-Sum-Square of the high jitter dataset is </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rss_high</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The Root-Sum-Square of the high jitter dataset is 1.7339999675750732&quot;
</pre></div>
</div>
</div>
</div>
<p>This observation’s RSS of the jitter values is <code class="docutils literal notranslate"><span class="pre">1.734&quot;</span></code>, indicating that the target may have gone off center during the course of the observation. In this instance, the user should check for large variations in the count rate throughout the observation (assuming the target is not variable). A tutorial notebook for creating lightcurves with COS data can be found <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/SplitTag/SplitTag.ipynb">here</a>.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="congrats-on-completing-the-notebook">
<h1>Congrats on completing the notebook!<a class="headerlink" href="#congrats-on-completing-the-notebook" title="Permalink to this heading">#</a></h1>
<section id="there-are-more-tutorial-notebooks-for-cos-in-this-repo-check-them-out">
<h2>There are more tutorial notebooks for COS in <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/tree/main/notebooks/COS">this</a> repo, check them out!<a class="headerlink" href="#there-are-more-tutorial-notebooks-for-cos-in-this-repo-check-them-out" title="Permalink to this heading">#</a></h2>
</section>
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this heading">#</a></h2>
<p><strong>Author:</strong> Sierra Gomez (sigomez&#64;stsci.edu)</p>
<p><strong>Updated on:</strong> August 29, 2024</p>
<p><em>This tutorial was generated to be in compliance with the <a class="reference external" href="https://github.com/spacetelescope/style-guides">STScI style guides</a> and would like to cite the <a class="reference external" href="https://github.com/spacetelescope/style-guides/blob/master/templates/example_notebook.ipynb">Jupyter guide</a> in particular.</em></p>
</section>
<section id="citations">
<h2>Citations<a class="headerlink" href="#citations" title="Permalink to this heading">#</a></h2>
<p>If you use <code class="docutils literal notranslate"><span class="pre">astropy</span></code>, <code class="docutils literal notranslate"><span class="pre">astroquery</span></code>, or <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>, <code class="docutils literal notranslate"><span class="pre">numpy</span></code> for published research, please cite the authors. Follow these links for more information about citations:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.astropy.org/en/stable/index.html">Citing <code class="docutils literal notranslate"><span class="pre">astropy</span></code></a></p></li>
<li><p><a class="reference external" href="https://astroquery.readthedocs.io/en/latest/">Citing <code class="docutils literal notranslate"><span class="pre">astroquery</span></code></a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/stable/users/project/citing.html">Citing <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></p></li>
<li><p><a class="reference external" href="https://numpy.org/citing-numpy/">Citing <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/hst_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/COS/ExceptionReport"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../Extract/Extract.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Editing the extraction boxes in a spectral extraction file (<code class="docutils literal notranslate"><span class="pre">XTRACTAB</span></code>)</p>
      </div>
    </a>
    <a class="right-next"
       href="../../DrizzlePac/README.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">DrizzlePac Notebooks</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">What to do when you get an Exception Report for COS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">0. Introduction</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-download">0.1 Data Download</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#inspecting-the-exposure-time">1. Inspecting the Exposure Time</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#reviewing-the-signal-to-noise-ratio">2. Reviewing the Signal-to-Noise Ratio</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#investigating-the-target-acquisition">3. Investigating the Target Acquisition</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acq-search">3.1 <code class="docutils literal notranslate"><span class="pre">ACQ/SEARCH</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acq-image">3.2 <code class="docutils literal notranslate"><span class="pre">ACQ/IMAGE</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acq-peakxd-acq-peakd">3.3 <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKXD</span></code>, <code class="docutils literal notranslate"><span class="pre">ACQ/PEAKD</span></code></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-the-wavelength-scale">4. Evaluating the Wavelength Scale</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-the-jitter">5. Checking the Jitter</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspecting-the-jif-headers-for-guiding-issues">5.1 Inspecting the <code class="docutils literal notranslate"><span class="pre">JIF</span></code> Headers for Guiding Issues</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspecting-the-jit-table">5.2 Inspecting the <code class="docutils literal notranslate"><span class="pre">JIT</span></code> Table</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#congrats-on-completing-the-notebook">Congrats on completing the notebook!</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#there-are-more-tutorial-notebooks-for-cos-in-this-repo-check-them-out">There are more tutorial notebooks for COS in this repo, check them out!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>