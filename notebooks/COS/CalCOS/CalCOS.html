

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Running the COS Data Pipeline (CalCOS) &#8212; HST Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/COS/CalCOS/CalCOS';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Splitting COS Exposures into sub-exposures with splittag" href="../SplitTag/SplitTag.html" />
    <link rel="prev" title="Modifying or Creating an Association File" href="../AsnFile/AsnFile.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="HST Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="HST Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    STScI HST Notebook Repository HQ
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">ACS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../ACS/README.html">ACS Notebooks</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_findsat_mrt/acs_findsat_mrt_example.html">Satellite trail detection in ACS/WFC data using acstools.findsat_mrt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_saturation_trails/acs_saturation_trails.html">ACS Linearity with Saturated Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_cte_forward_model/acs_cte_forward_model_example.html">Pixel-based ACS/WFC CTE Forward Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_subarrays/acs_subarrays.html">ACS Image Reduction for Subarray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_sbc_dark_analysis/acs_sbc_dark_analysis.html">SBC Dark Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_reduction/acs_reduction.html">ACS/WFC Image Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_pixel_area_maps/acs_pixel_area_maps.html">Obtaining Pixel Area Maps for ACS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_polarization_tools/acs_polarization_tools.html">Using ACS Polarization Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_focus_diverse_epsfs/acs_focus_diverse_epsfs.html">Focus Diverse ePSFs for ACS/WFC</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_exception_report/exception_report_checks.html">HST Exception Report - Investigate your ACS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/hst_orbits_ephem/hst_orbits_ephem.html">Getting HST Ephemeris and Related Data for an Observation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">COS</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../README.html">COS Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Setup/Setup.html">Setting up your computer environment for working with COS data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../DataDl/DataDl.html">Downloading COS Data</a></li>




<li class="toctree-l1"><a class="reference internal" href="../ViewData/ViewData.html">Viewing COS Data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../AsnFile/AsnFile.html">Modifying or Creating an Association File</a></li>





<li class="toctree-l1 current active"><a class="current reference internal" href="#">Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)</a></li>






<li class="toctree-l1"><a class="reference internal" href="../SplitTag/SplitTag.html">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></a></li>







<li class="toctree-l1"><a class="reference internal" href="../DayNight/DayNight.html">Filtering out COS Data taken during the Day or Night</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LSF/LSF.html">Working with the COS Line Spread Function (LSF)</a></li>

<li class="toctree-l1"><a class="reference internal" href="../Extract/Extract.html">Editing the extraction boxes in a spectral extraction file (<code class="docutils literal notranslate"><span class="pre">XTRACTAB</span></code>)</a></li>







<li class="toctree-l1"><a class="reference internal" href="../ExceptionReport/ExceptionReport.html">What to do when you get an Exception Report for COS</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">DrizzlePac</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/README.html">DrizzlePac Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/using_updated_astrometry_solutions/using_updated_astrometry_solutions.html">Improving Astrometry Using Alternate WCS Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_to_catalogs/align_to_catalogs.html">Aligning HST images to an Absolute Reference Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_sparse_fields/align_sparse_fields.html">Aligning Deep Exposures of Sparse Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_multiple_visits/align_multiple_visits.html">Optimizing Image Alignment for Multiple HST Visits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/use_ds9_regions_in_tweakreg/use_ds9_regions_in_tweakreg.html">TWEAKREG Tips - Using DS9 Regions for Source Inclusion/Exclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/optimize_image_sampling/optimize_image_sampling.html">Optimizing the Image Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_mosaics/align_mosaics.html">Aligning HST Mosaics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/sky_matching/sky_matching.html">Sky Matching for HST Mosaics <a id="top"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/mask_satellite/mask_satellite.html">Satellite Trail Masking Techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/drizzle_wfpc2/drizzle_wfpc2.html">Drizzling new WFPC2 FLT data products with chip-normalization   </a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HASP</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../HASP/Setup/Setup.html">Installing the Hubble Advanced Spectral Products Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../HASP/CoaddTutorial/CoaddTutorial.html">Inputting User Data using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/FluxScaleTutorial/FluxScaleTutorial.html">Scaling Flux while using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/DataDiagnostic/DataDiagnostics.html">HASP Data Diagnostic Notebook</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../HASP/WavelengthAdjustment/WavelengthAdjustment.html">Wavelength Adjustments for Running the Hubble Advanced Spectral Products (HASP) Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/COSLifetimePositions/COSLifetimePositions.html">Combining COS Data from Multiple Lifetime Positions and Central Wavelengths</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NICMOS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html">Programmatic Replacements for NICMOS Units Conversion Form</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">STIS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../STIS/README.html">STIS-Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/cross-correlation/cross-correlation.html">Correcting for Missing Wavecals with Cross-Correlation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/custom_ccd_darks/custom_ccd_darks.html">Custom CCD Darks <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/drizpac_notebook/STIS_DrizzlePac_Tutorial.html">STIS DrizzlePac Tutorial <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/CoronagraphyViz/STIS_Coronagraphy_Visualization_v2.html">STIS Coronagraphy Visualization Tool (v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/calstis/calstis_2d_ccd.html">Calstis 2-D CCD Data Reduction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/target_acquisition/target_acquisition.html">Evaluating STIS Target Acquisitions <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/view_data/view_data.html">Viewing STIS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/extraction/1D_Extraction.html">1D Spectra Extraction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/low_count_uncertainties/Low_Count_Uncertainties.html">Low Count Uncertainties in STIS <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/contrast_sensitivity/STIS_Coronagraphic_Observation_Feasibility.html">STIS Coronagraphic Observation Feasibility</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">WFC3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../WFC3/README.html">WFC3 Notebooks</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/general_tools.html">General Tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/image_displayer_analyzer/wfc3_image_displayer_analyzer.html">WFC3 Image Displayer &amp; Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/exception_report/wfc3_exception_report.html">Exception Report Checklist - WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/calwf3_v1.0_cte/calwf3_with_v1.0_PCTE.html">Processing WFC3/UVIS Data with <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> Using the v1.0 CTE-Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/persistence/wfc3_ir_persistence.html">Masking Persistence in WFC3/IR Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_g280_transit/G280_Exoplanet_Transits.html">Analyzing WFC3/UVIS G280 Exoplanet Transit Observations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/ir_tvb.html">WFC3/IR Time Variable Background (TVB)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_ima_visualization/IR_IMA_Visualization_with_an_Example_of_Time_Variable_Background.html">WFC3/IR IMA Visualization Tools with An Example of Time Variable Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/calwf3_recalibration/calwf3_recal_tvb.html">Manual Recalibration with calwf3: Turning off the IR Linear Ramp Fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/tvb_flattenramp/TVB_flattenramp_notebook.html">Correcting for Helium Line Emission Background in IR Exposures using the “Flatten-Ramp” Technique</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_scattered_light_calwf3_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_Using_calwf3_to_Mask_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Using <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> to Mask Bad Reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_scattered_light_manual_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_by_Manually_Subtracting_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Manually Subtracting Bad Reads</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/photometry.html">Photometry</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/filter_transformations/filter_transformations.html">WFC3/UVIS Filter Transformations with stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/flux_conversion_tool/flux_conversion_tool.html">Flux Unit Conversions with synphot and stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/photometry_examples/phot_examples.html">Synthetic Photometry Examples for WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_time_dependent_photometry/uvis_timedep_phot.html">WFC3/UVIS Time-dependent Photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/zeropoints/zeropoints.html">Calculating WFC3 Zeropoints with STSynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_pam_corrections/WFC3_UVIS_Pixel_Area_Map_Corrections_for_Subarrays.html">WFC3/UVIS Pixel Area Map Corrections for Subarrays</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/point_spread_function.html">Point Spread Function (PSF)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/point_spread_function/hst_point_spread_function.html">HST WFC3 Point Spread Function Modeling   </a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/mast_api_psf/download_psf_cutouts.html">Downloading WFC3 and WFPC2 PSF Cutouts from MAST</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/spacetelescope/hst_notebooks/blob/main/notebooks/COS/CalCOS/CalCOS.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/COS/CalCOS/CalCOS.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/COS/CalCOS/CalCOS.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Running the COS Data Pipeline (CalCOS)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">0. Introduction</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notes-for-those-new-to-python-jupyter-coding">Notes for those new to Python/Jupyter/Coding:</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-environment-to-run-calcos">1. Setting up the Environment to Run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">1.1. Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-your-conda-environment">1.2. Create Your <code class="docutils literal notranslate"><span class="pre">conda</span></code> Environment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-basic-directories">1.3. Imports and Basic Directories</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-will-also-define-a-few-basic-directories-in-which-to-place-our-inputs-and-outputs">We will also define a few basic directories in which to place our inputs and outputs.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-a-reference-file-directory">1.4. Set up a Reference File Directory</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#gathering-the-data-to-run-calcos">2. Gathering the Data to Run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-the-raw-data">2.1. Downloading the Raw Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gathering-reference-files">2.2. Gathering Reference Files</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#processing-raw-cos-data-using-calcos">3. Processing Raw COS Data Using <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-calcos-from-a-python-environment">3.1. Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>: <em>From a <code class="docutils literal notranslate"><span class="pre">Python</span></code> Environment</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-calcos-from-the-command-line">3.2. Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>: <em>From the Command Line</em></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#re-processing-cos-data-with-altered-parameters">4. Re-processing COS Data with Altered Parameters</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#altering-the-calibration-switches">4.1. Altering the Calibration Switches</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-calcos-with-a-specific-set-of-switches">4.2. Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> with a Specific Set of Switches</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-calcos-with-a-different-reference-file">4.3. Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> with a Different Reference File</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#congratulations-you-finished-this-notebook">Congratulations! You finished this Notebook!</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#there-are-more-cos-data-walkthrough-notebooks-on-different-topics-you-can-find-them-here">There are more COS data walkthrough Notebooks on different topics. You can find them here.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><a id="topC"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="running-the-cos-data-pipeline-calcos">
<h1>Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)<a class="headerlink" href="#running-the-cos-data-pipeline-calcos" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="learning-goals">
<h1>Learning Goals:<a class="headerlink" href="#learning-goals" title="Permalink to this heading">#</a></h1>
<p><font size="4 "> This Notebook is designed to walk the user (<em>you</em>) through:</font></p>
<p><strong>1. <span class="xref myst">Setting up the Environment to Run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></span></strong></p>
<p>- 1.1. <span class="xref myst">Prerequisites</span></p>
<p>- 1.2. <span class="xref myst">Create Your <code class="docutils literal notranslate"><span class="pre">conda</span></code> Environment</span></p>
<p>- 1.3. <span class="xref myst">Imports and Basic Directories</span></p>
<p>- 1.4. <span class="xref myst">Setup a Reference File directory</span></p>
<p><strong>2. <span class="xref myst">Gathering the Data to Run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></span></strong></p>
<p>- 2.1. <span class="xref myst">Downloading the Raw Data</span></p>
<p>- 2.2. <span class="xref myst">Gathering Reference Files</span></p>
<p><strong>3. <span class="xref myst">Processing Raw COS data using <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></span></strong></p>
<p>- 3.1. <span class="xref myst">Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>: <em>From a <code class="docutils literal notranslate"><span class="pre">Python</span></code> Environment</em></span></p>
<p>- 3.2. <span class="xref myst">Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>: <em>From the Command Line</em></span></p>
<p><strong>4. <span class="xref myst">Re-processing COS Data with Altered Parameters</span></strong></p>
<p>- 4.1. <span class="xref myst">Altering the Calibration Switches</span></p>
<p>- 4.2. <span class="xref myst">Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> with a Specific Set of Switches</span></p>
<p>- 4.3. <span class="xref myst">Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> with a Different Reference File</span></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction">
<h1>0. Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h1>
<p><strong>The Cosmic Origins Spectrograph (<a class="reference external" href="https://www.nasa.gov/content/hubble-space-telescope-cosmic-origins-spectrograph"><em>COS</em></a>) is an ultraviolet spectrograph on-board the Hubble Space Telescope (<a class="reference external" href="https://www.stsci.edu/hst/about"><em>HST</em></a>) with capabilities in the near ultraviolet (<em>NUV</em>) and far ultraviolet (<em>FUV</em>).</strong></p>
<p><strong><code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></strong> is the data processing pipeline which converts the raw data produced by COS’s detectors onboard HST into usable spectral data. It transforms the data from a list of many individual recorded photon interactions into tables of wavelength and flux.</p>
<p><strong>This tutorial aims to prepare you run the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> pipeline to reduce spectral data taken with the COS instrument.</strong> It focuses on COS data taken in <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> mode.
<em>Note</em> that there is another, less commonly used mode, <code class="docutils literal notranslate"><span class="pre">ACCUM</span></code>, which should generally be used only for UV bright targets.</p>
<ul class="simple">
<li><p>For an in-depth manual to working with COS data and a discussion of caveats and user tips, see the <a class="reference external" href="https://hst-docs.stsci.edu/display/COSDHB/">COS Data Handbook</a>.</p></li>
<li><p>For a detailed overview of the COS instrument, see the <a class="reference external" href="https://hst-docs.stsci.edu/display/COSIHB/">COS Instrument Handbook</a>.</p></li>
</ul>
<section id="notes-for-those-new-to-python-jupyter-coding">
<h2>Notes for those new to Python/Jupyter/Coding:<a class="headerlink" href="#notes-for-those-new-to-python-jupyter-coding" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>You will frequently see exclamation points (<strong>!</strong>) or dollar signs (<strong>$</strong>) at the beginning of a line of code. These are not part of the actual commands. The exclamation points tell a Jupyter Notebook cell to pass the following line to the command line, and the dollar sign merely indicates the start of a terminal prompt.</p></li>
</ul>
<p><a id = setupC></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="setting-up-the-environment-to-run-calcos">
<h1>1. Setting up the Environment to Run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code><a class="headerlink" href="#setting-up-the-environment-to-run-calcos" title="Permalink to this heading">#</a></h1>
<p>The first step to processing your data is setting up an environment from which to run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>.
<a id = prereqC></a></p>
<section id="prerequisites">
<h2>1.1. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">#</a></h2>
<p>This tutorial assumes some basic knowledge of the command line and was built using a unix style shell. Those using a Windows computer will likely have the best results if working within the <a class="reference external" href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">Windows Subsystem for Linux</a>.</p>
<p>If you do not already have any distribution of the <code class="docutils literal notranslate"><span class="pre">conda</span></code> tool, see <a class="reference external" href="https://stenv.readthedocs.io/en/latest/getting_started.html#getting-started">this page</a> for instructions, and install either <a class="reference external" href="https://docs.anaconda.com/anaconda/install/"><code class="docutils literal notranslate"><span class="pre">anaconda</span></code> (~ 3 GB, more beginner friendly, lots of extras you likely won’t use)</a>, <a class="reference external" href="https://docs.conda.io/en/latest/miniconda.html"><code class="docutils literal notranslate"><span class="pre">miniconda</span></code> (~ 400 MB, only what you need to make environments)</a>, or <a class="reference external" href="https://mamba.readthedocs.io/en/latest/installation/mamba-installation.html"><code class="docutils literal notranslate"><span class="pre">mamba</span></code> (~85 MB, similar to <code class="docutils literal notranslate"><span class="pre">miniconda</span></code> but rewritten in C++).</a></p>
<p><a id = condaenvC></a></p>
</section>
<section id="create-your-conda-environment">
<h2>1.2. Create Your <code class="docutils literal notranslate"><span class="pre">conda</span></code> Environment<a class="headerlink" href="#create-your-conda-environment" title="Permalink to this heading">#</a></h2>
<p>Once you have <code class="docutils literal notranslate"><span class="pre">conda</span></code> installed, you can create an environment.</p>
<p>Open up your terminal app, likely <code class="docutils literal notranslate"><span class="pre">Terminal</span></code> or <code class="docutils literal notranslate"><span class="pre">iTerm</span></code> on a Mac or <code class="docutils literal notranslate"><span class="pre">Windows</span> <span class="pre">Terminal</span></code> or <code class="docutils literal notranslate"><span class="pre">Powershell</span></code> on Windows.</p>
<p>First, add the <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> channel to your computer’s <code class="docutils literal notranslate"><span class="pre">conda</span></code> channel list. This enables <code class="docutils literal notranslate"><span class="pre">conda</span></code> to look in the right place to find all the packages we want to install.</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">conda</span> <span class="pre">config</span> <span class="pre">--add</span> <span class="pre">channels</span> <span class="pre">conda-forge</span></code></p>
<p>Now we can create a new environment for running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>; let’s call it <code class="docutils literal notranslate"><span class="pre">calcos_env</span></code>, and initialize it with <code class="docutils literal notranslate"><span class="pre">Python</span></code> version 3.10 and several packages we’ll need.</p>
<p><code class="docutils literal notranslate"> <span class="pre">$</span> <span class="pre">conda</span> <span class="pre">create</span> <span class="pre">-n</span> <span class="pre">calcos_env</span> <span class="pre">python=3.10</span> <span class="pre">notebook</span> <span class="pre">jupyterlab</span> <span class="pre">numpy</span> <span class="pre">astropy</span> <span class="pre">matplotlib</span> <span class="pre">astroquery</span></code></p>
<p>After allowing conda to proceed to installing the packages (type <code class="docutils literal notranslate"><span class="pre">y</span></code> then hit enter), you can see all of your environments with:</p>
<p><code class="docutils literal notranslate"> <span class="pre">$</span> <span class="pre">conda</span> <span class="pre">env</span> <span class="pre">list</span></code></p>
<p>and then switch over to your new environment with:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">calcos_env</span></code></p>
<p>Finally you must install the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> and <code class="docutils literal notranslate"><span class="pre">CRDS</span></code> packages using <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<p><code class="docutils literal notranslate"> <span class="pre">$</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">calcos</span> <span class="pre">crds</span></code></p>
<p>At this point, typing <code class="docutils literal notranslate"><span class="pre">calcos</span> <span class="pre">--version</span></code> into the command line and hitting enter should no longer yield the error:</p>
<p><code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">not</span> <span class="pre">found:</span> <span class="pre">calcos</span></code></p>
<p>but rather respond with a version number, i.e. version <code class="docutils literal notranslate"><span class="pre">3.4.4</span></code> at the time of writing this Notebook.</p>
<p>At this point, if you started this Jupyter Notebook in another <code class="docutils literal notranslate"><span class="pre">Python</span></code> environment, you should now quit that instance, run <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">calcos_env</span></code>, and reopen this Jupyter Notebook. If you’re unsure whether you’re already using the <code class="docutils literal notranslate"><span class="pre">calcos_env</span></code> environment, you can see the active environment with the following cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Displays name of current conda environment</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">os</span><span class="w"> </span><span class="kn">import</span> <span class="n">environ</span><span class="p">,</span> <span class="n">system</span>
<span class="k">if</span> <span class="s2">&quot;CONDA_DEFAULT_ENV&quot;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You are using:&quot;</span><span class="p">,</span> <span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONDA_DEFAULT_ENV&quot;</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">system</span><span class="p">(</span><span class="s2">&quot;conda info --envs&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>You are using: hstcal
</pre></div>
</div>
</div>
</div>
<p><a id=impdirC></a></p>
</section>
<section id="imports-and-basic-directories">
<h2>1.3. Imports and Basic Directories<a class="headerlink" href="#imports-and-basic-directories" title="Permalink to this heading">#</a></h2>
<p>We will import the following packages:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">calcos</span></code> to run the COS data pipeline</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astroquery.mast</span> <span class="pre">Mast</span> <span class="pre">and</span> <span class="pre">Observations</span></code> for finding and downloading data from the <a class="reference external" href="https://mast.stsci.edu/portal/Mashup/Clients/Mast/Portal.html">MAST</a> archive</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code> to handle array functions (version <span class="math notranslate nohighlight">\(\ge\)</span> 1.17)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.io</span> <span class="pre">fits</span></code> for accessing FITS files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.table</span> <span class="pre">Table</span></code> for creating and reading organized tables of the data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code> for plotting data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">glob</span></code>, <code class="docutils literal notranslate"><span class="pre">shutil</span></code>, and <code class="docutils literal notranslate"><span class="pre">os</span></code> for searching and working with system files and variables</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pathlib</span> <span class="pre">Path</span></code> for managing system paths</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">calcos</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.mast</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># This line makes plots appear in the Notebook instead of a separate window</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<section id="we-will-also-define-a-few-basic-directories-in-which-to-place-our-inputs-and-outputs">
<h3>We will also define a few basic directories in which to place our inputs and outputs.<a class="headerlink" href="#we-will-also-define-a-few-basic-directories-in-which-to-place-our-inputs-and-outputs" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># These will be important directories for the Notebook</span>
<span class="n">datadir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./data/&#39;</span><span class="p">)</span>
<span class="n">outputdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./output/&#39;</span><span class="p">)</span>

<span class="c1"># Make the directories if they don&#39;t exist</span>
<span class="n">datadir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">outputdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id = lrefC></a></p>
</section>
</section>
<section id="set-up-a-reference-file-directory">
<h2>1.4. Set up a Reference File Directory<a class="headerlink" href="#set-up-a-reference-file-directory" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> needs to be able to find all your reference files, (flat field image, bad pixel table, etc.), and the best way to enable that is to create a central directory of all the calibration files you’ll need. We refer to this directory  as <code class="docutils literal notranslate"><span class="pre">lref</span></code> by convention, and set a system variable <code class="docutils literal notranslate"><span class="pre">lref</span></code> to the location of the directory. In this section, we will create the <code class="docutils literal notranslate"><span class="pre">lref</span></code> environment variable; however, we need to populate the <code class="docutils literal notranslate"><span class="pre">lref</span></code> folder with the actual reference files. We do this in <span class="xref myst">Section 2.2</span>. If you have already downloaded the set of COS reference files you need to use into an existing lref directory, you should instead set <code class="docutils literal notranslate"><span class="pre">lref</span></code> to the path to this directory.</p>
<p>We can assign a system variable in three different ways, depending on whether we are working from:</p>
<ol class="arabic simple">
<li><p>The command line</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">Python</span></code> environment</p></li>
<li><p>A Jupyter Notebook</p></li>
</ol>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Unix-style Command Line</p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Python</span></code></p></th>
<th class="head"><p>Jupyter Notebook</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>export lref=’./data/reference/…’</p></td>
<td><p>os.environ[“lref”] = “./data/reference/…”</p></td>
<td><p>%env lref ./data/reference/…</p></td>
</tr>
</tbody>
</table>
</div>
<p>Note that this system variable must be set again with every new instance of a terminal - if you frequently need to use the same <code class="docutils literal notranslate"><span class="pre">lref</span></code> directory, consider adding an export statement to your <code class="docutils literal notranslate"><span class="pre">.bash_profile</span></code> or equivalent file.</p>
<p>Because this is a Jupyter Notebook, we set our reference directory with the <a class="reference external" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html">cell magic</a> below:</p>
<!-- Looking in the headers of our data below, we see that the `$lref` argument appears at the beginning of all of the reference file locations: --><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">env</span> lref ./data/reference/references/hst/cos/
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>env: lref=./data/reference/references/hst/cos/
</pre></div>
</div>
</div>
</div>
<p>We can note the value of the system variable using the following command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;lref&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;./data/reference/references/hst/cos/&#39;
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><a id = gatherC></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="gathering-the-data-to-run-calcos">
<h1>2. Gathering the Data to Run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code><a class="headerlink" href="#gathering-the-data-to-run-calcos" title="Permalink to this heading">#</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> pipeline can be run either from a <code class="docutils literal notranslate"><span class="pre">Python</span></code> environment, or directly from a Unix-style command line. The two use the same underlying machinery but can differ in syntax. For specifics on the keywords to run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> with specific behaviors and arguments, see <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-3-cos-calibration/3-6-customizing-cos-data-calibration#:~:text=Table%203.2%3A%20Arguments%20for%20Running%20calcos%20in%20Python">Table 3.2: Arguments for Running CalCOS in Python</a> and <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-3-cos-calibration/3-6-customizing-cos-data-calibration#:~:text=Table%203.3%3A%20Command%2Dline%20Options%20for%20Running%20calcos%20in%20Unix/Linux/Mac.">Table 3.3: Command-line Options for Running CalCOS in Unix/Linux/Mac</a>.</p>
<p><a id = datadlC></a></p>
<section id="downloading-the-raw-data">
<h2>2.1. Downloading the Raw Data<a class="headerlink" href="#downloading-the-raw-data" title="Permalink to this heading">#</a></h2>
<p>First, we need to make sure we have all of our data ready and in the right spot. If you are unfamiliar with searching the archive for data, we recommend that you view our <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/DataDl/DataDl.ipynb">tutorial on downloading COS data</a>. This Notebook will largely gloss over downloading the data.</p>
<p>To run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>, we will need the following files:</p>
<ol class="arabic simple">
<li><p>All the <strong>raw data</strong> from separate exposures we wish to combine as <code class="docutils literal notranslate"><span class="pre">_rawtag</span></code> FITS files</p></li>
<li><p>The <strong>association</strong> file telling <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> which files to combine as a <code class="docutils literal notranslate"><span class="pre">_asn</span></code> FITS file.</p></li>
</ol>
<p><strong><em>Note</em> that we do not generally run the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> pipeline directly on the data files, but instead on an association <code class="docutils literal notranslate"><span class="pre">_asn</span></code> file. This allows for the calibration of related exposures into combined <code class="docutils literal notranslate"><span class="pre">_x1dsum</span></code> files.</strong></p>
<p>If you instead use <code class="docutils literal notranslate"><span class="pre">_rawtag</span></code> or <code class="docutils literal notranslate"><span class="pre">_corrtag</span></code> exposure files as your inputs, you will only receive the exposure-specific <code class="docutils literal notranslate"><span class="pre">_x1d</span></code> files as your outputs.</p>
<p>For this example, we’re choosing the dataset <code class="docutils literal notranslate"><span class="pre">LCXV13040</span></code> of COS/FUV observing the <a class="reference external" href="http://simbad.cds.unistra.fr/simbad/sim-basic?Ident=3C+48&amp;submit=SIMBAD+search">quasar 3C48</a>. In the cell below we download the data from the archive:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Query the MAST archive for data with observation id starting with lcxv1304</span>
<span class="n">q1</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span>
                        <span class="n">obs_id</span><span class="o">=</span><span class="s1">&#39;lcxv1304*&#39;</span><span class="p">)</span>

<span class="c1"># Make a list of all products we could download with this file</span>
<span class="n">pl</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>

<span class="c1"># Filter to a list of only the products which are association files (asn)</span>
<span class="n">asn_file_list</span> <span class="o">=</span> <span class="n">pl</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;productSubGroupDescription&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ASN&#39;</span><span class="p">]</span>

<span class="c1"># Filter to a list of only therawtag files for both segments</span>
<span class="n">rawtag_list</span> <span class="o">=</span> <span class="n">pl</span><span class="p">[</span>
    <span class="p">(</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;productSubGroupDescription&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RAWTAG_A&#39;</span><span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;productSubGroupDescription&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RAWTAG_B&#39;</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Download the rawtag and asn lists to the data directory</span>
<span class="n">rawtag_locs</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span>
                                <span class="n">rawtag_list</span><span class="p">,</span>
                                <span class="n">download_dir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">datadir</span><span class="p">))</span>

<span class="n">asn_locs</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span>
                                <span class="n">asn_file_list</span><span class="p">,</span>
                                <span class="n">download_dir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">datadir</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13ezq_rawtag_a.fits to data/mastDownload/HST/lcxv13ezq/lcxv13ezq_rawtag_a.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13ezq_rawtag_b.fits to data/mastDownload/HST/lcxv13ezq/lcxv13ezq_rawtag_b.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13f4q_rawtag_a.fits to data/mastDownload/HST/lcxv13f4q/lcxv13f4q_rawtag_a.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13f4q_rawtag_b.fits to data/mastDownload/HST/lcxv13f4q/lcxv13f4q_rawtag_b.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13faq_rawtag_a.fits to data/mastDownload/HST/lcxv13faq/lcxv13faq_rawtag_a.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13faq_rawtag_b.fits to data/mastDownload/HST/lcxv13faq/lcxv13faq_rawtag_b.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13ffq_rawtag_a.fits to data/mastDownload/HST/lcxv13ffq/lcxv13ffq_rawtag_a.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13ffq_rawtag_b.fits to data/mastDownload/HST/lcxv13ffq/lcxv13ffq_rawtag_b.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13040_asn.fits to data/mastDownload/HST/lcxv13040/lcxv13040_asn.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
</div>
</div>
<p><strong>By default, each exposure’s files are downloaded to separate directories, as is the association file.</strong></p>
<p>We need to move around these files to all be in the same directory, which we do below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">lpath</span> <span class="ow">in</span> <span class="n">rawtag_locs</span><span class="p">[</span><span class="s1">&#39;Local Path&#39;</span><span class="p">]:</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">lpath</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">datadir</span><span class="o">/</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">lpath</span><span class="p">))</span>

<span class="k">for</span> <span class="n">lpath</span> <span class="ow">in</span> <span class="n">asn_locs</span><span class="p">[</span><span class="s1">&#39;Local Path&#39;</span><span class="p">]:</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">lpath</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">datadir</span><span class="o">/</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">lpath</span><span class="p">))</span>
    <span class="n">asn_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">lpath</span><span class="p">)</span>

<span class="c1"># Delete the now-empty nested subdirectories (./data/mastDownload)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">datadir</span><span class="o">/</span><span class="s1">&#39;mastDownload&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id = reffileC></a></p>
</section>
<section id="gathering-reference-files">
<h2>2.2. Gathering Reference Files<a class="headerlink" href="#gathering-reference-files" title="Permalink to this heading">#</a></h2>
<p>The following process of gathering reference files is given a detailed explanation in Section 3 of our <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/Setup/Setup.ipynb">Notebook on setting up an environment to work with COS data</a>. Your process will be somewhat simpler and quicker if you have already downloaded the reference files.</p>
<p>Each data file has an associated set of calibration files which are needed to run the associated correction with (i.e. you need the <code class="docutils literal notranslate"><span class="pre">FLATFILE</span></code> to flat field correct the data). These reference files must be located in the <code class="docutils literal notranslate"><span class="pre">$lref</span></code> directory to run the pipeline.</p>
<p>The STScI team is regularly producing new calibration files in an effort to keep improving data reduction. Periodically the pipeline is re-run on all COS data.
To determine which reference files were used most recently by STScI to calibrate your data, you can refer to your data file’s <code class="docutils literal notranslate"><span class="pre">CRDS_CTX</span></code> keyword in its FITS header:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find all of the raw files:</span>
<span class="n">rawfiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datadir</span><span class="o">/</span><span class="s1">&#39;*raw*.fits&#39;</span><span class="p">))</span>

<span class="c1"># Get the header of the 0th raw file, look for its CRDS context keyword:</span>
<span class="n">crds_ctx</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">rawfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="s1">&#39;CRDS_CTX&#39;</span><span class="p">]</span>

<span class="c1"># Print the file&#39;s CRDS context keyword:</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The CRDS Context last run with </span><span class="si">{</span><span class="n">rawfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> was:</span><span class="se">\t</span><span class="si">{</span><span class="n">crds_ctx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The CRDS Context last run with data/lcxv13ffq_rawtag_b.fits was:	hst_1180.pmap
</pre></div>
</div>
</div>
</div>
<p>The value of this keyword in the header is a <code class="docutils literal notranslate"><span class="pre">.pmap</span></code> or observatory context file which tells the CRDS calibration data distribution program which files to distribute. You can also find the newest “operational” context on the <a class="reference external" href="https://hst-crds.stsci.edu">HST CRDS website</a>.</p>
<p>To download the reference files specified by a context file, we use the <code class="docutils literal notranslate"><span class="pre">crds</span></code> tool we installed earlier.</p>
<hr class="docutils" />
<p><strong>If you haven’t already downloaded up-to-date reference files,</strong> (as in Section 3 of <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/Setup/Setup.ipynb">Setup Notebook</a>, <span class="xref myst">click to skip this cell and begin downloading the files!</span></p>
<p><strong>If you have recently downloaded COS reference files,</strong> (i.e. if you ran Section 3 of the <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/Setup/Setup.ipynb">Setup Notebook</a>,) you likely do not have to download more reference files. Instead, follow the instructions in this cell and then skip to <span class="xref myst">Section 3</span>.</p>
<p>If you already downloaded the files, you can simply point the pipeline to the ones you downloaded, using the <code class="docutils literal notranslate"><span class="pre">crds</span> <span class="pre">bestrefs</span></code> command, as shown in the following three steps. Run these steps from your command line if you already have the reference files in a local cache. <em>Note</em> also that there may be newer reference files available. To make sure you are always using the most up-to-date reference files, we advise you familiarize yourself with the newest files and documentation at the <a class="reference external" href="https://hst-crds.stsci.edu">CRDS homepage</a>.</p>
<ol class="arabic simple">
<li><p>The following sets the environment variable for crds to look for the reference data online:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">export</span> <span class="pre">CRDS_SERVER_URL=https://hst-crds.stsci.edu</span></code></p>
<ol class="arabic simple" start="2">
<li><p>The following tells crds where to save the files it downloads - set this to the directory where you saved the crds_cache, i.e. in Section 3 of our Notebook on <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/Setup/Setup.ipynb">Setup</a>:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">export</span> <span class="pre">CRDS_PATH=${HOME}/crds_cache</span></code></p>
<ol class="arabic simple" start="3">
<li><p>The following will update the data files you downloaded so that they will be processed with the reference files you previously downloaded:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">crds</span> <span class="pre">bestrefs</span> <span class="pre">--files</span> <span class="pre">data/*raw*.fits</span> <span class="pre">--update-bestrefs</span> <span class="pre">--new-context</span> <span class="pre">'&lt;the</span> <span class="pre">imap</span> <span class="pre">or</span> <span class="pre">pmap</span> <span class="pre">file</span> <span class="pre">you</span> <span class="pre">used</span> <span class="pre">to</span> <span class="pre">download</span> <span class="pre">the</span> <span class="pre">reference</span> <span class="pre">files&gt;'</span></code></p>
<p><strong>Assuming everything ran successfully, you can now <span class="xref myst">skip to Section 3</span>.</strong></p>
<hr class="docutils" />
<p><a id=skipcellC></a></p>
<p><font size="4 "> If you have not yet downloaded the reference files, you will need to do so, as shown below:</font></p>
<p><font size="4 ">Caution!</font></p>
<a class="reference internal image-reference" href="../../../_images/warning.png"><img alt="A warning symbol. Watch out!" src="../../../_images/warning.png" style="width: 60px;" /></a>
<p><em>Note</em> that as of the time of this Notebook’s update, the pipeline context used below was <strong><code class="docutils literal notranslate"><span class="pre">hst_1071.pmap</span></code></strong>, but this changes over time. You are running this in the future, and there is certainly a newer context you would be better off working with. Take a minute to consider this, and check the <a class="reference external" href="http://hst-crds.stsci.edu/">HST Calibration Reference Data System webpage</a> to determine what the <strong>current operational pmap file</strong> is.</p>
<p>Unless we are connected to the STScI network, or already have the reference files on our machine, we will need to download the reference files and tell the pipeline where to look for the flat files, bad-pixel files, etc.</p>
<p>The process in the following two cells can take a long time and strain network resources. If you have already downloaded up-to-date COS reference files, we recommend that you avoid doing so again. Instead, keep these <code class="docutils literal notranslate"><span class="pre">crds</span></code> files in an accessible location, and point an environment variable <code class="docutils literal notranslate"><span class="pre">lref</span></code> to this directory. For instance, if your <code class="docutils literal notranslate"><span class="pre">lref</span></code> files are on your home directory in a subdirectory called <code class="docutils literal notranslate"><span class="pre">crds_cache</span></code>, give Jupyter the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">%env</span> <span class="pre">lref</span> <span class="pre">/Users/&lt;your</span> <span class="pre">username&gt;/crds_cache/references/hst/cos/</span></code></p>
<p>If you have an older cache of reference files, you may also simply update your cached reference files. Please see the <a class="reference external" href="https://hst-crds.stsci.edu/static/users_guide/index.html">CRDS Guide</a> for more information.</p>
<p>Assuming you have not yet downloaded these files, in the next two cells, we will setup an environment of reference files, download the files, and save the output of the <code class="docutils literal notranslate"><span class="pre">crds</span></code> download process in a log file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture cap --no-stderr
# ^ The above puts the cell&#39;s output into a text file made in the next cell
# ^^ This avoids a very long printed output

# This sets an env variable for crds to look for the reference data online
%env CRDS_SERVER_URL https://hst-crds.stsci.edu

# This tells crds where to save the files it downloads
%env CRDS_PATH ./data/reference/

# This command looks up the pmap file, which tells what ref files to download.
# It then downloads these to the CRDS_PATH directory.
# Make sure you have the latest pmap file, found on the CRDS site.
!crds bestrefs --files data/*raw*.fits --sync-references=2
!crds bestrefs --update-bestrefs --new-context &#39;hst_1140.pmap&#39;
</pre></div>
</div>
</div>
</div>
<p>We continue on to creating the CRDS output text file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This file will contain the output of the last cell</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputdir</span> <span class="o">/</span> <span class="s1">&#39;crds_output_1.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll print the beginning and end of <code class="docutils literal notranslate"><span class="pre">crds_output_1.txt</span></code> just to take a look.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creating a dictionary to store each line as a key &amp; line info as a value</span>
<span class="n">crds_output_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Open the file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span><span class="o">/</span><span class="s1">&#39;crds_output_1.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cell_outputs</span><span class="p">:</span>
    <span class="c1"># Loop through the lines in the text file</span>
    <span class="k">for</span> <span class="n">linenum</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cell_outputs</span><span class="p">):</span>
        <span class="c1"># Save each line to the defined dictionary</span>
        <span class="n">crds_output_dict</span><span class="p">[</span><span class="n">linenum</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Get the length of the dictionary, aka, how many lines of output</span>
<span class="n">total_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">crds_output_dict</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Printing the first and last 5 lines of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">total_lines</span><span class="p">)</span> <span class="o">+</span>
      <span class="s2">&quot; lines output by the previous cell:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">total_lines</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">:   </span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">crds_output_dict</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># Delete the contents of the dict to avoid &#39;garbage&#39; filling memory</span>
<span class="n">crds_output_dict</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Printing the first and last 5 lines of 229 lines output by the previous cell:

Line 0:   	 env: CRDS_SERVER_URL=https://hst-crds.stsci.edu
Line 1:   	 env: CRDS_PATH=./data/reference/
Line 2:   	 CRDS - INFO -  Fetching  ./data/reference/mappings/hst/hst_wfpc2_wf4tfile_0250.rmap      678 bytes  (1 / 142 files) (0 / 1.8 M bytes)
Line 3:   	 CRDS - INFO -  Fetching  ./data/reference/mappings/hst/hst_wfpc2_shadfile_0250.rmap      977 bytes  (2 / 142 files) (678 / 1.8 M bytes)
Line 4:   	 CRDS - INFO -  Fetching  ./data/reference/mappings/hst/hst_wfpc2_offtab_0250.rmap      642 bytes  (3 / 142 files) (1.7 K / 1.8 M bytes)
Line 224:   	        ^^^^^^^^^^^^^^^^^^^
Line 225:   	   File &quot;/opt/hostedtoolcache/Python/3.11.11/x64/lib/python3.11/site-packages/crds/bestrefs/bestrefs.py&quot;, line 322, in complex_init
Line 226:   	     assert source_modes &lt;= 1 and (source_modes + using_pickles) &gt;= 1, \
Line 227:   	            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Line 228:   	 AssertionError: Must specify one of: --files, --datasets, --instruments, --all-instruments, --diffs-only and/or --load-pickles.
</pre></div>
</div>
</div>
</div>
<p><strong>Line 172 of the output should show 0 errors.</strong></p>
<p>If you receive errors, you may need to attempt to run the <code class="docutils literal notranslate"><span class="pre">crds</span> <span class="pre">bestrefs</span></code> line again. These errors can arise from imperfect network connections.</p>
<p><strong>It is recommended that you use this new <code class="docutils literal notranslate"><span class="pre">$lref</span></code> folder of reference files for subsequent <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> use, rather than re-downloading the reference files each time.</strong> To do this (after completing this Notebook):</p>
<ul class="simple">
<li><p>Save this folder somewhere accessibile, i.e. <code class="docutils literal notranslate"><span class="pre">~/crds_cache</span></code></p></li>
<li><p>Add a line to your <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> or similar: <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">lref=&lt;Path</span> <span class="pre">to</span> <span class="pre">your</span> <span class="pre">reference</span> <span class="pre">file</span> <span class="pre">directory&gt;</span></code></p>
<ul>
<li><p>If you wish to avoid adding this to your <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code>, simply type the line above into any terminal you wish to run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> from</p></li>
<li><p>If running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> from a Jupyter Notebook, instead add a cell with: <code class="docutils literal notranslate"><span class="pre">%env</span> <span class="pre">lref</span> <span class="pre">/Users/&lt;Your</span> <span class="pre">Username&gt;/crds_cache/references/hst/cos</span></code></p></li>
</ul>
</li>
</ul>
<p><a id = runC></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="processing-raw-cos-data-using-calcos">
<h1>3. Processing Raw COS Data Using <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code><a class="headerlink" href="#processing-raw-cos-data-using-calcos" title="Permalink to this heading">#</a></h1>
<p><strong>Now we have all the reference files we need to run the CalCOS pipeline on our data.</strong></p>
<p>This following cells which run the pipeline can take a while, sometimes more than <strong>10 minutes!</strong></p>
<p>By default, the pipeline also outputs hundreds of lines of text - we will suppress the printing of this text and instead save it to a text file.</p>
<p><a id = runpyC></a></p>
<section id="running-calcos-from-a-python-environment">
<h2>3.1. Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>: <em>From a <code class="docutils literal notranslate"><span class="pre">Python</span></code> Environment</em><a class="headerlink" href="#running-calcos-from-a-python-environment" title="Permalink to this heading">#</a></h2>
<p><strong>Now, we can run the pipeline program:</strong></p>
<p>Note that generally, <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> should be run on an association (<code class="docutils literal notranslate"><span class="pre">_asn</span></code>) file (check out the <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/AsnFile/AsnFile.ipynb">Notebook</a> we have for creating or editing association files if you wish to alter the <code class="docutils literal notranslate"><span class="pre">asn</span></code> file that we downloaded). In this case, our association file is: <code class="docutils literal notranslate"><span class="pre">./data/lcxv13040_asn.fits</span></code>. You <em>may</em> run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> directly on <code class="docutils literal notranslate"><span class="pre">_rawtag</span></code> or <code class="docutils literal notranslate"><span class="pre">_corrtag</span></code> exposure files, but this will not produce an <code class="docutils literal notranslate"><span class="pre">_x1dsum</span></code> file and can result in errors for data taken at certain lifetime positions. No matter what type of files you run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> on, you should only specify the FUVA segment’s file, i.e. the <code class="docutils literal notranslate"><span class="pre">_rawtag_a</span></code> file. If a <code class="docutils literal notranslate"><span class="pre">rawtag_b</span></code> file is in the same directory, <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> will find both segments’ files.</p>
<p>In this example, we also specify that <code class="docutils literal notranslate"><span class="pre">verbosity</span> <span class="pre">=</span> <span class="pre">2</span></code>, resulting in a <strong>very</strong> verbose output, and we specify a directory to put all the output files in: <code class="docutils literal notranslate"><span class="pre">output/calcos_processed_1</span></code>. To avoid polluting this Notebook with more than a thousand lines of the output, we again capture the output of the next cell and save it to <code class="docutils literal notranslate"><span class="pre">output/output_calcos_1.txt</span></code> in the cell below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span> cap --no-stderr
<span class="c1"># Above ^ again, capture the output and save it in the next cell</span>
<span class="c1"># 1st param specifies which asn file to run the pipeline on</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">calcos</span><span class="o">.</span><span class="n">calcos</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datadir</span><span class="o">/</span><span class="n">asn_name</span><span class="p">),</span>
                  <span class="c1"># verbosity param</span>
                  <span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                  <span class="c1"># Save all resulting files in this subdirectory in our outdir</span>
                  <span class="n">outdir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span><span class="o">/</span><span class="s2">&quot;calcos_processed_1&quot;</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An error occured, &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This file now contains the output of the previous cell</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span><span class="o">/</span><span class="s1">&#39;output_calcos_1.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Again, we’ll print the beginning and end of that file just to take a look and make sure <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> ran successfully.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pair each line with its line number, start at 0</span>
<span class="n">calcos_output_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Open the file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span><span class="o">/</span><span class="s1">&#39;output_calcos_1.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cell_outputs</span><span class="p">:</span>
    <span class="c1"># Loop through each line in output_calcos_1.txt</span>
    <span class="k">for</span> <span class="n">linenum</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cell_outputs</span><span class="p">):</span>
        <span class="c1"># Save each line to the dictionary we defined above</span>
        <span class="n">calcos_output_dict</span><span class="p">[</span><span class="n">linenum</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Get the length of the dictionary - how many lines of output</span>
<span class="n">total_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">calcos_output_dict</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Printing the first and last 5 lines of &quot;</span>
      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_lines</span><span class="si">}</span><span class="s2"> lines output by the previous cell:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">total_lines</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">:   </span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">calcos_output_dict</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># Delete the contents of the dictionary to save memory space</span>
<span class="n">calcos_output_dict</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Printing the first and last 5 lines of 2385 lines output by the previous cell:

Line 0:   	 Warning:  Creating output directory &#39;output/calcos_processed_1&#39;.
Line 1:   	 CALCOS version 3.6.0
Line 2:   	 numpy version 2.2.2
Line 3:   	 astropy version 7.0.1
Line 4:   	 Begin 13-Feb-2025 16:42:42 UTC
Line 2380:   	 updateMempresent
Line 2381:   	 copySptFile
Line 2382:   	 Warning:  spt file not found, so not copied to product
Line 2383:   	 End   13-Feb-2025 16:44:34 UTC
Line 2384:   	 elapsed time = 112.1 sec. = 1.87 min.
</pre></div>
</div>
</div>
</div>
<p><a id = runcliC></a></p>
</section>
<section id="running-calcos-from-the-command-line">
<h2>3.2. Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>: <em>From the Command Line</em><a class="headerlink" href="#running-calcos-from-the-command-line" title="Permalink to this heading">#</a></h2>
<p>The syntax for running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> from the command line is very similar. Assuming your data files, <code class="docutils literal notranslate"><span class="pre">lref</span></code> directory, and reference files are all where you’ve told <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> to look, you can simply run:</p>
<p><code class="docutils literal notranslate"><span class="pre">calcos</span> <span class="pre">-o</span> <span class="pre">directory_to_save_outputs_in</span> <span class="pre">filename_asn.fits</span></code></p>
<p><em>or, if you want to save a very verbose output to a log file <code class="docutils literal notranslate"><span class="pre">log.txt</span></code></em>:</p>
<p><code class="docutils literal notranslate"><span class="pre">calcos</span> <span class="pre">-v</span> <span class="pre">-o</span> <span class="pre">directory_to_save_outputs_in</span> <span class="pre">filename_asn.fits</span> <span class="pre">&gt;</span> <span class="pre">log.txt</span></code></p>
<p>To see the full list of commands, <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-3-cos-calibration/3-6-customizing-cos-data-calibration#:~:text=Table%203.3%3A%20Command%2Dline%20Options%20for%20Running%20calcos%20in%20Unix/Linux/Mac">Table 3.2: Command-line Options for Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> in Unix/Linux/Mac</a>, or run the following with the name of the association file:</p>
<p><code class="docutils literal notranslate"><span class="pre">!calcos</span> <span class="pre">&lt;PATH_TO_ASN_FILE&gt;</span></code></p>
<p><a id = rerunC></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="re-processing-cos-data-with-altered-parameters">
<h1>4. Re-processing COS Data with Altered Parameters<a class="headerlink" href="#re-processing-cos-data-with-altered-parameters" title="Permalink to this heading">#</a></h1>
<p><a id = alterswitchC></a></p>
<section id="altering-the-calibration-switches">
<h2>4.1. Altering the Calibration Switches<a class="headerlink" href="#altering-the-calibration-switches" title="Permalink to this heading">#</a></h2>
<p>The way to alter how <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> runs - i.e. which calibrations it performs - is with the <strong>calibration switches</strong> contained in the FITS headers.</p>
<p>The switches (with the exception of “XTRACTALG”), can be set to the values in the following table:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><em><strong>Value:</strong></em></p></th>
<th class="head"><p>“PERFORM”</p></th>
<th class="head"><p>“OMIT”</p></th>
<th class="head"><p>“N/A”</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em><strong>Meaning:</strong></em></p></td>
<td><p>Performs the calibration step</p></td>
<td><p>Does not perform the calibration step</p></td>
<td><p>This step would not make sense for this file</p></td>
</tr>
</tbody>
</table>
</div>
<p><code class="docutils literal notranslate"><span class="pre">XTRACTALG</span></code> instead can be set to either “BOXCAR” or “TWOZONE”, to specify the spectral extraction algorithm to be used. For more information, see <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-3-cos-calibration/3-2-pipeline-processing-overview#id-3.2PipelineProcessingOverview-3.2.1OverviewofTWOZONEextraction">Section 3.2.1: “Overview of TWOZONE extraction” of the Data Handbook</a>.</p>
<p>In the cell below, we get a full list of the switches by name. If you want to learn more about the calibration steps and switches, see <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb">Chapters 2 and 3 of the COS Data Handbook</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reads the header of the 0th rawfile</span>
<span class="n">header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">rawfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># The calibration switches are found in lines 82 - 109 of the header</span>
<span class="n">calibswitches</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="mi">82</span><span class="p">:</span><span class="mi">109</span><span class="p">]</span>
<span class="n">calibswitches</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TAGFLASH= &#39;AUTO            &#39;   / Type of flashed exposures in time-tag          
                                                                                
              / CALIBRATION SWITCHES: PERFORM, OMIT, COMPLETE                   
                                                                                
FLATCORR= &#39;PERFORM &#39;           / apply flat-field correction                    
DEADCORR= &#39;PERFORM &#39;           / correct for deadtime                           
DQICORR = &#39;PERFORM &#39;           / data quality initialization                    
STATFLAG=                    T / Calculate statistics?                          
TEMPCORR= &#39;PERFORM &#39;           / correct for thermal distortion                 
GEOCORR = &#39;PERFORM &#39;           / correct FUV for geometic distortion            
DGEOCORR= &#39;OMIT    &#39;           / Delta Corrections to FUV Geometric Distortion  
IGEOCORR= &#39;PERFORM &#39;           / interpolate geometric distortion in INL file   
RANDCORR= &#39;PERFORM &#39;           / add pseudo-random numbers to raw x and y       
RANDSEED=                    1 / seed for pseudo-random number generator        
XWLKCORR= &#39;PERFORM &#39;           / Correct FUV for Walk Distortion in X           
YWLKCORR= &#39;PERFORM &#39;           / Correct FUV for Walk Distortion in Y           
PHACORR = &#39;PERFORM &#39;           / filter by pulse-height                         
HVDSCORR= &#39;PERFORM &#39;           / Correct FUV sensitivity for high voltage level 
TRCECORR= &#39;PERFORM &#39;           / trace correction                               
ALGNCORR= &#39;PERFORM &#39;           / align data to profile                          
XTRCTALG= &#39;TWOZONE &#39;           / BOXCAR or TWOZONE                              
BADTCORR= &#39;PERFORM &#39;           / filter by time (excluding bad time intervals)  
DOPPCORR= &#39;PERFORM &#39;           / orbital Doppler correction                     
HELCORR = &#39;PERFORM &#39;           / heliocentric Doppler correction                
X1DCORR = &#39;PERFORM &#39;           / 1-D spectral extraction                        
BACKCORR= &#39;PERFORM &#39;           / subtract background (when doing 1-D extraction)
WAVECORR= &#39;PERFORM &#39;           / use wavecal to adjust wavelength zeropoint     
</pre></div>
</div>
</div>
</div>
<p><strong>Let’s begin by switching off all the switches currently set to “PERFORM” to a new value of “OMIT”, in every rawfile:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set to True to see a bit more about what is going on here</span>
<span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Find each rawfile, i is a counter variable for the files you loop through</span>
<span class="k">for</span> <span class="n">rawfile</span> <span class="ow">in</span> <span class="n">rawfiles</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">rawfile</span><span class="p">)</span>

    <span class="c1"># Read that rawfiles header</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">rawfile</span><span class="p">)</span>

    <span class="c1"># Find all calibration switches</span>
    <span class="n">corrections</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="s2">&quot;CORR&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">]</span>

    <span class="c1"># Checking if the value of each switch is &#39;PERFORM&#39;, and changing to &#39;OMIT&#39;</span>
    <span class="k">for</span> <span class="n">correction</span> <span class="ow">in</span> <span class="n">corrections</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="n">correction</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PERFORM&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;switching</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="p">[</span><span class="n">correction</span><span class="p">],</span>
                      <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">correction</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">to OMIT&quot;</span><span class="p">)</span>
            <span class="c1"># Turn off all the calib switches</span>
            <span class="n">fits</span><span class="o">.</span><span class="n">setval</span><span class="p">(</span><span class="n">rawfile</span><span class="p">,</span> <span class="n">correction</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;OMIT&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>In this case, <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> realizes that all the switches are set to “OMIT”, and exits without doing anything.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run CalCOS with all calib switches OFF; allow text output this time</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">calcos</span><span class="o">.</span><span class="n">calcos</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">datadir</span><span class="o">/</span><span class="n">asn_name</span><span class="p">),</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span><span class="o">/</span><span class="s2">&quot;calcos_processed_2&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An error occured, &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning:  Creating output directory &#39;output/calcos_processed_2&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CALCOS version 3.6.0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy version 2.2.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>astropy version 7.0.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Begin 13-Feb-2025 16:44:36 UTC
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nothing to do; all calibration switches are OMIT.
</pre></div>
</div>
</div>
</div>
<p><a id = switchrunC></a></p>
</section>
<section id="running-calcos-with-a-specific-set-of-switches">
<h2>4.2. Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> with a Specific Set of Switches<a class="headerlink" href="#running-calcos-with-a-specific-set-of-switches" title="Permalink to this heading">#</a></h2>
<p>Now, let’s set a single switch to “PERFORM”, and just run a flat-field correction (“FLATCORR”) and a pulse-height filter correction (“PHACORR”). Set verbosity = 1 or 2 to learn more about how <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> is working.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Find each rawfile, i is a counter variable for the files you loop through</span>
<span class="k">for</span> <span class="n">rawfile</span> <span class="ow">in</span> <span class="n">rawfiles</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">rawfile</span><span class="p">)</span>
    <span class="c1"># Change the header&#39;s keyword FLATCORR to the value PERFORM</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">setval</span><span class="p">(</span><span class="n">rawfile</span><span class="p">,</span> <span class="s2">&quot;FLATCORR&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;PERFORM&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Change the header&#39;s keyword PHACORR to the value PERFORM</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">setval</span><span class="p">(</span><span class="n">rawfile</span><span class="p">,</span> <span class="s2">&quot;PHACORR&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;PERFORM&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span> cap --no-stderr
<span class="c1"># Above ^ again, capture the output and save it in the next cell</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">calcos</span><span class="o">.</span><span class="n">calcos</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">datadir</span><span class="o">/</span><span class="n">asn_name</span><span class="p">),</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span><span class="o">/</span><span class="s2">&quot;calcos_processed_3&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An error occured, &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This file now contains the output of the last cell</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span><span class="o">/</span><span class="s1">&#39;output_calcos_3.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id = refrunC></a></p>
</section>
<section id="running-calcos-with-a-different-reference-file">
<h2>4.3. Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> with a Different Reference File<a class="headerlink" href="#running-calcos-with-a-different-reference-file" title="Permalink to this heading">#</a></h2>
<p>You may wish to run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> with a specific flat file, bad pixel table, or any other reference file. <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> offers the ability to do just this on a file-by-file basis, by changing the calibration reference file values in the header of your data.</p>
<p>As an example, we check which calibration files are selected for one of our rawtag files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read 0th rawfile&#39;s header</span>
<span class="n">header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">rawfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># The 110th to 138th lines of the header are filled with these reference files</span>
<span class="n">refFiles</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="mi">110</span><span class="p">:</span><span class="mi">138</span><span class="p">]</span>
<span class="c1"># Get just the keywords i.e. &quot;FLATFILE&quot; and &quot;DEADTAB&quot;</span>
<span class="n">refFile_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">refFiles</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">refFiles</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BRSTCORR= &#39;OMIT    &#39;           / switch controlling search for FUV bursts       
TDSCORR = &#39;OMIT    &#39;           / switch for time-dependent sensitivity correctio
                                                                                
              / CALIBRATION REFERENCE FILES                                     
                                                                                
FLATFILE= &#39;lref$z6n16118l_flat.fits&#39; / Pixel to Pixel Flat Field Reference File 
DEADTAB = &#39;lref$s7g1700gl_dead.fits&#39; / Deadtime Reference Table                 
BPIXTAB = &#39;lref$69m20528l_bpix.fits&#39; / bad pixel table                          
SPOTTAB = &#39;lref$69f20032l_spot.fits&#39; / Transient Bad Pixel Table                
GSAGTAB = &#39;lref$8991635ql_gsag.fits&#39; / Gain Sagged Region Reference File        
HVTAB   = &#39;N/A                    &#39; / High voltage command level Reference Table
BRFTAB  = &#39;lref$x1u1459il_brf.fits&#39; / Baseline Reference Frame Reference Table  
GEOFILE = &#39;lref$x1u1459gl_geo.fits&#39; / Geometric Correction Reference File       
DGEOFILE= &#39;N/A                    &#39; / Delta Geometric Correction Reference Image
TRACETAB= &#39;lref$5b91919sl_trace.fits&#39; / 1D spectral trace table                 
PROFTAB = &#39;lref$5b91920fl_profile.fits&#39; / 2D spectrum profile table             
TWOZXTAB= &#39;lref$5b919203l_2zx.fits&#39; / Two-zone spectral extraction parameters   
XWLKFILE= &#39;lref$14o2013ql_xwalk.fits&#39; / X Walk Correction Lookup Reference Image
YWLKFILE= &#39;lref$88m17269l_ywalk.fits&#39; / Y Walk Correction Lookup Reference Image
PHATAB  = &#39;lref$wc318317l_pha.fits&#39; / Pulse Height Discrimination Reference Tabl
HVDSTAB = &#39;lref$87t2019dl_hvds.fits&#39; / High voltage sensitivity correction table
PHAFILE = &#39;N/A                    &#39; / Pulse Height Threshold Reference File     
BADTTAB = &#39;lref$8141834il_badt.fits&#39; / Bad Time Interval Reference Table        
XTRACTAB= &#39;lref$5b919206l_1dx.fits&#39; / 1-D Spectral Extraction Information Table 
LAMPTAB = &#39;lref$5b91919tl_lamp.fits&#39; / template calibration lamp spectra table  
DISPTAB = &#39;lref$5b919205l_disp.fits&#39; / Dispersion Coefficient Reference Table   
IMPHTTAB= &#39;N/A                    &#39; / Imaging photometric table                 
FLUXTAB = &#39;lref$62m19539l_phot.fits&#39; / Spectroscopic flux calibration table     
</pre></div>
</div>
</div>
</div>
<p>For this section, let’s download another Pulse Height Amplitude (<code class="docutils literal notranslate"><span class="pre">\_pha</span></code>) table file using the <code class="docutils literal notranslate"><span class="pre">crds</span></code> tool:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>crds<span class="w"> </span>sync<span class="w"> </span>--files<span class="w"> </span>u1t1616ll_pha.fits<span class="w"> </span>--output-dir<span class="w"> </span><span class="nv">$lref</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CRDS - INFO -  Symbolic context &#39;hst-latest&#39; resolves to &#39;hst_1211.pmap&#39;
CRDS - INFO -  Reorganizing 23 references from &#39;flat&#39; to &#39;flat&#39;
CRDS - INFO -  Syncing explicitly listed files.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CRDS - INFO -  Fetching  ./data/reference/references/hst/cos/u1t1616ll_pha.fits    11.5 K bytes  (1 / 1 files) (0 / 11.5 K bytes)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CRDS - INFO -  0 errors
CRDS - INFO -  0 warnings
CRDS - INFO -  4 infos
</pre></div>
</div>
</div>
</div>
<p>Now we can use the FITS headers to set this new file as the <code class="docutils literal notranslate"><span class="pre">_pha</span></code> file. As a demonstration, let’s do this for <strong>only the raw data from segment FUVA</strong> of the FUV detector:</p>
<p><em>Note</em> that we are still only performing two corrections, as all calibration switches aside from <code class="docutils literal notranslate"><span class="pre">FLATCORR</span></code> and <code class="docutils literal notranslate"><span class="pre">PHACORR</span></code> are set to <code class="docutils literal notranslate"><span class="pre">OMIT</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find just the FUVA raw files</span>
<span class="n">rawfiles_segA</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datadir</span><span class="o">/</span><span class="s1">&#39;*rawtag_a*.fits&#39;</span><span class="p">))</span>

<span class="c1"># Iterate through each FUVA rawtag file to update the FITS header&#39;s PHATAB</span>
<span class="k">for</span> <span class="n">rawfileA</span> <span class="ow">in</span> <span class="n">rawfiles_segA</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">rawfileA</span><span class="p">)</span>
    <span class="c1"># Updating the header value</span>
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">rawfileA</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdulist</span><span class="p">:</span>
        <span class="c1"># Update the 0th header of that FUVA file</span>
        <span class="n">hdr0</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="c1"># NOTE: you need the $lref if you put it with your other ref files</span>
        <span class="n">hdr0</span><span class="p">[</span><span class="s2">&quot;PHATAB&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lref$u1t1616ll_pha.fits&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>data/lcxv13faq_rawtag_a.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>data/lcxv13f4q_rawtag_a.fits
data/lcxv13ezq_rawtag_a.fits
data/lcxv13ffq_rawtag_a.fits
</pre></div>
</div>
</div>
</div>
<p><strong>Finally, let’s run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> with the new <code class="docutils literal notranslate"><span class="pre">_pha</span></code> file for only the FUVA data:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span> cap --no-stderr
<span class="k">try</span><span class="p">:</span>
    <span class="n">calcos</span><span class="o">.</span><span class="n">calcos</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">datadir</span><span class="o">/</span><span class="n">asn_name</span><span class="p">),</span>
                <span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">outdir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span><span class="o">/</span><span class="s2">&quot;calcos_processed_4&quot;</span><span class="p">)</span>
                <span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An error occured, &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This file now contains the output of the last cell</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span><span class="o">/</span><span class="s1">&#39;output_calcos_4.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><font size="5">Before we go, let’s have a look at the spectra that we just calibrated and extracted</font></p>
<p><strong>We’ll make a very quick plot to show the two spectra calibrated by STScI’s pipeline and by us right now.</strong>
The two should agree very well. Small differences may be expected, given that the <code class="docutils literal notranslate"><span class="pre">RANDSEED</span></code> values may be different between the two versions.</p>
<p>Much more information on reading in and plotting COS spectra can be found in our other tutorial: <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/ViewData/ViewData.ipynb">Viewing COS Data</a>.</p>
<p><em>(You can ignore the UnitsWarning below)</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the STScI calibrated x1dsum spectrum from the archive</span>
<span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span>
                                                <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span>
                                                        <span class="n">obs_id</span><span class="o">=</span><span class="s1">&#39;lcxv13040&#39;</span><span class="p">)),</span>
                               <span class="n">mrp_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">download_dir</span><span class="o">=</span><span class="s1">&#39;data/compare/&#39;</span>
                               <span class="p">)</span>

<span class="c1"># Read in this lcxv13040 spectrum</span>
<span class="n">output_spectrum</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">datadir</span><span class="o">/</span><span class="s1">&#39;compare/mastDownload/HST/lcxv13040/lcxv13040_x1dsum.fits&#39;</span><span class="p">))</span>

<span class="c1"># Get the wavelength, flux, flux error, and data quality weight the X1DSUM file</span>
<span class="c1"># More info on the DQ_WGT can be found in Section 2.7 of the COS data handbook</span>
<span class="n">wvln_orig</span> <span class="o">=</span> <span class="n">output_spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">]</span>
<span class="n">flux_orig</span> <span class="o">=</span> <span class="n">output_spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;FLUX&quot;</span><span class="p">]</span>
<span class="n">fluxErr_orig</span> <span class="o">=</span> <span class="n">output_spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;ERROR&quot;</span><span class="p">]</span>
<span class="n">dqwgt_orig</span> <span class="o">=</span> <span class="n">output_spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;DQ_WGT&quot;</span><span class="p">]</span>

<span class="c1"># Convert the data quality (DQ) weight into a boolean to mask the data</span>
<span class="n">dqwgt_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dqwgt_orig</span><span class="p">,</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

<span class="c1"># Read in the spectrum we recently calibrated</span>
<span class="n">output_spectrum</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span><span class="o">/</span><span class="s1">&#39;calcos_processed_1/lcxv13040_x1dsum.fits&#39;</span><span class="p">))</span>

<span class="c1"># Get the wavelength, flux, flux error, and data quality weight spectrum</span>
<span class="n">new_wvln</span> <span class="o">=</span> <span class="n">output_spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">]</span>
<span class="n">new_flux</span> <span class="o">=</span> <span class="n">output_spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;FLUX&quot;</span><span class="p">]</span>
<span class="n">new_fluxErr</span> <span class="o">=</span> <span class="n">output_spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;ERROR&quot;</span><span class="p">]</span>
<span class="n">new_dqwgt</span> <span class="o">=</span> <span class="n">output_spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;DQ_WGT&quot;</span><span class="p">]</span>

<span class="c1"># Convert the data quality weight into a boolean to mask the data</span>
<span class="n">new_dqwgt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_dqwgt</span><span class="p">,</span>
                       <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

<span class="c1"># Build a 3 row x 1 column figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Plot the archive&#39;s spectrum in the top subplot</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wvln_orig</span><span class="p">[</span><span class="n">dqwgt_orig</span><span class="p">],</span> <span class="n">flux_orig</span><span class="p">[</span><span class="n">dqwgt_orig</span><span class="p">],</span>
         <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
         <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Processed by the archive&quot;</span><span class="p">)</span>

<span class="c1"># Plot your calibrated spectrum in the middle subplot</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">new_wvln</span><span class="p">[</span><span class="n">new_dqwgt</span><span class="p">],</span> <span class="n">new_flux</span><span class="p">[</span><span class="n">new_dqwgt</span><span class="p">],</span>
         <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
         <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Just now processed by you&quot;</span><span class="p">)</span>

<span class="c1"># Plot the archived &amp; newly calibrated spectra in bottom subplot</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wvln_orig</span><span class="p">[</span><span class="n">dqwgt_orig</span><span class="p">],</span> <span class="n">flux_orig</span><span class="p">[</span><span class="n">dqwgt_orig</span><span class="p">],</span>
         <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
         <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Processed by the archive&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">new_wvln</span><span class="p">[</span><span class="n">new_dqwgt</span><span class="p">],</span> <span class="n">new_flux</span><span class="p">[</span><span class="n">new_dqwgt</span><span class="p">],</span>
         <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
         <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Just now processed by you&quot;</span><span class="p">)</span>

<span class="c1"># Putting the legend on each subplot</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span>
           <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span>
           <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span>
           <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># Setting the title of our plot</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fig 3.1</span><span class="se">\n</span><span class="s2">Comparison of processed spectra&quot;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>

<span class="c1"># Getting rid of the plot&#39;s whitespace</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Saving the figure to our output directory</span>
<span class="c1"># The &#39;dpi&#39; parameter stands for &#39;dots per inch&#39; (the res of the image)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span><span class="o">/</span><span class="s2">&quot;fig3.1_compare_plot.png&quot;</span><span class="p">),</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13040_asn.fits to data/compare/mastDownload/HST/lcxv13040/lcxv13040_asn.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13040_x1dsum.fits to data/compare/mastDownload/HST/lcxv13040/lcxv13040_x1dsum.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
</pre></div>
</div>
<img alt="../../../_images/dc0f707c5d41c1c7b48ee723e7a6d360b95f00e53b97e57bdca9078b4a7fe647.png" src="../../../_images/dc0f707c5d41c1c7b48ee723e7a6d360b95f00e53b97e57bdca9078b4a7fe647.png" />
</div>
</div>
</section>
<section id="congratulations-you-finished-this-notebook">
<h2>Congratulations! You finished this Notebook!<a class="headerlink" href="#congratulations-you-finished-this-notebook" title="Permalink to this heading">#</a></h2>
<section id="there-are-more-cos-data-walkthrough-notebooks-on-different-topics-you-can-find-them-here">
<h3>There are more COS data walkthrough Notebooks on different topics. You can find them <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/tree/main/notebooks/COS">here</a>.<a class="headerlink" href="#there-are-more-cos-data-walkthrough-notebooks-on-different-topics-you-can-find-them-here" title="Permalink to this heading">#</a></h3>
</section>
</section>
<hr class="docutils" />
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this heading">#</a></h2>
<p><strong>Author:</strong> Nat Kerman - <a class="reference external" href="mailto:nkerman&#37;&#52;&#48;stsci&#46;edu">nkerman<span>&#64;</span>stsci<span>&#46;</span>edu</a></p>
<p><strong>Updated On:</strong> 2023-03-30</p>
<blockquote>
<div><p><em>This tutorial was generated to be in compliance with the <a class="reference external" href="https://github.com/spacetelescope/style-guides">STScI style guides</a> and would like to cite the <a class="reference external" href="https://github.com/spacetelescope/style-guides/blob/master/templates/example_notebook.ipynb">Jupyter guide</a> in particular.</em></p>
</div></blockquote>
</section>
<section id="citations">
<h2>Citations<a class="headerlink" href="#citations" title="Permalink to this heading">#</a></h2>
<p>If you use <code class="docutils literal notranslate"><span class="pre">astropy</span></code>, <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>, <code class="docutils literal notranslate"><span class="pre">astroquery</span></code>, or <code class="docutils literal notranslate"><span class="pre">numpy</span></code> for published research, please cite the
authors. Follow these links for more information about citations:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.astropy.org/en/stable/index.html">Citing <code class="docutils literal notranslate"><span class="pre">astropy</span></code></a></p></li>
<li><p><a class="reference external" href="https://numpy.org/citing-numpy/">Citing <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/">Citing <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></p></li>
<li><p><a class="reference external" href="https://astroquery.readthedocs.io/en/latest/">Citing <code class="docutils literal notranslate"><span class="pre">astroquery</span></code></a></p></li>
</ul>
<hr class="docutils" />
<p><span class="xref myst">Top of Page</span>
<a class="reference internal" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a></p>
<p><br></br>
<br></br>
<br></br></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/hst_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/COS/CalCOS"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../AsnFile/AsnFile.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Modifying or Creating an Association File</p>
      </div>
    </a>
    <a class="right-next"
       href="../SplitTag/SplitTag.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">0. Introduction</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notes-for-those-new-to-python-jupyter-coding">Notes for those new to Python/Jupyter/Coding:</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-environment-to-run-calcos">1. Setting up the Environment to Run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">1.1. Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-your-conda-environment">1.2. Create Your <code class="docutils literal notranslate"><span class="pre">conda</span></code> Environment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-basic-directories">1.3. Imports and Basic Directories</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-will-also-define-a-few-basic-directories-in-which-to-place-our-inputs-and-outputs">We will also define a few basic directories in which to place our inputs and outputs.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-a-reference-file-directory">1.4. Set up a Reference File Directory</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#gathering-the-data-to-run-calcos">2. Gathering the Data to Run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-the-raw-data">2.1. Downloading the Raw Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gathering-reference-files">2.2. Gathering Reference Files</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#processing-raw-cos-data-using-calcos">3. Processing Raw COS Data Using <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-calcos-from-a-python-environment">3.1. Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>: <em>From a <code class="docutils literal notranslate"><span class="pre">Python</span></code> Environment</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-calcos-from-the-command-line">3.2. Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>: <em>From the Command Line</em></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#re-processing-cos-data-with-altered-parameters">4. Re-processing COS Data with Altered Parameters</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#altering-the-calibration-switches">4.1. Altering the Calibration Switches</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-calcos-with-a-specific-set-of-switches">4.2. Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> with a Specific Set of Switches</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-calcos-with-a-different-reference-file">4.3. Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> with a Different Reference File</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#congratulations-you-finished-this-notebook">Congratulations! You finished this Notebook!</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#there-are-more-cos-data-walkthrough-notebooks-on-different-topics-you-can-find-them-here">There are more COS data walkthrough Notebooks on different topics. You can find them here.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>