

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Splitting COS Exposures into sub-exposures with splittag &#8212; HST Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/COS/SplitTag/SplitTag';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Filtering out COS Data taken during the Day or Night" href="../DayNight/DayNight.html" />
    <link rel="prev" title="Running the COS Data Pipeline (CalCOS)" href="../CalCOS/CalCOS.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="HST Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="HST Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    STScI HST Notebook Repository HQ
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">ACS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../ACS/README.html">ACS Notebooks</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_findsat_mrt/acs_findsat_mrt_example.html">Satellite trail detection in ACS/WFC data using acstools.findsat_mrt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_saturation_trails/acs_saturation_trails.html">ACS Linearity with Saturated Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_cte_forward_model/acs_cte_forward_model_example.html">Pixel-based ACS/WFC CTE Forward Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_subarrays/acs_subarrays.html">ACS Image Reduction for Subarray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_sbc_dark_analysis/acs_sbc_dark_analysis.html">SBC Dark Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_reduction/acs_reduction.html">ACS/WFC Image Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_pixel_area_maps/acs_pixel_area_maps.html">Obtaining Pixel Area Maps for ACS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_polarization_tools/acs_polarization_tools.html">Using ACS Polarization Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_focus_diverse_epsfs/acs_focus_diverse_epsfs.html">Focus Diverse ePSFs for ACS/WFC</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">COS</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../README.html">COS Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Setup/Setup.html">Setting up your computer environment for working with COS data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../DataDl/DataDl.html">Downloading COS Data</a></li>




<li class="toctree-l1"><a class="reference internal" href="../ViewData/ViewData.html">Viewing COS Data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../AsnFile/AsnFile.html">Modifying or Creating an Association File</a></li>





<li class="toctree-l1"><a class="reference internal" href="../CalCOS/CalCOS.html">Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)</a></li>






<li class="toctree-l1 current active"><a class="current reference internal" href="#">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></a></li>







<li class="toctree-l1"><a class="reference internal" href="../DayNight/DayNight.html">Filtering out COS Data taken during the Day or Night</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LSF/LSF.html">Working with the COS Line Spread Function (LSF)</a></li>

<li class="toctree-l1"><a class="reference internal" href="../Extract/Extract.html">Editing the extraction boxes in a spectral extraction file (<code class="docutils literal notranslate"><span class="pre">XTRACTAB</span></code>)</a></li>







<li class="toctree-l1"><a class="reference internal" href="../ExceptionReport/ExceptionReport.html">What to do when you get an Exception Report for COS</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">DrizzlePac</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/README.html">DrizzlePac Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/using_updated_astrometry_solutions/using_updated_astrometry_solutions.html">Improving Astrometry Using Alternate WCS Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_to_catalogs/align_to_catalogs.html">Aligning HST images to an Absolute Reference Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_sparse_fields/align_sparse_fields.html">Aligning Deep Exposures of Sparse Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_multiple_visits/align_multiple_visits.html">Optimizing Image Alignment for Multiple HST Visits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/use_ds9_regions_in_tweakreg/use_ds9_regions_in_tweakreg.html">TWEAKREG Tips - Using DS9 Regions for Source Inclusion/Exclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/optimize_image_sampling/optimize_image_sampling.html">Optimizing the Image Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_mosaics/align_mosaics.html">Aligning HST Mosaics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/sky_matching/sky_matching.html">Sky Matching for HST Mosaics <a id="top"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/mask_satellite/mask_satellite.html">Satellite Trail Masking Techniques</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HASP</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../HASP/Setup/Setup.html">Installing the Hubble Advanced Spectral Products Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../HASP/CoaddTutorial/CoaddTutorial.html">Inputting User Data using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/FluxScaleTutorial/FluxScaleTutorial.html">Scaling Flux while using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/DataDiagnostic/DataDiagnostics.html">HASP Data Diagnostic Notebook</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../HASP/WavelengthAdjustment/WavelengthAdjustment.html">Wavelength Adjustments for Running the Hubble Advanced Spectral Products (HASP) Script</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NICMOS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html">Programmatic Replacements for NICMOS Units Conversion Form</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">STIS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../STIS/README.html">STIS-Notebooks</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../STIS/cross-correlation/cross-correlation.html">Correcting for Missing Wavecals with Cross-Correlation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/custom_ccd_darks/custom_ccd_darks.html">Custom CCD Darks <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/drizpac_notebook/STIS_DrizzlePac_Tutorial.html">STIS DrizzlePac Tutorial <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/CoronagraphyViz/STIS_Coronagraphy_Visualization_v2.html">STIS Coronagraphy Visualization Tool (v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/calstis/calstis_2d_ccd.html">Calstis 2-D CCD Data Reduction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/target_acquisition/target_acquisition.html">Evaluating STIS Target Acquisitions <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/view_data/view_data.html">Viewing STIS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/extraction/1D_Extraction.html">1D Spectra Extraction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/low_count_uncertainties/Low_Count_Uncertainties.html">Low Count Uncertainties in STIS <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/contrast_sensitivity/STIS_Coronagraphic_Observation_Feasibility.html">STIS Coronagraphic Observation Feasibility</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">WFC3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../WFC3/README.html">WFC3 Notebooks</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/general_tools.html">General Tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/image_displayer_analyzer/wfc3_image_displayer_analyzer.html">WFC3 Image Displayer &amp; Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/exception_report/wfc3_exception_report.html">Exception Report Checklist - WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/calwf3_v1.0_cte/calwf3_with_v1.0_PCTE.html">Processing WFC3/UVIS Data with <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> Using the v1.0 CTE-Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/persistence/wfc3_ir_persistence.html">Masking Persistence in WFC3/IR Images</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/ir_tvb.html">WFC3/IR Time Variable Background (TVB)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_ima_visualization/IR_IMA_Visualization_with_an_Example_of_Time_Variable_Background.html">WFC3/IR IMA Visualization Tools with An Example of Time Variable Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/calwf3_recalibration/calwf3_recal_tvb.html">Manual Recalibration with calwf3: Turning off the IR Linear Ramp Fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/tvb_flattenramp/TVB_flattenramp_notebook.html">Correcting for Helium Line Emission Background in IR Exposures using the “Flatten-Ramp” Technique</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_scattered_light_calwf3_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_Using_calwf3_to_Mask_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Using <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> to Mask Bad Reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_scattered_light_manual_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_by_Manually_Subtracting_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Manually Subtracting Bad Reads</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/photometry.html">Photometry</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/filter_transformations/filter_transformations.html">WFC3/UVIS Filter Transformations with stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/flux_conversion_tool/flux_conversion_tool.html">Flux Unit Conversions with synphot and stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/photometry_examples/phot_examples.html">Synthetic Photometry Examples for WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_time_dependent_photometry/uvis_timedep_phot.html">WFC3/UVIS Time-dependent Photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/zeropoints/zeropoints.html">Calculating WFC3 Zeropoints with STSynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_pam_corrections/WFC3_UVIS_Pixel_Area_Map_Corrections_for_Subarrays.html">WFC3/UVIS Pixel Area Map Corrections for Subarrays</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/point_spread_function.html">Point Spread Function (PSF)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/point_spread_function/hst_point_spread_function.html">HST WFC3 Point Spread Function Modeling   </a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/mast_api_psf/download_psf_cutouts.html">Downloading WFC3 and WFPC2 PSF Cutouts from MAST</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/spacetelescope/hst_notebooks/blob/main/notebooks/COS/SplitTag/SplitTag.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/COS/SplitTag/SplitTag.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/COS/SplitTag/SplitTag.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Splitting COS Exposures into sub-exposures with splittag</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">0. Introduction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#examining-the-data-to-determine-how-to-split-the-files">1. Examining the data to determine how to split the files</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#using-splittag-to-create-multiple-sub-exposure-files">2. Using <code class="docutils literal notranslate"><span class="pre">splittag</span></code> to create multiple sub-exposure files</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-practice-sub-dividing-with-splittag">Exercise 1: <em>Practice sub-dividing with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></em></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-spectra-from-the-sub-exposures-using-calcos">3. Extracting spectra from the sub-exposures using <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-the-lref-reference-files">3.1 Getting the <code class="docutils literal notranslate"><span class="pre">lref</span></code> reference files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-calcos-and-processing-sub-exposure-files">3.2 Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> and processing sub-exposure files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-the-1200-1230-angstrom-region"><strong>For the 1200 - 1230 Angstrom region:</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-the-1250-1350-angstrom-region"><strong>For the 1250 - 1350 Angstrom region:</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-multiple-sub-exposure-files-at-regular-intervals">4. Creating multiple sub-exposure files at regular intervals</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-examining-epoch-1-5">Exercise 2: <em>Examining epoch 1.5</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#congratulations-you-finished-this-notebook">Congratulations! You finished this Notebook!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-solutions">Exercise Solutions</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><a id="topSp"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="splitting-cos-exposures-into-sub-exposures-with-splittag">
<h1>Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code><a class="headerlink" href="#splitting-cos-exposures-into-sub-exposures-with-splittag" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="learning-goals">
<h1>Learning Goals<a class="headerlink" href="#learning-goals" title="Permalink to this heading">#</a></h1>
<p><font size="4 ">This Notebook is designed to walk the user (<em>you</em>) through:</font><br></p>
<p><strong>Filtering Cosmic Origins Spectrograph (COS) <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> data using the <code class="docutils literal notranslate"><span class="pre">splittag</span></code> tool</strong> by</p>
<p><strong>1. <span class="xref myst">Examining the data to determine how to split the files</span></strong></p>
<p><strong>2. <span class="xref myst">Using <code class="docutils literal notranslate"><span class="pre">splittag</span></code> to create multiple sub-exposure files</span></strong></p>
<p><strong>3. <span class="xref myst">Extracting spectra from the sub-exposures using <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></span></strong></p>
<p><strong>4. <span class="xref myst">Creating multiple sub-exposure files at regular intervals</span></strong></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction">
<h1>0. Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h1>
<p><strong>The Cosmic Origins Spectrograph (<a class="reference external" href="https://www.nasa.gov/content/hubble-space-telescope-cosmic-origins-spectrograph"><em>COS</em></a>) is an ultraviolet spectrograph on-board the Hubble Space Telescope (<a class="reference external" href="https://www.stsci.edu/hst/about"><em>HST</em></a>) with capabilities in the near ultraviolet (<em>NUV</em>) and far ultraviolet (<em>FUV</em>).</strong></p>
<p><strong>This tutorial aims to prepare you to work with the COS data of your choice by walking you through filtering <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> datapoints obtained by COS based on arbitrary times.</strong></p>
<p>COS Data can be taken in <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-1-cos-overview/1-1-instrument-capabilities-and-design"><code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code></a> mode, in which each individual encounter with a photon is recorded with its own metadata such as the time of the encounter. You may wish to split a COS exposure into multiple sub-exposure files. For instance, a transit may occur during your exposure, and you may wish to see the difference between the source’s spectrum before, during, and after the transit. This is possible with <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> data, and the functionality to do this is built into the <a class="reference external" href="https://github.com/spacetelescope/costools"><code class="docutils literal notranslate"><span class="pre">COSTools</span></code> python module</a> with the tool <code class="docutils literal notranslate"><span class="pre">splittag</span></code>.</p>
<ul class="simple">
<li><p>For an in-depth manual to working with COS data and a discussion of caveats and user tips, see the <a class="reference external" href="https://hst-docs.stsci.edu/display/COSDHB/">COS Data Handbook</a>.</p></li>
<li><p>For a detailed overview of the COS instrument, see the <a class="reference external" href="https://hst-docs.stsci.edu/display/COSIHB/">COS Instrument Handbook</a>.</p></li>
<li><p>The code for the <code class="docutils literal notranslate"><span class="pre">splittag</span></code> tool is found on the <a class="reference external" href="https://github.com/spacetelescope/costools/blob/master/costools/splittag.py">spacetelescope/costools GitHub repository</a></p></li>
</ul>
<p><font size="5"> We will import the following packages:</font></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">costools</span> <span class="pre">splittag</span></code> to select <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> datapoints by their time of encounter</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">calcos</span></code> to re-process the data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code> to handle array functions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.table</span> <span class="pre">Table</span></code> for reading FITS file data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">glob</span></code>, <code class="docutils literal notranslate"><span class="pre">os</span></code>, and <code class="docutils literal notranslate"><span class="pre">Path</span></code> for working with system files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code> for plotting data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astroquery.mast</span> <span class="pre">Mast</span></code> and <code class="docutils literal notranslate"><span class="pre">Observations</span></code> for finding and downloading data from the <a class="reference external" href="https://mast.stsci.edu/portal/Mashup/Clients/Mast/Portal.html">MAST</a> archive</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">warnings</span></code> and <code class="docutils literal notranslate"><span class="pre">astropy.units</span> <span class="pre">Warnings</span></code> for suppressing a warning that is not helpful later on.</p></li>
</ul>
<p>New versions of <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> are currently incompatible with astroconda. To create a Python environment capable of running all the data analyses in these COS Notebooks, please see Section 1 of our Notebook tutorial on <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/Setup/Setup.ipynb">setting up an environment</a>. Your version of <code class="docutils literal notranslate"><span class="pre">costools</span></code> may display a message on input about <code class="docutils literal notranslate"><span class="pre">TEAL</span></code> support (described <span class="xref myst">here</span>), but you may ignore this as it is largely irrelevant to our discussion.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For array manipulation</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># For reading FITS files</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>

<span class="c1"># For plotting</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># For filtering time-tag events by time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">costools</span><span class="w"> </span><span class="kn">import</span> <span class="n">splittag</span>

<span class="c1"># For processing COS data</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">calcos</span>

<span class="c1"># For system files</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># For downloading the data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.mast</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observations</span>

<span class="c1"># For supressing an unhelpful warning:</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnitsWarning</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">clear_output</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following tasks in the costools package can be run with TEAL:
         splittag                 timefilter                 x1dcorr
</pre></div>
</div>
</div>
</div>
<p><font size="5"> We will also define a few directories we will need: </font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using the pathlib style of system path</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./output/&#39;</span><span class="p">)</span>
<span class="n">plots_dir</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;plots&#39;</span>

<span class="c1"># Make the directories in case they don&#39;t exist</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plots_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><font size="5"> And we will need to download the data we wish to filter and analyze </font></p>
<p>We choose the exposure with obs_id: <code class="docutils literal notranslate"><span class="pre">lc1va0010</span></code>, because we happen to know it contains an exposure taken while the target, <a class="reference external" href="http://simbad.u-strasbg.fr/simbad/sim-id?Ident=IY+UMa">IY UMa</a>, underwent a transit event. For more information on downloading COS data, see our <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/DataDl/DataDl.ipynb">notebook tutorial on downloading COS data</a>.</p>
<p>We will download <code class="docutils literal notranslate"><span class="pre">corrtag</span></code> files for both segments. The <code class="docutils literal notranslate"><span class="pre">corrtag</span></code> file is a corrected events list for <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> data (more info in the <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-2-cos-data-files/2-4-cos-data-products#:~:text=Science%20Data%20Files-,Corrected%20Events%20Lists%20(corrtag),-The%20COS%20pipeline">Data Handbook</a>). In the <span class="xref myst">next section</span>, we will use this file to create a rough light curve of the exposure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find all MAST data on this obs_id:</span>
<span class="n">pl</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span>
                                    <span class="n">obs_id</span><span class="o">=</span><span class="s1">&#39;lc1va0010&#39;</span><span class="p">))</span>

<span class="c1"># Filter and download the Corrtag TIME-TAG files:</span>
<span class="n">pl_filt</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span>
    <span class="n">pl</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;CORRTAG_A&#39;</span><span class="p">,</span> <span class="s1">&#39;CORRTAG_B&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">downloaded_corrtags</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">pl_filt</span><span class="p">)[</span><span class="s1">&#39;Local Path&#39;</span><span class="p">]</span>

<span class="c1"># Let us know how many corrtags were found:</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;#####</span><span class="se">\n</span><span class="s2">Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">downloaded_corrtags</span><span class="p">)</span><span class="si">}</span><span class="s2"> corrtag exposure &quot;</span>
    <span class="s2">&quot;files from the COS FUV detector (segment A only)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lc1va0yeq_corrtag_a.fits to ./mastDownload/HST/lc1va0yeq/lc1va0yeq_corrtag_a.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lc1va0yjq_corrtag_a.fits to ./mastDownload/HST/lc1va0yjq/lc1va0yjq_corrtag_a.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lc1va0zcq_corrtag_a.fits to ./mastDownload/HST/lc1va0zcq/lc1va0zcq_corrtag_a.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lc1va0zgq_corrtag_a.fits to ./mastDownload/HST/lc1va0zgq/lc1va0zgq_corrtag_a.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#####
Found 4 corrtag exposure files from the COS FUV detector (segment A only)
</pre></div>
</div>
</div>
</div>
<p><a id= exSpdata></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="examining-the-data-to-determine-how-to-split-the-files">
<h1>1. Examining the data to determine how to split the files<a class="headerlink" href="#examining-the-data-to-determine-how-to-split-the-files" title="Permalink to this heading">#</a></h1>
<p>We chose this dataset because of its transit event. However, let’s suppose for a moment that we don’t know which, if any, of our exposures have transits or other time-variable events. We’ll imagine we are simply investigating our data.</p>
<p><strong>To look for transits and other anomalies, we will create and examine a rough lightcurve of our four exposures.</strong></p>
<p>A <a class="reference external" href="https://en.wikipedia.org/wiki/Light_curve">lightcurve</a> is simply a graph of net light or photon counts over time. We can make one by grabbing the time of all recorded photon events from each exposure, and plotting a histogram of the times. There are packages which can create detailed lightcurves, such as the <a class="reference external" href="https://github.com/justincely/lightcurve">lightcurve</a> package, but we will make these simple lightcurve plots ourselves. We also do not claim to explain every feature of all the lightcurves created. We will focus on any clear transit shapes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build the figure structure with subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                         <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Get the time data for each exposure</span>
<span class="c1"># Number of seconds in a bin</span>
<span class="n">binsize</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ctag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">downloaded_corrtags</span><span class="p">):</span>
    <span class="c1"># Make the subplot</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">])</span>
    <span class="c1"># Read the data into a table</span>
    <span class="n">ctab</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ctag</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">event_times</span> <span class="o">=</span> <span class="n">ctab</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span>
    <span class="c1"># Plot the histogram of times</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
        <span class="n">event_times</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">event_times</span><span class="p">)</span><span class="o">+</span><span class="n">binsize</span><span class="p">,</span> <span class="n">binsize</span><span class="p">),</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">ctag</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;C3&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># Add a gray box around the suspected transit:</span>
    <span class="k">if</span> <span class="s2">&quot;zgq&quot;</span> <span class="ow">in</span> <span class="n">ctag</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span>
            <span class="mi">450</span><span class="p">,</span> <span class="mi">850</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Approximate time of transit&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Storing the path of this transit exposure for next cell</span>
        <span class="n">transit_exp</span> <span class="o">=</span> <span class="n">ctag</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Format the figure and add text:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Fig 1.1</span><span class="se">\n</span><span class="s2">Rough lightcurves of exposures&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="mf">0.42</span><span class="p">,</span> <span class="n">y</span><span class="o">=-</span><span class="mf">0.0001</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="s2">&quot;Time from exposure start [s]&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">0.42</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mf">0.001</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Counts in ~</span><span class="si">{</span><span class="n">binsize</span><span class="si">}</span><span class="s2"> second bin&quot;</span><span class="p">,</span>
    <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span> <span class="o">/</span> <span class="s1">&#39;compare_exposures.png&#39;</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/7b730d4bdfc839a7f1850c9a240022437d4fa6f46db0123281cbbb0ec8f146b5.png" src="../../../_images/7b730d4bdfc839a7f1850c9a240022437d4fa6f46db0123281cbbb0ec8f146b5.png" />
</div>
</div>
<p>We can see an apparent transit in the exposure <code class="docutils literal notranslate"><span class="pre">lc1va0zgq</span></code>, occurring from about 450 - 850 seconds into the exposure. We highlight this in Figure 1.2 below.</p>
<p>Exposure <code class="docutils literal notranslate"><span class="pre">lc1va0yeq</span></code> also seems to contain at least the latter part of a transit, but for now we’ll focus on <code class="docutils literal notranslate"><span class="pre">lc1va0zgq</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the plot:</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Select the data and plot it:</span>
<span class="c1"># Binsize in seconds</span>
<span class="n">binsize</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># Reading the corrtag table for this exposure</span>
<span class="n">ctab</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">transit_exp</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># Getting the event times</span>
<span class="n">event_times</span> <span class="o">=</span> <span class="n">ctab</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span>
<span class="n">hist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">event_times</span><span class="p">,</span>
                <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">event_times</span><span class="p">)</span><span class="o">+</span><span class="n">binsize</span><span class="p">,</span> <span class="n">binsize</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># Add time ranges &quot;epochs&quot; or &quot;windows of time&quot; as transparent spans:</span>
<span class="n">epoch_markers</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">550</span><span class="p">),</span> <span class="p">(</span><span class="mi">550</span><span class="p">,</span> <span class="mi">850</span><span class="p">),</span> <span class="p">(</span><span class="mi">850</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">event_times</span><span class="p">))]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The length of the exposure is ~</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">event_times</span><span class="p">))</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
<span class="n">epoch_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Before Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;During Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;After Transit&quot;</span><span class="p">]</span>

<span class="c1"># Adding color to distinguish before, during, and after the transit</span>
<span class="k">for</span> <span class="n">epoch_time</span><span class="p">,</span> <span class="n">epoch_label</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">epoch_markers</span><span class="p">,</span> <span class="n">epoch_labels</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span>
        <span class="n">epoch_time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">epoch_time</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">epoch_label</span>
    <span class="p">)</span>

<span class="c1"># Format the Figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Getting the transit file basename</span>
<span class="n">transit_basename</span> <span class="o">=</span> <span class="n">transit_exp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fig 1.2</span><span class="se">\n</span><span class="s2">Rough lightcurves of exposure </span><span class="si">{</span><span class="n">transit_basename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
          <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time from exposure start [s]&quot;</span><span class="p">,</span>
           <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;Counts in ~</span><span class="si">{</span><span class="n">binsize</span><span class="si">}</span><span class="s2"> second bin&quot;</span><span class="p">,</span>
           <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span> <span class="o">/</span> <span class="s1">&#39;examine_transit.png&#39;</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The length of the exposure is ~1337 s
</pre></div>
</div>
<img alt="../../../_images/e1bf1c4a62542c3de2299967c203d15dcea088e8e295404583e42c3c5388e311.png" src="../../../_images/e1bf1c4a62542c3de2299967c203d15dcea088e8e295404583e42c3c5388e311.png" />
</div>
</div>
<p><strong>We now wish to actually split the file into three sub-exposures with the counts gathered during these three windows of time.</strong></p>
<p>For research purposes, the transit should be measured more carefully than simply looking at this rough lightcurve. However for our purposes, we explicitly and somewhat arbitrarily define the windows, ‘by eye’, as:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Window</p></th>
<th class="head"><p>Time Range</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Before Transit</p></td>
<td><p>0-550 seconds</p></td>
</tr>
<tr class="row-odd"><td><p>During Transit</p></td>
<td><p>550-850 seconds</p></td>
</tr>
<tr class="row-even"><td><p>After Transit</p></td>
<td><p>850-1337 seconds</p></td>
</tr>
</tbody>
</table>
</div>
<p><a id=SpSp></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="using-splittag-to-create-multiple-sub-exposure-files">
<h1>2. Using <code class="docutils literal notranslate"><span class="pre">splittag</span></code> to create multiple sub-exposure files<a class="headerlink" href="#using-splittag-to-create-multiple-sub-exposure-files" title="Permalink to this heading">#</a></h1>
<p>The next cell creates a directory for the sub-exposure files we’re about to create, and uses <code class="docutils literal notranslate"><span class="pre">splittag</span></code> to split the exposures.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">time_list</span></code> parameter defines the times at which the exposure will be split. Because we pass this parameter the list <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">550,</span> <span class="pre">850,</span> <span class="pre">&lt;time</span> <span class="pre">of</span> <span class="pre">last</span> <span class="pre">recorded</span> <span class="pre">count&gt;]</span></code>, <code class="docutils literal notranslate"><span class="pre">splittag</span></code> will produce 3 sub-exposure files with data taken from:</p>
<ol class="arabic simple">
<li><p>0-550 seconds</p></li>
<li><p>550-850 seconds</p></li>
<li><p>850-1337 seconds (because the <code class="docutils literal notranslate"><span class="pre">&lt;time</span> <span class="pre">of</span> <span class="pre">last</span> <span class="pre">recorded</span> <span class="pre">count&gt;</span></code> for this exposure ~1337 s)</p></li>
</ol>
<p><em>Please note</em> that <code class="docutils literal notranslate"><span class="pre">splittag</span></code> will <strong>not</strong> overwrite files if you run it multiple times. Instead, it will write a new set of files with increasing numeric suffixes (e.g. <code class="docutils literal notranslate"><span class="pre">filepath_corrtag_a.fits</span></code> –&gt; <code class="docutils literal notranslate"><span class="pre">filepath_1_corrtag_a.fits</span></code>). This can cause issues if you do not update your filepaths to the output files you wish to use. To prevent problems, we will delete any older <code class="docutils literal notranslate"><span class="pre">corrtag</span></code> files in the directory. If you do not wish to delete your old files, set the <code class="docutils literal notranslate"><span class="pre">delete_old_files</span></code> variable to <code class="docutils literal notranslate"><span class="pre">False</span></code> in the cell below. Alternatively, you may wish to create a new directory for each time you run <code class="docutils literal notranslate"><span class="pre">splittag</span></code>. Please take care to prevent these issues when attempting the exercises, as well. You may ignore any <code class="docutils literal notranslate"><span class="pre">AstropyDeprecationWarnings</span></code> about keywords.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make the folder in which to store the newly split corrtag files:</span>
<span class="n">spec_int_dir</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;spec_intervals&#39;</span>
<span class="c1"># An output directory for files split on specified intervals</span>
<span class="n">spec_int_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Use CAUTION when deleting files - as in the next lines:</span>

<span class="c1"># These lines delete existing processed files in the output directory</span>
<span class="c1"># If you have run this cell before, this will overwrite previous outputs</span>
<span class="n">delete_old_files</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">delete_old_files</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">spec_int_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*corrtag*fits&quot;</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deleting files from a previous run...&quot;</span><span class="p">)</span>
    <span class="p">[</span><span class="n">old_f</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span> <span class="k">for</span> <span class="n">old_f</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">spec_int_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*corrtag*fits&quot;</span><span class="p">))]</span>

<span class="c1"># Print info to the user:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating and writing split files...&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">epoch_times</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">epoch_markers</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;&gt; File </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> contains counts from time:&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">epoch_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">epoch_times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
    <span class="p">)</span>

<span class="n">split_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">550</span><span class="p">,</span> <span class="mi">850</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">event_times</span><span class="p">)]</span>

<span class="c1"># Run splittag using our specified times:</span>
<span class="n">splittag</span><span class="o">.</span><span class="n">splittag</span><span class="p">(</span><span class="n">infiles</span><span class="o">=</span><span class="n">transit_exp</span><span class="p">,</span>
                  <span class="n">outroot</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;./output/spec_intervals/</span><span class="si">{</span><span class="n">transit_basename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                  <span class="n">time_list</span><span class="o">=</span><span class="n">split_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Creating and writing split files...
&gt; File 1 contains counts from time: 0 - 550 seconds
&gt; File 2 contains counts from time: 550 - 850 seconds
&gt; File 3 contains counts from time: 850 - 1337.2159423828125 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/spec_intervals/lc1va0zgq_1_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/spec_intervals/lc1va0zgq_2_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/spec_intervals/lc1va0zgq_3_corrtag_a.fits written
</pre></div>
</div>
</div>
</div>
<p><strong>Excellent! We’ve now created 3 sub-exposure files.</strong></p>
<p>Below, we show the lightcurves of sub-exposure files which resulted from splitting at the specified intervals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the plot:</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Gather the split sub-exposure files:</span>
<span class="n">spec_outlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./output/spec_intervals/*fits&#39;</span><span class="p">))</span>

<span class="c1"># Make histogram lightcurves as in previous plots:</span>

<span class="c1"># Binsize of lightcurve histogram in seconds</span>
<span class="n">binsize</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># For each of our newly split up files:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec_outlist</span><span class="p">)):</span>
    <span class="n">splitfile</span> <span class="o">=</span> <span class="n">spec_outlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">epoch_number</span> <span class="o">=</span> <span class="n">splitfile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># Read in the file as a table of events:</span>
    <span class="n">events_table</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">splitfile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">event_times</span> <span class="o">=</span> <span class="n">events_table</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
        <span class="n">event_times</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">event_times</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">event_times</span><span class="p">))</span><span class="o">/</span><span class="n">binsize</span><span class="p">),</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;sub-exposure </span><span class="si">{</span><span class="n">epoch_number</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

<span class="c1"># Add time ranges &quot;epochs&quot; or &quot;windows of time&quot; as transparent spans:</span>
<span class="k">for</span> <span class="n">epoch_time</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">epoch_markers</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span>
        <span class="n">epoch_time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">epoch_time</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

<span class="c1"># Format the Figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Fig 2.1</span><span class="se">\n</span><span class="s2">Examining the split sub-exposures created &quot;</span>
          <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="n">transit_basename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
          <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time from $original$ exposure start [s]&quot;</span><span class="p">,</span>
           <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;Counts in ~</span><span class="si">{</span><span class="n">binsize</span><span class="si">}</span><span class="s2"> second bin&quot;</span><span class="p">,</span>
           <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span> <span class="o">/</span> <span class="s1">&#39;subexps.png&#39;</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/34740308154cdd6b56a70548493af685be25b7d989f439207cf31f855c1cd477.png" src="../../../_images/34740308154cdd6b56a70548493af685be25b7d989f439207cf31f855c1cd477.png" />
</div>
</div>
<p>Now that we have the three sub-exposure files, we can process them into 1-dimensional spectra using the <a class="reference external" href="https://github.com/spacetelescope/calcos">COS Calibration Pipeline: <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></a>.</p>
<section id="exercise-1-practice-sub-dividing-with-splittag">
<h2>Exercise 1: <em>Practice sub-dividing with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></em><a class="headerlink" href="#exercise-1-practice-sub-dividing-with-splittag" title="Permalink to this heading">#</a></h2>
<p>Examining Fig 2.1, we see that from approximately 450-550 seconds, there is are in fact 2 drops in flux. Starting from an initial flux similar to that at the start of the exposure, the flux drops first by ~50% at around 450 seconds, and then drops by ~75% at around 550 seconds to its depth for the duration of the transit.</p>
<p>Separate out the data taken during this initial drop (from ~450-550 seconds) into its own sub-exposure file using <code class="docutils literal notranslate"><span class="pre">splittag</span></code>. Then, demonstrate your split files with a lightcurve like that in Fig 2.1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your code here:</span>
</pre></div>
</div>
</div>
</div>
<p><a id=extractSp></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="extracting-spectra-from-the-sub-exposures-using-calcos">
<h1>3. Extracting spectra from the sub-exposures using <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code><a class="headerlink" href="#extracting-spectra-from-the-sub-exposures-using-calcos" title="Permalink to this heading">#</a></h1>
<p>While for most circumstances, <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> is best run on an association file, (a FITS table which specifies a series of exposures to calibrate and combine into a spectrum,) the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> pipeline can usually be run on individual <code class="docutils literal notranslate"><span class="pre">rawtag</span></code> or <code class="docutils literal notranslate"><span class="pre">corrtag</span></code> files.</p>
<ul class="simple">
<li><p>More information on running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> can be found in <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-3-cos-calibration/3-6-customizing-cos-data-calibration#id-3.6CustomizingCOSDataCalibration-3.6.1MechanicsofTailoredRecalibration">Chapter 3.6 of the COS Instrument Handbook</a></p></li>
<li><p>An interactive walkthrough to running the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> can be found in <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/CalCOS/CalCOS.ipynb">our notebook on the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> pipeline</a>.</p></li>
</ul>
<p><a id=setlref></a></p>
<section id="getting-the-lref-reference-files">
<h2>3.1 Getting the <code class="docutils literal notranslate"><span class="pre">lref</span></code> reference files<a class="headerlink" href="#getting-the-lref-reference-files" title="Permalink to this heading">#</a></h2>
<p>To run <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>, your computer will need an <code class="docutils literal notranslate"><span class="pre">lref</span></code> system variable to tell the pipeline where to find your reference files. If you are on the STScI internet network (including via VPN), you may set this to the shared Institute <code class="docutils literal notranslate"><span class="pre">lref</span></code> directory. However, if you’re not on the network, you will need to use the <code class="docutils literal notranslate"><span class="pre">CRDS</span></code> command to download the necessary reference files. This process is described in detail in Chapter 3 of our <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/Setup/Setup.ipynb#crdsS">notebook on setting up an environment for working with COS data</a>.</p>
<p>The code in this cell ensures that the “lref” path is correctly set in the environment variables and the crds files will be downloaded.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CRDS_SERVER_URL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://hst-crds.stsci.edu&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CRDS_PATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./crds_cache&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;lref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./crds_cache/references/hst/cos&quot;</span>

<span class="o">!</span>crds<span class="w"> </span>sync<span class="w"> </span>--contexts<span class="w"> </span>hst_cos_0358.imap<span class="w"> </span>--fetch-references<span class="w"> </span>
<span class="n">clear_output</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><a id=#runcalcos></a></p>
</section>
<section id="running-calcos-and-processing-sub-exposure-files">
<h2>3.2 Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> and processing sub-exposure files<a class="headerlink" href="#running-calcos-and-processing-sub-exposure-files" title="Permalink to this heading">#</a></h2>
<p><strong>We can now run the pipeline on each of our new sub-exposure files to create processed spectra based on data taken in the three time periods.</strong></p>
<p>The cells may take several minutes to run.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># When we run CalCOS on corrtags, we must go 1-by-1</span>
<span class="k">for</span> <span class="n">split_corrtag</span> <span class="ow">in</span> <span class="n">spec_outlist</span><span class="p">:</span>
    <span class="c1"># Define epoch as chunk of the initial exposure. epoch 2 = the transit.</span>
    <span class="n">epoch_number</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">split_corrtag</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracting file </span><span class="si">{</span><span class="n">split_corrtag</span><span class="si">}</span><span class="s2"> using CalCOS&quot;</span><span class="p">)</span>

    <span class="c1"># Make a sub-directory of output/calcos/ named for each epoch:</span>
    <span class="n">cal_output_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;./output/calcos/epoch</span><span class="si">{</span><span class="n">epoch_number</span><span class="si">}</span><span class="s1">/&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">cal_output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Extract the spectrum from each of the sub-exposures:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">calcos</span><span class="o">.</span><span class="n">calcos</span><span class="p">(</span><span class="n">split_corrtag</span><span class="p">,</span>
                      <span class="n">outdir</span><span class="o">=</span><span class="n">cal_output_dir</span><span class="p">,</span>
                      <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An error occured&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="c1"># Print a message at the end to let us know it&#39;s finished:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done running the pipeline.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Extracting file ./output/spec_intervals/lc1va0zgq_1_corrtag_a.fits using CalCOS
CALCOS version 3.6.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy version 1.26.0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>astropy version 7.1.0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Begin 17-Sep-2025 23:08:40 UTC
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR:  The following reference files are missing:
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>disptab=./crds_cache/references/hst/cos/97h1816gl_disp.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fluxtab=./crds_cache/references/hst/cos/97h18182l_phot.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tdstab=./crds_cache/references/hst/cos/97h18216l_tds.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xtractab=./crds_cache/references/hst/cos/97h1818el_1dx.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>An error occured 
Extracting file ./output/spec_intervals/lc1va0zgq_2_corrtag_a.fits using CalCOS
CALCOS version 3.6.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy version 1.26.0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>astropy version 7.1.0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR:  The following reference files are missing:
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>disptab=./crds_cache/references/hst/cos/97h1816gl_disp.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fluxtab=./crds_cache/references/hst/cos/97h18182l_phot.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tdstab=./crds_cache/references/hst/cos/97h18216l_tds.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xtractab=./crds_cache/references/hst/cos/97h1818el_1dx.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>An error occured 
Extracting file ./output/spec_intervals/lc1va0zgq_3_corrtag_a.fits using CalCOS
CALCOS version 3.6.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy version 1.26.0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>astropy version 7.1.0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR:  The following reference files are missing:
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>disptab=./crds_cache/references/hst/cos/97h1816gl_disp.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fluxtab=./crds_cache/references/hst/cos/97h18182l_phot.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tdstab=./crds_cache/references/hst/cos/97h18216l_tds.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xtractab=./crds_cache/references/hst/cos/97h1818el_1dx.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>An error occured 
Done running the pipeline.
</pre></div>
</div>
</div>
</div>
<p><strong>Now, we can examine our newly processed spectra</strong></p>
<p>We first examine the entire spectrum:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find all the `x1d` files:</span>
<span class="n">processed_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;output/calcos/epoch*/*x1d.fits&#39;</span><span class="p">))</span>
<span class="n">num_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">processed_files</span><span class="p">)</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">processed_files</span><span class="p">))</span>

<span class="c1"># Set up figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># Loop through</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_files</span><span class="p">)):</span>
    <span class="n">epoch_label</span> <span class="o">=</span> <span class="n">processed_files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Mark the transit</span>
    <span class="k">if</span> <span class="s2">&quot;2&quot;</span> <span class="ow">in</span> <span class="n">epoch_label</span><span class="p">:</span>
        <span class="n">epoch_label</span> <span class="o">+=</span> <span class="s2">&quot; (transit)&quot;</span>
        <span class="n">alpha_value</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alpha_value</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                                <span class="n">category</span><span class="o">=</span><span class="n">UnitsWarning</span><span class="p">,</span>
                                <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ferr</span><span class="p">,</span> <span class="n">dq</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
            <span class="n">processed_files</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">,</span> <span class="s1">&#39;FLUX&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span> <span class="s1">&#39;DQ&#39;</span><span class="p">]</span>

    <span class="c1"># Filter to good quality data</span>
    <span class="n">dq_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ferr</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">dq_mask</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">dq_mask</span><span class="p">],</span> <span class="n">ferr</span><span class="p">[</span><span class="n">dq_mask</span><span class="p">]</span>

    <span class="c1"># Plot each epoch</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span>
             <span class="c1"># Epoch2 should stand out</span>
             <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_value</span><span class="p">,</span>
             <span class="n">c</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
             <span class="c1"># Label with the epoch name</span>
             <span class="n">label</span><span class="o">=</span><span class="n">epoch_label</span><span class="p">)</span>

<span class="c1"># Format plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">3E-15</span><span class="p">,</span> <span class="mf">5E-14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Fig 3.1</span><span class="se">\n</span><span class="s2">Comparison of processed spectra&quot;</span><span class="p">,</span>
          <span class="n">size</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Wavelength [$\AA$]&quot;</span><span class="p">,</span>
           <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Flux [$ergs\ cm^{-2} \AA^{-1}s^{-1}$]&quot;</span><span class="p">,</span>
           <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span> <span class="o">/</span> <span class="s2">&quot;Compare_spectrum.png&quot;</span><span class="p">,</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2768/1060791704.py:52: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  plt.legend()
</pre></div>
</div>
<img alt="../../../_images/e37117e7ba9cc2d4556963dbdb7dc9042b54acd8d82a9c134e2adf0b14b7f3bd.png" src="../../../_images/e37117e7ba9cc2d4556963dbdb7dc9042b54acd8d82a9c134e2adf0b14b7f3bd.png" />
</div>
</div>
<p>Now we can take a closer look at two spectral regions the region from 1200 - 1230 and from 1250 - 1350 Angstroms.
In the first region, we see the 1215 Angstrom Lyman-alpha line, much of which is <a class="reference external" href="https://www.stsci.edu/hst/instrumentation/cos/calibration/airglow">generated by geocoronal emission</a>. At this line, the flux of the the three epochs is very similar, because the transit in the IY UMa system has no effect on Earth’s atmosphere. There are slight differences because the sun’s changing position in the sky changes the geocoronal glow. This causes the third sub-exposure to have a slightly higher Lyman-alpha line. However these are small differences compared to the flux of these lines.</p>
<p>For this and the following plots, we will plot the errors as well, to see if the apparent differences in flux between epochs are significant.</p>
<section id="for-the-1200-1230-angstrom-region">
<h3><strong>For the 1200 - 1230 Angstrom region:</strong><a class="headerlink" href="#for-the-1200-1230-angstrom-region" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                               <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
                               <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_files</span><span class="p">)):</span>
    <span class="n">epoch_label</span> <span class="o">=</span> <span class="n">processed_files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;2&quot;</span> <span class="ow">in</span> <span class="n">epoch_label</span><span class="p">:</span>
        <span class="n">epoch_label</span> <span class="o">+=</span> <span class="s2">&quot; (transit)&quot;</span>
        <span class="n">alpha_value</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alpha_value</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                                <span class="n">category</span><span class="o">=</span><span class="n">UnitsWarning</span><span class="p">,</span>
                                <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ferr</span><span class="p">,</span> <span class="n">dq</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
            <span class="n">processed_files</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">,</span> <span class="s1">&#39;FLUX&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span> <span class="s1">&#39;DQ&#39;</span><span class="p">]</span>

    <span class="c1"># Filter to good quality data</span>
    <span class="n">dq_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ferr</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">dq_mask</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">dq_mask</span><span class="p">],</span> <span class="n">ferr</span><span class="p">[</span><span class="n">dq_mask</span><span class="p">]</span>

    <span class="c1"># Plot each epoch</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span>
             <span class="c1"># Epoch2 should stand out</span>
             <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_value</span><span class="p">,</span>
             <span class="n">c</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
             <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
             <span class="c1"># Label with the epoch name</span>
             <span class="n">label</span><span class="o">=</span><span class="n">epoch_label</span><span class="p">)</span>

    <span class="c1"># Plot each epoch</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">ferr</span><span class="p">,</span>
                 <span class="c1"># Epoch2 should stand out</span>
                 <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_value</span><span class="p">,</span>
                 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                 <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                 <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">ecolor</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                 <span class="c1"># Label with the epoch name</span>
                 <span class="n">label</span><span class="o">=</span><span class="n">epoch_label</span><span class="p">)</span>

<span class="c1"># Format both subplots</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">1230</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1E-13</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1E-13</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Top: Simple plot&quot;</span><span class="p">,</span>
              <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Bottom: Errorbar plot&quot;</span><span class="p">,</span>
              <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
    <span class="s2">&quot;Fig 3.2</span><span class="se">\n</span><span class="s2">Comparison of processed spectra - 1200 - 1230 Angstrom&quot;</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">24</span>
<span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Wavelength [$\AA$]&quot;</span><span class="p">,</span>
               <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Flux [$ergs\ cm^{-2} \AA^{-1}s^{-1}$]&quot;</span><span class="p">,</span>
               <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Flux [$ergs\ cm^{-2} \AA^{-1}s^{-1}$]&quot;</span><span class="p">,</span>
               <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span> <span class="o">/</span> <span class="s2">&quot;Compare_spectrum_zoom_1215A.png&quot;</span><span class="p">,</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2768/3563608290.py:67: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  ax0.legend()
/tmp/ipykernel_2768/3563608290.py:68: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  ax1.legend()
</pre></div>
</div>
<img alt="../../../_images/fb31bd3966debff7a2c352b4d0d2cdee837b2d6c5ec448d185a4d1c6683d5deb.png" src="../../../_images/fb31bd3966debff7a2c352b4d0d2cdee837b2d6c5ec448d185a4d1c6683d5deb.png" />
</div>
</div>
</section>
<section id="for-the-1250-1350-angstrom-region">
<h3><strong>For the 1250 - 1350 Angstrom region:</strong><a class="headerlink" href="#for-the-1250-1350-angstrom-region" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                               <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
                               <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_files</span><span class="p">)):</span>
    <span class="n">epoch_label</span> <span class="o">=</span> <span class="n">processed_files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;2&quot;</span> <span class="ow">in</span> <span class="n">epoch_label</span><span class="p">:</span>
        <span class="n">epoch_label</span> <span class="o">+=</span> <span class="s2">&quot; (transit)&quot;</span>
        <span class="n">alpha_value</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alpha_value</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                                <span class="n">category</span><span class="o">=</span><span class="n">UnitsWarning</span><span class="p">,</span>
                                <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ferr</span><span class="p">,</span> <span class="n">dq</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
            <span class="n">processed_files</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">,</span> <span class="s1">&#39;FLUX&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span> <span class="s1">&#39;DQ&#39;</span><span class="p">]</span>

    <span class="c1"># Filter to good quality data</span>
    <span class="n">dq_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ferr</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">dq_mask</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">dq_mask</span><span class="p">],</span> <span class="n">ferr</span><span class="p">[</span><span class="n">dq_mask</span><span class="p">]</span>

    <span class="c1"># Plot each epoch</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span>
             <span class="c1"># Epoch2 should stand out</span>
             <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_value</span><span class="p">,</span>
             <span class="n">c</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
             <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
             <span class="c1"># Label with the epoch name</span>
             <span class="n">label</span><span class="o">=</span><span class="n">epoch_label</span><span class="p">)</span>

    <span class="c1"># Plot each epoch</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">ferr</span><span class="p">,</span>
                 <span class="c1"># Epoch2 should stand out</span>
                 <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_value</span><span class="p">,</span>
                 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                 <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                 <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">ecolor</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                 <span class="c1"># Label with the epoch name</span>
                 <span class="n">label</span><span class="o">=</span><span class="n">epoch_label</span><span class="p">)</span>

<span class="c1"># Format both subplots:</span>
<span class="c1"># Zoom to 1250-1350 Angstrom</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1250</span><span class="p">,</span> <span class="mi">1350</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1250</span><span class="p">,</span> <span class="mi">1350</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">5.E-16</span><span class="p">,</span> <span class="mf">1.1E-14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">5.E-16</span><span class="p">,</span> <span class="mf">1.1E-14</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Top: Simple plot&quot;</span><span class="p">,</span>
              <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Bottom: Errorbar plot&quot;</span><span class="p">,</span>
              <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
    <span class="s2">&quot;Fig 3.3</span><span class="se">\n</span><span class="s2">Comparison of processed spectra - 1250 - 1350 Angstrom&quot;</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">24</span>
<span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Wavelength [$\AA$]&quot;</span><span class="p">,</span>
               <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Flux [$ergs\ cm^{-2} \AA^{-1}s^{-1}$]&quot;</span><span class="p">,</span>
               <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Flux [$ergs\ cm^{-2} \AA^{-1}s^{-1}$]&quot;</span><span class="p">,</span>
               <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span> <span class="o">/</span> <span class="s2">&quot;Compare_spectrum_zoom.png&quot;</span><span class="p">,</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2768/643280535.py:71: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  ax0.legend()
/tmp/ipykernel_2768/643280535.py:72: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  ax1.legend()
</pre></div>
</div>
<img alt="../../../_images/c2be8e927fdb6f3d8dc7a7d39de2e9e089505c40a9ada83621457183423beea5.png" src="../../../_images/c2be8e927fdb6f3d8dc7a7d39de2e9e089505c40a9ada83621457183423beea5.png" />
</div>
</div>
<p>Examining Fig 3.3, we first notice that the very low number of counts in a given wavelength region has limited our spectra’s precision. This is especially evidenced by how epoch 2’s flux is visibly quantized to several values, corresponding with the very low numbers of counted photons in each wavelength bin.</p>
<p>However, we can still detect a significant change in the spectrum during the transit, with certain spectral features absent or suppressed while the transit occurs. During the transit, COS receives almost no photons coming from the source at these spectral features.</p>
<p><a id="reg"></a></p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="creating-multiple-sub-exposure-files-at-regular-intervals">
<h1>4. Creating multiple sub-exposure files at regular intervals<a class="headerlink" href="#creating-multiple-sub-exposure-files-at-regular-intervals" title="Permalink to this heading">#</a></h1>
<p>Above, we split an input exposure at a series of specified times.
The <code class="docutils literal notranslate"><span class="pre">splittag</span></code> command can also be used to split at regular time intervals. For instance, you can split the file every 100 seconds as shown in the code below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make the folder in which to store the newly split corrtag files:</span>
<span class="n">reg_int_dir</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;regular_intervals&#39;</span>
<span class="c1"># Output directory for intervals specified by start/end/length</span>
<span class="n">reg_int_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Split the file every 100 seconds</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">reg_int_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()):</span>
    <span class="n">splittag</span><span class="o">.</span><span class="n">splittag</span><span class="p">(</span>
        <span class="n">infiles</span><span class="o">=</span><span class="n">transit_exp</span><span class="p">,</span>
        <span class="n">outroot</span><span class="o">=</span><span class="s1">&#39;./output/regular_intervals/lc1va0zgq&#39;</span><span class="p">,</span>
        <span class="n">starttime</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">increment</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">endtime</span><span class="o">=</span><span class="mf">1300.</span>
    <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;files already exist&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_1_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_2_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_3_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_4_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_5_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_6_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_7_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_8_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_9_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_10_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_11_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_12_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./output/regular_intervals/lc1va0zgq_13_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>files already exist
</pre></div>
</div>
</div>
</div>
<p>Similarly to our 3 epoch sub-exposures, we can show the light curve of our 100s regularly spaced sub-exposure files:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creating an array of colors for this exposure to be used in plotting</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;red&#39;</span><span class="p">,</span>
    <span class="s1">&#39;firebrick&#39;</span><span class="p">,</span>
    <span class="s1">&#39;saddlebrown&#39;</span><span class="p">,</span>
    <span class="s1">&#39;darkorange&#39;</span><span class="p">,</span>
    <span class="s1">&#39;purple&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lightseagreen&#39;</span><span class="p">,</span>
    <span class="s1">&#39;teal&#39;</span><span class="p">,</span>
    <span class="s1">&#39;deepskyblue&#39;</span><span class="p">,</span>
    <span class="s1">&#39;steelblue&#39;</span><span class="p">,</span>
    <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rebeccapurple&#39;</span><span class="p">,</span>
    <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lightslategrey&#39;</span>
<span class="p">]</span>

<span class="c1"># Create the plot:</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Gather the split sub-exposure files:</span>
<span class="n">spec_outlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./output/regular_intervals/*fits&#39;</span><span class="p">))</span>

<span class="c1"># Make histogram lightcurves as in previous plots:</span>
<span class="c1"># Binsize of lightcurve histogram in seconds</span>
<span class="n">binsize</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># For each of our newly split up files:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec_outlist</span><span class="p">)):</span>
    <span class="n">splitfile</span> <span class="o">=</span> <span class="n">spec_outlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">epoch_number</span> <span class="o">=</span> <span class="n">splitfile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Read in the file as a table of events:</span>
    <span class="n">events_table</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">splitfile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">event_times</span> <span class="o">=</span> <span class="n">events_table</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span>

    <span class="n">hist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
        <span class="n">event_times</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">event_times</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">event_times</span><span class="p">))</span><span class="o">/</span><span class="n">binsize</span><span class="p">),</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;sub-exp </span><span class="si">{</span><span class="n">epoch_number</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

<span class="c1"># Add time ranges &quot;epochs&quot; or &quot;windows of time&quot; as transparent spans:</span>
<span class="k">for</span> <span class="n">epoch_time</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">epoch_markers</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span>
        <span class="n">epoch_time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">epoch_time</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

<span class="c1"># Format the Figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fig 2.1</span><span class="se">\n</span><span class="s2">Examining split sub-exp created from </span><span class="si">{</span><span class="n">transit_basename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
          <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time from $original$ exposure start [s]&quot;</span><span class="p">,</span>
           <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;Counts in $\sim$</span><span class="si">{</span><span class="n">binsize</span><span class="si">}</span><span class="s2"> second bin&quot;</span><span class="p">,</span>
           <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span> <span class="o">/</span> <span class="s1">&#39;subexps.png&#39;</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/7da1b08769aec3dd3e69d5a304dd428eb885968d851100057667684ceeab609f.png" src="../../../_images/7da1b08769aec3dd3e69d5a304dd428eb885968d851100057667684ceeab609f.png" />
</div>
</div>
<section id="exercise-2-examining-epoch-1-5">
<h2>Exercise 2: <em>Examining epoch 1.5</em><a class="headerlink" href="#exercise-2-examining-epoch-1-5" title="Permalink to this heading">#</a></h2>
<p>From Exercise 1, you have an additional epoch, from 450-550 seconds, which overlaps with the end of epoch 1, and has a flux between epoch 1 and epoch 2.</p>
<p>We wish to know whether the data taken during epoch 1.5 more closely aligns with that during epoch 1 or 2. To analyze this,</p>
<ul class="simple">
<li><p><strong>2.1:</strong> Run epoch 1.5’s data through <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></p></li>
<li><p><strong>2.2:</strong> Plot epoch 1.5 alongside epochs 1 and 2 in the wavelength range around 1275 Å (<em>i.e. recreate Fig. 3.2 without epoch 3 and with epoch 1.5</em>).</p></li>
<li><p><strong>2.3:</strong> Briefly analyze whether epoch 1.5 is more in line with epoch 1 or 2, and consider how this knowledge may be useful. Consider whether our approach here to answering this question has any major flaws.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your code here:</span>
</pre></div>
</div>
</div>
</div>
<p><strong>This is certainly not an exhaustive analysis,</strong> and we do not claim in this Notebook to have made any measurements confirming or quantifying a transit.</p>
<p>However, you should now be equipped to use the <code class="docutils literal notranslate"><span class="pre">splittag</span></code> tool to subdivide exposures to look for time-variable phenomena.</p>
</section>
<section id="congratulations-you-finished-this-notebook">
<h2>Congratulations! You finished this Notebook!<a class="headerlink" href="#congratulations-you-finished-this-notebook" title="Permalink to this heading">#</a></h2>
<p><font size="5">There are more COS data walkthrough Notebooks on different topics. You can find them <a href="https://github.com/spacetelescope/hst_notebooks/tree/main/notebooks/COS">here</a>.</font></p>
</section>
<hr class="docutils" />
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this heading">#</a></h2>
<p><strong>Author:</strong> Nat Kerman: <a class="reference external" href="mailto:nkerman&#37;&#52;&#48;stsci&#46;edu">nkerman<span>&#64;</span>stsci<span>&#46;</span>edu</a></p>
<p><strong>Contributors:</strong> This Notebook drew from a previously existing <a class="reference external" href="https://github.com/justincely/AAS224/blob/master/splittag_tutorial.ipynb">Notebook written by Justin Ely</a>.</p>
<p><strong>Updated On:</strong> 2022-01-04</p>
<blockquote>
<div><p><em>This tutorial was generated to be in compliance with the <a class="reference external" href="https://github.com/spacetelescope/style-guides">STScI style guides</a> and would like to cite the <a class="reference external" href="https://github.com/spacetelescope/style-guides/blob/master/templates/example_notebook.ipynb">Jupyter guide</a> in particular.</em></p>
</div></blockquote>
</section>
<section id="citations">
<h2>Citations<a class="headerlink" href="#citations" title="Permalink to this heading">#</a></h2>
<p>If you use <code class="docutils literal notranslate"><span class="pre">astropy</span></code>, <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>, <code class="docutils literal notranslate"><span class="pre">astroquery</span></code>, or <code class="docutils literal notranslate"><span class="pre">numpy</span></code> for published research, please cite the
authors. Follow these links for more information about citations:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/citing-numpy/">Citing <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.astropy.org/acknowledging.html">Citing <code class="docutils literal notranslate"><span class="pre">astropy</span></code></a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/3.4.3/citing.html">Citing <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></p></li>
<li><p><a class="reference external" href="https://astroquery.readthedocs.io/en/latest/">Citing <code class="docutils literal notranslate"><span class="pre">astroquery</span></code></a></p></li>
</ul>
<hr>
<p><span class="xref myst">Top of Page</span>
<a class="reference internal" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a></p>
<p><br></br>
<br></br>
<br></br></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exercise-solutions">
<h1>Exercise Solutions<a class="headerlink" href="#exercise-solutions" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exercise 1:</span>

<span class="c1"># Make the folder in which to store the newly split corrtag files:</span>
<span class="n">spec_int_dir2</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;spec_intervals_Ex1&#39;</span>
<span class="c1"># A second output directory for files split on specified intervals</span>
<span class="n">spec_int_dir2</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># List the specified times</span>
<span class="n">split_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">550</span><span class="p">,</span> <span class="mi">1337</span><span class="p">]</span>

<span class="c1"># Run splittag using our specified times:</span>
<span class="n">splittag</span><span class="o">.</span><span class="n">splittag</span><span class="p">(</span><span class="n">infiles</span><span class="o">=</span><span class="n">transit_exp</span><span class="p">,</span>
                  <span class="n">outroot</span><span class="o">=</span><span class="n">spec_int_dir2</span> <span class="o">/</span> <span class="s1">&#39;transit_basename&#39;</span><span class="p">,</span>
                  <span class="n">time_list</span><span class="o">=</span><span class="n">split_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>output/spec_intervals_Ex1/transit_basename_1_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>output/spec_intervals_Ex1/transit_basename_2_corrtag_a.fits written
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>output/spec_intervals_Ex1/transit_basename_3_corrtag_a.fits written
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exercise 2.1 (CalCOS):</span>

<span class="c1"># Make a sub-directory of output/calcos/examples named for this epoch.</span>
<span class="c1"># We&#39;ll call the epoch &quot;1.5&quot; because it&#39;s between epochs 1 and 2</span>
<span class="n">calcos_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./output/calcos&#39;</span><span class="p">)</span> 
<span class="n">examples_dir</span> <span class="o">=</span> <span class="n">calcos_dir</span> <span class="o">/</span> <span class="s1">&#39;examples&#39;</span>
<span class="n">epoch_dir</span> <span class="o">=</span> <span class="n">examples_dir</span> <span class="o">/</span> <span class="s1">&#39;epoch1.5&#39;</span>

<span class="n">calcos_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">examples_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">epoch_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Extract the spectrum from the 2nd sub-exposure in spec_intervals_Ex1:</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">calcos</span><span class="o">.</span><span class="n">calcos</span><span class="p">(</span>
        <span class="s1">&#39;output/spec_intervals_Ex1/transit_basename_2_corrtag_a.fits&#39;</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="n">epoch_dir</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An error occured&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CALCOS version 3.6.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy version 1.26.0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>astropy version 7.1.0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Begin 17-Sep-2025 23:08:45 UTC
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR:  The following reference files are missing:
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>disptab=./crds_cache/references/hst/cos/97h1816gl_disp.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fluxtab=./crds_cache/references/hst/cos/97h18182l_phot.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tdstab=./crds_cache/references/hst/cos/97h18216l_tds.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xtractab=./crds_cache/references/hst/cos/97h1818el_1dx.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>An error occured 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exercise 2.2 (Plotting):</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;output/calcos/epoch1/lc1va0zgq_1_x1d.fits&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;output/calcos/examples/epoch1.5/transit_basename_2_x1d.fits&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;output/calcos/epoch2/lc1va0zgq_2_x1d.fits&#39;</span><span class="p">):</span>

    <span class="c1"># Set up figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                   <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
                                   <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Specify the files explicitly here</span>
    <span class="n">processed_example_files</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;output/calcos/epoch1/lc1va0zgq_1_x1d.fits&#39;</span><span class="p">,</span>
        <span class="s1">&#39;output/calcos/examples/epoch1.5/transit_basename_2_x1d.fits&#39;</span><span class="p">,</span>
        <span class="s1">&#39;output/calcos/epoch2/lc1va0zgq_2_x1d.fits&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_example_files</span><span class="p">)):</span>
        <span class="n">epoch_label</span> <span class="o">=</span> <span class="n">processed_example_files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                                    <span class="n">category</span><span class="o">=</span><span class="n">UnitsWarning</span><span class="p">,</span>
                                    <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ferr</span><span class="p">,</span> <span class="n">dq</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
                <span class="n">processed_example_files</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">,</span> <span class="s1">&#39;FLUX&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span> <span class="s1">&#39;DQ&#39;</span><span class="p">]</span>

        <span class="c1"># Filter to good quality data</span>
        <span class="n">dq_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ferr</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">dq_mask</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">dq_mask</span><span class="p">],</span> <span class="n">ferr</span><span class="p">[</span><span class="n">dq_mask</span><span class="p">]</span>

        <span class="c1"># Plot each epoch</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span>
                    <span class="c1"># Epoch 2 should stand out</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                    <span class="c1"># Label with the epoch name</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">epoch_label</span><span class="p">)</span>

        <span class="c1"># Plot each epoch</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">ferr</span><span class="p">,</span>
                     <span class="c1"># Epoch 2 should stand out</span>
                     <span class="n">alpha</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                     <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                     <span class="n">markerfacecolor</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                     <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="n">ecolor</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                     <span class="c1"># Label with the epoch name</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">epoch_label</span><span class="p">)</span>

    <span class="c1"># Format both subplots</span>
    <span class="c1"># Zoom to 1225 - 1300 Angstrom</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1250</span><span class="p">,</span> <span class="mi">1300</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1250</span><span class="p">,</span> <span class="mi">1300</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">5.E-16</span><span class="p">,</span> <span class="mf">1.1E-14</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">5.E-16</span><span class="p">,</span> <span class="mf">1.1E-14</span><span class="p">)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Top: Simple plot&quot;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Bottom: Errorbar plot&quot;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
        <span class="s2">&quot;Fig Ex2.1</span><span class="se">\n</span><span class="s2">Comparison of processed spectra - Zoom on source spectrum&quot;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">24</span>
    <span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Wavelength [$\AA$]&quot;</span><span class="p">,</span>
                   <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Flux [$ergs\ cm^{-2} \AA^{-1}s^{-1}$]&quot;</span><span class="p">,</span>
                   <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Flux [$ergs\ cm^{-2} \AA^{-1}s^{-1}$]&quot;</span><span class="p">,</span>
                   <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="n">plots_dir</span> <span class="o">/</span> <span class="s2">&quot;Compare_spectrum_zoom_1275A_Ex2.png&quot;</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span>
    <span class="p">)</span>
    
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File not found, please run the previous cells first.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File not found, please run the previous cells first.
</pre></div>
</div>
</div>
</div>
<p><strong>Ex 2.3 (Analysis):</strong></p>
<p>From a brief look, it seems that epoch 1.5 shares much more in common with epoch 1 (before the transit) than epoch 2 (during the transit).</p>
<p>If we wished to get as good a signal to noise ratio observation of the pre-transit spectrum as possible, we might include epochs 1 and 1.5 together to get additional counts.</p>
<p>Note that epoch 1 contains all the counts from epoch 1.5, while epoch 2 does not. Thus this is not a perfect test. However, the vast majority of epoch 1’s counts do <em>not</em> overlap with epoch 1.5 (see fig  2.1), so this is an acceptable “first pass” test. It’s also possible that the very low number of counts, especially in epochs 1.5 and 2, does not give us the signal-to-noise we would need to accurately distinguish the epochs.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/hst_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/COS/SplitTag"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../CalCOS/CalCOS.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)</p>
      </div>
    </a>
    <a class="right-next"
       href="../DayNight/DayNight.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Filtering out COS Data taken during the Day or Night</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">0. Introduction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#examining-the-data-to-determine-how-to-split-the-files">1. Examining the data to determine how to split the files</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#using-splittag-to-create-multiple-sub-exposure-files">2. Using <code class="docutils literal notranslate"><span class="pre">splittag</span></code> to create multiple sub-exposure files</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-practice-sub-dividing-with-splittag">Exercise 1: <em>Practice sub-dividing with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></em></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-spectra-from-the-sub-exposures-using-calcos">3. Extracting spectra from the sub-exposures using <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-the-lref-reference-files">3.1 Getting the <code class="docutils literal notranslate"><span class="pre">lref</span></code> reference files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-calcos-and-processing-sub-exposure-files">3.2 Running <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> and processing sub-exposure files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-the-1200-1230-angstrom-region"><strong>For the 1200 - 1230 Angstrom region:</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-the-1250-1350-angstrom-region"><strong>For the 1250 - 1350 Angstrom region:</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-multiple-sub-exposure-files-at-regular-intervals">4. Creating multiple sub-exposure files at regular intervals</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-examining-epoch-1-5">Exercise 2: <em>Examining epoch 1.5</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#congratulations-you-finished-this-notebook">Congratulations! You finished this Notebook!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-solutions">Exercise Solutions</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>