

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Filtering out COS Data taken during the Day or Night &#8212; HST Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/COS/DayNight/DayNight';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Working with the COS Line Spread Function (LSF)" href="../LSF/LSF.html" />
    <link rel="prev" title="Splitting COS Exposures into sub-exposures with splittag" href="../SplitTag/SplitTag.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="HST Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="HST Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    STScI HST Notebook Repository HQ
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">ACS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../ACS/README.html">ACS Notebooks</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_findsat_mrt/acs_findsat_mrt_example.html">Satellite trail detection in ACS/WFC data using acstools.findsat_mrt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_saturation_trails/acs_saturation_trails.html">ACS Linearity with Saturated Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_cte_forward_model/acs_cte_forward_model_example.html">Pixel-based ACS/WFC CTE Forward Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_subarrays/acs_subarrays.html">ACS Image Reduction for Subarray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_sbc_dark_analysis/acs_sbc_dark_analysis.html">SBC Dark Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_reduction/acs_reduction.html">ACS/WFC Image Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_pixel_area_maps/acs_pixel_area_maps.html">Obtaining Pixel Area Maps for ACS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_polarization_tools/acs_polarization_tools.html">Using ACS Polarization Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_focus_diverse_epsfs/acs_focus_diverse_epsfs.html">Focus Diverse ePSFs for ACS/WFC</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">COS</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../README.html">COS Notebooks</a></li>



<li class="toctree-l1"><a class="reference internal" href="../Setup/Setup.html">Setting up your computer environment for working with COS data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../DataDl/DataDl.html">Downloading COS Data</a></li>




<li class="toctree-l1"><a class="reference internal" href="../ViewData/ViewData.html">Viewing COS Data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../AsnFile/AsnFile.html">Modifying or Creating an Association File</a></li>





<li class="toctree-l1"><a class="reference internal" href="../CalCOS/CalCOS.html">Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)</a></li>






<li class="toctree-l1"><a class="reference internal" href="../SplitTag/SplitTag.html">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></a></li>







<li class="toctree-l1 current active"><a class="current reference internal" href="#">Filtering out COS Data taken during the Day or Night</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LSF/LSF.html">Working with the COS Line Spread Function (LSF)</a></li>

<li class="toctree-l1"><a class="reference internal" href="../Extract/Extract.html">Editing the extraction boxes in a spectral extraction file (<code class="docutils literal notranslate"><span class="pre">XTRACTAB</span></code>)</a></li>







<li class="toctree-l1"><a class="reference internal" href="../ExceptionReport/ExceptionReport.html">What to do when you get an Exception Report for COS</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">DrizzlePac</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/README.html">DrizzlePac Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/using_updated_astrometry_solutions/using_updated_astrometry_solutions.html">Improving Astrometry Using Alternate WCS Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_to_catalogs/align_to_catalogs.html">Aligning HST images to an Absolute Reference Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_sparse_fields/align_sparse_fields.html">Aligning Deep Exposures of Sparse Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_multiple_visits/align_multiple_visits.html">Optimizing Image Alignment for Multiple HST Visits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/use_ds9_regions_in_tweakreg/use_ds9_regions_in_tweakreg.html">TWEAKREG Tips - Using DS9 Regions for Source Inclusion/Exclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/optimize_image_sampling/optimize_image_sampling.html">Optimizing the Image Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_mosaics/align_mosaics.html">Aligning HST Mosaics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/sky_matching/sky_matching.html">Sky Matching for HST Mosaics <a id="top"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/mask_satellite/mask_satellite.html">Satellite Trail Masking Techniques</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HASP</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../HASP/Setup/Setup.html">Installing the Hubble Advanced Spectral Products Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../HASP/CoaddTutorial/CoaddTutorial.html">Inputting User Data using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/FluxScaleTutorial/FluxScaleTutorial.html">Scaling Flux while using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/DataDiagnostic/DataDiagnostics.html">HASP Data Diagnostic Notebook</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../HASP/WavelengthAdjustment/WavelengthAdjustment.html">Wavelength Adjustments for Running the Hubble Advanced Spectral Products (HASP) Script</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NICMOS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html">Programmatic Replacements for NICMOS Units Conversion Form</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">STIS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../STIS/README.html">STIS-Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/cross-correlation/cross-correlation.html">Correcting for Missing Wavecals with Cross-Correlation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/custom_ccd_darks/custom_ccd_darks.html">Custom CCD Darks <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/drizpac_notebook/STIS_DrizzlePac_Tutorial.html">STIS DrizzlePac Tutorial <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/CoronagraphyViz/STIS_Coronagraphy_Visualization_v2.html">STIS Coronagraphy Visualization Tool (v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/calstis/calstis_2d_ccd.html">Calstis 2-D CCD Data Reduction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/target_acquisition/target_acquisition.html">Evaluating STIS Target Acquisitions <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/view_data/view_data.html">Viewing STIS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/extraction/1D_Extraction.html">1D Spectra Extraction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/low_count_uncertainties/Low_Count_Uncertainties.html">Low Count Uncertainties in STIS <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/contrast_sensitivity/STIS_Coronagraphic_Observation_Feasibility.html">STIS Coronagraphic Observation Feasibility</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">WFC3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../WFC3/README.html">WFC3 Notebooks</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/general_tools.html">General Tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/image_displayer_analyzer/wfc3_image_displayer_analyzer.html">WFC3 Image Displayer &amp; Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/exception_report/wfc3_exception_report.html">Exception Report Checklist - WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/calwf3_v1.0_cte/calwf3_with_v1.0_PCTE.html">Processing WFC3/UVIS Data with <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> Using the v1.0 CTE-Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/persistence/wfc3_ir_persistence.html">Masking Persistence in WFC3/IR Images</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/ir_tvb.html">WFC3/IR Time Variable Background (TVB)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_ima_visualization/IR_IMA_Visualization_with_an_Example_of_Time_Variable_Background.html">WFC3/IR IMA Visualization Tools with An Example of Time Variable Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/calwf3_recalibration/calwf3_recal_tvb.html">Manual Recalibration with calwf3: Turning off the IR Linear Ramp Fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/tvb_flattenramp/TVB_flattenramp_notebook.html">Correcting for Helium Line Emission Background in IR Exposures using the “Flatten-Ramp” Technique</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_scattered_light_calwf3_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_Using_calwf3_to_Mask_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Using <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> to Mask Bad Reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_scattered_light_manual_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_by_Manually_Subtracting_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Manually Subtracting Bad Reads</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/photometry.html">Photometry</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/filter_transformations/filter_transformations.html">WFC3/UVIS Filter Transformations with stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/flux_conversion_tool/flux_conversion_tool.html">Flux Unit Conversions with synphot and stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/photometry_examples/phot_examples.html">Synthetic Photometry Examples for WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_time_dependent_photometry/uvis_timedep_phot.html">WFC3/UVIS Time-dependent Photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/zeropoints/zeropoints.html">Calculating WFC3 Zeropoints with STSynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_pam_corrections/WFC3_UVIS_Pixel_Area_Map_Corrections_for_Subarrays.html">WFC3/UVIS Pixel Area Map Corrections for Subarrays</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/point_spread_function.html">Point Spread Function (PSF)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/point_spread_function/hst_point_spread_function.html">HST WFC3 Point Spread Function Modeling   </a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/mast_api_psf/download_psf_cutouts.html">Downloading WFC3 and WFPC2 PSF Cutouts from MAST</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/spacetelescope/hst_notebooks/blob/main/notebooks/COS/DayNight/DayNight.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/COS/DayNight/DayNight.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/COS/DayNight/DayNight.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Filtering out COS Data taken during the Day or Night</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-and-setup">0. Introduction and Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-will-import-the-following-packages">We will import the following packages:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-will-also-define-a-few-directories-we-will-need">We will also define a few directories we will need:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#and-we-will-need-to-download-the-data-we-wish-to-filter-and-analyze">And we will need to download the data we wish to filter and analyze</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#processing-a-spectrum-from-a-filtered-dataset">1. Processing a spectrum from a filtered dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-the-time-tag-data">1.1. Filtering the <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-new-association-file">1.2. Creating a new association file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-calcos-pipeline">1.3. Running the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> pipeline</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-the-filtered-and-unfiltered-data">2. Comparing the filtered and unfiltered data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-conclusion">In conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#congratulations-you-finished-this-notebook">Congratulations! You finished this Notebook!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><a id="topF"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="filtering-out-cos-data-taken-during-the-day-or-night">
<h1>Filtering out COS Data taken during the Day or Night<a class="headerlink" href="#filtering-out-cos-data-taken-during-the-day-or-night" title="Permalink to this heading">#</a></h1>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Permalink to this heading">#</a></h2>
<p><font size="4 "> This Notebook is designed to walk the user (<em>you</em>) through: <b>Filtering Cosmic Origins Spectrograph (<em>COS</em>) <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> data taken during the day from data taken during the night</b>:</font></p>
<p><strong>1. <span class="xref myst">Processing a spectrum from a filtered dataset</span></strong></p>
<p>- 1.1. <span class="xref myst">Filtering the <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> data</span></p>
<p>- 1.2. <span class="xref myst">Creating a new association file</span></p>
<p>- 1.3. <span class="xref myst">Running the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> pipeline on the filtered dataset</span></p>
<p><strong>2. <span class="xref myst">Comparing the filtered and unfiltered data</span></strong></p>
</section>
<section id="introduction-and-setup">
<h2>0. Introduction and Setup<a class="headerlink" href="#introduction-and-setup" title="Permalink to this heading">#</a></h2>
<p><strong>The Cosmic Origins Spectrograph (<a class="reference external" href="https://www.nasa.gov/content/hubble-space-telescope-cosmic-origins-spectrograph"><em>COS</em></a>) is an ultraviolet spectrograph on-board the Hubble Space Telescope (<a class="reference external" href="https://www.stsci.edu/hst/about"><em>HST</em></a>) with capabilities in the near ultraviolet (<em>NUV</em>) and far ultraviolet (<em>FUV</em>).</strong></p>
<p><strong>This tutorial aims to prepare you to work with the COS data of your choice by walking you through filtering <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> datapoints obtained by COS.</strong></p>
<p>In particular, this tutorial will walk you through separating datapoints obtained during the Hubble Space Telescope’s “night” - when the sun is below the geometric horizon from the observatory’s point of view - from datapoints taken during the observatory’s “day” - when the sun is above this horizon.
You may wish to disaggregate photons from these two time periods, as data taken during the day can be subject to different and higher background noise conditions, as well as more intense geocoronal Lyman-alpha or Oxygen-I emission lines from the Earth’s atmosphere (<a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-5-cos-data-analysis/5-4-working-with-time-tag-data#id-5.4WorkingwithTIMETAGData-5.4.2FilteringTime-TagData:~:text=same%20as%20above.-,5.4.2%20Filtering%20Time%2DTag%20Data,-Filtering%20Events%20in">See Data Handbook 5.4.2</a>).
This type of data separation is possible with the <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-5-cos-data-analysis/5-4-working-with-time-tag-data"><code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> data</a> obtained by the COS photon-counting detectors, because each individual encounter with a photon is recorded with its own metadata such as the time of the encounter, and can be linked to the physical position of Hubble at that time.</p>
<ul class="simple">
<li><p>For an in-depth manual to working with COS data and a discussion of caveats and user tips, see the <a class="reference external" href="https://hst-docs.stsci.edu/display/COSDHB/">COS Data Handbook</a>.</p></li>
<li><p>For a detailed overview of the COS instrument, see the <a class="reference external" href="https://hst-docs.stsci.edu/display/COSIHB/">COS Instrument Handbook</a>.</p></li>
</ul>
<section id="we-will-import-the-following-packages">
<h3>We will import the following packages:<a class="headerlink" href="#we-will-import-the-following-packages" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">costools</span> <span class="pre">timefilter</span></code> to select <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> datapoints by their metadata parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">calcos</span></code> to re-process the data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code> to handle array functions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.io</span> <span class="pre">fits</span></code> and <code class="docutils literal notranslate"><span class="pre">astropy.table</span> <span class="pre">Table</span></code> for accessing FITS files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">glob</span></code> and <code class="docutils literal notranslate"><span class="pre">os</span></code> for working with system files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code> and <code class="docutils literal notranslate"><span class="pre">gridspec</span></code> for plotting data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astroquery.mast</span> <span class="pre">Mast</span></code> and <code class="docutils literal notranslate"><span class="pre">Observations</span></code> for finding and downloading data from the <a class="reference external" href="https://mast.stsci.edu/search/ui/#/hst">MAST</a> archive</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pathlib</span> <span class="pre">Path</span></code> for managing system paths</p></li>
</ul>
<p>New versions of <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> are currently incompatible with astroconda. To create a Python environment capable of running all the data analyses in these COS Notebooks, please see Section 1 of our Notebook tutorial on <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/Setup/Setup.ipynb">setting up an environment</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import for: filtering TIME TAG data i.e. by sun altitude</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">costools</span><span class="w"> </span><span class="kn">import</span> <span class="n">timefilter</span>

<span class="c1"># Import for: processing COS data</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">calcos</span> 

<span class="c1"># Import for: array manipulation</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Import for: reading FITS files</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span>                                            
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>

<span class="c1"># Import for: dealing with system files</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># Import for: plotting</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">gridspec</span>

<span class="c1"># Import for: downloading the data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.mast</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observations</span>

<span class="c1"># Import for: working with system paths</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following tasks in the costools package can be run with TEAL:
         splittag                 timefilter                 x1dcorr
</pre></div>
</div>
</div>
</div>
</section>
<section id="we-will-also-define-a-few-directories-we-will-need">
<h3>We will also define a few directories we will need:<a class="headerlink" href="#we-will-also-define-a-few-directories-we-will-need" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># These will be important directories</span>
<span class="n">datadir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./data&#39;</span><span class="p">)</span>
<span class="n">outputdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./output/&#39;</span><span class="p">)</span>
<span class="n">intermediate_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./intermediate/&#39;</span><span class="p">)</span>
<span class="n">plotsdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./output/plots&#39;</span><span class="p">)</span>

<span class="c1"># Make the directories if they don&#39;t exist</span>
<span class="n">datadir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">outputdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plotsdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">intermediate_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="and-we-will-need-to-download-the-data-we-wish-to-filter-and-analyze">
<h3>And we will need to download the data we wish to filter and analyze<a class="headerlink" href="#and-we-will-need-to-download-the-data-we-wish-to-filter-and-analyze" title="Permalink to this heading">#</a></h3>
<p>We choose the exposure with obs_id: <code class="docutils literal notranslate"><span class="pre">lbry01i6q</span></code>, because we happen to know it contains data taken both in the observatory’s night and day and shows strong airglow lines. For more information on downloading COS data, see our <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/DataDl/DataDl.ipynb">notebook tutorial on downloading COS data</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename_root</span> <span class="o">=</span> <span class="s1">&#39;lbry01i6q&#39;</span>

<span class="c1"># Create product list of all observations with that obs_id root</span>
<span class="n">pl</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span>
            <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span>
                <span class="n">proposal_id</span><span class="o">=</span><span class="s1">&#39;12604&#39;</span><span class="p">,</span>
                <span class="n">obs_id</span><span class="o">=</span><span class="s1">&#39;lbry01*&#39;</span><span class="p">))</span>

<span class="c1"># Create a mask with only the corrtag files</span>
<span class="n">pl_mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">pl</span><span class="p">[</span><span class="s1">&#39;productSubGroupDescription&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CORRTAG_A&quot;</span><span class="p">)</span>
           <span class="o">|</span> <span class="p">(</span><span class="n">pl</span><span class="p">[</span><span class="s1">&#39;productSubGroupDescription&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CORRTAG_B&quot;</span><span class="p">))</span>\
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">pl</span><span class="p">[</span><span class="s1">&#39;obs_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">filename_root</span><span class="p">)</span>

<span class="c1"># Download those corrtag files</span>
<span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">pl</span><span class="p">[</span><span class="n">pl_mask</span><span class="p">],</span>
                               <span class="n">download_dir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">datadir</span><span class="p">))</span>

<span class="n">file_locations_orig</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./data/**/*corrtag*.fits&#39;</span><span class="p">,</span>
                                <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">file_orig</span> <span class="ow">in</span> <span class="n">file_locations_orig</span><span class="p">:</span>
    <span class="c1"># Aggregates the data from out of long convoluted filepaths</span>
    <span class="c1"># NOTE: can cause problems if you have non-unique filenames</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">file_orig</span><span class="p">,</span>
              <span class="s1">&#39;./data/&#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_orig</span><span class="p">))</span>

<span class="c1"># Finds all the FUVA and FUVB files</span>
<span class="n">file_locations_a</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./data/**/*corrtag_a.fits&#39;</span><span class="p">,</span>
                             <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">file_locations_b</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./data/**/*corrtag_b.fits&#39;</span><span class="p">,</span>
                             <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lbry01i6q_corrtag_a.fits to data/mastDownload/HST/lbry01i6q/lbry01i6q_corrtag_a.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lbry01i6q_corrtag_b.fits to data/mastDownload/HST/lbry01i6q/lbry01i6q_corrtag_b.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
</div>
</div>
<p><a id = procF></a></p>
</section>
</section>
<section id="processing-a-spectrum-from-a-filtered-dataset">
<h2>1. Processing a spectrum from a filtered dataset<a class="headerlink" href="#processing-a-spectrum-from-a-filtered-dataset" title="Permalink to this heading">#</a></h2>
<p><a id = filtF></a></p>
<section id="filtering-the-time-tag-data">
<h3>1.1. Filtering the <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> data<a class="headerlink" href="#filtering-the-time-tag-data" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">costools</span></code> package contains the <code class="docutils literal notranslate"><span class="pre">TimelineFilter</span></code> class, which - upon instantiation - filters by the parameters you give it. In other words, you don’t have to run any functions or methods aside from instantiating the class. This is done by passing the following parameters to <code class="docutils literal notranslate"><span class="pre">timefilter.TimelineFilter</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input</span></code>: the path to the input <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> file. (string)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output</span></code>: the path to the output <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> file. (string)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filter</span></code>: a comparison filter (see examples below). Data points who meet the filter criteria will be <em>filtered out</em> by turning on their “bad time interval” data quality flag. (string)</p></li>
</ul>
<p>Only <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> data has the timing data necessary to be processed using <code class="docutils literal notranslate"><span class="pre">timefilter</span></code>. We must first ensure that all the data we wish to process is <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">check_time_tag</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function which yields descriptive errors if the input file is not a COS TIME-TAG file.</span>
<span class="sd">    Inputs: </span>
<span class="sd">      filepath (str): path to your data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">instrume</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="s1">&#39;INSTRUME&#39;</span><span class="p">),</span> 
    <span class="n">imagetyp</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="s1">&#39;IMAGETYP&#39;</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">instrume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;COS&#39;</span><span class="p">,</span> <span class="s2">&quot;DataTypeError: Files not from COS&quot;</span>
    <span class="k">assert</span> <span class="n">imagetyp</span> <span class="o">==</span> <span class="s1">&#39;TIME-TAG&#39;</span><span class="p">,</span> <span class="s2">&quot;DataTypeError: Files not TIME-TAG. Cannot process with timefilter.&quot;</span>


<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="p">(</span><span class="n">file_locations_a</span> <span class="o">+</span> <span class="n">file_locations_b</span><span class="p">):</span>
    <span class="n">check_time_tag</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><font size="4"> Below, we will filter by the sun’s altitude above the geometric horizon from the point-of-view of the Hubble Observatory. <b>Daytime</b> is whenever this altitude is greater than 0 degrees.</font></p>
<p>The filtering parameters are explained in the <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-5-cos-data-analysis/5-4-working-with-time-tag-data#id-5.4WorkingwithTIMETAGData-5.4.2FilteringTime-TagData:~:text=same%20as%20above.-,5.4.2%20Filtering%20Time%2DTag%20Data,-Filtering%20Events%20in">Section 5.4.2 of the COS Data Handbook: Filtering Time-Tag Data</a>.</p>
<p><em>All of the available filters are</em>:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Variable name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Time of photon encounter [32 ms bins]</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">time</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Observatory latitude/longitude</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">longitude</span></code>/<code class="docutils literal notranslate"><span class="pre">latitude</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Sun’s altitude</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sun_alt</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Observing target’s current altitude</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">target_alt</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Radial velocity of HST towards target</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">radial_vel</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Shift along dispersion axis</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">shift1</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Total <span class="math notranslate nohighlight">\(\frac{counts}{sec}\)</span> in a box across the aperture about <span class="math notranslate nohighlight">\(Ly_\alpha\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ly_alpha</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Total <span class="math notranslate nohighlight">\(\frac{counts}{sec}\)</span> in a box across the aperture about <span class="math notranslate nohighlight">\(O I 1304\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">oi_1304</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Total <span class="math notranslate nohighlight">\(\frac{counts}{sec}\)</span> in a box across the aperture about <span class="math notranslate nohighlight">\(O I 1356\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">oi_1356</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Detector dark current rate</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">darkrate</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p>… or any combination of these filters. There is one more filter keyword which behaves slightly differently: <code class="docutils literal notranslate"><span class="pre">saa</span></code>. By specifying <code class="docutils literal notranslate"><span class="pre">saa</span> <span class="pre">&lt;n&gt;</span></code> where <span class="math notranslate nohighlight">\(0\le n \le 32\)</span>, you can exclude the <span class="math notranslate nohighlight">\(n^{th}\)</span> model contour of the <a class="reference external" href="https://en.wikipedia.org/wiki/South_Atlantic_Anomaly">South Atlantic Anomaly (SAA)</a> as modeled by <code class="docutils literal notranslate"><span class="pre">costools.saamodel</span></code>.</p>
<p>The following comparison operators are allowed:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Example</p></th>
<th class="head"><p>Meaning (“Filter <em>out</em> points taken when…”)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">==</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">==</span> <span class="pre">0</span></code></p></td>
<td><p>Time of photon interaction is equal to 0 seconds</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">!=</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">longitude</span> <span class="pre">!=</span> <span class="pre">3</span></code></p></td>
<td><p>HST’s longitude is not equal to 3˚</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;=</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sun_alt</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code></p></td>
<td><p>Sun’s altitude is greater than or equal to 0˚</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&gt;=</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">target_alt</span> <span class="pre">&lt;=</span> <span class="pre">90</span></code></p></td>
<td><p>Target’s altitude is less than or equal to 90˚</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">radial_vel</span> <span class="pre">&lt;</span> <span class="pre">0.1</span></code></p></td>
<td><p>Radial velocity of HST towards target is less than 10 <span class="math notranslate nohighlight">\(\frac{km}{s}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ly_a</span> <span class="pre">&gt;</span> <span class="pre">5</span></code></p></td>
<td><p>Total <span class="math notranslate nohighlight">\(\frac{counts}{sec}\)</span> in a box across the aperture about <span class="math notranslate nohighlight">\(Ly_\alpha\)</span> is greater than 5 <span class="math notranslate nohighlight">\(\frac{counts}{sec}\)</span></p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><em><strong>Combination</strong></em></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">oi_1304</span> <span class="pre">&gt;</span> <span class="pre">100</span> <span class="pre">AND</span> <span class="pre">sun_alt</span> <span class="pre">&lt;=</span> <span class="pre">10</span> <span class="pre">OR</span> <span class="pre">target_alt</span> <span class="pre">&lt;</span> <span class="pre">30</span></code></p></td>
<td><p>Total irradiance about 1304 Å is greater than 100 <em>AND</em> the Sun’s altitude is less than or equal to 10˚ <em>OR</em> the target’s altitude is below 30˚</p></td>
</tr>
</tbody>
</table>
</div>
<p><em>Note</em> that in the combination example above, the <em>“OR”</em> takes precedence over “AND”. If a count does not satisfy both of the first 2 statements, but it does satisfy statement 3, it will be considered to meet the filter, its “bad time interval” data quality flag will be turned on, and it will not be allowed to contribute to the output spectrum.</p>
<p><em>Note</em> also that the <code class="docutils literal notranslate"><span class="pre">TimelineFilter</span></code> class will not overwrite existing files, so if you wish to filter the files using the following code more than once, you must delete the files you have already created in the <code class="docutils literal notranslate"><span class="pre">intermediate</span></code> directory. To ease this process, the first several lines in the following cell attempt to delete any previously created files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If the files already exist, delete them so you may run the filter again</span>
<span class="c1"># Check if you have created a filtered FUVA file:</span>
<span class="k">if</span> <span class="p">(</span><span class="n">intermediate_dir</span> <span class="o">/</span> <span class="s2">&quot;filtered_corrtag_a.fits&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File exists; deleting </span><span class="si">{</span><span class="n">intermediate_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">&#39;filtered_corrtag_a.fits&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># If so, delete the file so we can re-create it with TimelineFilter</span>
    <span class="p">(</span><span class="n">intermediate_dir</span> <span class="o">/</span> <span class="s2">&quot;filtered_corrtag_a.fits&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

<span class="c1"># Repeat the check-delete process above with FUVB file:</span>
<span class="k">if</span> <span class="p">(</span><span class="n">intermediate_dir</span> <span class="o">/</span> <span class="s2">&quot;filtered_corrtag_b.fits&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File exists; deleting </span><span class="si">{</span><span class="n">intermediate_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">&#39;filtered_corrtag_b.fits&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="n">intermediate_dir</span> <span class="o">/</span> <span class="s2">&quot;filtered_corrtag_b.fits&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

<span class="c1"># Filter the files based on your criteria</span>
<span class="c1"># This must be repeated for all exposure files, so both FUVA and FUVB</span>
<span class="k">for</span> <span class="n">afile</span><span class="p">,</span> <span class="n">bfile</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">file_locations_a</span><span class="p">,</span> <span class="n">file_locations_b</span><span class="p">):</span>
    <span class="n">timefilter</span><span class="o">.</span><span class="n">TimelineFilter</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">afile</span><span class="p">,</span>
                              <span class="c1"># Run TimelineFilter on FUVA file</span>
                              <span class="n">output</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">intermediate_dir</span> <span class="o">/</span> <span class="s2">&quot;filtered_corrtag_a.fits&quot;</span><span class="p">),</span>
                              <span class="c1"># Removes daytime data, where the Sun&#39;s altitude above horizon is 0 degrees</span>
                              <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;sun_alt &gt; 0.&quot;</span><span class="p">,</span>
                              <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">timefilter</span><span class="o">.</span><span class="n">TimelineFilter</span><span class="p">(</span><span class="n">bfile</span><span class="p">,</span>
                              <span class="c1"># Run TimelineFilter on FUVB file</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">intermediate_dir</span> <span class="o">/</span> <span class="s2">&quot;filtered_corrtag_b.fits&quot;</span><span class="p">),</span>
                              <span class="s2">&quot;sun_alt &gt; 0.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Input file /home/runner/work/hst_notebooks/hst_notebooks/notebooks/COS/DayNight/data/lbry01i6q_corrtag_a.fits
sun_alt &gt; 0. flagged as bad
EXPTIME changed from 1176.192 to 137.18394
New GTI extension appended
Writing to /home/runner/work/hst_notebooks/hst_notebooks/notebooks/COS/DayNight/intermediate/filtered_corrtag_a.fits
</pre></div>
</div>
</div>
</div>
<p><a id = asnF></a></p>
</section>
<section id="creating-a-new-association-file">
<h3>1.2. Creating a new association file<a class="headerlink" href="#creating-a-new-association-file" title="Permalink to this heading">#</a></h3>
<p>In order to run the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> pipeline on your newly filtered data, an association (<code class="docutils literal notranslate"><span class="pre">asn</span></code>) file must be made, instructing the pipeline where to look for the filtered <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> data files. Association files, (and how to create and edit them,) are discussed in detail in our <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/AsnFile/AsnFile.ipynb">Notebook Tutorial on Association Files</a>.</p>
<p>In the next cells, we build <strong>two</strong> new association files from scratch:</p>
<ol class="arabic simple">
<li><p>For these new <strong>filtered</strong> files</p></li>
<li><p>For the original <strong>unfiltered</strong> files, so that we can compare and see the effect of filtering.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, create asn for the newly filtered-by-sun_alt files (this and next cell):</span>
<span class="c1"># This dict properly assigns the type of exposure in a way that CalCOS will recognize</span>
<span class="n">type_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;WAVECAL&#39;</span><span class="p">:</span> <span class="s1">&#39;EXP-AWAVE&#39;</span><span class="p">,</span>
             <span class="s1">&#39;EXTERNAL/SCI&#39;</span><span class="p">:</span> <span class="s1">&#39;EXP-FP&#39;</span><span class="p">}</span>

<span class="c1"># Finds all the corrtag_a (just FUVA) files downloaded above</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">intermediate_dir</span><span class="o">/</span><span class="s2">&quot;*_corrtag_a.fits&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong><em>Note</em> that the above cell only found the segment A files</strong> (i.e. from the COS FUVA detector.) You only need the A segment in the ASN, and CalCOS will find the associated B segment data for you, if the files are in the same directory.</p>
<p>We can now build the <code class="docutils literal notranslate"><span class="pre">asn</span></code> file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>    
    <span class="c1"># Adding the file details to the association table</span>
    <span class="c1"># MEMNAME:</span>
    <span class="n">rootnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">]</span>
    <span class="c1"># MEMTYPE:</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="n">type_dict</span><span class="p">[</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;EXPTYPE&#39;</span><span class="p">)]]</span>
    <span class="c1"># MEMPRSNT</span>
    <span class="n">included</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
    
    <span class="c1"># Adding the ASN details to the end of the association table</span>
    <span class="c1"># the rootname needs to be the full name, not just the rootname:</span>
    <span class="c1"># Remove the extra &quot;_&quot; at the end of string</span>
    <span class="n">asn_root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;corrtag&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># MEMNAME:</span>
    <span class="n">rootnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asn_root</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="c1"># MEMTYPE:</span>
    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;PROD-FP&#39;</span><span class="p">)</span>
    <span class="c1"># MEMPRSNT</span>
    <span class="n">included</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Putting together the FITS table</span>
    <span class="c1"># 40 is the number of characters allowed in this &#39;40A&#39; field.</span>
    <span class="c1"># If your rootname is longer than 40, you will need to increase this</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MEMNAME&#39;</span><span class="p">,</span>
                     <span class="n">array</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rootnames</span><span class="p">),</span>
                     <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;40A&#39;</span><span class="p">)</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MEMTYPE&#39;</span><span class="p">,</span>
                     <span class="n">array</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">types</span><span class="p">),</span>
                     <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;14A&#39;</span><span class="p">)</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MEMPRSNT&#39;</span><span class="p">,</span>
                     <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">,</span>
                     <span class="n">array</span><span class="o">=</span><span class="n">included</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">BinTableHDU</span><span class="o">.</span><span class="n">from_columns</span><span class="p">([</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">])</span>

    <span class="c1"># Writing the FITS table</span>
    <span class="n">t</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">asn_root</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_asn.fits&#39;</span><span class="p">,</span>
              <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">asn_root</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_asn.fits&#39;</span><span class="p">),</span> <span class="s2">&quot;in cwd&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Saved: filtered_asn.fits in cwd
</pre></div>
</div>
</div>
</div>
<p>We can see the contents of this new association file below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;filtered_asn.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=2</i>
<table id="table139717239905872" class="table-striped table-bordered table-condensed">
<thead><tr><th>MEMNAME</th><th>MEMTYPE</th><th>MEMPRSNT</th></tr></thead>
<thead><tr><th>bytes40</th><th>bytes14</th><th>bool</th></tr></thead>
<tr><td>intermediate/filtered_corrtag_a.fits</td><td>EXP-FP</td><td>True</td></tr>
<tr><td>FILTERED</td><td>PROD-FP</td><td>True</td></tr>
</table></div></div></div>
</div>
<p><em>Note</em> that in the “MEMNAME” column, we define the location of the corrtag file we wish to process in terms of a local path (the path from the current working directory from which we run our code to the file in the <code class="docutils literal notranslate"><span class="pre">intermediate</span></code> directory.) It is also possible to simply give the “MEMNAME” column the file’s rootname (i.e <code class="docutils literal notranslate"><span class="pre">filtered_corrtag_a</span></code>) as long as this file and the association files are in the same directory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In this cell, we make an association file for the unfiltered data files:</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_locations_a</span><span class="p">:</span>
    <span class="c1"># Adding the file details to the association table</span>
    <span class="c1"># MEMNAME:</span>
    <span class="n">rootnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">]</span>
    <span class="c1"># MEMTYPE</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="n">type_dict</span><span class="p">[</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;EXPTYPE&#39;</span><span class="p">)]]</span>
    <span class="c1"># MEMPRSNT</span>
    <span class="n">included</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>

    <span class="c1"># Adding the ASN details to the end of the association table:</span>
    <span class="c1"># The rootname needs to be full name, not just the rootname</span>
    <span class="c1"># Removing the extra &quot;_&quot; at end of string</span>
    <span class="n">asn_root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;corrtag&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># MEMNAME:</span>
    <span class="n">rootnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asn_root</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="c1"># MEMTYPE</span>
    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;PROD-FP&#39;</span><span class="p">)</span>
    <span class="c1"># MEMPRSNT</span>
    <span class="n">included</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Putting together the FITS table</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MEMNAME&#39;</span><span class="p">,</span>
                     <span class="n">array</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rootnames</span><span class="p">),</span>
                     <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;40A&#39;</span><span class="p">)</span> 
    <span class="n">c2</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MEMTYPE&#39;</span><span class="p">,</span>
                     <span class="n">array</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">types</span><span class="p">),</span>
                     <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;14A&#39;</span><span class="p">)</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MEMPRSNT&#39;</span><span class="p">,</span>
                     <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">,</span>
                     <span class="n">array</span><span class="o">=</span><span class="n">included</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">BinTableHDU</span><span class="o">.</span><span class="n">from_columns</span><span class="p">([</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">])</span>
    
    <span class="c1"># Writing the FITS table</span>
    <span class="n">t</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">asn_root</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_asn.fits&#39;</span><span class="p">,</span>
              <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">asn_root</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_asn.fits&#39;</span><span class="p">),</span> <span class="s2">&quot;in cwd&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Saved: lbry01i6q_asn.fits in cwd
</pre></div>
</div>
</div>
</div>
<p>Again, we can see the contents of this association file below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename_root</span><span class="si">}</span><span class="s2">_asn.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=2</i>
<table id="table139717239911248" class="table-striped table-bordered table-condensed">
<thead><tr><th>MEMNAME</th><th>MEMTYPE</th><th>MEMPRSNT</th></tr></thead>
<thead><tr><th>bytes40</th><th>bytes14</th><th>bool</th></tr></thead>
<tr><td>./data/lbry01i6q_corrtag_a.fits</td><td>EXP-FP</td><td>True</td></tr>
<tr><td>LBRY01I6Q</td><td>PROD-FP</td><td>True</td></tr>
</table></div></div></div>
</div>
<p><a id = CalCOSF></a></p>
</section>
<section id="running-the-calcos-pipeline">
<h3>1.3. Running the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> pipeline<a class="headerlink" href="#running-the-calcos-pipeline" title="Permalink to this heading">#</a></h3>
<p>Now we need to reduce the data using the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> pipeline. If you have not already checked out our tutorial on <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/CalCOS/CalCOS.ipynb">Running the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> pipeline</a>, it contains vital information and is <em>highly recommended</em>.</p>
<hr class="docutils" />
<p><font size="4 "><span class="xref myst">If you have not yet downloaded the files as in Section 3 of “Setup.ipynb”, click to skip this cell</span></font></p>
<p><font size="4 ">If you ran <a href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/Setup/Setup.ipynb">Section 3 of our Notebook on “Setting up your environment”</a>, you likely do not need to download more reference files. </font></p>
<p>You can instead simply point to the reference files you downloaded, using the <code class="docutils literal notranslate"><span class="pre">crds</span> <span class="pre">bestrefs</span></code> command, as shown in the following three steps. Run these steps from your command line <em>if and only if</em> you already have the reference files in a local cache.</p>
<p><strong>1</strong>. The following sets environment variable for crds to look for the reference data online:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">export</span> <span class="pre">CRDS_SERVER_URL=https://hst-crds.stsci.edu</span></code></p>
<p><strong>2</strong>. The following tells crds where to save the files it downloads - set this to the directory where you saved the crds_cache as in <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/COS/Setup/Setup.ipynb">Section 3 of our Notebook on “Setup”</a>:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">export</span> <span class="pre">CRDS_PATH=${HOME}/crds_cache</span></code></p>
<p><strong>3</strong>. The following will update the data files you downloaded so that they will be processed with the reference files you previously downloaded.</p>
<blockquote>
<div><p><em>Note that these reference files are continually updated and for documentation and to find the newest reference files, see the <a class="reference external" href="https://hst-crds.stsci.edu">CRDS website</a>.</em></p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">crds</span> <span class="pre">bestrefs</span> <span class="pre">--files</span> <span class="pre">data/*.fits</span> <span class="pre">--update-bestrefs</span> <span class="pre">--new-context</span> <span class="pre">'&lt;the</span> <span class="pre">imap</span> <span class="pre">or</span> <span class="pre">pmap</span> <span class="pre">file</span> <span class="pre">you</span> <span class="pre">used</span> <span class="pre">to</span> <span class="pre">download</span> <span class="pre">the</span> <span class="pre">reference</span> <span class="pre">files&gt;'</span></code></p>
<p>Assuming everything ran successfully, you can now <span class="xref myst">skip the next several cells to running the pipeline</span>.</p>
<hr class="docutils" />
<p><a id=skipcellF></a></p>
<p><font size="4"> If you have not yet downloaded the reference files, you will need to do so, as shown below:</font></p>
<p>Unless we are connected to the STScI network, or already have the reference files on our machine, we will need to download the reference files and tell the pipeline where to look for the flat files, bad-pixel files, etc.</p>
<p><font size="4 "> Caution!</font></p>
<a class="reference internal image-reference" href="../../../_images/warning2.png"><img alt="../../../_images/warning2.png" src="../../../_images/warning2.png" style="width: 60px;" /></a>
<p><strong>The process in the following two cells can take a long time and strain network resources!</strong> If you have already downloaded <em>up-to-date</em> COS reference files, avoid doing so again.</p>
<p>Instead, keep these crds files in an accessible location, and point an environment variable <code class="docutils literal notranslate"><span class="pre">lref</span></code> to this directory. For instance, if your lref files are on your username’s home directory, in a subdirectory called <code class="docutils literal notranslate"><span class="pre">crds_cache</span></code>, give Jupyter the following command then skip the next 2 cells:</p>
<p><code class="docutils literal notranslate"><span class="pre">%env</span> <span class="pre">lref</span> <span class="pre">/Users/&lt;your</span> <span class="pre">username&gt;/crds_cache/references/hst/cos/</span></code></p>
<p><strong>Again, only run the following two cells if you have not downloaded these files before:</strong>
In the next two cells, we will setup an environment of reference files, download the files, and save the output of the crds download process in a log file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture cap --no-stderr

%env lref ./data/reference/references/hst/cos/
%env CRDS_SERVER_URL https://hst-crds.stsci.edu
%env CRDS_PATH ./data/reference/

# The next line depends on your context and pmap file
# You can find the latest pmap file at https://hst-crds.stsci.edu
!crds bestrefs --files **/*corrtag*.fits  --sync-references=2 --update-bestrefs --new-context &#39;hst_1123.pmap&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This file now contains the output of the last cell</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span><span class="o">/</span><span class="s1">&#39;crds_output_1.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id=runC></a></p>
<p><font size="4 "> <b>And now, to run the pipeline itself:</b></font></p>
<p>Again, <em>because we wish to compare against the unfiltered data</em>, we must run the pipeline twice:</p>
<ol class="arabic simple">
<li><p>For these new <strong>filtered</strong> files</p></li>
<li><p>For the original <strong>unfiltered</strong> files, so that we can compare and see the effect of filtering.</p></li>
</ol>
<p><em>You can ignore any <code class="docutils literal notranslate"><span class="pre">AstropyDeprecationWarning</span></code>s that pop up</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span> cap --no-stderr
<span class="c1"># First, run with &quot;filtered&quot; data with only time-tag datapoints allowed by filter</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">calcos</span><span class="o">.</span><span class="n">calcos</span><span class="p">(</span><span class="s1">&#39;./filtered_asn.fits&#39;</span><span class="p">,</span>
                  <span class="n">outdir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span> <span class="o">/</span> <span class="s2">&quot;filtered_data_outs&quot;</span><span class="p">),</span>
                  <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An error occured&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span> cap --no-stderr
<span class="c1"># Now, run CalCOS with the initial &quot;full&quot; data - with all time-tag datapoints</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">calcos</span><span class="o">.</span><span class="n">calcos</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./</span><span class="si">{</span><span class="n">filename_root</span><span class="si">}</span><span class="s1">_asn.fits&#39;</span><span class="p">,</span>
                  <span class="n">outdir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">outputdir</span> <span class="o">/</span> <span class="s2">&quot;full_data_outs&quot;</span><span class="p">),</span>
                  <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An error occured&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id = compF></a></p>
</section>
</section>
<section id="comparing-the-filtered-and-unfiltered-data">
<h2>2. Comparing the filtered and unfiltered data<a class="headerlink" href="#comparing-the-filtered-and-unfiltered-data" title="Permalink to this heading">#</a></h2>
<p><strong>Excellent!</strong> We’re essentially done at this point.</p>
<p>Let’s read in both of the processed spectra (the <code class="docutils literal notranslate"><span class="pre">x1dsum</span></code> files) and plot the spectra against one another.</p>
<p><em>You can ignore any <code class="docutils literal notranslate"><span class="pre">UnitsWarning</span></code>s that pop up about formatting.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in the wvln, flux, flux error of the *UNfiltered* spectrum file</span>
<span class="n">unfilt_tab</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./output/full_data_outs/</span><span class="si">{</span><span class="n">filename_root</span><span class="si">}</span><span class="s2">_x1dsum.fits&quot;</span><span class="p">)[</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">,</span> <span class="s1">&#39;FLUX&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">]</span>

<span class="c1"># Read in the wvln, flux, flux error of the *filtered* spectrum file</span>
<span class="n">filt_tab</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;./output/filtered_data_outs/filtered_x1dsum.fits&quot;</span><span class="p">)[</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">,</span> <span class="s1">&#39;FLUX&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">]</span>

<span class="c1"># Convert to dict and combine segments</span>
<span class="n">combo_dict_f</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;FLUX&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">:</span> <span class="p">[]}</span>
<span class="n">combo_dict_u</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;FLUX&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">:</span> <span class="p">[]}</span>

<span class="c1"># Reverse segments FUVA and B for filtered data</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">filt_tab</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
        <span class="n">combo_dict_f</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>

<span class="c1"># Reverse segments FUVA and B for UNfiltered data</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">unfilt_tab</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
        <span class="n">combo_dict_u</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;count /s /pixel&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;count /s /pixel&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up the figure with subplots:</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                       <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># Plot the data in 3 subplots</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">combo_dict_u</span><span class="p">[</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">],</span>
            <span class="n">combo_dict_u</span><span class="p">[</span><span class="s2">&quot;FLUX&quot;</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unfiltered&quot;</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">combo_dict_f</span><span class="p">[</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">],</span>
            <span class="n">combo_dict_f</span><span class="p">[</span><span class="s2">&quot;FLUX&quot;</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Filtered to SUN_ALT&lt;0&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">combo_dict_u</span><span class="p">[</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">],</span>
            <span class="n">combo_dict_u</span><span class="p">[</span><span class="s2">&quot;FLUX&quot;</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unfiltered&quot;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">combo_dict_f</span><span class="p">[</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">],</span>
            <span class="n">combo_dict_f</span><span class="p">[</span><span class="s2">&quot;FLUX&quot;</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Filtered to SUN_ALT&lt;0&quot;</span><span class="p">)</span>

<span class="c1"># Format the figure</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2E-14</span><span class="p">,</span> <span class="mf">6.5E-13</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2E-14</span><span class="p">,</span> <span class="mf">6.5E-13</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fig 2.1</span><span class="se">\n</span><span class="s2">Spectra Filtered and Unfiltered</span><span class="se">\n</span><span class="s2">by Solar altitude (`SUN_ALT`)&quot;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Flux [$\dfrac</span><span class="si">{erg}</span><span class="s2">{cm\ s\ \AA}$]&quot;</span><span class="p">,</span> 
               <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
               <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Wavelength [$\AA$]&quot;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span> <span class="o">/</span> <span class="s1">&#39;compare_spectra_sunalt.png&#39;</span><span class="p">),</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/481cb485fb665465a8497fbde2061c8bcfec9866f82b761044e620ad59e79d32.png" src="../../../_images/481cb485fb665465a8497fbde2061c8bcfec9866f82b761044e620ad59e79d32.png" />
</div>
</div>
<p><strong>We can see that the filtered spectrum largely follows the unfiltered spectrum; however, we significantly reduce the Lyman-alpha light from airglow around 1215 Å.</strong></p>
<p>Because we filter out many of the datapoints used to calculate the spectrum, we can see a significant reduction in precision in flux space (visible as a <strong>banding</strong> in the y-axis). This can come about because with few datapoints, the bands represent wavelengths which received (0,1,2…n) discrete photons. The banding can sometimes be more pronounced at longer, redder wavelengths.</p>
<p><strong>Below, let’s make one final plot: a segment of the spectrum around Lyman-alpha (~1215 Å) showing the errors in flux:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
             <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">combo_dict_u</span><span class="p">[</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">],</span>
             <span class="n">combo_dict_u</span><span class="p">[</span><span class="s2">&quot;FLUX&quot;</span><span class="p">],</span>
             <span class="n">combo_dict_u</span><span class="p">[</span><span class="s2">&quot;ERROR&quot;</span><span class="p">],</span> 
             <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
             <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unfiltered&quot;</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">combo_dict_f</span><span class="p">[</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">],</span>
             <span class="n">combo_dict_f</span><span class="p">[</span><span class="s2">&quot;FLUX&quot;</span><span class="p">],</span>
             <span class="n">combo_dict_f</span><span class="p">[</span><span class="s2">&quot;ERROR&quot;</span><span class="p">],</span> 
             <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
             <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Filtered to SUN_ALT&lt;0&quot;</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Wavelength [$\AA$]&quot;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Flux [$\dfrac</span><span class="si">{erg}</span><span class="s2">{cm\ s\ \AA}$]&quot;</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fig 2.2</span><span class="se">\n</span><span class="s2">Spectra with Errors of Filtered and Unfiltered by `SUN_ALT`&quot;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1213</span><span class="p">,</span> <span class="mi">1218</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span> <span class="o">/</span> <span class="s1">&#39;ebar_compare_spectra_sunalt.png&#39;</span><span class="p">),</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/3cbdd3f0c39b78fc190eb857b6c2b846625570101d2077dfb935abdada949a8c.png" src="../../../_images/3cbdd3f0c39b78fc190eb857b6c2b846625570101d2077dfb935abdada949a8c.png" />
</div>
</div>
<p><strong>With substantially fewer datapoints, our filtered dataset has larger errors.</strong></p>
<p>We can, however, understand why we might want to filter by this, or another <code class="docutils literal notranslate"><span class="pre">sun_alt</span></code> filter. For instance, if most of your exposure was taken at night, but the last 10% was taken after the sun had risen and induced an atmospheric line which interferes with your data, it would often be necessary to filter out this last 10% of the exposure.</p>
</section>
<section id="in-conclusion">
<h2>In conclusion<a class="headerlink" href="#in-conclusion" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>We have learned how to use <code class="docutils literal notranslate"><span class="pre">costools.timefilter</span></code> to separate data taken during HST’s day from data taken during the observatory’s night</p></li>
<li><p>We have discussed the benefits of using this method to remove light from Earth’s upper atmosphere, as well as the associated loss in signal-to-noise ratio that comes from shortening the effective exposure time.</p></li>
</ul>
</section>
<section id="congratulations-you-finished-this-notebook">
<h2>Congratulations! You finished this Notebook!<a class="headerlink" href="#congratulations-you-finished-this-notebook" title="Permalink to this heading">#</a></h2>
<p><font size="5">There are more COS data walkthrough Notebooks on different topics. You can find them <a href="https://github.com/spacetelescope/hst_notebooks/tree/main/notebooks/COS">here</a>.</font></p>
</section>
<hr class="docutils" />
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this heading">#</a></h2>
<p><strong>Author:</strong> Nat Kerman <a class="reference external" href="mailto:nkerman&#37;&#52;&#48;stsci&#46;edu">nkerman<span>&#64;</span>stsci<span>&#46;</span>edu</a></p>
<p><strong>Contributors:</strong> Elaine Mae Frazer</p>
<p><strong>Updated On:</strong> 2023-12-05</p>
<blockquote>
<div><p><em>This tutorial was generated to be in compliance with the <a class="reference external" href="https://github.com/spacetelescope/style-guides">STScI style guides</a> and would like to cite the <a class="reference external" href="https://github.com/spacetelescope/style-guides/blob/master/templates/example_notebook.ipynb">Jupyter guide</a> in particular.</em></p>
</div></blockquote>
</section>
<section id="citations">
<h2>Citations<a class="headerlink" href="#citations" title="Permalink to this heading">#</a></h2>
<p>If you use <code class="docutils literal notranslate"><span class="pre">astropy</span></code>, <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>, <code class="docutils literal notranslate"><span class="pre">astroquery</span></code>, or <code class="docutils literal notranslate"><span class="pre">numpy</span></code> for published research, please cite the
authors. Follow these links for more information about citations:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.astropy.org/acknowledging.html">Citing <code class="docutils literal notranslate"><span class="pre">astropy</span></code></a></p></li>
<li><p><a class="reference external" href="https://numpy.org/citing-numpy/">Citing <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/stable/users/project/citing.html">Citing<code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></p></li>
<li><p><a class="reference external" href="https://astroquery.readthedocs.io/en/latest/">Citing <code class="docutils literal notranslate"><span class="pre">astroquery</span></code></a></p></li>
</ul>
<hr class="docutils" />
<p><span class="xref myst">Top of Page</span>
<a class="reference internal" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a></p>
<p><br></br>
<br></br>
<br></br></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/hst_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/COS/DayNight"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../SplitTag/SplitTag.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></p>
      </div>
    </a>
    <a class="right-next"
       href="../LSF/LSF.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Working with the COS Line Spread Function (LSF)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-and-setup">0. Introduction and Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-will-import-the-following-packages">We will import the following packages:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-will-also-define-a-few-directories-we-will-need">We will also define a few directories we will need:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#and-we-will-need-to-download-the-data-we-wish-to-filter-and-analyze">And we will need to download the data we wish to filter and analyze</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#processing-a-spectrum-from-a-filtered-dataset">1. Processing a spectrum from a filtered dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-the-time-tag-data">1.1. Filtering the <code class="docutils literal notranslate"><span class="pre">TIME-TAG</span></code> data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-new-association-file">1.2. Creating a new association file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-calcos-pipeline">1.3. Running the <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> pipeline</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-the-filtered-and-unfiltered-data">2. Comparing the filtered and unfiltered data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-conclusion">In conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#congratulations-you-finished-this-notebook">Congratulations! You finished this Notebook!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>