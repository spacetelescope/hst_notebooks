

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Aligning HST Mosaics &#8212; HST Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/DrizzlePac/align_mosaics/align_mosaics';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Sky Matching for HST Mosaics" href="../sky_matching/sky_matching.html" />
    <link rel="prev" title="Optimizing the Image Sampling" href="../optimize_image_sampling/optimize_image_sampling.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="HST Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="HST Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    STScI HST Notebook Repository HQ
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">ACS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../ACS/README.html">ACS Notebooks</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_findsat_mrt/acs_findsat_mrt_example.html">Satellite trail detection in ACS/WFC data using acstools.findsat_mrt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_saturation_trails/acs_saturation_trails.html">ACS Linearity with Saturated Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_cte_forward_model/acs_cte_forward_model_example.html">Pixel-based ACS/WFC CTE Forward Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_subarrays/acs_subarrays.html">ACS Image Reduction for Subarray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_sbc_dark_analysis/acs_sbc_dark_analysis.html">SBC Dark Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_reduction/acs_reduction.html">ACS/WFC Image Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_pixel_area_maps/acs_pixel_area_maps.html">Obtaining Pixel Area Maps for ACS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_polarization_tools/acs_polarization_tools.html">Using ACS Polarization Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_focus_diverse_epsfs/acs_focus_diverse_epsfs.html">Focus Diverse ePSFs for ACS/WFC</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">COS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../COS/README.html">COS Notebooks</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../COS/Setup/Setup.html">Setting up your computer environment for working with COS data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/DataDl/DataDl.html">Downloading COS Data</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../COS/ViewData/ViewData.html">Viewing COS Data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/AsnFile/AsnFile.html">Modifying or Creating an Association File</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/CalCOS/CalCOS.html">Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)</a></li>






<li class="toctree-l1"><a class="reference internal" href="../../COS/SplitTag/SplitTag.html">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></a></li>







<li class="toctree-l1"><a class="reference internal" href="../../COS/DayNight/DayNight.html">Filtering out COS Data taken during the Day or Night</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COS/LSF/LSF.html">Working with the COS Line Spread Function (LSF)</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../COS/Extract/Extract.html">Editing the extraction boxes in a spectral extraction file (<code class="docutils literal notranslate"><span class="pre">XTRACTAB</span></code>)</a></li>







<li class="toctree-l1"><a class="reference internal" href="../../COS/ExceptionReport/ExceptionReport.html">What to do when you get an Exception Report for COS</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">DrizzlePac</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../README.html">DrizzlePac Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_updated_astrometry_solutions/using_updated_astrometry_solutions.html">Improving Astrometry Using Alternate WCS Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../align_to_catalogs/align_to_catalogs.html">Aligning HST images to an Absolute Reference Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../align_sparse_fields/align_sparse_fields.html">Aligning Deep Exposures of Sparse Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../align_multiple_visits/align_multiple_visits.html">Optimizing Image Alignment for Multiple HST Visits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use_ds9_regions_in_tweakreg/use_ds9_regions_in_tweakreg.html">TWEAKREG Tips - Using DS9 Regions for Source Inclusion/Exclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize_image_sampling/optimize_image_sampling.html">Optimizing the Image Sampling</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Aligning HST Mosaics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sky_matching/sky_matching.html">Sky Matching for HST Mosaics <a id="top"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../mask_satellite/mask_satellite.html">Satellite Trail Masking Techniques</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HASP</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../HASP/Setup/Setup.html">Installing the Hubble Advanced Spectral Products Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../HASP/CoaddTutorial/CoaddTutorial.html">Inputting User Data using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/FluxScaleTutorial/FluxScaleTutorial.html">Scaling Flux while using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/DataDiagnostic/DataDiagnostics.html">HASP Data Diagnostic Notebook</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../HASP/WavelengthAdjustment/WavelengthAdjustment.html">Wavelength Adjustments for Running the Hubble Advanced Spectral Products (HASP) Script</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NICMOS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html">Programmatic Replacements for NICMOS Units Conversion Form</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">STIS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../STIS/README.html">STIS-Notebooks</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../STIS/cross-correlation/cross-correlation.html">Correcting for Missing Wavecals with Cross-Correlation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/custom_ccd_darks/custom_ccd_darks.html">Custom CCD Darks <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/drizpac_notebook/STIS_DrizzlePac_Tutorial.html">STIS DrizzlePac Tutorial <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/CoronagraphyViz/STIS_Coronagraphy_Visualization_v2.html">STIS Coronagraphy Visualization Tool (v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/calstis/calstis_2d_ccd.html">Calstis 2-D CCD Data Reduction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/target_acquisition/target_acquisition.html">Evaluating STIS Target Acquisitions <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/view_data/view_data.html">Viewing STIS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/extraction/1D_Extraction.html">1D Spectra Extraction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/low_count_uncertainties/Low_Count_Uncertainties.html">Low Count Uncertainties in STIS <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/contrast_sensitivity/STIS_Coronagraphic_Observation_Feasibility.html">STIS Coronagraphic Observation Feasibility</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">WFC3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../WFC3/README.html">WFC3 Notebooks</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/general_tools.html">General Tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/image_displayer_analyzer/wfc3_image_displayer_analyzer.html">WFC3 Image Displayer &amp; Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/exception_report/wfc3_exception_report.html">Exception Report Checklist - WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/calwf3_v1.0_cte/calwf3_with_v1.0_PCTE.html">Processing WFC3/UVIS Data with <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> Using the v1.0 CTE-Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/persistence/wfc3_ir_persistence.html">Masking Persistence in WFC3/IR Images</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/ir_tvb.html">WFC3/IR Time Variable Background (TVB)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_ima_visualization/IR_IMA_Visualization_with_an_Example_of_Time_Variable_Background.html">WFC3/IR IMA Visualization Tools with An Example of Time Variable Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/calwf3_recalibration/calwf3_recal_tvb.html">Manual Recalibration with calwf3: Turning off the IR Linear Ramp Fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/tvb_flattenramp/TVB_flattenramp_notebook.html">Correcting for Helium Line Emission Background in IR Exposures using the “Flatten-Ramp” Technique</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_scattered_light_calwf3_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_Using_calwf3_to_Mask_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Using <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> to Mask Bad Reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/ir_scattered_light_manual_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_by_Manually_Subtracting_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Manually Subtracting Bad Reads</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/photometry.html">Photometry</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/filter_transformations/filter_transformations.html">WFC3/UVIS Filter Transformations with stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/flux_conversion_tool/flux_conversion_tool.html">Flux Unit Conversions with synphot and stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/photometry_examples/phot_examples.html">Synthetic Photometry Examples for WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_time_dependent_photometry/uvis_timedep_phot.html">WFC3/UVIS Time-dependent Photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/zeropoints/zeropoints.html">Calculating WFC3 Zeropoints with STSynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/uvis_pam_corrections/WFC3_UVIS_Pixel_Area_Map_Corrections_for_Subarrays.html">WFC3/UVIS Pixel Area Map Corrections for Subarrays</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../WFC3/point_spread_function.html">Point Spread Function (PSF)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/point_spread_function/hst_point_spread_function.html">HST WFC3 Point Spread Function Modeling   </a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WFC3/mast_api_psf/download_psf_cutouts.html">Downloading WFC3 and WFPC2 PSF Cutouts from MAST</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/spacetelescope/hst_notebooks/blob/main/notebooks/DrizzlePac/align_mosaics/align_mosaics.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/DrizzlePac/align_mosaics/align_mosaics.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/DrizzlePac/align_mosaics/align_mosaics.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Aligning HST Mosaics</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-id-intro-a">Introduction <a id="intro"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observations-a-id-obs-a">Observations <a id="obs"></a></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-a-id-import-a">1. Imports <a id="import"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mast-download-a-id-mast-a">2. MAST Download <a id="MAST"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wfc3-ir">2.1 WFC3/IR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wfc3-uvis">WFC3/UVIS</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-image-header-data-a-id-check-keywords-a">3. Check image header data <a id="check_keywords"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ir-detector-a-id-ir-dither-a">3.1 IR detector <a id="ir_dither"></a></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#uvis-detector-a-id-uvis-dither-a">3.2 UVIS detector <a id="uvis_dither"></a></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-the-wcs-solution-a-id-wcs-a">4. Inspect the WCS Solution  <a id="wcs"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-gaia-catalog-a-id-gaia-cat-a">5. Create Gaia Catalog <a id="gaia_cat"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tweakreg-for-mosaics-a-id-tweakreg-a">6. TweakReg for Mosaics <a id="tweakreg"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ir-alignment-a-id-ir-align-a">6.1 IR Alignment <a id="ir_align"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-the-shift-file-to-verify-the-pointing-residuals-a-id-ir-shift-a">6.2 Inspect the shift file to verify the pointing residuals <a id="ir_shift"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-the-ir-fits-a-id-inspect-ir-a">6.3 Inspect the IR fits <a id="inspect_ir"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mosaicking-features-in-astrodrizzle-a-id-mosaic-feat-a">7. Mosaicking Features in AstroDrizzle <a id="mosaic_feat"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drizzle-the-ir-f160w-mosaic-a-id-ir-driz-a">7.1 Drizzle the IR/F160W Mosaic <a id="ir_driz"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#display-the-combined-drz-science-and-weight-images-a-id-ir-drz-a">7.2 Display the combined DRZ science and weight images <a id="ir_drz"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#align-the-uvis-flc-frames-to-the-ir-mosaic-a-id-uvis-align-a">8. Align the UVIS FLC frames to the IR mosaic <a id="uvis_align"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-the-shift-file-to-verify-the-pointing-residuals-a-id-inspect-resid-a">8.1 Inspect the shift file to verify the pointing residuals <a id="inspect_resid"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-the-uvis-fits-a-id-uvis-inspect-a">8.2 Inspect the UVIS fits  <a id="uvis_inspect"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drizzling-the-f657n-mosaic-a-id-mosaic-657-a">9. Drizzling the F657N mosaic <a id="mosaic_657"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#display-the-combined-drc-science-and-weight-images-a-id-uvis-drc-a">9.1 Display the combined DRC science and weight images <a id="uvis_drc"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions-a-id-conclusions-a">10. Conclusions <a id="conclusions"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources-a-id-add-a">Additional Resources <a id="add"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook-a-id-about-a">About this Notebook <a id="about"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations-a-id-cite-a">Citations <a id="cite"></a></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><a id="top"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="aligning-hst-mosaics">
<h1>Aligning HST Mosaics<a class="headerlink" href="#aligning-hst-mosaics" title="Permalink to this heading">#</a></h1>
<hr class="docutils" />
<div class="alert alert-block alert-warning" style="color:black" > <b> This notebook requires creating and activating a virtual environment using the requirements file in this notebook's repository. Please also review the README file before using the notebook. Note that the text file "align_mosaics_uvis_skyfile.txt" is one of the downloads expected for this notebook.</b> </div> 
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Permalink to this heading">#</a></h2>
<p>By the end of this notebook tutorial, you will:</p>
<ul class="simple">
<li><p>Download WFC3 UVIS &amp; IR images with <code class="docutils literal notranslate"><span class="pre">astroquery</span></code></p></li>
<li><p>Check the active WCS (world coordinate system) solution in the FITS images</p></li>
<li><p>Create a Gaia reference catalog and align the IR images using <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code></p></li>
<li><p>Verify the quality of the alignment results and compare to the MAST alignment solutions</p></li>
<li><p>Update the WCS and use <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> to combine the IR mosaic</p></li>
<li><p>Align the UVIS data to the IR drizzled mosaic using <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code></p></li>
<li><p>Update the WCS and use <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> to combine the UVIS mosaic</p></li>
</ul>
</section>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">#</a></h2>
<p><span class="xref myst">Introduction</span> <br></p>
<p><span class="xref myst">1. Imports</span> <br>
<span class="xref myst">2. MAST Download</span> <br>
<span class="xref myst">3. Check image header data</span> <br>
    <span class="xref myst">3.1 IR detector</span> <br>
    <span class="xref myst">3.2 UVIS detector</span> <br>
<span class="xref myst">4. Inspect the WCS Solution and fit statistics</span> <br>
<span class="xref myst">5. Create Gaia Catalog</span> <br>
<span class="xref myst">6. <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> for Mosaics</span> <br>
    <span class="xref myst">6.1 IR Alignment</span> <br>
    <span class="xref myst">6.2 Inspect the shift file to verify the pointing residuals</span> <br>
    <span class="xref myst">6.3 Inspect the IR fits</span> <br>
<span class="xref myst">7. Mosaicking Features in <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code></span> <br>
    <span class="xref myst">7.1 Drizzle the IR/F160W Mosaic</span> <br>
    <span class="xref myst">7.2 Display the combined <code class="docutils literal notranslate"><span class="pre">DRZ</span></code> science and weight images</span> <br>
<span class="xref myst">8. Align the UVIS <code class="docutils literal notranslate"><span class="pre">FLC</span></code> frames to the IR mosaic</span> <br>
    <span class="xref myst">8.1 Inspect the shift file to verify the pointing residuals</span> <br>
    <span class="xref myst">8.2 Inspect the UVIS fits</span> <br>
<span class="xref myst">9. Drizzling the F657N mosaic</span> <br>
    <span class="xref myst">9.1 Display the combined <code class="docutils literal notranslate"><span class="pre">DRC</span></code> science and weight images</span> <br>
<span class="xref myst">10. Conclusions</span> <br></p>
<p><span class="xref myst">Additional Resources</span> <br>
<span class="xref myst">About this Notebook</span> <br>
<span class="xref myst">Citations</span> <br></p>
</section>
<section id="introduction-a-id-intro-a">
<h2>Introduction <a id="intro"></a><a class="headerlink" href="#introduction-a-id-intro-a" title="Permalink to this heading">#</a></h2>
<p>This notebook demonstrates how to align and drizzle mosaicked tiles of the Eagle Nebula (M16) obtained with WFC3 with both <br>
UVIS and IR detectors. It is based on the example highlighted in the following WFC3 technical report: <a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/wfc3/documentation/instrument-science-reports-isrs/_documents/2015/WFC3-2015-09.pdf">ISR 2015-09: Combining<br>WFC3 Mosaics of M16 with DrizzlePac</a> and highlights special features in DrizzlePac to improve mosaics.</p>
<p>In prior alignment <a class="reference external" href="https://archive.stsci.edu/prepds/heritage/horsehead/readme_HLSP_v3.txt">tutorials</a>, building up an aligned set of tiles required an iterative approach. Now, mosaic alignment can be <br>
achieved in a single step by aligning to the Gaia eDR3 reference catalog. We also show how to use sky matching in <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> <br> to produce seamless mosaics, which can be challenging for extended sources with little or no blank sky. <br></p>
<section id="observations-a-id-obs-a">
<h3>Observations <a id="obs"></a><a class="headerlink" href="#observations-a-id-obs-a" title="Permalink to this heading">#</a></h3>
<p>Mosaics of the Eagle Nebula were acquired by HST GO/DD <a class="reference external" href="http://www.stsci.edu/cgi-bin/get-proposal-info?id=13926&amp;observatory=HST">program 13926</a> (PI Z. Levay) in September 2014 for HST’s 25th <br>
Annivery. A 2x2 tile mosaic with the IR detector (~4 arcmin across) was observed in the F110W and F160W filters.</p>
<p>A slightly larger 2x2 mosaic with the UVIS detector (~5 arcmin across) was observed with the F502N, F657N, and F673N filters.<br>
Small dithers between exposures in a given tile will fill in the UVIS chip gap and allow for the rejection of cosmic rays and detector <br> artifacts. More detail on the observing strategy may be found in the <a class="reference external" href="http://www.stsci.edu/hst/phase2-public/13926.pro">Phase II file</a>.</p>
<p>Two additional UVIS tiles overlap the central portion of 2x2 mosaic in order to increase the high signal-to-noise in the Eagle’s pillars. <br> These two visits (09,10) are not included in this example for brevity but can be added by the user. The data used in this notebook <br> example is also limited to a single IR filter (F160W, visits 01-04) and a single UVIS filter (F657N, visits 05-08), shown in the diagrams <br> below. Additional filters in both detectors are available for this observing program.<br></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span> IR Mosaic           UVIS Mosaic         UVIS (overlap visits, excluded)
 ____ ____            ____ ____            ____ 
|    |    |          |    |    |          |    |   
| 02 | 01 |          | 06 | 05 |          | 09 | 
|____|____|          |____|____|          |____|
|    |    |          |    |    |          |    |  
| 04 | 03 |          | 08 | 07 |          | 10 |
|____|____|          |____|____|          |____|
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="imports-a-id-import-a">
<h2>1. Imports <a id="import"></a><a class="headerlink" href="#imports-a-id-import-a" title="Permalink to this heading">#</a></h2>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Package Name</p></th>
<th class="head text-left"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">glob</span></code></p></td>
<td class="text-left"><p>Making lists of files</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code></p></td>
<td class="text-left"><p>Plotting/displaying data</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">matplotlib.image.mpimg</span></code></p></td>
<td class="text-left"><p>Displaying images</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code></p></td>
<td class="text-left"><p>Concatenating, arrays, and rounding</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">os</span></code></p></td>
<td class="text-left"><p>Directory/file manipulation</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">shutil</span></code></p></td>
<td class="text-left"><p>Directy clean up</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">astropy.io.ascii</span></code></p></td>
<td class="text-left"><p>Reading ascii files</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">astropy.io.fits</span></code></p></td>
<td class="text-left"><p>Reading FITS files</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">astropy.table.Table</span></code></p></td>
<td class="text-left"><p>Making astropy tables</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">astropy.visualization.ZScaleInterval</span></code></p></td>
<td class="text-left"><p>ZScale limits for image displaying</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">drizzlepac.astrodrizzle</span></code></p></td>
<td class="text-left"><p>Combining images/making mosaics</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">drizzlepac.haputils.astrometric_utils.create_astrometric_catalog</span></code></p></td>
<td class="text-left"><p>Creating Gaia catalog with proper motions</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">drizzlepac.tweakreg</span></code></p></td>
<td class="text-left"><p>Aligning images</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">IPython.display.Image</span></code></p></td>
<td class="text-left"><p>Displaying images</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">collections.defaultdict</span></code></p></td>
<td class="text-left"><p>Creating dictionaries</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">astroquery.gaia.Gaia</span> </code></p></td>
<td class="text-left"><p>Gaia catalog to create ref catalog</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">astroquery.mast.Observations</span></code></p></td>
<td class="text-left"><p>Downloading data from MAST</p></td>
</tr>
</tbody>
</table>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.image</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpimg</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">ascii</span><span class="p">,</span> <span class="n">fits</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.visualization</span><span class="w"> </span><span class="kn">import</span> <span class="n">ZScaleInterval</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">drizzlepac.astrodrizzle</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstroDrizzle</span> <span class="k">as</span> <span class="n">adriz</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">drizzlepac.haputils.astrometric_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_astrometric_catalog</span>  
<span class="kn">from</span><span class="w"> </span><span class="nn">drizzlepac</span><span class="w"> </span><span class="kn">import</span> <span class="n">tweakreg</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">clear_output</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.gaia</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gaia</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.mast</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observations</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39; # Improves the resolution of figures rendered in notebooks.
<span class="n">Gaia</span><span class="o">.</span><span class="n">MAIN_GAIA_TABLE</span> <span class="o">=</span> <span class="s1">&#39;gaiadr3.gaia_source&#39;</span>   <span class="c1"># Change if different data release is desired</span>
<span class="n">Gaia</span><span class="o">.</span><span class="n">ROW_LIMIT</span> <span class="o">=</span> <span class="mi">100000</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following task in the stsci.skypac package can be run with TEAL:
                                    skymatch                                    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following tasks in the drizzlepac package can be run with TEAL:
    astrodrizzle       config_testbed      imagefindpars           mapreg       
       photeq            pixreplace           pixtopix            pixtosky      
  refimagefindpars       resetbits          runastrodriz          skytopix      
     tweakback            tweakreg           updatenpol
</pre></div>
</div>
</div>
</div>
</section>
<section id="mast-download-a-id-mast-a">
<h2>2. MAST Download <a id="MAST"></a><a class="headerlink" href="#mast-download-a-id-mast-a" title="Permalink to this heading">#</a></h2>
<hr class="docutils" />
<p>MAST queries may be done using <a href="https://astroquery.readthedocs.io/en/latest/mast/mast_obsquery.html#observation-criteria-queries"> <code class="docutils literal notranslate"><span class="pre">query_criteria</span></code></a>, where we specify: <br></p>
<p>    –&gt; obs_id, proposal_id, and filters</p>
<p>MAST data products may be downloaded by using <a href="https://astroquery.readthedocs.io/en/latest/mast/mast_obsquery.html#downloading-data"> <code class="docutils literal notranslate"><span class="pre">download_products</span></code></a>, where we specify:<br></p>
<p>    –&gt; products = calibrated (FLT, FLC) or drizzled (DRZ, DRC) files</p>
<p>    –&gt; type = standard products (CALxxx) or advanced products (HAP-SVM)</p>
<section id="wfc3-ir">
<h3>2.1 WFC3/IR<a class="headerlink" href="#wfc3-ir" title="Permalink to this heading">#</a></h3>
<p>Here, the 8 calibrated IR FLT files (*_flt.fits) in the F160W filter are retrieved from MAST and placed in the same directory as this notebook.</p>
<div class="alert alert-block alert-warning" style="color:black" >  Depending on your connection speed, this cell may take a few minutes to execute. </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">props</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;13926&#39;</span><span class="p">]</span>
<span class="n">filts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;F160W&#39;</span><span class="p">]</span>

<span class="n">obsTable</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">proposal_id</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filts</span><span class="p">)</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obsTable</span><span class="p">)</span>

<span class="n">data_prod</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FLT&#39;</span><span class="p">]</span>                                 <span class="c1"># [&#39;FLC&#39;,&#39;FLT&#39;,&#39;DRC&#39;,&#39;DRZ&#39;]                  </span>
<span class="n">data_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CALWF3&#39;</span><span class="p">]</span>                              <span class="c1"># [&#39;CALACS&#39;,&#39;CALWF3&#39;,&#39;CALWP2&#39;,&#39;HAP-SVM&#39;]    </span>

<span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">products</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="n">data_prod</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="n">data_type</span><span class="p">)</span>
<span class="n">clear_output</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Move to the files to the local working directory</span>
<span class="k">for</span> <span class="n">flt</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./mastDownload/HST/*/*flt.fits&#39;</span><span class="p">):</span>     
    <span class="n">flt_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">flt</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">flt</span><span class="p">,</span> <span class="n">flt_name</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;mastDownload/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ir_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*flt.fits&#39;</span><span class="p">))</span>
<span class="n">ir_files</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;ick901hzq_flt.fits&#39;,
 &#39;ick901i7q_flt.fits&#39;,
 &#39;ick902n9q_flt.fits&#39;,
 &#39;ick902neq_flt.fits&#39;,
 &#39;ick903n4q_flt.fits&#39;,
 &#39;ick903ncq_flt.fits&#39;,
 &#39;ick904obq_flt.fits&#39;,
 &#39;ick904ogq_flt.fits&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="wfc3-uvis">
<h3>WFC3/UVIS<a class="headerlink" href="#wfc3-uvis" title="Permalink to this heading">#</a></h3>
<p>Here, the 12 calibrated, CTE-corrected UVIS FLC files (*_flc.fits) from visits 05, 06, 07, 08 in the F657N filter are <br> retrieved from MAST and placed in the same directory as this notebook.  (Visits 09 and 10 are excluded for brevity.)</p>
<div class="alert alert-block alert-warning" style="color:black" >  Depending on your connection speed, this cell may take several minutes to execute. </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obs_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ICK90[5678]*&#39;</span><span class="p">]</span>
<span class="n">props</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;13926&#39;</span><span class="p">]</span>
<span class="n">filts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;F657N&#39;</span><span class="p">]</span>

<span class="n">obsTable</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">obs_id</span><span class="o">=</span><span class="n">obs_ids</span><span class="p">,</span> <span class="n">proposal_id</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filts</span><span class="p">)</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obsTable</span><span class="p">)</span>

<span class="n">data_prod</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FLC&#39;</span><span class="p">]</span>        <span class="c1"># [&#39;FLC&#39;,&#39;FLT&#39;,&#39;DRC&#39;,&#39;DRZ&#39;]                  </span>
<span class="n">data_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CALWF3&#39;</span><span class="p">]</span>     <span class="c1"># [&#39;CALACS&#39;,&#39;CALWF3&#39;,&#39;CALWP2&#39;,&#39;HAP-SVM&#39;]    </span>

<span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">products</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="n">data_prod</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="n">data_type</span><span class="p">)</span>
<span class="n">clear_output</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Move to the files to the local working directory</span>
<span class="k">for</span> <span class="n">flc</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./mastDownload/HST/*/*flc.fits&#39;</span><span class="p">):</span>     
    <span class="n">flc_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">flc</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">flc</span><span class="p">,</span> <span class="n">flc_name</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;mastDownload/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uvis_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*flc.fits&#39;</span><span class="p">))</span>
<span class="n">uvis_files</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;ick905k5q_flc.fits&#39;,
 &#39;ick905keq_flc.fits&#39;,
 &#39;ick905knq_flc.fits&#39;,
 &#39;ick906kwq_flc.fits&#39;,
 &#39;ick906l5q_flc.fits&#39;,
 &#39;ick906leq_flc.fits&#39;,
 &#39;ick907nkq_flc.fits&#39;,
 &#39;ick907o1q_flc.fits&#39;,
 &#39;ick907ouq_flc.fits&#39;,
 &#39;ick908pbq_flc.fits&#39;,
 &#39;ick908pkq_flc.fits&#39;,
 &#39;ick908ptq_flc.fits&#39;]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="check-image-header-data-a-id-check-keywords-a">
<h2>3. Check image header data <a id="check_keywords"></a><a class="headerlink" href="#check-image-header-data-a-id-check-keywords-a" title="Permalink to this heading">#</a></h2>
<p>Here we will look at important keywords in the image headers</p>
<section id="ir-detector-a-id-ir-dither-a">
<h3>3.1 IR detector <a id="ir_dither"></a><a class="headerlink" href="#ir-detector-a-id-ir-dither-a" title="Permalink to this heading">#</a></h3>
<p>IR exposures were obtained in Visits 01-04. (The visit ID is found in the 5th and 6th character of the filename).</p>
<p>Each visit (mosaic tile) consists of a pair of exposures using the <b>WFC3-IR-DITHER-BLOB</b> dither of 7.2” along the <br> y-axis (pattern_orient=90 degrees). This dither can be seen when comparing the POSTARG2 keyword between pairs <br> of exposures in a given visit in the table below.</p>
<p>Because there is dithered data to fill in the blob regions, we will later be able to select DQ flags to reject the blobs.</p>
<p>Pairs of IR exposures making up each visit are referred to as v01a and v01b in this notebook. The first four images <br> listed in the table below are associated with v01a and the last four with v01b.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">paths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*flt.fits&#39;</span><span class="p">))</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">keywords_ext0</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ROOTNAME&quot;</span><span class="p">,</span> <span class="s2">&quot;ASN_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;TARGNAME&quot;</span><span class="p">,</span> <span class="s2">&quot;DETECTOR&quot;</span><span class="p">,</span> <span class="s2">&quot;FILTER&quot;</span><span class="p">,</span> <span class="s2">&quot;EXPTIME&quot;</span><span class="p">,</span> 
                 <span class="s2">&quot;RA_TARG&quot;</span><span class="p">,</span> <span class="s2">&quot;DEC_TARG&quot;</span><span class="p">,</span> <span class="s2">&quot;POSTARG1&quot;</span><span class="p">,</span> <span class="s2">&quot;POSTARG2&quot;</span><span class="p">,</span> <span class="s2">&quot;DATE-OBS&quot;</span><span class="p">]</span>
<span class="n">keywords_ext1</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ORIENTAT&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
    <span class="n">path_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords_ext0</span><span class="p">:</span>
        <span class="n">path_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords_ext1</span><span class="p">:</span>
        <span class="n">path_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path_data</span><span class="p">)</span>
    
<span class="n">keywords</span> <span class="o">=</span> <span class="n">keywords_ext0</span> <span class="o">+</span> <span class="n">keywords_ext1</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="n">keywords</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">])</span>
<span class="n">table</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;7.1f&#39;</span>  
<span class="n">table</span><span class="p">[</span><span class="s1">&#39;RA_TARG&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;DEC_TARG&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;7.4f&#39;</span>
<span class="n">table</span><span class="p">[</span><span class="s1">&#39;POSTARG1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;POSTARG2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;7.3f&#39;</span> 
<span class="n">table</span><span class="p">[</span><span class="s1">&#39;ORIENTAT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;7.2f&#39;</span>
<span class="n">table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=8</i>
<table id="table140141786670032" class="table-striped table-bordered table-condensed">
<thead><tr><th>ROOTNAME</th><th>ASN_ID</th><th>TARGNAME</th><th>DETECTOR</th><th>FILTER</th><th>EXPTIME</th><th>RA_TARG</th><th>DEC_TARG</th><th>POSTARG1</th><th>POSTARG2</th><th>DATE-OBS</th><th>ORIENTAT</th></tr></thead>
<thead><tr><th>str32</th><th>str32</th><th>str32</th><th>str32</th><th>str32</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>str32</th><th>float64</th></tr></thead>
<tr><td>ick901hzq</td><td>ICK901030</td><td>LBN67-IR</td><td>IR</td><td>F160W</td><td>702.9</td><td>274.7172</td><td>-13.8361</td><td>-62.566</td><td>-62.047</td><td>2014-09-02</td><td>-35.35</td></tr>
<tr><td>ick901i7q</td><td>ICK901030</td><td>LBN67-IR</td><td>IR</td><td>F160W</td><td>702.9</td><td>274.7172</td><td>-13.8361</td><td>-62.566</td><td>-54.847</td><td>2014-09-02</td><td>-35.36</td></tr>
<tr><td>ick902n9q</td><td>ICK902030</td><td>LBN67-IR</td><td>IR</td><td>F160W</td><td>702.9</td><td>274.7172</td><td>-13.8361</td><td>62.566</td><td>-62.047</td><td>2014-09-02</td><td>-35.36</td></tr>
<tr><td>ick902neq</td><td>ICK902030</td><td>LBN67-IR</td><td>IR</td><td>F160W</td><td>702.9</td><td>274.7172</td><td>-13.8361</td><td>62.566</td><td>-54.847</td><td>2014-09-02</td><td>-35.36</td></tr>
<tr><td>ick903n4q</td><td>ICK903030</td><td>LBN67-IR</td><td>IR</td><td>F160W</td><td>702.9</td><td>274.7172</td><td>-13.8361</td><td>-62.566</td><td>54.847</td><td>2014-09-07</td><td>-35.36</td></tr>
<tr><td>ick903ncq</td><td>ICK903030</td><td>LBN67-IR</td><td>IR</td><td>F160W</td><td>702.9</td><td>274.7172</td><td>-13.8361</td><td>-62.566</td><td>62.047</td><td>2014-09-07</td><td>-35.35</td></tr>
<tr><td>ick904obq</td><td>ICK904030</td><td>LBN67-IR</td><td>IR</td><td>F160W</td><td>702.9</td><td>274.7172</td><td>-13.8361</td><td>62.566</td><td>54.847</td><td>2014-09-07</td><td>-35.36</td></tr>
<tr><td>ick904ogq</td><td>ICK904030</td><td>LBN67-IR</td><td>IR</td><td>F160W</td><td>702.9</td><td>274.7172</td><td>-13.8361</td><td>62.566</td><td>62.047</td><td>2014-09-07</td><td>-35.36</td></tr>
</table></div></div></div>
</div>
</section>
<section id="uvis-detector-a-id-uvis-dither-a">
<h3>3.2 UVIS detector <a id="uvis_dither"></a><a class="headerlink" href="#uvis-detector-a-id-uvis-dither-a" title="Permalink to this heading">#</a></h3>
<p>UVIS exposures were acquired in Visits 05-08.</p>
<p>Each UVIS visit (tile) consists of a set of 3 dithered exposures using the <b> WFC3-UVIS-MOSAIC-LINE </b> pattern, with an offset ~12” along a 65 degree diagonal. <br> This dither can be seen in the POSTARG1, POSTARG2 offsets which are ~5” in X and ~10” in Y between exposures in a given visit.</p>
<p>Sets of three exposures making up each UVIS visit are referred to as v05a, v05b, v05c in this notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">paths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*flc.fits&#39;</span><span class="p">))</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">keywords_ext0</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ROOTNAME&quot;</span><span class="p">,</span> <span class="s2">&quot;ASN_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;TARGNAME&quot;</span><span class="p">,</span> <span class="s2">&quot;DETECTOR&quot;</span><span class="p">,</span> <span class="s2">&quot;FILTER&quot;</span><span class="p">,</span> <span class="s2">&quot;EXPTIME&quot;</span><span class="p">,</span> 
                 <span class="s2">&quot;RA_TARG&quot;</span><span class="p">,</span> <span class="s2">&quot;DEC_TARG&quot;</span><span class="p">,</span> <span class="s2">&quot;POSTARG1&quot;</span><span class="p">,</span> <span class="s2">&quot;POSTARG2&quot;</span><span class="p">,</span> <span class="s2">&quot;DATE-OBS&quot;</span><span class="p">]</span>
<span class="n">keywords_ext1</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ORIENTAT&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
    <span class="n">path_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords_ext0</span><span class="p">:</span>
        <span class="n">path_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords_ext1</span><span class="p">:</span>
        <span class="n">path_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path_data</span><span class="p">)</span>
    
<span class="n">keywords</span> <span class="o">=</span> <span class="n">keywords_ext0</span> <span class="o">+</span> <span class="n">keywords_ext1</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="n">keywords</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">])</span>
<span class="n">table</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;7.1f&#39;</span>
<span class="n">table</span><span class="p">[</span><span class="s1">&#39;RA_TARG&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;DEC_TARG&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;7.4f&#39;</span>
<span class="n">table</span><span class="p">[</span><span class="s1">&#39;POSTARG1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;POSTARG2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;7.3f&#39;</span>
<span class="n">table</span><span class="p">[</span><span class="s1">&#39;ORIENTAT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;7.2f&#39;</span>
<span class="n">table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=12</i>
<table id="table140141780212944" class="table-striped table-bordered table-condensed">
<thead><tr><th>ROOTNAME</th><th>ASN_ID</th><th>TARGNAME</th><th>DETECTOR</th><th>FILTER</th><th>EXPTIME</th><th>RA_TARG</th><th>DEC_TARG</th><th>POSTARG1</th><th>POSTARG2</th><th>DATE-OBS</th><th>ORIENTAT</th></tr></thead>
<thead><tr><th>str32</th><th>str32</th><th>str32</th><th>str32</th><th>str32</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>str32</th><th>float64</th></tr></thead>
<tr><td>ick905k5q</td><td>ICK905040</td><td>LBN67-UVIS</td><td>UVIS</td><td>F657N</td><td>600.0</td><td>274.7104</td><td>-13.8289</td><td>-65.384</td><td>-74.272</td><td>2014-09-02</td><td>-35.25</td></tr>
<tr><td>ick905keq</td><td>ICK905040</td><td>LBN67-UVIS</td><td>UVIS</td><td>F657N</td><td>600.0</td><td>274.7104</td><td>-13.8289</td><td>-60.312</td><td>-63.396</td><td>2014-09-02</td><td>-35.25</td></tr>
<tr><td>ick905knq</td><td>ICK905040</td><td>LBN67-UVIS</td><td>UVIS</td><td>F657N</td><td>600.0</td><td>274.7104</td><td>-13.8289</td><td>-55.241</td><td>-52.521</td><td>2014-09-02</td><td>-35.25</td></tr>
<tr><td>ick906kwq</td><td>ICK906040</td><td>LBN67-UVIS</td><td>UVIS</td><td>F657N</td><td>600.0</td><td>274.7104</td><td>-13.8289</td><td>65.384</td><td>-65.128</td><td>2014-09-02</td><td>-35.25</td></tr>
<tr><td>ick906l5q</td><td>ICK906040</td><td>LBN67-UVIS</td><td>UVIS</td><td>F657N</td><td>600.0</td><td>274.7104</td><td>-13.8289</td><td>70.455</td><td>-54.252</td><td>2014-09-02</td><td>-35.26</td></tr>
<tr><td>ick906leq</td><td>ICK906040</td><td>LBN67-UVIS</td><td>UVIS</td><td>F657N</td><td>600.0</td><td>274.7104</td><td>-13.8289</td><td>75.527</td><td>-43.377</td><td>2014-09-02</td><td>-35.26</td></tr>
<tr><td>ick907nkq</td><td>ICK907040</td><td>LBN67-UVIS</td><td>UVIS</td><td>F657N</td><td>600.0</td><td>274.7104</td><td>-13.8289</td><td>-65.384</td><td>65.128</td><td>2014-09-03</td><td>-35.25</td></tr>
<tr><td>ick907o1q</td><td>ICK907040</td><td>LBN67-UVIS</td><td>UVIS</td><td>F657N</td><td>600.0</td><td>274.7104</td><td>-13.8289</td><td>-60.312</td><td>76.004</td><td>2014-09-03</td><td>-35.25</td></tr>
<tr><td>ick907ouq</td><td>ICK907040</td><td>LBN67-UVIS</td><td>UVIS</td><td>F657N</td><td>600.0</td><td>274.7104</td><td>-13.8289</td><td>-55.241</td><td>86.879</td><td>2014-09-03</td><td>-35.25</td></tr>
<tr><td>ick908pbq</td><td>ICK908040</td><td>LBN67-UVIS</td><td>UVIS</td><td>F657N</td><td>600.0</td><td>274.7104</td><td>-13.8289</td><td>65.384</td><td>74.272</td><td>2014-09-03</td><td>-35.26</td></tr>
<tr><td>ick908pkq</td><td>ICK908040</td><td>LBN67-UVIS</td><td>UVIS</td><td>F657N</td><td>600.0</td><td>274.7104</td><td>-13.8289</td><td>70.455</td><td>85.148</td><td>2014-09-03</td><td>-35.26</td></tr>
<tr><td>ick908ptq</td><td>ICK908040</td><td>LBN67-UVIS</td><td>UVIS</td><td>F657N</td><td>600.0</td><td>274.7104</td><td>-13.8289</td><td>75.527</td><td>96.024</td><td>2014-09-03</td><td>-35.26</td></tr>
</table></div></div></div>
</div>
</section>
</section>
<section id="inspect-the-wcs-solution-a-id-wcs-a">
<h2>4. Inspect the WCS Solution  <a id="wcs"></a><a class="headerlink" href="#inspect-the-wcs-solution-a-id-wcs-a" title="Permalink to this heading">#</a></h2>
<p>Check the active WCS solution in the image header. If the image is aligned to a catalog, list the <b>number of matches and the fit RMS (mas). </b> <br></p>
<p>Convert the fit RMS values to pixels for comparison with the alignment results performed later in this notebook. <br>This is done by creating a dictionary of values which contain the plate scale for each detector.</p>
<p>For the IR detector, we find the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">det_scale</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IR&#39;</span><span class="p">:</span> <span class="mf">0.1283</span><span class="p">,</span> <span class="s1">&#39;UVIS&#39;</span><span class="p">:</span> <span class="mf">0.0396</span><span class="p">,</span> <span class="s1">&#39;WFC&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}</span>   <span class="c1"># plate scale (arcsec/pixel)</span>
<span class="n">ext_0_kws</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DETECTOR&#39;</span><span class="p">]</span>
<span class="n">ext_1_kws</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;WCSNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;NMATCHES&#39;</span><span class="p">,</span> <span class="s1">&#39;RMS_RA&#39;</span><span class="p">,</span> <span class="s1">&#39;RMS_DEC&#39;</span><span class="p">]</span>
<span class="n">format_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">col_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*flt.fits&#39;</span><span class="p">)):</span>
    <span class="n">col_dict</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">hdr0</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">hdr1</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">ext_0_kws</span><span class="p">:</span>
        <span class="n">col_dict</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdr0</span><span class="p">[</span><span class="n">kw</span><span class="p">])</span>    
    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">ext_1_kws</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;RMS&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">hdr1</span><span class="p">[</span><span class="n">kw</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">val</span> <span class="o">=</span> <span class="n">hdr1</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span>
        <span class="n">col_dict</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>        
    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RMS_RA&#39;</span><span class="p">,</span> <span class="s1">&#39;RMS_DEC&#39;</span><span class="p">]:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdr1</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span><span class="o">/</span><span class="n">det_scale</span><span class="p">[</span><span class="n">hdr0</span><span class="p">[</span><span class="s1">&#39;DETECTOR&#39;</span><span class="p">]],</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># convert RMS from mas to pixels</span>
        <span class="n">col_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">kw</span><span class="si">}</span><span class="s1">pix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        
<span class="n">mast_ir_wcs</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">col_dict</span><span class="p">)</span>
<span class="n">mast_ir_wcs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=8</i>
<table id="table140142917086224" class="table-striped table-bordered table-condensed">
<thead><tr><th>filename</th><th>DETECTOR</th><th>WCSNAME</th><th>NMATCHES</th><th>RMS_RA</th><th>RMS_DEC</th><th>RMS_RApix</th><th>RMS_DECpix</th></tr></thead>
<thead><tr><th>str18</th><th>str2</th><th>str30</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>ick901hzq_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>96</td><td>20.1</td><td>17.6</td><td>0.16</td><td>0.14</td></tr>
<tr><td>ick901i7q_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>96</td><td>20.1</td><td>17.6</td><td>0.16</td><td>0.14</td></tr>
<tr><td>ick902n9q_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>102</td><td>12.0</td><td>11.1</td><td>0.09</td><td>0.09</td></tr>
<tr><td>ick902neq_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>102</td><td>12.0</td><td>11.1</td><td>0.09</td><td>0.09</td></tr>
<tr><td>ick903n4q_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>57</td><td>11.0</td><td>9.7</td><td>0.09</td><td>0.08</td></tr>
<tr><td>ick903ncq_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>57</td><td>11.0</td><td>9.7</td><td>0.09</td><td>0.08</td></tr>
<tr><td>ick904obq_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>60</td><td>19.8</td><td>19.0</td><td>0.15</td><td>0.15</td></tr>
<tr><td>ick904ogq_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>60</td><td>19.8</td><td>19.0</td><td>0.15</td><td>0.15</td></tr>
</table></div></div></div>
</div>
<p>Here we see the the images have a <b>FIT-REL-GAIAeDR3</b> solution which means the HST images in a given visit and filter were realigned to one another and then aligned as a set relative to Gaia eDR3. <br>
<br>
Note that each visit has a different number of matches to Gaia (between 50-100) and fit rms values varying from 0.05 to 0.1 pixel. <br> In the cells below, we will realign the images to Gaia and see if we can get a better fit to Gaia than in the MAST data products. <br>
<br>
Next, we look at the WCS for the UVIS data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col_dict_uvis</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*flc.fits&#39;</span><span class="p">)):</span>
    <span class="n">col_dict_uvis</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">hdr0</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">hdr1</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">ext_0_kws</span><span class="p">:</span>
        <span class="n">col_dict_uvis</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdr0</span><span class="p">[</span><span class="n">kw</span><span class="p">])</span>    
    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">ext_1_kws</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;RMS&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">hdr1</span><span class="p">[</span><span class="n">kw</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">val</span> <span class="o">=</span> <span class="n">hdr1</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span>
        <span class="n">col_dict_uvis</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>        
    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RMS_RA&#39;</span><span class="p">,</span> <span class="s1">&#39;RMS_DEC&#39;</span><span class="p">]:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdr1</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span><span class="o">/</span><span class="n">det_scale</span><span class="p">[</span><span class="n">hdr0</span><span class="p">[</span><span class="s1">&#39;DETECTOR&#39;</span><span class="p">]],</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># convert RMS from mas to pixels</span>
        <span class="n">col_dict_uvis</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">kw</span><span class="si">}</span><span class="s1">pix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        
<span class="n">mast_uvis_wcs</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">col_dict_uvis</span><span class="p">)</span>
<span class="n">mast_uvis_wcs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=12</i>
<table id="table140141787173008" class="table-striped table-bordered table-condensed">
<thead><tr><th>filename</th><th>DETECTOR</th><th>WCSNAME</th><th>NMATCHES</th><th>RMS_RA</th><th>RMS_DEC</th><th>RMS_RApix</th><th>RMS_DECpix</th></tr></thead>
<thead><tr><th>str18</th><th>str4</th><th>str30</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>ick905k5q_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>159</td><td>4.4</td><td>3.8</td><td>0.11</td><td>0.1</td></tr>
<tr><td>ick905keq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>159</td><td>4.4</td><td>3.8</td><td>0.11</td><td>0.1</td></tr>
<tr><td>ick905knq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>159</td><td>4.4</td><td>3.8</td><td>0.11</td><td>0.1</td></tr>
<tr><td>ick906kwq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>153</td><td>4.4</td><td>4.0</td><td>0.11</td><td>0.1</td></tr>
<tr><td>ick906l5q_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>153</td><td>4.4</td><td>4.0</td><td>0.11</td><td>0.1</td></tr>
<tr><td>ick906leq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>153</td><td>4.4</td><td>4.0</td><td>0.11</td><td>0.1</td></tr>
<tr><td>ick907nkq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>77</td><td>2.4</td><td>3.6</td><td>0.06</td><td>0.09</td></tr>
<tr><td>ick907o1q_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>77</td><td>2.4</td><td>3.6</td><td>0.06</td><td>0.09</td></tr>
<tr><td>ick907ouq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>77</td><td>2.4</td><td>3.6</td><td>0.06</td><td>0.09</td></tr>
<tr><td>ick908pbq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>101</td><td>5.2</td><td>4.2</td><td>0.13</td><td>0.11</td></tr>
<tr><td>ick908pkq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>101</td><td>5.2</td><td>4.2</td><td>0.13</td><td>0.11</td></tr>
<tr><td>ick908ptq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>101</td><td>5.2</td><td>4.2</td><td>0.13</td><td>0.11</td></tr>
</table></div></div></div>
</div>
<p>Here we see the the images have a <b>FIT-REL-GAIAeDR3</b> solution which means the HST images in a given visit and filter were realigned to one another and then aligned as a set relative to Gaia eDR3. <br>
<br>
Note that each visit has a different number of matches to Gaia (between 80-160) and fit rms values ~0.1 UVIS pixel. <br> In the cells below, we will realign the images to Gaia and see if we can get a better fit to Gaia than in the MAST data products.</p>
</section>
<section id="create-gaia-catalog-a-id-gaia-cat-a">
<h2>5. Create Gaia Catalog <a id="gaia_cat"></a><a class="headerlink" href="#create-gaia-catalog-a-id-gaia-cat-a" title="Permalink to this heading">#</a></h2>
<p>Create a catalog of Gaia DR3 sources (with proper motion data) using the UVIS image FLC footprints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gaia_pm_cat</span> <span class="o">=</span> <span class="n">create_astrometric_catalog</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*flc.fits&#39;</span><span class="p">)))</span>

<span class="n">gaia_pm_cat</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;gaia_pm.cat&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii.no_header&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025044164307 INFO src=drizzlepac.haputils.astrometric_utils- Getting catalog using: 
    http://gsss.stsci.edu/webservices/vo/CatalogSearch.aspx?RA=274.7202282494018&amp;DEC=-13.840002895709132&amp;SR=0.06355961441785501&amp;FORMAT=CSV&amp;CAT=GAIAedr3&amp;MINDET=5&amp;EPOCH=2014.668
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025044164308 INFO src=drizzlepac.haputils.astrometric_utils- Created catalog &#39;ref_cat.ecsv&#39; with 1061  sources
</pre></div>
</div>
</div>
</div>
</section>
<section id="tweakreg-for-mosaics-a-id-tweakreg-a">
<h2>6. TweakReg for Mosaics <a id="tweakreg"></a><a class="headerlink" href="#tweakreg-for-mosaics-a-id-tweakreg-a" title="Permalink to this heading">#</a></h2>
<p>Before combining observations with <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code>, the WCS keywords in the header of each input frame should be aligned to sub-pixel accuracy. <br> This may be tested using <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code>, which allows users to align sets of images to one another or to an external astrometric reference catalog.</p>
</section>
<section id="ir-alignment-a-id-ir-align-a">
<h2>6.1 IR Alignment <a id="ir_align"></a><a class="headerlink" href="#ir-alignment-a-id-ir-align-a" title="Permalink to this heading">#</a></h2>
<p>For this large dataset, the user should consider which filters/detectors to align and combine first. These will serve as a reference image for aligning additional filters. The broadband IR images of M16 contain a large number of stars distributed uniformly over the field of view. The UVIS frames, on the other hand, are full of cosmic-rays which can trip up TweakReg when trying to compute a fit. Even though the IR detector has a smaller footprint on the sky and the IR PSF is more undersampled, the high density of stars makes it a good choice for the reference image.</p>
<p>To generate source lists for matching, the TweakReg parameter <code class="docutils literal notranslate"><span class="pre">conv_width</span></code> should be set to approximately twice the FWHM of the PSF, ~2.5 pixels for IR observations and ~3.5 pixels for UVIS observations. TweakReg will automatically compute the standard deviation of the sky background (<code class="docutils literal notranslate"><span class="pre">skysigma</span></code>), so the number of sources in each catalog may be controlled simply by changing the ‘threshold’ parameter.</p>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> is run in ‘non-interactive’ mode with <code class="docutils literal notranslate"><span class="pre">interactive</span></code> = False so that the astrometric fit residuals and vectors diagrams will be saved as png files in the user’s local directory for inspection. The first time the alignment is performed, we recommend setting the parameter <code class="docutils literal notranslate"><span class="pre">updatehdr</span></code>= False. <b>Once the parameters have been fine-tuned and the fit looks adequate, users may run TweakReg a second time (see below) to update the image header WCS keywords</b> by setting the parameter <code class="docutils literal notranslate"><span class="pre">updatehdr</span></code> = True.</p>
<p>Note that the parameter <code class="docutils literal notranslate"><span class="pre">searchrad</span></code> has be set to a value of 0.25”, or about 2 IR pixels. This is smaller than the <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> default value of 1.0” since the images have already been aligned to Gaia.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">refcat</span> <span class="o">=</span> <span class="s1">&#39;gaia_pm.cat&#39;</span>   <span class="c1"># Choose the Gaia catalog with proper motion data</span>
<span class="n">cw</span> <span class="o">=</span> <span class="mf">2.5</span>                 <span class="c1"># Set to two times the FWHM of the PSF.</span>
<span class="n">wcsname</span> <span class="o">=</span> <span class="s1">&#39;IR_FLT&#39;</span>       <span class="c1"># Specify the WCS name for this alignment</span>

<span class="n">ir_flts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*flt.fits&#39;</span><span class="p">))</span>

<span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="n">ir_flts</span><span class="p">,</span>                                             
                  <span class="n">updatehdr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>                                  <span class="c1"># DO NOT UPDATE the header yet</span>
                  <span class="n">imagefindcfg</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">150.</span><span class="p">,</span> <span class="s1">&#39;conv_width&#39;</span><span class="p">:</span> <span class="n">cw</span><span class="p">},</span>  <span class="c1"># Detection parameters</span>
                  <span class="n">refcat</span><span class="o">=</span><span class="n">refcat</span><span class="p">,</span>                                    <span class="c1"># User supplied catalog (Gaia)</span>
                  <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">see2dplot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">shiftfile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                                   <span class="c1"># Save  shift file </span>
                  <span class="n">outshifts</span><span class="o">=</span><span class="s1">&#39;shift160_flt.txt&#39;</span><span class="p">,</span>                     <span class="c1"># name of the shift file</span>
                  <span class="n">wcsname</span><span class="o">=</span><span class="n">wcsname</span><span class="p">,</span>                                  <span class="c1"># Give our WCS a unique name</span>
                  <span class="n">reusename</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">searchrad</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                  <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                  <span class="n">ylimit</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
                  <span class="n">fitgeometry</span><span class="o">=</span><span class="s1">&#39;rscale&#39;</span><span class="p">)</span>                             <span class="c1"># Fit geometry (shift, rotation, scale)</span>
<span class="n">clear_output</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/e81b21431b715f199079976a0addb49a89ebb0524a0caaae76365f40fa2a8f5f.png" src="../../../_images/e81b21431b715f199079976a0addb49a89ebb0524a0caaae76365f40fa2a8f5f.png" />
<img alt="../../../_images/2e9c7a24e4ebd488d538999747be9c01850592b11cd243beb81842dcc026be4a.png" src="../../../_images/2e9c7a24e4ebd488d538999747be9c01850592b11cd243beb81842dcc026be4a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If the alignment is unsuccessful, stop the notebook</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;shift160_flt.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">shift</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shift</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;nan&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;nan found in line </span><span class="si">{}</span><span class="s1"> in shift file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line_number</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">continue</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="inspect-the-shift-file-to-verify-the-pointing-residuals-a-id-ir-shift-a">
<h2>6.2 Inspect the shift file to verify the pointing residuals <a id="ir_shift"></a><a class="headerlink" href="#inspect-the-shift-file-to-verify-the-pointing-residuals-a-id-ir-shift-a" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> finds stars in each image, matches with the Gaia DR3 reference catalog, and computes residual shifts between exposures. <br> These offsets (given in pixels at the native IR scale=0.1283”/pixel) are recorded in an output “shift file” which is shown below. <br> The computed offsets reflect updates to the header WCS  required to correct for small alignment errors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shift_table</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;shift160_flt.txt&#39;</span><span class="p">,</span>
                         <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii.no_header&#39;</span><span class="p">,</span> 
                         <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;rot&#39;</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="s1">&#39;xrms&#39;</span><span class="p">,</span> <span class="s1">&#39;yrms&#39;</span><span class="p">])</span>

<span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.2f&#39;</span><span class="p">,</span> <span class="s1">&#39;.2f&#39;</span><span class="p">,</span> <span class="s1">&#39;.3f&#39;</span><span class="p">,</span> <span class="s1">&#39;.5f&#39;</span><span class="p">,</span> <span class="s1">&#39;.2f&#39;</span><span class="p">,</span> <span class="s1">&#39;.2f&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shift_table</span><span class="o">.</span><span class="n">colnames</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="n">shift_table</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">formats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">shift_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=8</i>
<table id="table140141774258448" class="table-striped table-bordered table-condensed">
<thead><tr><th>file</th><th>dx</th><th>dy</th><th>rot</th><th>scale</th><th>xrms</th><th>yrms</th></tr></thead>
<thead><tr><th>str18</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>ick901hzq_flt.fits</td><td>0.04</td><td>0.06</td><td>359.996</td><td>0.99993</td><td>0.05</td><td>0.05</td></tr>
<tr><td>ick901i7q_flt.fits</td><td>0.01</td><td>0.07</td><td>0.001</td><td>0.99997</td><td>0.05</td><td>0.05</td></tr>
<tr><td>ick902n9q_flt.fits</td><td>-0.00</td><td>0.01</td><td>0.001</td><td>1.00004</td><td>0.05</td><td>0.04</td></tr>
<tr><td>ick902neq_flt.fits</td><td>0.01</td><td>0.01</td><td>360.000</td><td>1.00002</td><td>0.05</td><td>0.04</td></tr>
<tr><td>ick903n4q_flt.fits</td><td>0.00</td><td>0.02</td><td>360.000</td><td>1.00001</td><td>0.06</td><td>0.03</td></tr>
<tr><td>ick903ncq_flt.fits</td><td>-0.00</td><td>-0.01</td><td>359.998</td><td>1.00000</td><td>0.07</td><td>0.04</td></tr>
<tr><td>ick904obq_flt.fits</td><td>-0.03</td><td>0.08</td><td>359.995</td><td>0.99999</td><td>0.04</td><td>0.03</td></tr>
<tr><td>ick904ogq_flt.fits</td><td>-0.05</td><td>0.07</td><td>359.997</td><td>0.99994</td><td>0.05</td><td>0.03</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print the Number of Gaia Matches per image from the TweakReg output</span>
<span class="n">match_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*_flt_catalog_fit.match&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">match_files</span><span class="p">:</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of matches for&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s1">&#39;= &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of matches for ick901hzq_flt_catalog_fit.match =  107
Number of matches for ick901i7q_flt_catalog_fit.match =  106
Number of matches for ick902n9q_flt_catalog_fit.match =  104
Number of matches for ick902neq_flt_catalog_fit.match =  107
Number of matches for ick903n4q_flt_catalog_fit.match =  51
Number of matches for ick903ncq_flt_catalog_fit.match =  49
Number of matches for ick904obq_flt_catalog_fit.match =  65
Number of matches for ick904ogq_flt_catalog_fit.match =  52
</pre></div>
</div>
</div>
</div>
<p>Compare the RMS and number of Matches from <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> with the MAST alignment results. <br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mast_ir_wcs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=8</i>
<table id="table140142917086224" class="table-striped table-bordered table-condensed">
<thead><tr><th>filename</th><th>DETECTOR</th><th>WCSNAME</th><th>NMATCHES</th><th>RMS_RA</th><th>RMS_DEC</th><th>RMS_RApix</th><th>RMS_DECpix</th></tr></thead>
<thead><tr><th>str18</th><th>str2</th><th>str30</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>ick901hzq_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>96</td><td>20.1</td><td>17.6</td><td>0.16</td><td>0.14</td></tr>
<tr><td>ick901i7q_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>96</td><td>20.1</td><td>17.6</td><td>0.16</td><td>0.14</td></tr>
<tr><td>ick902n9q_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>102</td><td>12.0</td><td>11.1</td><td>0.09</td><td>0.09</td></tr>
<tr><td>ick902neq_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>102</td><td>12.0</td><td>11.1</td><td>0.09</td><td>0.09</td></tr>
<tr><td>ick903n4q_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>57</td><td>11.0</td><td>9.7</td><td>0.09</td><td>0.08</td></tr>
<tr><td>ick903ncq_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>57</td><td>11.0</td><td>9.7</td><td>0.09</td><td>0.08</td></tr>
<tr><td>ick904obq_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>60</td><td>19.8</td><td>19.0</td><td>0.15</td><td>0.15</td></tr>
<tr><td>ick904ogq_flt.fits</td><td>IR</td><td>IDC_w3m18525i-FIT_REL_GAIAeDR3</td><td>60</td><td>19.8</td><td>19.0</td><td>0.15</td><td>0.15</td></tr>
</table></div></div></div>
</div>
<p>Note that while similar numbers of stars were matched during MAST processing and in our custom alignment, the fit RMS is ~2x lower. Before updating the WCS solutions, we inspect the quality of the fitting in the next section.</p>
</section>
<section id="inspect-the-ir-fits-a-id-inspect-ir-a">
<h2>6.3 Inspect the IR fits <a id="inspect_ir"></a><a class="headerlink" href="#inspect-the-ir-fits-a-id-inspect-ir-a" title="Permalink to this heading">#</a></h2>
<p>To verify that <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> obtained a good fit between matched source catalogs, it is useful to inspect the results before updating the image header WCS. Below sources matched with Gaia are overplotted on the first exposures from Visits 01 and 02. It can be useful to check that <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> locked onto stars and not hot pixels or other detector artifacts before proceeding.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rootname1a</span> <span class="o">=</span> <span class="s1">&#39;ick901hzq&#39;</span>
<span class="n">rootname2a</span> <span class="o">=</span> <span class="s1">&#39;ick902n9q&#39;</span>
<span class="n">rootname3a</span> <span class="o">=</span> <span class="s1">&#39;ick903n4q&#39;</span>
<span class="n">rootname4a</span> <span class="o">=</span> <span class="s1">&#39;ick904ogq&#39;</span>

<span class="n">panel1_rootname</span> <span class="o">=</span> <span class="n">rootname1a</span>   <span class="c1"># Visit 01               #This cell requires two visits as input (uncommented)</span>
<span class="n">panel2_rootname</span> <span class="o">=</span> <span class="n">rootname2a</span>   <span class="c1"># Visit 02</span>
<span class="c1"># panel1_rootname = rootname3a   # Visit 03</span>
<span class="c1"># panel2_rootname = rootname4a   # Visit 04</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">data_a</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">panel1_rootname</span><span class="o">+</span><span class="s1">&#39;_flt.fits&#39;</span><span class="p">)[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">data_b</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">panel2_rootname</span><span class="o">+</span><span class="s1">&#39;_flt.fits&#39;</span><span class="p">)[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">zscale</span> <span class="o">=</span> <span class="n">ZScaleInterval</span><span class="p">()</span>
<span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">zscale</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">data_a</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_a</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">z1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">z2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_b</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">z1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">z2</span><span class="p">)</span>

<span class="n">match_tab_a</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">panel1_rootname</span><span class="o">+</span><span class="s1">&#39;_flt_catalog_fit.match&#39;</span><span class="p">)</span>
<span class="n">match_tab_b</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">panel2_rootname</span><span class="o">+</span><span class="s1">&#39;_flt_catalog_fit.match&#39;</span><span class="p">)</span> <span class="c1"># load match file in astropy table</span>
<span class="n">x_coord_a</span><span class="p">,</span> <span class="n">y_coord_a</span> <span class="o">=</span> <span class="n">match_tab_a</span><span class="p">[</span><span class="s1">&#39;col11&#39;</span><span class="p">],</span> <span class="n">match_tab_a</span><span class="p">[</span><span class="s1">&#39;col12&#39;</span><span class="p">]</span>
<span class="n">x_coord_b</span><span class="p">,</span> <span class="n">y_coord_b</span> <span class="o">=</span> <span class="n">match_tab_b</span><span class="p">[</span><span class="s1">&#39;col11&#39;</span><span class="p">],</span> <span class="n">match_tab_b</span><span class="p">[</span><span class="s1">&#39;col12&#39;</span><span class="p">]</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_coord_a</span><span class="p">,</span> <span class="n">y_coord_a</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_coord_b</span><span class="p">,</span> <span class="n">y_coord_b</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">panel1_rootname</span><span class="si">}</span><span class="s1"> to Gaia N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">match_tab_a</span><span class="p">)</span><span class="si">}</span><span class="s1"> Matches&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">panel2_rootname</span><span class="si">}</span><span class="s1"> to Gaia N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">match_tab_b</span><span class="p">)</span><span class="si">}</span><span class="s1"> Matches&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/81dbfc9fdede48de53308ebf3349292eb8dcf9ea007148c38cbb9f9731f7bb91.png" src="../../../_images/81dbfc9fdede48de53308ebf3349292eb8dcf9ea007148c38cbb9f9731f7bb91.png" />
</div>
</div>
<p>Next, the 4-panel fit residual plots: dx, dy vs X and Y are inspected to verify that the residuals cluster around zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read images</span>
<span class="n">panel1_png</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;residuals_</span><span class="si">{</span><span class="n">panel1_rootname</span><span class="si">}</span><span class="s1">_flt.png&#39;</span><span class="p">)</span>
<span class="n">panel2_png</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;residuals_</span><span class="si">{</span><span class="n">panel2_rootname</span><span class="si">}</span><span class="s1">_flt.png&#39;</span><span class="p">)</span>
<span class="c1"># display images</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">panel1_png</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">panel2_png</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/7c9df3984ac2517c4ca0af10b915b0f5a03f4f4519a0bce73cd52d11233ea8f0.png" src="../../../_images/7c9df3984ac2517c4ca0af10b915b0f5a03f4f4519a0bce73cd52d11233ea8f0.png" />
</div>
</div>
<p>We repeat the following for Visits 03 and 04.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># panel1_rootname =rootname1a   # Visit 01          #This cell requires two visits as input (uncommented)</span>
<span class="c1"># panel2_rootname =rootname2a   # Visit 02</span>
<span class="n">panel1_rootname</span> <span class="o">=</span> <span class="n">rootname3a</span>   <span class="c1"># Visit 03</span>
<span class="n">panel2_rootname</span> <span class="o">=</span> <span class="n">rootname4a</span>   <span class="c1"># Visit 04</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">data_a</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">panel1_rootname</span><span class="o">+</span><span class="s1">&#39;_flt.fits&#39;</span><span class="p">)[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">data_b</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">panel2_rootname</span><span class="o">+</span><span class="s1">&#39;_flt.fits&#39;</span><span class="p">)[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">zscale</span> <span class="o">=</span> <span class="n">ZScaleInterval</span><span class="p">()</span>
<span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">zscale</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">data_a</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_a</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">z1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">z2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_b</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">z1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">z2</span><span class="p">)</span>

<span class="n">match_tab_a</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">panel1_rootname</span><span class="o">+</span><span class="s1">&#39;_flt_catalog_fit.match&#39;</span><span class="p">)</span>
<span class="n">match_tab_b</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">panel2_rootname</span><span class="o">+</span><span class="s1">&#39;_flt_catalog_fit.match&#39;</span><span class="p">)</span> <span class="c1"># load match file in astropy table</span>
<span class="n">x_coord_a</span><span class="p">,</span> <span class="n">y_coord_a</span> <span class="o">=</span> <span class="n">match_tab_a</span><span class="p">[</span><span class="s1">&#39;col11&#39;</span><span class="p">],</span> <span class="n">match_tab_a</span><span class="p">[</span><span class="s1">&#39;col12&#39;</span><span class="p">]</span>
<span class="n">x_coord_b</span><span class="p">,</span> <span class="n">y_coord_b</span> <span class="o">=</span> <span class="n">match_tab_b</span><span class="p">[</span><span class="s1">&#39;col11&#39;</span><span class="p">],</span> <span class="n">match_tab_b</span><span class="p">[</span><span class="s1">&#39;col12&#39;</span><span class="p">]</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_coord_a</span><span class="p">,</span> <span class="n">y_coord_a</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_coord_b</span><span class="p">,</span> <span class="n">y_coord_b</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">panel1_rootname</span><span class="si">}</span><span class="s1"> to Gaia N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">match_tab_a</span><span class="p">)</span><span class="si">}</span><span class="s1"> Matches&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">panel2_rootname</span><span class="si">}</span><span class="s1"> to Gaia N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">match_tab_b</span><span class="p">)</span><span class="si">}</span><span class="s1"> Matches&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/97a2f82a6b1303c3d8dfc4aa212a9566350b04d96b245aa09b567bd4655bbb15.png" src="../../../_images/97a2f82a6b1303c3d8dfc4aa212a9566350b04d96b245aa09b567bd4655bbb15.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read images</span>
<span class="n">panel1_png</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;residuals_</span><span class="si">{</span><span class="n">panel1_rootname</span><span class="si">}</span><span class="s1">_flt.png&#39;</span><span class="p">)</span>
<span class="n">panel2_png</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;residuals_</span><span class="si">{</span><span class="n">panel2_rootname</span><span class="si">}</span><span class="s1">_flt.png&#39;</span><span class="p">)</span>
<span class="c1"># display images</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">panel1_png</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">panel2_png</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/36bd3eee0ff3a06b8b0bef7c8d3c36658fec5ddf12a6fa7954ecba8746de315b.png" src="../../../_images/36bd3eee0ff3a06b8b0bef7c8d3c36658fec5ddf12a6fa7954ecba8746de315b.png" />
</div>
</div>
<p>The dx,dy residuals for all IR exposures are all clustered around dx,dy=0 and have an RMS less than 0.1 pixels, indicating a good fit. If the alignment needs to be fine-tuned, changing the parameters <code class="docutils literal notranslate"><span class="pre">threshold</span></code>, <code class="docutils literal notranslate"><span class="pre">sigma</span></code>, and <code class="docutils literal notranslate"><span class="pre">searchrad</span></code> may help TweakReg to lock onto an accurate solution.</p>
<p>Since the fit looks good, the RMS is better than the MAST solution, and there appears to be a small residual rotation in the shift file, we rerun TweakReg but now with <code class="docutils literal notranslate"><span class="pre">updatehdr=True</span></code> to update the header WCS with the new Gaia fit. Here we set a unique name for the WCS solution to be <code class="docutils literal notranslate"><span class="pre">IR_FLT_GAIA</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">refcat</span> <span class="o">=</span> <span class="s1">&#39;gaia_pm.cat&#39;</span>   <span class="c1"># Choose the Gaia catalog with proper motion data</span>
<span class="n">cw</span> <span class="o">=</span> <span class="mf">2.5</span>                 <span class="c1"># Set to two times the FWHM of the PSF.</span>
<span class="n">wcsname</span> <span class="o">=</span> <span class="s1">&#39;IR_FLT_GAIA&#39;</span>       <span class="c1"># Specify the WCS name for this alignment</span>

<span class="n">ir_flts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*flt.fits&#39;</span><span class="p">))</span>

<span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="n">ir_flts</span><span class="p">,</span>                                             
                  <span class="n">updatehdr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                                      <span class="c1"># Update header NOW ******</span>
                  <span class="n">imagefindcfg</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">150.</span><span class="p">,</span> <span class="s1">&#39;conv_width&#39;</span><span class="p">:</span> <span class="n">cw</span><span class="p">},</span>     <span class="c1"># Detection parameters</span>
                  <span class="n">refcat</span><span class="o">=</span><span class="n">refcat</span><span class="p">,</span>                                       <span class="c1"># User supplied catalog (Gaia)</span>
                  <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">see2dplot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shiftfile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>                                   
                  <span class="n">wcsname</span><span class="o">=</span><span class="n">wcsname</span><span class="p">,</span>                                     <span class="c1"># Give our WCS a unique name</span>
                  <span class="n">reusename</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">searchrad</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                  <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                  <span class="n">ylimit</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
                  <span class="n">fitgeometry</span><span class="o">=</span><span class="s1">&#39;rscale&#39;</span><span class="p">)</span>                             <span class="c1"># Fit geometry (shift, rotation, scale)</span>
<span class="n">clear_output</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/e81b21431b715f199079976a0addb49a89ebb0524a0caaae76365f40fa2a8f5f.png" src="../../../_images/e81b21431b715f199079976a0addb49a89ebb0524a0caaae76365f40fa2a8f5f.png" />
<img alt="../../../_images/2e9c7a24e4ebd488d538999747be9c01850592b11cd243beb81842dcc026be4a.png" src="../../../_images/2e9c7a24e4ebd488d538999747be9c01850592b11cd243beb81842dcc026be4a.png" />
</div>
</div>
</section>
<section id="mosaicking-features-in-astrodrizzle-a-id-mosaic-feat-a">
<h2>7. Mosaicking Features in AstroDrizzle <a id="mosaic_feat"></a><a class="headerlink" href="#mosaicking-features-in-astrodrizzle-a-id-mosaic-feat-a" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> now makes it easier for users to match the sky background when tiling together large mosaics. In prior versions of the software, the sky method <code class="docutils literal notranslate"><span class="pre">localmin</span></code> was computed using clipped statistics in each image separately. The sky background was measured for each chip and the lowest sky value (in electrons/arcsec^2) among all of the chips was adopted. For observations of sparse fields, this approach generally works well. However, when large extended objects fill the detector, there is no true ‘blank sky’ and the background value will be an overestimate. Additionally, when extended targets are observed as mosaics (e.g. with large dithers), the ‘scene’ can change significantly between exposures and bias the background estimate.</p>
<p>An error in determining the sky background may in turn impact the cosmic-ray rejection, and if severe enough, the resulting photometry. Additionally, by not properly matching the sky background before combining frames, correlated noise will be added to the final drizzled products when differences in the background levels are significant. Until now, the recommended workaround has been for users to give <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> an ASCII file containing user-defined background values via the <code class="docutils literal notranslate"><span class="pre">skyfile</span></code> parameter.</p>
<p>AstroDrizzle now features several options for computing the sky. One of these, <code class="docutils literal notranslate"><span class="pre">skymethod='match</span></code>, is useful for “equalizing” the sky background across large mosaics. This method computes differences in sky values using only pixels in common between images. The sky values will then be set relative to the value computed for the input frame with the lowest sky value for which the MDRIZSKY keyword will be set to 0. In this way, the sky background is not removed, but instead equalized before the data are combined. For more details on the sky matching functions used by <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code>, see the <a class="reference external" href="https://drizzlepac.readthedocs.io/en/latest/drizzlepac_api/sky.html">readthedocs</a> and <a class="reference external" href="https://stsci-skypac.readthedocs.io/en/latest/skymatch.html">skypac</a> online documentation.</p>
</section>
<section id="drizzle-the-ir-f160w-mosaic-a-id-ir-driz-a">
<h2>7.1 Drizzle the IR/F160W Mosaic <a id="ir_driz"></a><a class="headerlink" href="#drizzle-the-ir-f160w-mosaic-a-id-ir-driz-a" title="Permalink to this heading">#</a></h2>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> can be used to combine the full set of F160W frames. In this case the final orientation has been set to -35 degrees so that the pillars will be oriented vertically. Note that users must first set the parameter <code class="docutils literal notranslate"><span class="pre">final_wcs='True'</span></code> in order to turn on parameters in AstroDrizzle’s step 7a: <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">WCS</span> <span class="pre">for</span> <span class="pre">Final</span> <span class="pre">Output</span></code>. For these observations, the IR scale (0.08”/pixel) is chosen to be exactly twice that for the UVIS mosaics (0.04”/pixel) by setting <code class="docutils literal notranslate"><span class="pre">final_scale=0.08</span></code>, and the drizzled images have been oversized slightly to match the sky area on the sky covered by the UVIS. The sky background may be equalized across mosaic tiles by setting the parameter <code class="docutils literal notranslate"><span class="pre">skymethod='match'</span></code>.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">final_bits</span></code> defines which DQ flags in the FLT image to treat as good. All other pixels with non-zero DQ values will be assumed to be bad and rejected from the final mosaic. For IR data, these two parameters are typically set to 64+512 in the pipeline, corresponding to warm pixels and IR blobs. This program included a blob dither, however, and so the 512 flag may be removed from the list of good DQ values such that these pixels will be replaced with non-flagged pixels from the accompanying dithered pair.</p>
<p>For IR data, cosmic-rays have already rejected via the ‘up-the-ramp’ fitting by calwf3, so Steps 3, 4, 5, 6 in AstroDrizzle have been turned off when combining the FLT exposures.  See <a class="reference external" href="https://drizzlepac.readthedocs.io/en/latest/drizzlepac_api.html">readthedocs</a> for more information about the various input parameters to AstroDrizzle.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adriz</span><span class="p">(</span><span class="n">ir_flts</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;f160w&#39;</span><span class="p">,</span>
      <span class="n">preserve</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">build</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
      <span class="n">driz_separate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">driz_cr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Turn off cr-rejection</span>
      <span class="n">skymethod</span><span class="o">=</span><span class="s1">&#39;match&#39;</span><span class="p">,</span> 
      <span class="n">final_bits</span><span class="o">=</span><span class="s1">&#39;16&#39;</span><span class="p">,</span>                                               <span class="c1"># Only DQ=16 are good (stable hot pixels)</span>
      <span class="n">final_wcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">final_scale</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">final_rot</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span>
      <span class="n">final_ra</span><span class="o">=</span><span class="mf">274.721587</span><span class="p">,</span> <span class="n">final_dec</span><span class="o">=-</span><span class="mf">13.841549</span><span class="p">,</span>
      <span class="n">final_outnx</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">final_outny</span><span class="o">=</span><span class="mi">4500</span><span class="p">)</span>

<span class="n">clear_output</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="display-the-combined-drz-science-and-weight-images-a-id-ir-drz-a">
<h2>7.2 Display the combined DRZ science and weight images <a id="ir_drz"></a><a class="headerlink" href="#display-the-combined-drz-science-and-weight-images-a-id-ir-drz-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sci</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;f160w_drz_sci.fits&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">140</span><span class="p">)</span>
<span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">zscale</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">sci</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sci</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">z1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">z2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys_r&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f7550113fd0&gt;
</pre></div>
</div>
<img alt="../../../_images/3d3c529753a22d4873ac3d497cdc12e0aca0d3bbc0edfbd333016ab71653ff6c.png" src="../../../_images/3d3c529753a22d4873ac3d497cdc12e0aca0d3bbc0edfbd333016ab71653ff6c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wht</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;f160w_drz_wht.fits&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">140</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wht</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1700</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys_r&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f754cd71f50&gt;
</pre></div>
</div>
<img alt="../../../_images/d8aace62a373fb9a38811171d066072a6c7893aedd1b603e27c216a958a1051f.png" src="../../../_images/d8aace62a373fb9a38811171d066072a6c7893aedd1b603e27c216a958a1051f.png" />
</div>
</div>
</section>
<section id="align-the-uvis-flc-frames-to-the-ir-mosaic-a-id-uvis-align-a">
<h2>8. Align the UVIS FLC frames to the IR mosaic <a id="uvis_align"></a><a class="headerlink" href="#align-the-uvis-flc-frames-to-the-ir-mosaic-a-id-uvis-align-a" title="Permalink to this heading">#</a></h2>
<p>The F160W drizzled mosaic defines the reference frame for aligning the UVIS filters. In <a class="reference external" href="http://www.stsci.edu/hst/wfc3/documents/ISRs/WFC3-2015-09.pdf">ISR 2015-09</a>, the UVIS visit-level DRC frames were aligned directly to the IR reference image, and this approach was chosen because the long UVIS exposures contain numerous cosmic-rays and relatively few point sources. The DrizzlePac task <code class="docutils literal notranslate"><span class="pre">TweakBack</span></code> was then used to propagate the updated WCS from the drizzled image header back to the individual FLC input frames making up each association prior to drizzling.</p>
<p>In this notebook, we instead align the UVIS FLC frames directly to the Gaia catalog, making use of a parameter in <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> which allows for specific flags in the DQ array of the FLC frames to be used or ignored. The <code class="docutils literal notranslate"><span class="pre">imagefindpars</span></code> parameter <code class="docutils literal notranslate"><span class="pre">dqbits</span></code> may be prepended with tilda to the string value to indicate which DQ flags to consider as “bad” pixels. For example, when deriving source catalogs, <code class="docutils literal notranslate"><span class="pre">Tweakreg</span></code> will ignore any pixels flagged as cosmic-ray flags in the MAST visit-level drizzled data products when <code class="docutils literal notranslate"><span class="pre">dqbits</span></code> is set to ~4096. This dramatically cuts down the number of false detections due to cosmic rays in the input FLC science arrays. More details on <code class="docutils literal notranslate"><span class="pre">imagefindpars</span></code> options may be found on the following <a class="reference external" href="https://drizzlepac.readthedocs.io/en/latest/user_reprocessing/imagefindpars.html">webpage</a>.</p>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">threshold</span></code> value was manually adjusted to get ~100 matches per UVIS exposure. Note that setting the <code class="docutils literal notranslate"><span class="pre">threshold</span></code> to a very low value does not necessarily translate to a better solution, since all sources are weighted equally when computing fits to match catalogs. This is especially relevant for UVIS data where CTE tails can shift the centroid position slightly along the readout direction for faint sources and potentially bias the fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">refcat</span> <span class="o">=</span> <span class="s1">&#39;gaia_pm.cat&#39;</span>   <span class="c1"># Choose the Gaia catalog with proper motion data</span>
<span class="n">cw</span> <span class="o">=</span> <span class="mf">3.5</span>                 <span class="c1"># Set to two times the FWHM of the PSF. (3.5 pixels for UVIS, 2.5 pixels for IR)</span>
<span class="n">wcsname</span> <span class="o">=</span> <span class="s1">&#39;UVIS_FLT&#39;</span>       <span class="c1"># Specify the WCS name for this alignment</span>

<span class="n">uvis_flcs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*flc.fits&#39;</span><span class="p">))</span>

<span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="n">uvis_flcs</span><span class="p">,</span>                                             
                  <span class="n">updatehdr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>                                  <span class="c1"># DO NOT UPDATE the header yet</span>
                  <span class="n">refcat</span><span class="o">=</span><span class="n">refcat</span><span class="p">,</span>                                    
                  <span class="n">imagefindcfg</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">40.</span><span class="p">,</span> <span class="s1">&#39;conv_width&#39;</span><span class="p">:</span> <span class="n">cw</span><span class="p">,</span> <span class="s1">&#39;dqbits&#39;</span><span class="p">:</span> <span class="s2">&quot;~4096&quot;</span><span class="p">},</span>  
                  <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">see2dplot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">shiftfile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
                  <span class="n">outshifts</span><span class="o">=</span><span class="s1">&#39;shift657_flc.txt&#39;</span><span class="p">,</span>                     
                  <span class="n">wcsname</span><span class="o">=</span><span class="n">wcsname</span><span class="p">,</span>                                  <span class="c1"># Give our WCS a unique name</span>
                  <span class="n">reusename</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">searchrad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                  <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                  <span class="n">ylimit</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
                  <span class="n">fitgeometry</span><span class="o">=</span><span class="s1">&#39;rscale&#39;</span><span class="p">)</span>                             <span class="c1"># Fit geometry (shift, rotation, scale)</span>
<span class="n">clear_output</span><span class="p">()</span>                 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/859e7b991172a38f4a10a7af9ef7a1fdce4b04881c574e4d0fddcebb9b9b1395.png" src="../../../_images/859e7b991172a38f4a10a7af9ef7a1fdce4b04881c574e4d0fddcebb9b9b1395.png" />
<img alt="../../../_images/0a3fbd5f9416e92e1d98bb4df2cbf19f2113f1dcdf6a15234b25201be66c9250.png" src="../../../_images/0a3fbd5f9416e92e1d98bb4df2cbf19f2113f1dcdf6a15234b25201be66c9250.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If the alignment is unsuccessful, stop the notebook</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;shift657_flc.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">shift</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shift</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;nan&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;nan found in line </span><span class="si">{}</span><span class="s1"> in shift file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line_number</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">continue</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="inspect-the-shift-file-to-verify-the-pointing-residuals-a-id-inspect-resid-a">
<h2>8.1 Inspect the shift file to verify the pointing residuals <a id="inspect_resid"></a><a class="headerlink" href="#inspect-the-shift-file-to-verify-the-pointing-residuals-a-id-inspect-resid-a" title="Permalink to this heading">#</a></h2>
<p>Because each visit was acquired using a unique pair of Guide Stars, the three FLC exposures making up each visit should have roughly similar residual corrections to the WCS, which can be seen in the table below. Since the residuals in the shift file are close to zero and the rms values are &lt;0.1 pixel, we can be confident that the fitting was successful.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shift_table</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;shift657_flc.txt&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii.no_header&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;rot&#39;</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="s1">&#39;xrms&#39;</span><span class="p">,</span> <span class="s1">&#39;yrms&#39;</span><span class="p">])</span>

<span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.2f&#39;</span><span class="p">,</span> <span class="s1">&#39;.2f&#39;</span><span class="p">,</span> <span class="s1">&#39;.3f&#39;</span><span class="p">,</span> <span class="s1">&#39;.5f&#39;</span><span class="p">,</span> <span class="s1">&#39;.2f&#39;</span><span class="p">,</span> <span class="s1">&#39;.2f&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shift_table</span><span class="o">.</span><span class="n">colnames</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="n">shift_table</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">formats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">shift_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=12</i>
<table id="table140141770413328" class="table-striped table-bordered table-condensed">
<thead><tr><th>file</th><th>dx</th><th>dy</th><th>rot</th><th>scale</th><th>xrms</th><th>yrms</th></tr></thead>
<thead><tr><th>str18</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>ick905k5q_flc.fits</td><td>-0.00</td><td>0.01</td><td>0.000</td><td>1.00000</td><td>0.06</td><td>0.05</td></tr>
<tr><td>ick905keq_flc.fits</td><td>0.01</td><td>0.04</td><td>0.000</td><td>0.99999</td><td>0.05</td><td>0.04</td></tr>
<tr><td>ick905knq_flc.fits</td><td>0.03</td><td>0.02</td><td>360.000</td><td>0.99999</td><td>0.05</td><td>0.04</td></tr>
<tr><td>ick906kwq_flc.fits</td><td>0.04</td><td>0.07</td><td>360.000</td><td>1.00000</td><td>0.06</td><td>0.06</td></tr>
<tr><td>ick906l5q_flc.fits</td><td>0.03</td><td>0.04</td><td>360.000</td><td>1.00000</td><td>0.06</td><td>0.05</td></tr>
<tr><td>ick906leq_flc.fits</td><td>0.02</td><td>0.02</td><td>360.000</td><td>1.00000</td><td>0.05</td><td>0.05</td></tr>
<tr><td>ick907nkq_flc.fits</td><td>-0.00</td><td>0.06</td><td>359.999</td><td>1.00001</td><td>0.06</td><td>0.04</td></tr>
<tr><td>ick907o1q_flc.fits</td><td>-0.02</td><td>-0.06</td><td>359.999</td><td>1.00000</td><td>0.05</td><td>0.04</td></tr>
<tr><td>ick907ouq_flc.fits</td><td>0.01</td><td>0.06</td><td>0.000</td><td>1.00000</td><td>0.05</td><td>0.05</td></tr>
<tr><td>ick908pbq_flc.fits</td><td>0.00</td><td>0.02</td><td>0.000</td><td>1.00001</td><td>0.03</td><td>0.03</td></tr>
<tr><td>ick908pkq_flc.fits</td><td>0.01</td><td>0.02</td><td>0.000</td><td>1.00001</td><td>0.04</td><td>0.04</td></tr>
<tr><td>ick908ptq_flc.fits</td><td>0.02</td><td>0.02</td><td>0.000</td><td>1.00000</td><td>0.04</td><td>0.04</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print the Number of Gaia Matches per image from the TweakReg output</span>
<span class="n">match_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*_flc_catalog_fit.match&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">match_files</span><span class="p">:</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of matches for&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s1">&#39;= &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of matches for ick905k5q_flc_catalog_fit.match =  137
Number of matches for ick905keq_flc_catalog_fit.match =  132
Number of matches for ick905knq_flc_catalog_fit.match =  119
Number of matches for ick906kwq_flc_catalog_fit.match =  143
Number of matches for ick906l5q_flc_catalog_fit.match =  136
Number of matches for ick906leq_flc_catalog_fit.match =  135
Number of matches for ick907nkq_flc_catalog_fit.match =  71
Number of matches for ick907o1q_flc_catalog_fit.match =  76
Number of matches for ick907ouq_flc_catalog_fit.match =  75
Number of matches for ick908pbq_flc_catalog_fit.match =  78
Number of matches for ick908pkq_flc_catalog_fit.match =  81
Number of matches for ick908ptq_flc_catalog_fit.match =  77
</pre></div>
</div>
</div>
</div>
<p>Compare the RMS and number of Matches from <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> with the MAST alignment results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mast_uvis_wcs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=12</i>
<table id="table140141787173008" class="table-striped table-bordered table-condensed">
<thead><tr><th>filename</th><th>DETECTOR</th><th>WCSNAME</th><th>NMATCHES</th><th>RMS_RA</th><th>RMS_DEC</th><th>RMS_RApix</th><th>RMS_DECpix</th></tr></thead>
<thead><tr><th>str18</th><th>str4</th><th>str30</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>ick905k5q_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>159</td><td>4.4</td><td>3.8</td><td>0.11</td><td>0.1</td></tr>
<tr><td>ick905keq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>159</td><td>4.4</td><td>3.8</td><td>0.11</td><td>0.1</td></tr>
<tr><td>ick905knq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>159</td><td>4.4</td><td>3.8</td><td>0.11</td><td>0.1</td></tr>
<tr><td>ick906kwq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>153</td><td>4.4</td><td>4.0</td><td>0.11</td><td>0.1</td></tr>
<tr><td>ick906l5q_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>153</td><td>4.4</td><td>4.0</td><td>0.11</td><td>0.1</td></tr>
<tr><td>ick906leq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>153</td><td>4.4</td><td>4.0</td><td>0.11</td><td>0.1</td></tr>
<tr><td>ick907nkq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>77</td><td>2.4</td><td>3.6</td><td>0.06</td><td>0.09</td></tr>
<tr><td>ick907o1q_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>77</td><td>2.4</td><td>3.6</td><td>0.06</td><td>0.09</td></tr>
<tr><td>ick907ouq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>77</td><td>2.4</td><td>3.6</td><td>0.06</td><td>0.09</td></tr>
<tr><td>ick908pbq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>101</td><td>5.2</td><td>4.2</td><td>0.13</td><td>0.11</td></tr>
<tr><td>ick908pkq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>101</td><td>5.2</td><td>4.2</td><td>0.13</td><td>0.11</td></tr>
<tr><td>ick908ptq_flc.fits</td><td>UVIS</td><td>IDC_2731450pi-FIT_REL_GAIAeDR3</td><td>101</td><td>5.2</td><td>4.2</td><td>0.13</td><td>0.11</td></tr>
</table></div></div></div>
</div>
<p>Note that there are similar numbers of stars matched during MAST processing and in our custom alignment, with no significant shift rotation or scale resiuals in the shift file.  To verify this, we inspect the quality of the fitting in the next section.</p>
</section>
<section id="inspect-the-uvis-fits-a-id-uvis-inspect-a">
<h2>8.2 Inspect the UVIS fits  <a id="uvis_inspect"></a><a class="headerlink" href="#inspect-the-uvis-fits-a-id-uvis-inspect-a" title="Permalink to this heading">#</a></h2>
<p>Here, we overplot matched sources on the FLC frame, pasting the two chips together. In this example, we show only the first exposure in Visit 05, but additional visits may be inspected by uncommenting the lines below starting with <code class="docutils literal notranslate"><span class="pre">rootname=</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rootname</span> <span class="o">=</span> <span class="s1">&#39;ick905k5q&#39;</span>     <span class="c1"># Visit 05a</span>
<span class="c1"># rootname = &#39;ick906kwq&#39;   # Visit 06a</span>
<span class="c1"># rootname = &#39;ick907nkq&#39;   # Visit 07a</span>
<span class="c1"># rootname = &#39;ick908pbq&#39;   # Visit 08a  </span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">140</span><span class="p">)</span>
<span class="n">chip1_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">rootname</span><span class="o">+</span><span class="s1">&#39;_flc.fits&#39;</span><span class="p">)[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">chip2_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">rootname</span><span class="o">+</span><span class="s1">&#39;_flc.fits&#39;</span><span class="p">)[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">fullsci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">chip2_data</span><span class="p">,</span> <span class="n">chip1_data</span><span class="p">])</span>
<span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">zscale</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">fullsci</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fullsci</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">z1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">z2</span><span class="p">)</span>

<span class="n">match_tab</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">rootname</span><span class="o">+</span><span class="s1">&#39;_flc_catalog_fit.match&#39;</span><span class="p">)</span>  <span class="c1"># load match file in astropy table</span>
<span class="n">match_tab_chip1</span> <span class="o">=</span> <span class="n">match_tab</span><span class="p">[</span><span class="n">match_tab</span><span class="p">[</span><span class="s1">&#39;col15&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>   <span class="c1"># filter table for sources on chip 1 (on ext 4)</span>
<span class="n">match_tab_chip2</span> <span class="o">=</span> <span class="n">match_tab</span><span class="p">[</span><span class="n">match_tab</span><span class="p">[</span><span class="s1">&#39;col15&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>   <span class="c1"># filter table for sources on chip 2 (on ext 1)</span>
<span class="n">x_cord1</span><span class="p">,</span> <span class="n">y_cord1</span> <span class="o">=</span> <span class="n">match_tab_chip1</span><span class="p">[</span><span class="s1">&#39;col11&#39;</span><span class="p">],</span> <span class="n">match_tab_chip1</span><span class="p">[</span><span class="s1">&#39;col12&#39;</span><span class="p">]</span>
<span class="n">x_cord2</span><span class="p">,</span> <span class="n">y_cord2</span> <span class="o">=</span> <span class="n">match_tab_chip2</span><span class="p">[</span><span class="s1">&#39;col11&#39;</span><span class="p">],</span> <span class="n">match_tab_chip2</span><span class="p">[</span><span class="s1">&#39;col12&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_cord1</span><span class="p">,</span> <span class="n">y_cord1</span><span class="o">+</span><span class="mi">2051</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Matched Sources&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_cord2</span><span class="p">,</span> <span class="n">y_cord2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rootname</span><span class="si">}</span><span class="s1"> to Gaia N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">match_tab</span><span class="p">)</span><span class="si">}</span><span class="s1"> Matches&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;ick905k5q to Gaia N = 137 Matches&#39;)
</pre></div>
</div>
<img alt="../../../_images/cdb1d8329353c8ac3294a249eb4ffa03d95a8d40f0335b6f934e8df6fe68e06b.png" src="../../../_images/cdb1d8329353c8ac3294a249eb4ffa03d95a8d40f0335b6f934e8df6fe68e06b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># inspect residual PNG </span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;residuals_</span><span class="si">{</span><span class="n">rootname</span><span class="si">}</span><span class="s1">_flc.png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/991e7aac4105cecd5a55f5d715b30207edc63a74ac7eef37de0945279c64d69c.png" src="../../../_images/991e7aac4105cecd5a55f5d715b30207edc63a74ac7eef37de0945279c64d69c.png" />
</div>
</div>
<p>Below is the <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> call to update the header WCS. However since the shift file shows that the MAST alignment is good, we will not need to run this cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># tweakreg.TweakReg(uvis_flcs,                                             </span>
<span class="c1">#                   updatehdr=True,                                  # Update the header</span>
<span class="c1">#                   refcat=refcat,                                    </span>
<span class="c1">#                   interactive=False, see2dplot=False, shiftfile=False,  </span>
<span class="c1">#                   imagefindcfg={&#39;threshold&#39;:40.,&#39;conv_width&#39;:cw,&#39;dqbits&#39;: &quot;~4096&quot;},  </span>
<span class="c1">#                   wcsname=wcsname,                                  # Give our WCS a unique name</span>
<span class="c1">#                   reusename=True,</span>
<span class="c1">#                   searchrad=0.3,</span>
<span class="c1">#                   sigma=3,</span>
<span class="c1">#                   ylimit=0.4,</span>
<span class="c1">#                   fitgeometry=&#39;rscale&#39;)                             # Fit geometry (shift, rotation, scale)</span>
<span class="c1">#  clear_output()           </span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="drizzling-the-f657n-mosaic-a-id-mosaic-657-a">
<h2>9. Drizzling the F657N mosaic <a id="mosaic_657"></a><a class="headerlink" href="#drizzling-the-f657n-mosaic-a-id-mosaic-657-a" title="Permalink to this heading">#</a></h2>
<p>Now that we have confirmed the alignment of the 12 FLC frames, these may be drizzled to a mosaic exactly half the scale (0.04”/pixel) of the original IR mosaic (0.08”/pixel). The same output WCS paramters: <code class="docutils literal notranslate"><span class="pre">final_rot</span></code>,<code class="docutils literal notranslate"><span class="pre">final_ra</span></code>, and <code class="docutils literal notranslate"><span class="pre">final_dec</span></code> values are used, but the <code class="docutils literal notranslate"><span class="pre">final_outnx</span></code> and <code class="docutils literal notranslate"><span class="pre">final_outny</span></code> are now twice the size of the IR mosaic at 8000x9000 pixels.</p>
<p>To save time for this notebook, the visit-level cosmic-ray flags for the individual UVIS tiles are assumed to be adequate, Steps 3, 4, 5, 6 are turned off, and the parameter <code class="docutils literal notranslate"><span class="pre">resetbits</span></code> is set to ‘0’ to avoid wiping out the 4096 flags in the FLC data quality arrays.</p>
<p>To improve processing speed, the sky background levels have been provided in advance and fed to <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> via the <code class="docutils literal notranslate"><span class="pre">skyfile</span></code> parameter which reads in the input text file <code class="docutils literal notranslate"><span class="pre">align_mosaics_uvis_skyfile.txt</span></code>. Users would typically set <code class="docutils literal notranslate"><span class="pre">skymethod='match'</span></code> to compute the sky background levels, and this populates the image header keyword MDRIZSKY with the sky values in the imheader header of the FLC FITS files.</p>
<p>To further improve cosmic-ray rejection in the chip gap, <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> may alternatively be run with all steps turned on as shown in the text below and with <code class="docutils literal notranslate"><span class="pre">resetbits=4096</span></code> to update the DQ flags.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">astrodrizzle</span><span class="o">.</span><span class="n">AstroDrizzle</span><span class="p">(</span><span class="n">input_uvis_images</span><span class="p">,</span>
                          <span class="n">preserve</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">build</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">output</span><span class="o">=</span><span class="s1">&#39;f657n_improved&#39;</span><span class="p">,</span>
                          <span class="n">resetbits</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span>                              <span class="c1"># Wipe out the CR flags</span>
                          <span class="n">skymethod</span><span class="o">=</span><span class="s1">&#39;match&#39;</span><span class="p">,</span>                           <span class="c1"># Sky Matching takes a lot of memory</span>
                          <span class="n">combine_type</span><span class="o">=</span><span class="s1">&#39;minmed&#39;</span><span class="p">,</span>
                          <span class="n">final_bits</span><span class="o">=</span><span class="s1">&#39;64,16&#39;</span><span class="p">,</span>
                          <span class="n">final_wcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">final_scale</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">final_rot</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span>
                          <span class="n">final_ra</span><span class="o">=</span><span class="mf">274.721587</span><span class="p">,</span><span class="n">final_dec</span><span class="o">=-</span><span class="mf">13.841549</span><span class="p">,</span>
                          <span class="n">final_outnx</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">final_outny</span><span class="o">=</span><span class="mi">9000</span><span class="p">)</span>
</pre></div>
</div>
<div class="alert alert-block alert-warning" style="color:black" >  Depending on your connection speed, this cell may take a few minutes to execute. </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_uvis_images</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*flc.fits&#39;</span><span class="p">))</span>

<span class="n">adriz</span><span class="p">(</span><span class="n">input_uvis_images</span><span class="p">,</span>
      <span class="n">preserve</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">build</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
      <span class="n">output</span><span class="o">=</span><span class="s1">&#39;f657n&#39;</span><span class="p">,</span>
      <span class="n">driz_separate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">driz_cr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>   <span class="c1"># Turn off CR rejection steps</span>
      <span class="n">resetbits</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>                                                    <span class="c1"># Do not wipe out the MAST DQ flags               </span>
      <span class="n">skyfile</span><span class="o">=</span><span class="s1">&#39;align_mosaics_uvis_skyfile.txt&#39;</span><span class="p">,</span>                       <span class="c1"># Provide user-defined sky values </span>
      <span class="n">final_bits</span><span class="o">=</span><span class="s1">&#39;64, 16&#39;</span><span class="p">,</span>
      <span class="n">final_wcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">final_scale</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">final_rot</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span>                <span class="c1"># Set the output WCS</span>
      <span class="n">final_ra</span><span class="o">=</span><span class="mf">274.721587</span><span class="p">,</span> <span class="n">final_dec</span><span class="o">=-</span><span class="mf">13.841549</span><span class="p">,</span>
      <span class="n">final_outnx</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">final_outny</span><span class="o">=</span><span class="mi">9000</span><span class="p">)</span>

<span class="n">clear_output</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="display-the-combined-drc-science-and-weight-images-a-id-uvis-drc-a">
<h2>9.1 Display the combined DRC science and weight images <a id="uvis_drc"></a><a class="headerlink" href="#display-the-combined-drc-science-and-weight-images-a-id-uvis-drc-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sci</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;f657n_drc_sci.fits&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sci</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys_r&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f754c83db50&gt;
</pre></div>
</div>
<img alt="../../../_images/4015e7e2d566d870684403375bfbb2e411513d47a54d6fa2895fb8ffdad2fc64.png" src="../../../_images/4015e7e2d566d870684403375bfbb2e411513d47a54d6fa2895fb8ffdad2fc64.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sci</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;f657n_drc_wht.fits&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sci</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys_r&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f754c75eed0&gt;
</pre></div>
</div>
<img alt="../../../_images/e19fb651c9a5243b73fe5252e4458ac3aed69d3f367e229e5ca0e019fdc4ae6a.png" src="../../../_images/e19fb651c9a5243b73fe5252e4458ac3aed69d3f367e229e5ca0e019fdc4ae6a.png" />
</div>
</div>
</section>
<section id="conclusions-a-id-conclusions-a">
<h2>10. Conclusions <a id="conclusions"></a><a class="headerlink" href="#conclusions-a-id-conclusions-a" title="Permalink to this heading">#</a></h2>
<p>This notebook provides the methodology for creating UVIS and IR mosaics of M16, as well as recommendations for key parameters. As such, it is relevant for users combining multi-visit observations from any HST imaging program, whether mosaics or single pointings.</p>
<p>For more detail on aligning to an absolute reference catalog such as GAIA, see the notebook ‘aligning_to_catalogs.ipynb’.</p>
<p>Thank you for walking through this notebook. You should be more familiar with:</p>
<ul class="simple">
<li><p>Downloading data with astroquery.</p></li>
<li><p>Examining the active WCS.</p></li>
<li><p>Creating a reference catalog and aligning a dataset to it.</p></li>
<li><p>Checking tweakreg results.</p></li>
<li><p>Drizzling two detectors to the same output</p></li>
</ul>
<p><strong>Congratulations, you have completed the notebook.</strong></p>
</section>
<section id="additional-resources-a-id-add-a">
<h2>Additional Resources <a id="add"></a><a class="headerlink" href="#additional-resources-a-id-add-a" title="Permalink to this heading">#</a></h2>
<p>Try to weave resource links into the main content of your tutorial so that they are falling in line with the context of your writing. For resources that do not fit cleanly into your narrative, you may include an additional resources section at the end of your tutorial. Usually a list of links using markdown bullet list plus link format is appropriate.</p>
<p>Below are some additional resources that may be helpful. Please send any questions through the <a class="reference external" href="https://stsci.service-now.com/hst">HST Help Desk</a>.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.stsci.edu/hst/instrumentation/wfc3">WFC3 Website</a></p></li>
<li><p><a class="reference external" href="https://www.stsci.edu/hst/instrumentation/wfc3/performance/cte">WFC3/UVIS CTE Website</a></p></li>
<li><p><a class="reference external" href="https://hst-docs.stsci.edu/wfc3ihb">WFC3 Instrument Handbook</a></p></li>
<li><p><a class="reference external" href="https://hst-docs.stsci.edu/wfc3dhb">WFC3 Data Handbook</a></p>
<ul>
<li><p>See Section 3.4.1 for documentation on <code class="docutils literal notranslate"><span class="pre">wf3cte</span></code>, WFC3’s CTE correction pipeline</p></li>
<li><p>See Section 6 for documentation on WFC3/UVIS CTE</p></li>
</ul>
</li>
</ul>
</section>
<section id="about-this-notebook-a-id-about-a">
<h2>About this Notebook <a id="about"></a><a class="headerlink" href="#about-this-notebook-a-id-about-a" title="Permalink to this heading">#</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Created: 14 Dec 2018;     J. Mack
Updated: 02 Aug 2024;     J. Mack &amp; B. Kuhn
</pre></div>
</div>
<p><strong>Source:</strong> GitHub <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks">spacetelescope/hst_notebooks</a></p>
</section>
<section id="citations-a-id-cite-a">
<h2>Citations <a id="cite"></a><a class="headerlink" href="#citations-a-id-cite-a" title="Permalink to this heading">#</a></h2>
<p>Provide your reader with guidelines on how to cite open source software and other resources in their own published work.</p>
<p>If you use Python packages such as <code class="docutils literal notranslate"><span class="pre">astropy</span></code>, <code class="docutils literal notranslate"><span class="pre">astroquery</span></code>, <code class="docutils literal notranslate"><span class="pre">drizzlepac</span></code>, <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>, or <code class="docutils literal notranslate"><span class="pre">numpy</span></code> for published research, please cite the
authors. Follow these links for more information about citing various packages.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.astropy.org/acknowledging.html">Citing <code class="docutils literal notranslate"><span class="pre">astropy</span></code></a></p></li>
<li><p><a class="reference external" href="https://github.com/astropy/astroquery/blob/main/astroquery/CITATION">Citing <code class="docutils literal notranslate"><span class="pre">astroquery</span></code></a></p></li>
<li><p><a class="reference external" href="https://zenodo.org/records/3743274">Citing <code class="docutils literal notranslate"><span class="pre">drizzlepac</span></code></a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/stable/users/project/citing.html">Citing <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.scipy.org/citing.html#numpy">Citing <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></p></li>
</ul>
<hr class="docutils" />
<p><span class="xref myst">Top of Page</span>
<a class="reference internal" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/hst_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/DrizzlePac/align_mosaics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../optimize_image_sampling/optimize_image_sampling.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Optimizing the Image Sampling</p>
      </div>
    </a>
    <a class="right-next"
       href="../sky_matching/sky_matching.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Sky Matching for HST Mosaics <a id="top"></a></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-id-intro-a">Introduction <a id="intro"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observations-a-id-obs-a">Observations <a id="obs"></a></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-a-id-import-a">1. Imports <a id="import"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mast-download-a-id-mast-a">2. MAST Download <a id="MAST"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wfc3-ir">2.1 WFC3/IR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wfc3-uvis">WFC3/UVIS</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-image-header-data-a-id-check-keywords-a">3. Check image header data <a id="check_keywords"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ir-detector-a-id-ir-dither-a">3.1 IR detector <a id="ir_dither"></a></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#uvis-detector-a-id-uvis-dither-a">3.2 UVIS detector <a id="uvis_dither"></a></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-the-wcs-solution-a-id-wcs-a">4. Inspect the WCS Solution  <a id="wcs"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-gaia-catalog-a-id-gaia-cat-a">5. Create Gaia Catalog <a id="gaia_cat"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tweakreg-for-mosaics-a-id-tweakreg-a">6. TweakReg for Mosaics <a id="tweakreg"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ir-alignment-a-id-ir-align-a">6.1 IR Alignment <a id="ir_align"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-the-shift-file-to-verify-the-pointing-residuals-a-id-ir-shift-a">6.2 Inspect the shift file to verify the pointing residuals <a id="ir_shift"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-the-ir-fits-a-id-inspect-ir-a">6.3 Inspect the IR fits <a id="inspect_ir"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mosaicking-features-in-astrodrizzle-a-id-mosaic-feat-a">7. Mosaicking Features in AstroDrizzle <a id="mosaic_feat"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drizzle-the-ir-f160w-mosaic-a-id-ir-driz-a">7.1 Drizzle the IR/F160W Mosaic <a id="ir_driz"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#display-the-combined-drz-science-and-weight-images-a-id-ir-drz-a">7.2 Display the combined DRZ science and weight images <a id="ir_drz"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#align-the-uvis-flc-frames-to-the-ir-mosaic-a-id-uvis-align-a">8. Align the UVIS FLC frames to the IR mosaic <a id="uvis_align"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-the-shift-file-to-verify-the-pointing-residuals-a-id-inspect-resid-a">8.1 Inspect the shift file to verify the pointing residuals <a id="inspect_resid"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-the-uvis-fits-a-id-uvis-inspect-a">8.2 Inspect the UVIS fits  <a id="uvis_inspect"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drizzling-the-f657n-mosaic-a-id-mosaic-657-a">9. Drizzling the F657N mosaic <a id="mosaic_657"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#display-the-combined-drc-science-and-weight-images-a-id-uvis-drc-a">9.1 Display the combined DRC science and weight images <a id="uvis_drc"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions-a-id-conclusions-a">10. Conclusions <a id="conclusions"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources-a-id-add-a">Additional Resources <a id="add"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook-a-id-about-a">About this Notebook <a id="about"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations-a-id-cite-a">Citations <a id="cite"></a></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>