

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Analyzing WFC3/UVIS G280 Exoplanet Transit Observations &#8212; HST Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/WFC3/uvis_g280_transit/G280_Exoplanet_Transits';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="WFC3/IR Time Variable Background (TVB)" href="../ir_tvb.html" />
    <link rel="prev" title="Masking Persistence in WFC3/IR Images" href="../persistence/wfc3_ir_persistence.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="HST Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="HST Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    STScI HST Notebook Repository HQ
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">ACS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../ACS/README.html">ACS Notebooks</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_findsat_mrt/acs_findsat_mrt_example.html">Satellite trail detection in ACS/WFC data using acstools.findsat_mrt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_saturation_trails/acs_saturation_trails.html">ACS Linearity with Saturated Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_cte_forward_model/acs_cte_forward_model_example.html">Pixel-based ACS/WFC CTE Forward Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_subarrays/acs_subarrays.html">ACS Image Reduction for Subarray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_sbc_dark_analysis/acs_sbc_dark_analysis.html">SBC Dark Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_reduction/acs_reduction.html">ACS/WFC Image Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_pixel_area_maps/acs_pixel_area_maps.html">Obtaining Pixel Area Maps for ACS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_polarization_tools/acs_polarization_tools.html">Using ACS Polarization Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_focus_diverse_epsfs/acs_focus_diverse_epsfs.html">Focus Diverse ePSFs for ACS/WFC</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_exception_report/exception_report_checks.html">HST Exception Report - Investigate your ACS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/hst_orbits_ephem/hst_orbits_ephem.html">Getting HST Ephemeris and Related Data for an Observation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">COS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../COS/README.html">COS Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COS/Setup/Setup.html">Setting up your computer environment for working with COS data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/DataDl/DataDl.html">Downloading COS Data</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../COS/ViewData/ViewData.html">Viewing COS Data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/AsnFile/AsnFile.html">Modifying or Creating an Association File</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/CalCOS/CalCOS.html">Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)</a></li>






<li class="toctree-l1"><a class="reference internal" href="../../COS/SplitTag/SplitTag.html">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></a></li>







<li class="toctree-l1"><a class="reference internal" href="../../COS/DayNight/DayNight.html">Filtering out COS Data taken during the Day or Night</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COS/LSF/LSF.html">Working with the COS Line Spread Function (LSF)</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../COS/Extract/Extract.html">Editing the extraction boxes in a spectral extraction file (<code class="docutils literal notranslate"><span class="pre">XTRACTAB</span></code>)</a></li>







<li class="toctree-l1"><a class="reference internal" href="../../COS/ExceptionReport/ExceptionReport.html">What to do when you get an Exception Report for COS</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">DrizzlePac</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/README.html">DrizzlePac Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/using_updated_astrometry_solutions/using_updated_astrometry_solutions.html">Improving Astrometry Using Alternate WCS Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_to_catalogs/align_to_catalogs.html">Aligning HST images to an Absolute Reference Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_sparse_fields/align_sparse_fields.html">Aligning Deep Exposures of Sparse Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_multiple_visits/align_multiple_visits.html">Optimizing Image Alignment for Multiple HST Visits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/use_ds9_regions_in_tweakreg/use_ds9_regions_in_tweakreg.html">TWEAKREG Tips - Using DS9 Regions for Source Inclusion/Exclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/optimize_image_sampling/optimize_image_sampling.html">Optimizing the Image Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_mosaics/align_mosaics.html">Aligning HST Mosaics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/sky_matching/sky_matching.html">Sky Matching for HST Mosaics <a id="top"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/mask_satellite/mask_satellite.html">Satellite Trail Masking Techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/drizzle_wfpc2/drizzle_wfpc2.html">Drizzling new WFPC2 FLT data products with chip-normalization   </a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HASP</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../HASP/Setup/Setup.html">Installing the Hubble Advanced Spectral Products Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../HASP/CoaddTutorial/CoaddTutorial.html">Inputting User Data using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/FluxScaleTutorial/FluxScaleTutorial.html">Scaling Flux while using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/DataDiagnostic/DataDiagnostics.html">HASP Data Diagnostic Notebook</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../HASP/WavelengthAdjustment/WavelengthAdjustment.html">Wavelength Adjustments for Running the Hubble Advanced Spectral Products (HASP) Script</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NICMOS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html">Programmatic Replacements for NICMOS Units Conversion Form</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">STIS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../STIS/README.html">STIS-Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/cross-correlation/cross-correlation.html">Correcting for Missing Wavecals with Cross-Correlation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/custom_ccd_darks/custom_ccd_darks.html">Custom CCD Darks <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/drizpac_notebook/STIS_DrizzlePac_Tutorial.html">STIS DrizzlePac Tutorial <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/CoronagraphyViz/STIS_Coronagraphy_Visualization_v2.html">STIS Coronagraphy Visualization Tool (v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/calstis/calstis_2d_ccd.html">Calstis 2-D CCD Data Reduction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/target_acquisition/target_acquisition.html">Evaluating STIS Target Acquisitions <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/view_data/view_data.html">Viewing STIS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/extraction/1D_Extraction.html">1D Spectra Extraction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/low_count_uncertainties/Low_Count_Uncertainties.html">Low Count Uncertainties in STIS <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/contrast_sensitivity/STIS_Coronagraphic_Observation_Feasibility.html">STIS Coronagraphic Observation Feasibility</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">WFC3</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../README.html">WFC3 Notebooks</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../general_tools.html">General Tools</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../image_displayer_analyzer/wfc3_image_displayer_analyzer.html">WFC3 Image Displayer &amp; Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exception_report/wfc3_exception_report.html">Exception Report Checklist - WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calwf3_v1.0_cte/calwf3_with_v1.0_PCTE.html">Processing WFC3/UVIS Data with <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> Using the v1.0 CTE-Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../persistence/wfc3_ir_persistence.html">Masking Persistence in WFC3/IR Images</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Analyzing WFC3/UVIS G280 Exoplanet Transit Observations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ir_tvb.html">WFC3/IR Time Variable Background (TVB)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../ir_ima_visualization/IR_IMA_Visualization_with_an_Example_of_Time_Variable_Background.html">WFC3/IR IMA Visualization Tools with An Example of Time Variable Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calwf3_recalibration/calwf3_recal_tvb.html">Manual Recalibration with calwf3: Turning off the IR Linear Ramp Fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tvb_flattenramp/TVB_flattenramp_notebook.html">Correcting for Helium Line Emission Background in IR Exposures using the “Flatten-Ramp” Technique</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ir_scattered_light_calwf3_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_Using_calwf3_to_Mask_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Using <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> to Mask Bad Reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ir_scattered_light_manual_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_by_Manually_Subtracting_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Manually Subtracting Bad Reads</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../photometry.html">Photometry</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../filter_transformations/filter_transformations.html">WFC3/UVIS Filter Transformations with stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flux_conversion_tool/flux_conversion_tool.html">Flux Unit Conversions with synphot and stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../photometry_examples/phot_examples.html">Synthetic Photometry Examples for WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uvis_time_dependent_photometry/uvis_timedep_phot.html">WFC3/UVIS Time-dependent Photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zeropoints/zeropoints.html">Calculating WFC3 Zeropoints with STSynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uvis_pam_corrections/WFC3_UVIS_Pixel_Area_Map_Corrections_for_Subarrays.html">WFC3/UVIS Pixel Area Map Corrections for Subarrays</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../point_spread_function.html">Point Spread Function (PSF)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../point_spread_function/hst_point_spread_function.html">HST WFC3 Point Spread Function Modeling   </a></li>
<li class="toctree-l2"><a class="reference internal" href="../mast_api_psf/download_psf_cutouts.html">Downloading WFC3 and WFPC2 PSF Cutouts from MAST</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/spacetelescope/hst_notebooks/blob/main/notebooks/WFC3/uvis_g280_transit/G280_Exoplanet_Transits.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/WFC3/uvis_g280_transit/G280_Exoplanet_Transits.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/WFC3/uvis_g280_transit/G280_Exoplanet_Transits.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Analyzing WFC3/UVIS G280 Exoplanet Transit Observations</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">1. Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-grism-observations-from-mast">2. Downloading Grism Observations from MAST</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#direct-image">2.1 Direct Image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-g280-spectrum">2.2 Example G280 Spectrum</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examining-the-time-series">2.3 Examining the Time-Series</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background-subtraction">3. Background Subtraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cosmic-ray-correction">4. Cosmic Ray Correction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#embedding-subarrays">5. Embedding Subarrays</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spectral-trace-fitting">6. Spectral Trace Fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#g280-spectral-extraction">7. G280 Spectral Extraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-1d-time-series-stellar-spectra">8. Extracting 1D Time-Series Stellar Spectra</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-light-curves">9. Generating Light Curves</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">10. Conclusions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources">Additional Resources</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><a id="top"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="analyzing-wfc3-uvis-g280-exoplanet-transit-observations">
<h1>Analyzing WFC3/UVIS G280 Exoplanet Transit Observations<a class="headerlink" href="#analyzing-wfc3-uvis-g280-exoplanet-transit-observations" title="Permalink to this heading">#</a></h1>
<hr class="docutils" />
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Permalink to this heading">#</a></h2>
<p>This notebook demonstrates reduction and analysis of exoplanet transit observations of the
hot Jupiter HAT-P-41b taken with the WFC3/UVIS G280 grism. By the end of this tutorial, you will be able to do the following for G280 time-series transit observations:</p>
<ul class="simple">
<li><p>Perform a background subtraction.</p></li>
<li><p>Remove cosmic rays spatially and temporally.</p></li>
<li><p>Perform trace fitting to extract the 1D time-series of stellar spectra.</p></li>
<li><p>Produce light curves for transit fitting.</p></li>
</ul>
</section>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">#</a></h2>
<p><span class="xref myst">Introduction</span> <br>
<span class="xref myst">1. Imports</span> <br>
<span class="xref myst">2. Downloading Grism Observations from MAST</span> <br></p>
<ul class="simple">
<li><p><span class="xref myst">2.1 Direct Image</span> <br></p></li>
<li><p><span class="xref myst">2.2 Example G280 Spectrum</span> <br></p></li>
<li><p><span class="xref myst">2.3 Examining the Time-Series</span> <br></p></li>
</ul>
<p><span class="xref myst">3. Background Subtraction</span> <br>
<span class="xref myst">4. Cosmic Ray Correction</span> <br>
<span class="xref myst">5. Embedding Subarrays</span> <br>
<span class="xref myst">6. Spectral Trace Fitting</span> <br>
<span class="xref myst">7. G280 Spectral Extraction</span> <br>
<span class="xref myst">8. Extracting 1D Time-Series Stellar Spectra</span> <br>
<span class="xref myst">9. Generating Transit Light Curves</span> <br>
<span class="xref myst">10. Conclusions</span> <br></p>
<p><span class="xref myst">Additional Resources</span> <br>
<span class="xref myst">About this Notebook</span> <br>
<span class="xref myst">Citations</span> <br></p>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p><a id="intro"></a></p>
<p>Time-series observations of transiting exoplanets can allow us to measure their atmospheric compositions. Hubble has paved the way for such observations, where STIS (G430L, G750L) and WFC3 (G102, G141) served as the workhorse instruments for transit spectroscopy over the past two decades. Recently, however, WFC3’s G280 grism  has become popular among the exoplanet community thanks to recent studies demonstrating its usefulness for transit observations (e.g., <a class="reference external" href="https://arxiv.org/abs/2003.00536">Wakeford et al. 2020</a>, <a class="reference external" href="https://arxiv.org/abs/2204.03639">Lothringer et al. 2022</a>, <a class="reference external" href="https://arxiv.org/abs/2410.17368">Boehm et al. 2024</a>). In particular, G280’s blue-optical wavelength range (0.2-0.8 <span class="math notranslate nohighlight">\(\mu\)</span>m) can yield critical information about the cloud and haze properties in exoplanets’ atmospheres.</p>
</section>
<section id="imports">
<h2>1. Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<p><a id="import"></a></p>
<p>This notebook assumes you have installed the required libraries as described <a class="reference external" href="https://github.com/spacetelescope/hst_notebooks/blob/main/notebooks/WFC3/uvis_g280_transit/requirements.txt">here</a>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">glob</span></code> for finding directories &amp; files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">os</span></code> for operating system operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shutil</span></code> for file operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tqdm</span></code> for loading bars</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code> for handling array functions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> for plotting data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.io</span> <span class="pre">fits</span></code> for accessing FITS files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.stats</span> <span class="pre">sigma_clipped_stats</span></code> for outlier removal</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astroquery.mast</span> <span class="pre">Observations</span></code> for downloading data from MAST</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">photutils.detection</span> <span class="pre">DAOStarFinder</span></code> for source detection in an image</p></li>
</ul>
<p>We also import a custom module <code class="docutils literal notranslate"><span class="pre">g280_transit_tools.py</span></code> for G280-specific reduction &amp; analysis tools.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tqdm</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.cm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">sigma_clipped_stats</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.mast</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">photutils.detection</span><span class="w"> </span><span class="kn">import</span> <span class="n">DAOStarFinder</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">g280_transit_tools</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.11/x64/lib/python3.11/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div>
</div>
</div>
</div>
</section>
<section id="downloading-grism-observations-from-mast">
<h2>2. Downloading Grism Observations from MAST<a class="headerlink" href="#downloading-grism-observations-from-mast" title="Permalink to this heading">#</a></h2>
<p><a id="data_download"></a></p>
<p>First, we query the observations necessary to complete the tutorial from the <a class="reference external" href="https://archive.stsci.edu/">Mikulski Archive for Space Telescopes (MAST)</a>. Using the G280 grism, <a class="reference external" href="https://www.stsci.edu/hst-program-info/program/?program=15288">GO 15288</a> observed transits of the giant exoplanet HAT-P-41b, which was the first exoplanet planet transit data set ever taken with G280. The results of this analysis are published in Wakeford et al. (2020). To query only the first visit of the proposal and reject bias frames, we use a wildcard for <code class="docutils literal notranslate"><span class="pre">obs_id</span></code> and specify <code class="docutils literal notranslate"><span class="pre">target_name</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transit_obs</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">obs_id</span><span class="o">=</span><span class="s1">&#39;idps01*&#39;</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s1">&#39;HAT-P-41B&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we retrieve a filtered product list of our observations. For our analysis, we use the <code class="docutils literal notranslate"><span class="pre">_flt.fits</span></code> (i.e. calibrated, flat-fielded exposure) files produced using the <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> pipeline.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transit_prods</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">transit_obs</span><span class="p">)</span>
<span class="n">transit_prods_filtered</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">transit_prods</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we download the <code class="docutils literal notranslate"><span class="pre">_flt.fits</span></code> files from MAST.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">transit_prods_filtered</span><span class="p">,</span> <span class="n">mrp_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01oqq_flt.fits to ./mastDownload/HST/idps01oqq/idps01oqq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01orq_flt.fits to ./mastDownload/HST/idps01orq/idps01orq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01osq_flt.fits to ./mastDownload/HST/idps01osq/idps01osq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01otq_flt.fits to ./mastDownload/HST/idps01otq/idps01otq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01ouq_flt.fits to ./mastDownload/HST/idps01ouq/idps01ouq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01ovq_flt.fits to ./mastDownload/HST/idps01ovq/idps01ovq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01oxq_flt.fits to ./mastDownload/HST/idps01oxq/idps01oxq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01oyq_flt.fits to ./mastDownload/HST/idps01oyq/idps01oyq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01ozq_flt.fits to ./mastDownload/HST/idps01ozq/idps01ozq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01p0q_flt.fits to ./mastDownload/HST/idps01p0q/idps01p0q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01p1q_flt.fits to ./mastDownload/HST/idps01p1q/idps01p1q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01p6q_flt.fits to ./mastDownload/HST/idps01p6q/idps01p6q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01p7q_flt.fits to ./mastDownload/HST/idps01p7q/idps01p7q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01p8q_flt.fits to ./mastDownload/HST/idps01p8q/idps01p8q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01p9q_flt.fits to ./mastDownload/HST/idps01p9q/idps01p9q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01paq_flt.fits to ./mastDownload/HST/idps01paq/idps01paq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01pcq_flt.fits to ./mastDownload/HST/idps01pcq/idps01pcq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01pdq_flt.fits to ./mastDownload/HST/idps01pdq/idps01pdq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01peq_flt.fits to ./mastDownload/HST/idps01peq/idps01peq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01pfq_flt.fits to ./mastDownload/HST/idps01pfq/idps01pfq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01pgq_flt.fits to ./mastDownload/HST/idps01pgq/idps01pgq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01piq_flt.fits to ./mastDownload/HST/idps01piq/idps01piq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01plq_flt.fits to ./mastDownload/HST/idps01plq/idps01plq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01pmq_flt.fits to ./mastDownload/HST/idps01pmq/idps01pmq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01pnq_flt.fits to ./mastDownload/HST/idps01pnq/idps01pnq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01poq_flt.fits to ./mastDownload/HST/idps01poq/idps01poq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01pqq_flt.fits to ./mastDownload/HST/idps01pqq/idps01pqq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01prq_flt.fits to ./mastDownload/HST/idps01prq/idps01prq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01psq_flt.fits to ./mastDownload/HST/idps01psq/idps01psq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01ptq_flt.fits to ./mastDownload/HST/idps01ptq/idps01ptq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01puq_flt.fits to ./mastDownload/HST/idps01puq/idps01puq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01pwq_flt.fits to ./mastDownload/HST/idps01pwq/idps01pwq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01pxq_flt.fits to ./mastDownload/HST/idps01pxq/idps01pxq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01q1q_flt.fits to ./mastDownload/HST/idps01q1q/idps01q1q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01q2q_flt.fits to ./mastDownload/HST/idps01q2q/idps01q2q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01q3q_flt.fits to ./mastDownload/HST/idps01q3q/idps01q3q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01q5q_flt.fits to ./mastDownload/HST/idps01q5q/idps01q5q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01q6q_flt.fits to ./mastDownload/HST/idps01q6q/idps01q6q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01q7q_flt.fits to ./mastDownload/HST/idps01q7q/idps01q7q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01q8q_flt.fits to ./mastDownload/HST/idps01q8q/idps01q8q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01q9q_flt.fits to ./mastDownload/HST/idps01q9q/idps01q9q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qbq_flt.fits to ./mastDownload/HST/idps01qbq/idps01qbq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qcq_flt.fits to ./mastDownload/HST/idps01qcq/idps01qcq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qdq_flt.fits to ./mastDownload/HST/idps01qdq/idps01qdq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qlq_flt.fits to ./mastDownload/HST/idps01qlq/idps01qlq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qmq_flt.fits to ./mastDownload/HST/idps01qmq/idps01qmq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qnq_flt.fits to ./mastDownload/HST/idps01qnq/idps01qnq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qoq_flt.fits to ./mastDownload/HST/idps01qoq/idps01qoq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qpq_flt.fits to ./mastDownload/HST/idps01qpq/idps01qpq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qqq_flt.fits to ./mastDownload/HST/idps01qqq/idps01qqq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qrq_flt.fits to ./mastDownload/HST/idps01qrq/idps01qrq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qsq_flt.fits to ./mastDownload/HST/idps01qsq/idps01qsq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qtq_flt.fits to ./mastDownload/HST/idps01qtq/idps01qtq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01quq_flt.fits to ./mastDownload/HST/idps01quq/idps01quq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/idps01qvq_flt.fits to ./mastDownload/HST/idps01qvq/idps01qvq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output text_html"><div><i>Table length=55</i>
<table id="table140283291685904" class="table-striped table-bordered table-condensed">
<thead><tr><th>Local Path</th><th>Status</th><th>Message</th><th>URL</th></tr></thead>
<thead><tr><th>str47</th><th>str8</th><th>object</th><th>object</th></tr></thead>
<tr><td>./mastDownload/HST/idps01oqq/idps01oqq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01orq/idps01orq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01osq/idps01osq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01otq/idps01otq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01ouq/idps01ouq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01ovq/idps01ovq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01oxq/idps01oxq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01oyq/idps01oyq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01ozq/idps01ozq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>./mastDownload/HST/idps01qmq/idps01qmq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01qnq/idps01qnq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01qoq/idps01qoq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01qpq/idps01qpq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01qqq/idps01qqq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01qrq/idps01qrq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01qsq/idps01qsq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01qtq/idps01qtq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01quq/idps01quq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/idps01qvq/idps01qvq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
</table></div></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">_flt.fits</span></code> files for HAT-P-41b are now in our current working directory under <code class="docutils literal notranslate"><span class="pre">mastDownload</span></code>. We organize this data into separate directories for the <code class="docutils literal notranslate"><span class="pre">_flt.fits</span></code> and remove the <code class="docutils literal notranslate"><span class="pre">mastDownload</span></code> directory.</p>
<p>We define all the subdirectories for MAST, data, direct image, and <code class="docutils literal notranslate"><span class="pre">_flt.fits</span></code> (calibrated, clean, and full frame).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s1">&#39;mastDownload/HST&#39;</span><span class="p">)</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">image_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s1">&#39;direct_image&#39;</span><span class="p">)</span>
<span class="n">flt_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;flt&#39;</span><span class="p">)</span>
<span class="n">flt_clean_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;flt_clean&#39;</span><span class="p">)</span>
<span class="n">flt_full_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;flt_full&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We create each subdirectory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">sub_dir</span> <span class="ow">in</span> <span class="p">[</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">image_dir</span><span class="p">,</span> <span class="n">flt_dir</span><span class="p">,</span> <span class="n">flt_clean_dir</span><span class="p">,</span> <span class="n">flt_full_dir</span><span class="p">]:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">sub_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We move the files to the appropriate subdirectories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve paths in MAST</span>
<span class="n">paths_old</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">download_dir</span><span class="si">}</span><span class="s1">/*/*&#39;</span><span class="p">))</span>

<span class="c1"># Loop through paths</span>
<span class="k">for</span> <span class="n">path_old</span> <span class="ow">in</span> <span class="n">paths_old</span><span class="p">:</span>
    <span class="n">basename_old</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path_old</span><span class="p">)</span>
    <span class="c1"># Put direct image in appropriate subdirectory</span>
    <span class="k">if</span> <span class="s1">&#39;idps01oqq&#39;</span> <span class="ow">in</span> <span class="n">basename_old</span><span class="p">:</span>
        <span class="n">sub_dir</span> <span class="o">=</span> <span class="n">image_dir</span>
    <span class="c1"># Put grism images in appropriate subdirectory</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sub_dir</span> <span class="o">=</span> <span class="n">flt_dir</span>
    <span class="n">path_new</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">sub_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">basename_old</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">path_old</span><span class="p">,</span> <span class="n">path_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We delete the MAST subdirectory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;mastDownload/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have downloaded and organized the relevant files for our time-series analysis, we can analyze them.</p>
<section id="direct-image">
<h3>2.1 Direct Image<a class="headerlink" href="#direct-image" title="Permalink to this heading">#</a></h3>
<p><a id="direct_image"></a></p>
<p>We retrieve the direct image data of the target, which was taken with the F300X filter. It is common practice for time-series transit observations to take a direct image of the target before taking spectroscopic data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_direct_image</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">image_dir</span><span class="si">}</span><span class="s1">/idps01oqq_flt.fits&#39;</span>
<span class="n">file_direct_image</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path_direct_image</span><span class="p">)</span>
<span class="n">direct_image</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">path_direct_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we plot the direct image using 1 and 99 percentile min and max values, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">direct_image</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_direct_image</span><span class="si">}</span><span class="s1"> (Direct Image)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">direct_image</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f963f86dc10&gt;
</pre></div>
</div>
<img alt="../../../_images/56ee1f1fdb5db449ca6c220d59fd39e8542fa945172df8e29ef68751611bc288.png" src="../../../_images/56ee1f1fdb5db449ca6c220d59fd39e8542fa945172df8e29ef68751611bc288.png" />
</div>
</div>
<p>By eye, we can see that our target is the bright source in the center of this image, but let’s find its location more precisely. First, we find the 3-sigma clipped mean, median, and standard deviation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">sigma_clipped_stats</span><span class="p">(</span><span class="n">direct_image</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we set our <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/1987PASP...99..191S/abstract">DAOStarFinder algorithm</a> to a full width half maximum of 5 and a threshold 1075 times the standard deviation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">find_source</span> <span class="o">=</span> <span class="n">DAOStarFinder</span><span class="p">(</span><span class="n">fwhm</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">1075</span><span class="o">*</span><span class="n">std</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we find our sources from the global background (i.e. median) subtracted image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sources</span> <span class="o">=</span> <span class="n">find_source</span><span class="p">(</span><span class="n">direct_image</span> <span class="o">-</span> <span class="n">median</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we format our columns and return the found sources.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">sources</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
    <span class="n">sources</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.8g</span><span class="s1">&#39;</span>   
<span class="n">sources</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>QTable length=1</i>
<table id="table140283288519248" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>xcentroid</th><th>ycentroid</th><th>sharpness</th><th>roundness1</th><th>roundness2</th><th>npix</th><th>peak</th><th>flux</th><th>mag</th><th>daofind_mag</th></tr></thead>
<thead><tr><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float32</th><th>float64</th><th>int64</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th></tr></thead>
<tr><td>1</td><td>1069.8841</td><td>437.85493</td><td>0.97561314</td><td>-0.10247992</td><td>0.060946854</td><td>49</td><td>8806.0215</td><td>58814.789</td><td>-11.923716</td><td>-0.71761847</td></tr>
</table></div></div></div>
</div>
<p>Our target HAT-P-41b is located around (x,y) = (1070, 438). However, this is in the subarray frame. Therefore, we convert our source coordinates from the subarray frame to the full frame, which is needed later in the analysis. To do this, we use the <code class="docutils literal notranslate"><span class="pre">LTV</span></code> keywords from the <code class="docutils literal notranslate"><span class="pre">SCI</span></code> extension.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract subarray offsets</span>
<span class="n">x_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">path_direct_image</span><span class="p">,</span> <span class="s1">&#39;ltv1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">y_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">path_direct_image</span><span class="p">,</span> <span class="s1">&#39;ltv2&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Extract source coordinates from direct image</span>
<span class="n">source_x_direct</span> <span class="o">=</span> <span class="n">sources</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">source_y_direct</span> <span class="o">=</span> <span class="n">sources</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Convert coordinates from subarray to full frame</span>
<span class="n">source_x</span> <span class="o">=</span> <span class="n">source_x_direct</span> <span class="o">+</span> <span class="n">x_offset</span>
<span class="n">source_y</span> <span class="o">=</span> <span class="n">source_y_direct</span> <span class="o">+</span> <span class="n">y_offset</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Source Location: (x, y) = </span><span class="si">{</span><span class="n">source_x</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">source_y</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Source Location: (x, y) = 2040.8841, 1063.8549
</pre></div>
</div>
</div>
</div>
<p>Our source location of HAT-P-41b is within a few hundreths of a pixel to Section 3.1 of <a class="reference external" href="https://arxiv.org/pdf/2003.00536">Wakeford et al. (2020)</a> (2040.8756, 1063.8825).</p>
</section>
<section id="example-g280-spectrum">
<h3>2.2 Example G280 Spectrum<a class="headerlink" href="#example-g280-spectrum" title="Permalink to this heading">#</a></h3>
<p><a id="spectrum"></a>
We retrieve the data from one of the spectra in the time-series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve all paths</span>
<span class="n">paths_flt</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">flt_dir</span><span class="si">}</span><span class="s1">/*&#39;</span><span class="p">))</span>

<span class="c1"># Retrieve data from first path</span>
<span class="n">path_grism_image</span> <span class="o">=</span> <span class="n">paths_flt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">file_grism_image</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path_grism_image</span><span class="p">)</span>
<span class="n">grism_image</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">path_grism_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we plot a grism image using 1 and 99 percentile min and max values, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">grism_image</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_grism_image</span><span class="si">}</span><span class="s1"> (Grism Image)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grism_image</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f963d534b90&gt;
</pre></div>
</div>
<img alt="../../../_images/6f0f6957f5a3a5665d2db12a92dc994a38dc480b48e62002f6a0226315ac2d7c.png" src="../../../_images/6f0f6957f5a3a5665d2db12a92dc994a38dc480b48e62002f6a0226315ac2d7c.png" />
</div>
</div>
<p>G280 spectra have curved spectral traces and multiple overlapping spectral orders. The zeroth order is shown in the center of the image, and is saturated with large diffraction spikes. The spectral traces to the left of the zeroth order are the positive orders, and the traces to the right of the zeroth order are the negative orders. The brightest orders that we can see here are the +1 and -1 orders.</p>
</section>
<section id="examining-the-time-series">
<h3>2.3 Examining the Time-Series<a class="headerlink" href="#examining-the-time-series" title="Permalink to this heading">#</a></h3>
<p><a id="time_series"></a></p>
<p>We extract the data from each spectrum, and print the shape.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_series_grism</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths_flt</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">n_spectra</span><span class="p">,</span> <span class="n">y_length</span><span class="p">,</span> <span class="n">x_length</span> <span class="o">=</span> <span class="n">time_series_grism</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Spectra time-series shape </span><span class="si">{</span><span class="n">time_series_grism</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spectra time-series shape (54, 800, 2100)
</pre></div>
</div>
</div>
</div>
<p>Next, we plot a standard deviation stack of the grism images to better understand outliers in the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standard deviation stack grisms</span>
<span class="n">grism_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">time_series_grism</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">vmin_std</span><span class="p">,</span> <span class="n">vmax_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">grism_std</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;WFC3/UVIS G280 HAT-P-41b Standard Deviation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grism_std</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin_std</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_std</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f963d5ca4d0&gt;
</pre></div>
</div>
<img alt="../../../_images/68a296044989a8f2619350f0d03867a9deaf24045d8652220e8f792aa2e1aedf.png" src="../../../_images/68a296044989a8f2619350f0d03867a9deaf24045d8652220e8f792aa2e1aedf.png" />
</div>
</div>
<p>Several hot/bad pixels are present in these images as seen above. The first step in the data reduction process is to clean each exposure in the time-series data and remove these bad pixels, which can affect the precision of our extracted stellar spectra and transit light curves.</p>
</section>
</section>
<section id="background-subtraction">
<h2>3. Background Subtraction<a class="headerlink" href="#background-subtraction" title="Permalink to this heading">#</a></h2>
<p><a id="bkgd_sub"></a></p>
<p>First, we perform a background subtraction for all of the spectra in the time-series. There are a few ways to do this, but here we will use the publicly available <a class="reference external" href="https://www.stsci.edu/hst/instrumentation/wfc3/documentation/grism-resources/uvis-grism-sky-images">G280 sky frames</a>, which should be downloaded before execution. These sky frames were generated by stacking all public on-orbit science exposures on MAST (as of July 2023) and aggressively masking sources using a modified segmentation map (<a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/wfc3/documentation/instrument-science-reports-isrs/_documents/2023/WFC3-ISR-2023-06.pdf">Pagul et al. 2023</a>). Since our grisms were observed on UVIS2, we download that sky frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>curl<span class="w"> </span>-O<span class="w"> </span>https://www.stsci.edu/~WFC3/grism-resources/uvis-grism-sky-images/G280sky_chip2_flt_v1.0.fits
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100 32.0M  100 32.0M    0     0  61.7M      0 --:--:-- --:--:-- --:--:-- 61.8M
</pre></div>
</div>
</div>
</div>
<p>Then, we load the UVIS2 G280 sky frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g280_sky_full</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;G280sky_chip2_flt_v1.0.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We plot the sky with a box around the subarray.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot sky</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;UVIS2 G280 Sky&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">g280_sky_full</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="c1"># Plot box around subarray</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x_offset</span><span class="p">,</span> <span class="n">y_offset</span><span class="p">,</span> <span class="n">y_offset</span> <span class="o">+</span> <span class="n">y_length</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Subarray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x_offset</span> <span class="o">+</span> <span class="n">x_length</span><span class="p">,</span> <span class="n">y_offset</span><span class="p">,</span> <span class="n">y_offset</span> <span class="o">+</span> <span class="n">y_length</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y_offset</span><span class="p">,</span> <span class="n">x_offset</span><span class="p">,</span> <span class="n">x_offset</span> <span class="o">+</span> <span class="n">x_length</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y_offset</span> <span class="o">+</span> <span class="n">y_length</span><span class="p">,</span> <span class="n">x_offset</span><span class="p">,</span> <span class="n">x_offset</span> <span class="o">+</span> <span class="n">x_length</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f963c379a90&gt;
</pre></div>
</div>
<img alt="../../../_images/432786aaa27dc2b226aeda313afc89e3fa542c4dcbb4ca2a7819020a57621df7.png" src="../../../_images/432786aaa27dc2b226aeda313afc89e3fa542c4dcbb4ca2a7819020a57621df7.png" />
</div>
</div>
<p>Next, we extract the subarray pixels from the sky.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g280_sky</span> <span class="o">=</span> <span class="n">g280_sky_full</span><span class="p">[</span><span class="n">y_offset</span><span class="p">:</span><span class="n">y_offset</span><span class="o">+</span><span class="n">y_length</span><span class="p">,</span> <span class="n">x_offset</span><span class="p">:</span><span class="n">x_offset</span><span class="o">+</span><span class="n">x_length</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we scale each sky by each exposure’s median.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_series_grism_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">time_series_grism</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">time_series_grism</span><span class="p">)</span>
<span class="n">time_series_g280_sky</span> <span class="o">=</span> <span class="n">g280_sky</span> <span class="o">*</span> <span class="n">time_series_grism_median</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we apply background subtraction to each science frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_series_bkg_sub</span> <span class="o">=</span> <span class="n">time_series_grism</span> <span class="o">-</span> <span class="n">time_series_g280_sky</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cosmic-ray-correction">
<h2>4. Cosmic Ray Correction<a class="headerlink" href="#cosmic-ray-correction" title="Permalink to this heading">#</a></h2>
<p><a id="cr_corr_sub"></a></p>
<p>Now, we remove cosmic rays, which can not only hit the detector throughout the course of the hours-long time-series observations, but may also be more frequent in G280 data due to its wide wavelength coverage. It is important to correct for cosmic rays within an exposure (spatially) and also across exposures in the time-series (temporally).</p>
<p>First, we apply the temporal and spatial cosmic ray correction routines using <code class="docutils literal notranslate"><span class="pre">g280_transit_tools.remove_cosmic_rays_time</span></code> and <code class="docutils literal notranslate"><span class="pre">g280_transit_tools.remove_cosmic_rays_space</span></code>. These functions return the corrected data, and the masks for corrected pixels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Temporal correction</span>
<span class="n">time_series_cr_time</span><span class="p">,</span> <span class="n">mask_outliers_time</span> <span class="o">=</span> <span class="n">g280_transit_tools</span><span class="o">.</span><span class="n">remove_cosmic_rays_time</span><span class="p">(</span><span class="n">time_series_bkg_sub</span><span class="p">,</span> <span class="n">n_sigma</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Spatial correction</span>
<span class="n">time_series_cr_corr</span><span class="p">,</span> <span class="n">mask_outliers_space</span> <span class="o">=</span> <span class="n">g280_transit_tools</span><span class="o">.</span><span class="n">remove_cosmic_rays_space</span><span class="p">(</span><span class="n">time_series_cr_time</span><span class="p">,</span> <span class="n">n_sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/4 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 25%|██▌       | 1/4 [00:02&lt;00:07,  2.37s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 2/4 [00:04&lt;00:04,  2.35s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 75%|███████▌  | 3/4 [00:07&lt;00:02,  2.35s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 4/4 [00:09&lt;00:00,  2.34s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 4/4 [00:09&lt;00:00,  2.34s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/54 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2%|▏         | 1/54 [00:00&lt;00:12,  4.10it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4%|▎         | 2/54 [00:00&lt;00:12,  4.13it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6%|▌         | 3/54 [00:00&lt;00:12,  4.14it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7%|▋         | 4/54 [00:00&lt;00:12,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  9%|▉         | 5/54 [00:01&lt;00:11,  4.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 11%|█         | 6/54 [00:01&lt;00:11,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 13%|█▎        | 7/54 [00:01&lt;00:11,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 15%|█▍        | 8/54 [00:01&lt;00:11,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 17%|█▋        | 9/54 [00:02&lt;00:10,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 19%|█▊        | 10/54 [00:02&lt;00:10,  4.18it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 20%|██        | 11/54 [00:02&lt;00:10,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 22%|██▏       | 12/54 [00:02&lt;00:10,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 24%|██▍       | 13/54 [00:03&lt;00:09,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 26%|██▌       | 14/54 [00:03&lt;00:09,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 28%|██▊       | 15/54 [00:03&lt;00:09,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 30%|██▉       | 16/54 [00:03&lt;00:09,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 31%|███▏      | 17/54 [00:04&lt;00:08,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 33%|███▎      | 18/54 [00:04&lt;00:08,  4.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 35%|███▌      | 19/54 [00:04&lt;00:08,  4.13it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 37%|███▋      | 20/54 [00:04&lt;00:08,  4.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 39%|███▉      | 21/54 [00:05&lt;00:07,  4.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 41%|████      | 22/54 [00:05&lt;00:07,  4.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 43%|████▎     | 23/54 [00:05&lt;00:07,  4.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 44%|████▍     | 24/54 [00:05&lt;00:07,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 46%|████▋     | 25/54 [00:06&lt;00:06,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 48%|████▊     | 26/54 [00:06&lt;00:06,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 27/54 [00:06&lt;00:06,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 52%|█████▏    | 28/54 [00:06&lt;00:06,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 54%|█████▎    | 29/54 [00:06&lt;00:06,  4.14it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 56%|█████▌    | 30/54 [00:07&lt;00:05,  4.14it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 57%|█████▋    | 31/54 [00:07&lt;00:05,  4.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 59%|█████▉    | 32/54 [00:07&lt;00:05,  4.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 61%|██████    | 33/54 [00:07&lt;00:05,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 63%|██████▎   | 34/54 [00:08&lt;00:04,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 65%|██████▍   | 35/54 [00:08&lt;00:04,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 67%|██████▋   | 36/54 [00:08&lt;00:04,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 69%|██████▊   | 37/54 [00:08&lt;00:04,  4.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 70%|███████   | 38/54 [00:09&lt;00:03,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 72%|███████▏  | 39/54 [00:09&lt;00:03,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 74%|███████▍  | 40/54 [00:09&lt;00:03,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 76%|███████▌  | 41/54 [00:09&lt;00:03,  4.14it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 78%|███████▊  | 42/54 [00:10&lt;00:02,  4.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 80%|███████▉  | 43/54 [00:10&lt;00:02,  4.13it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 81%|████████▏ | 44/54 [00:10&lt;00:02,  4.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 83%|████████▎ | 45/54 [00:10&lt;00:02,  4.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 85%|████████▌ | 46/54 [00:11&lt;00:01,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 87%|████████▋ | 47/54 [00:11&lt;00:01,  4.14it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 89%|████████▉ | 48/54 [00:11&lt;00:01,  4.14it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 91%|█████████ | 49/54 [00:11&lt;00:01,  4.14it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 93%|█████████▎| 50/54 [00:12&lt;00:00,  4.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 94%|█████████▍| 51/54 [00:12&lt;00:00,  4.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 96%|█████████▋| 52/54 [00:12&lt;00:00,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 98%|█████████▊| 53/54 [00:12&lt;00:00,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 54/54 [00:12&lt;00:00,  4.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 54/54 [00:12&lt;00:00,  4.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>We compare the raw 2D spectral image to the spectrum corrected for outliers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

<span class="c1"># Plot grism image</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">file_grism_image</span><span class="p">)</span>
<span class="n">axs0</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grism_image</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axs0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Plot clean grism image</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_grism_image</span><span class="si">}</span><span class="s1"> (CR Corrected)&#39;</span><span class="p">)</span>
<span class="n">axs1</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">time_series_cr_corr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axs1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/4c027b65bf87a007bc13e34c5f99bfc1cad8c21df65af17979988fa48765a79b.png" src="../../../_images/4c027b65bf87a007bc13e34c5f99bfc1cad8c21df65af17979988fa48765a79b.png" />
</div>
</div>
<p>Our routine sufficiently removed the outliers. All we have left are background stars. Now, we save the cosmic ray corrected data as <code class="docutils literal notranslate"><span class="pre">_c_flt.fits</span></code> files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop through paths</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">paths_flt</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">paths_flt</span><span class="p">)):</span>

    <span class="c1"># Make a copy of each file</span>
    <span class="n">file_c</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;flt.fits&#39;</span><span class="p">,</span> <span class="s1">&#39;c_flt.fits&#39;</span><span class="p">))</span>
    <span class="n">path_c</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">flt_clean_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">file_c</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">path_c</span><span class="p">)</span>

    <span class="c1"># Update the copy</span>
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path_c</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdu</span><span class="p">:</span>
        <span class="n">hdu</span><span class="p">[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">time_series_cr_corr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/54 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4%|▎         | 2/54 [00:00&lt;00:02, 19.01it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7%|▋         | 4/54 [00:00&lt;00:02, 19.20it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 11%|█         | 6/54 [00:00&lt;00:02, 19.30it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 15%|█▍        | 8/54 [00:00&lt;00:02, 19.36it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 19%|█▊        | 10/54 [00:00&lt;00:02, 19.34it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 22%|██▏       | 12/54 [00:00&lt;00:02, 19.39it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 26%|██▌       | 14/54 [00:00&lt;00:02, 19.39it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 30%|██▉       | 16/54 [00:00&lt;00:01, 19.28it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 33%|███▎      | 18/54 [00:00&lt;00:01, 19.25it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 37%|███▋      | 20/54 [00:01&lt;00:01, 19.31it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 41%|████      | 22/54 [00:01&lt;00:01, 19.36it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 44%|████▍     | 24/54 [00:01&lt;00:01, 19.45it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 48%|████▊     | 26/54 [00:01&lt;00:01, 19.44it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 52%|█████▏    | 28/54 [00:01&lt;00:01, 19.27it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 56%|█████▌    | 30/54 [00:01&lt;00:01, 19.31it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 59%|█████▉    | 32/54 [00:01&lt;00:01, 18.93it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 63%|██████▎   | 34/54 [00:01&lt;00:01, 18.45it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 67%|██████▋   | 36/54 [00:01&lt;00:00, 18.58it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 70%|███████   | 38/54 [00:01&lt;00:00, 18.74it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 74%|███████▍  | 40/54 [00:02&lt;00:00, 18.86it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 78%|███████▊  | 42/54 [00:02&lt;00:00, 18.86it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 81%|████████▏ | 44/54 [00:02&lt;00:00, 19.05it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 85%|████████▌ | 46/54 [00:02&lt;00:00, 19.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 89%|████████▉ | 48/54 [00:02&lt;00:00, 19.22it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 93%|█████████▎| 50/54 [00:02&lt;00:00, 19.22it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 96%|█████████▋| 52/54 [00:02&lt;00:00, 19.26it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 54/54 [00:02&lt;00:00, 19.26it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 54/54 [00:02&lt;00:00, 19.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="embedding-subarrays">
<h2>5. Embedding Subarrays<a class="headerlink" href="#embedding-subarrays" title="Permalink to this heading">#</a></h2>
<p><a id="embed_sub"></a></p>
<p>The G280 spectra are taken on UVIS2, but we need to embed this subarray into the full frame image in order to proceed with the spectral extraction. For this step, we use <code class="docutils literal notranslate"><span class="pre">g280_transit_tools.embedsub_uvis</span></code>, which is a derivative of <a class="reference external" href="https://github.com/spacetelescope/wfc3tools/blob/main/wfc3tools/embedsub.py"><code class="docutils literal notranslate"><span class="pre">wfc3tools.embedsub</span></code></a>. The former function uses header keywords from the <code class="docutils literal notranslate"><span class="pre">_flt.fits</span></code> file (i.e. <code class="docutils literal notranslate"><span class="pre">NAXIS</span></code>, <code class="docutils literal notranslate"><span class="pre">LTV</span></code>), while the latter function requires keywords from the <code class="docutils literal notranslate"><span class="pre">_spt.files</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve clean flt paths</span>
<span class="n">paths_c_flt</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">flt_clean_dir</span><span class="si">}</span><span class="s1">/*&#39;</span><span class="p">))</span>

<span class="c1"># Loop through cleaned paths and embed</span>
<span class="k">for</span> <span class="n">path_c</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">paths_c_flt</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">paths_c_flt</span><span class="p">)):</span>
    <span class="n">path_c_f</span> <span class="o">=</span> <span class="n">g280_transit_tools</span><span class="o">.</span><span class="n">embedsub_uvis</span><span class="p">(</span><span class="n">path_c</span><span class="p">,</span> <span class="n">flt_full_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/54 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2%|▏         | 1/54 [00:00&lt;00:07,  7.33it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4%|▎         | 2/54 [00:00&lt;00:07,  7.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6%|▌         | 3/54 [00:00&lt;00:07,  7.02it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7%|▋         | 4/54 [00:00&lt;00:07,  6.96it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  9%|▉         | 5/54 [00:00&lt;00:06,  7.02it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 11%|█         | 6/54 [00:00&lt;00:06,  7.05it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 13%|█▎        | 7/54 [00:00&lt;00:06,  7.07it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 15%|█▍        | 8/54 [00:01&lt;00:06,  7.01it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 17%|█▋        | 9/54 [00:01&lt;00:06,  7.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 19%|█▊        | 10/54 [00:01&lt;00:06,  6.98it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 20%|██        | 11/54 [00:01&lt;00:06,  6.89it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 22%|██▏       | 12/54 [00:01&lt;00:06,  6.86it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 24%|██▍       | 13/54 [00:01&lt;00:05,  6.85it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 26%|██▌       | 14/54 [00:02&lt;00:05,  6.75it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 28%|██▊       | 15/54 [00:02&lt;00:05,  6.79it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 30%|██▉       | 16/54 [00:02&lt;00:05,  6.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 31%|███▏      | 17/54 [00:02&lt;00:05,  6.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 33%|███▎      | 18/54 [00:02&lt;00:05,  6.72it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 35%|███▌      | 19/54 [00:02&lt;00:05,  6.78it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 37%|███▋      | 20/54 [00:02&lt;00:04,  6.83it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 39%|███▉      | 21/54 [00:03&lt;00:04,  6.85it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 41%|████      | 22/54 [00:03&lt;00:04,  6.88it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 43%|████▎     | 23/54 [00:03&lt;00:04,  6.84it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 44%|████▍     | 24/54 [00:03&lt;00:04,  6.25it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 46%|████▋     | 25/54 [00:03&lt;00:04,  6.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 48%|████▊     | 26/54 [00:03&lt;00:04,  5.61it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 27/54 [00:04&lt;00:04,  5.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 52%|█████▏    | 28/54 [00:04&lt;00:05,  5.04it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 54%|█████▎    | 29/54 [00:04&lt;00:04,  5.38it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 56%|█████▌    | 30/54 [00:04&lt;00:04,  4.95it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 57%|█████▋    | 31/54 [00:04&lt;00:04,  5.11it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 59%|█████▉    | 32/54 [00:05&lt;00:04,  4.70it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 61%|██████    | 33/54 [00:05&lt;00:04,  4.93it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 63%|██████▎   | 34/54 [00:05&lt;00:03,  5.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 65%|██████▍   | 35/54 [00:05&lt;00:03,  4.97it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 67%|██████▋   | 36/54 [00:05&lt;00:03,  4.88it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 69%|██████▊   | 37/54 [00:06&lt;00:03,  5.03it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 70%|███████   | 38/54 [00:06&lt;00:03,  4.94it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 72%|███████▏  | 39/54 [00:06&lt;00:03,  4.65it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 74%|███████▍  | 40/54 [00:06&lt;00:02,  4.95it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 76%|███████▌  | 41/54 [00:06&lt;00:02,  5.04it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 78%|███████▊  | 42/54 [00:07&lt;00:02,  4.71it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 80%|███████▉  | 43/54 [00:07&lt;00:02,  4.93it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 81%|████████▏ | 44/54 [00:07&lt;00:02,  4.89it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 83%|████████▎ | 45/54 [00:07&lt;00:01,  4.80it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 85%|████████▌ | 46/54 [00:08&lt;00:01,  4.71it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 87%|████████▋ | 47/54 [00:08&lt;00:01,  4.85it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 89%|████████▉ | 48/54 [00:08&lt;00:01,  4.87it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 91%|█████████ | 49/54 [00:08&lt;00:01,  4.87it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 93%|█████████▎| 50/54 [00:08&lt;00:00,  4.99it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 94%|█████████▍| 51/54 [00:09&lt;00:00,  4.98it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 96%|█████████▋| 52/54 [00:09&lt;00:00,  5.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 98%|█████████▊| 53/54 [00:09&lt;00:00,  5.07it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 54/54 [00:09&lt;00:00,  5.10it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 54/54 [00:09&lt;00:00,  5.63it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>We extract the cleaned subarray image and the full frame embedded image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define filenames and paths</span>
<span class="n">file_grism_image_c</span> <span class="o">=</span> <span class="n">file_grism_image</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;flt&#39;</span><span class="p">,</span> <span class="s1">&#39;c_flt&#39;</span><span class="p">)</span>
<span class="n">file_grism_image_c_f</span> <span class="o">=</span> <span class="n">file_grism_image</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;flt&#39;</span><span class="p">,</span> <span class="s1">&#39;c_f_flt&#39;</span><span class="p">)</span>
<span class="n">path_grism_image_c</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">flt_clean_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">file_grism_image_c</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">path_grism_image_c_f</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">flt_full_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">file_grism_image_c_f</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="c1"># Extract data</span>
<span class="n">grism_image_c</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">path_grism_image_c</span><span class="p">)</span>
<span class="n">grism_image_c_f</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">path_grism_image_c_f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We compare the cleaned subarray image to the full frame embedded image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

<span class="c1"># Plot clean grism image</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_grism_image_c</span><span class="si">}</span><span class="s1"> (CR Corrected)&#39;</span><span class="p">)</span>
<span class="n">axs0</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grism_image_c</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axs0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Plot clean full frame grism image</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_grism_image_c_f</span><span class="si">}</span><span class="s1"> (CR Corrected; Full Frame)&#39;</span><span class="p">)</span>
<span class="n">axs1</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grism_image_c_f</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axs1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/d65b86d04298a1d5037f0540d250c18cd666b5a5e9ce6e196be7cee7a433ef82.png" src="../../../_images/d65b86d04298a1d5037f0540d250c18cd666b5a5e9ce6e196be7cee7a433ef82.png" />
</div>
</div>
</section>
<section id="spectral-trace-fitting">
<h2>6. Spectral Trace Fitting<a class="headerlink" href="#spectral-trace-fitting" title="Permalink to this heading">#</a></h2>
<p><a id="trace_fitting"></a></p>
<p>We fit the spectral trace using <code class="docutils literal notranslate"><span class="pre">g280_transit_tools.fit_spectral_trace</span></code>. This function uses <a class="reference external" href="https://github.com/npirzkal/GRISMCONF/tree/master">GRISMCONF</a>, which implements the grism configuration detailed in <a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/wfc3/documentation/instrument-science-reports-isrs/_documents/2017/WFC3-2017-01.pdf">Pirzkal &amp; Ryan (2017)</a>. We download the <a class="reference external" href="https://github.com/npirzkal/GRISM_WFC3/blob/master">configuration files</a> required to fit the spectral trace.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/npirzkal/GRISM_WFC3.git
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cloning into &#39;GRISM_WFC3&#39;...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>remote: Enumerating objects: 63, done.
Receiving objects:   1% (1/63)
Receiving objects:   3% (2/63)
Receiving objects:   4% (3/63)
Receiving objects:   6% (4/63)
Receiving objects:   7% (5/63)
Receiving objects:   9% (6/63)
Receiving objects:  11% (7/63)
Receiving objects:  12% (8/63)
Receiving objects:  14% (9/63)
Receiving objects:  15% (10/63)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Receiving objects:  17% (11/63)
Receiving objects:  19% (12/63)
Receiving objects:  20% (13/63)
Receiving objects:  22% (14/63)
Receiving objects:  23% (15/63)
Receiving objects:  25% (16/63)
Receiving objects:  26% (17/63)
Receiving objects:  28% (18/63)
Receiving objects:  30% (19/63)
Receiving objects:  31% (20/63)
Receiving objects:  33% (21/63)
Receiving objects:  34% (22/63)
Receiving objects:  36% (23/63)
Receiving objects:  38% (24/63)
Receiving objects:  39% (25/63)
Receiving objects:  41% (26/63)
Receiving objects:  42% (27/63)
Receiving objects:  44% (28/63)
Receiving objects:  46% (29/63)
Receiving objects:  47% (30/63)
Receiving objects:  49% (31/63)
Receiving objects:  50% (32/63)
Receiving objects:  52% (33/63)
Receiving objects:  53% (34/63)
Receiving objects:  55% (35/63)
Receiving objects:  57% (36/63)
Receiving objects:  58% (37/63)
Receiving objects:  60% (38/63)
Receiving objects:  61% (39/63)
Receiving objects:  63% (40/63)
Receiving objects:  65% (41/63)
Receiving objects:  66% (42/63)
Receiving objects:  68% (43/63)
Receiving objects:  69% (44/63)
Receiving objects:  71% (45/63)
Receiving objects:  73% (46/63)
Receiving objects:  74% (47/63)
Receiving objects:  76% (48/63)
Receiving objects:  77% (49/63)
Receiving objects:  79% (50/63)
Receiving objects:  80% (51/63)
Receiving objects:  82% (52/63)
Receiving objects:  84% (53/63)
Receiving objects:  85% (54/63)
Receiving objects:  87% (55/63)
Receiving objects:  88% (56/63)
Receiving objects:  90% (57/63)
Receiving objects:  92% (58/63)
Receiving objects:  93% (59/63)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>remote: Total 63 (delta 0), reused 0 (delta 0), pack-reused 63 (from 1)
Receiving objects:  95% (60/63)
Receiving objects:  96% (61/63)
Receiving objects:  98% (62/63)
Receiving objects: 100% (63/63)
Receiving objects: 100% (63/63), 881.99 KiB | 9.69 MiB/s, done.
Resolving deltas:   0% (0/28)
Resolving deltas:   3% (1/28)
Resolving deltas:   7% (2/28)
Resolving deltas:  10% (3/28)
Resolving deltas:  14% (4/28)
Resolving deltas:  17% (5/28)
Resolving deltas:  21% (6/28)
Resolving deltas:  25% (7/28)
Resolving deltas:  28% (8/28)
Resolving deltas:  32% (9/28)
Resolving deltas:  35% (10/28)
Resolving deltas:  39% (11/28)
Resolving deltas:  42% (12/28)
Resolving deltas:  46% (13/28)
Resolving deltas:  50% (14/28)
Resolving deltas:  53% (15/28)
Resolving deltas:  57% (16/28)
Resolving deltas:  60% (17/28)
Resolving deltas:  64% (18/28)
Resolving deltas:  67% (19/28)
Resolving deltas:  71% (20/28)
Resolving deltas:  75% (21/28)
Resolving deltas:  78% (22/28)
Resolving deltas:  82% (23/28)
Resolving deltas:  85% (24/28)
Resolving deltas:  89% (25/28)
Resolving deltas:  92% (26/28)
Resolving deltas:  96% (27/28)
Resolving deltas: 100% (28/28)
Resolving deltas: 100% (28/28), done.
</pre></div>
</div>
</div>
</div>
<p>First, we extract the +1 and -1 orders of one of the cleaned full frame images for the full width of G280 (0.2-0.8 <span class="math notranslate nohighlight">\(\mu\)</span>m).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define parameters</span>
<span class="n">path_config</span> <span class="o">=</span> <span class="s1">&#39;GRISM_WFC3/UVIS/UVIS_G280_CCD2_V2.conf&#39;</span>
<span class="n">order_p1</span> <span class="o">=</span> <span class="s1">&#39;+1&#39;</span>
<span class="n">order_m1</span> <span class="o">=</span> <span class="s1">&#39;-1&#39;</span>
<span class="n">wl_min</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">wl_max</span> <span class="o">=</span> <span class="mi">8000</span>

<span class="c1"># Fit +1 spectral trace</span>
<span class="n">trace_x_p1</span><span class="p">,</span> <span class="n">trace_y_p1</span><span class="p">,</span> <span class="n">wavelength_p1</span><span class="p">,</span> <span class="n">sensitivity_p1</span> <span class="o">=</span> <span class="n">g280_transit_tools</span><span class="o">.</span><span class="n">fit_spectral_trace</span><span class="p">(</span>
    <span class="n">path_config</span><span class="p">,</span> <span class="n">source_x</span><span class="p">,</span> <span class="n">source_y</span><span class="p">,</span> <span class="n">order_p1</span><span class="p">,</span> <span class="n">wl_min</span><span class="p">,</span> <span class="n">wl_max</span>
<span class="p">)</span>

<span class="c1"># Fit -1 spectral trace</span>
<span class="n">trace_x_m1</span><span class="p">,</span> <span class="n">trace_y_m1</span><span class="p">,</span> <span class="n">wavelength_m1</span><span class="p">,</span> <span class="n">sensitivity_m1</span> <span class="o">=</span> <span class="n">g280_transit_tools</span><span class="o">.</span><span class="n">fit_spectral_trace</span><span class="p">(</span>
    <span class="n">path_config</span><span class="p">,</span> <span class="n">source_x</span><span class="p">,</span> <span class="n">source_y</span><span class="p">,</span> <span class="n">order_m1</span><span class="p">,</span> <span class="n">wl_min</span><span class="p">,</span> <span class="n">wl_max</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We plot the sensitivity profiles of each order normalized by the +1 maximum sensitivity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sensitivity Profiles&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelength_p1</span><span class="p">,</span> <span class="n">sensitivity_p1</span><span class="o">/</span><span class="n">sensitivity_p1</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Order </span><span class="si">{</span><span class="n">order_p1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelength_m1</span><span class="p">,</span> <span class="n">sensitivity_m1</span><span class="o">/</span><span class="n">sensitivity_p1</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Order </span><span class="si">{</span><span class="n">order_m1</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (Angstrom)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Sensitivity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f9663959a90&gt;
</pre></div>
</div>
<img alt="../../../_images/ea69db787e17bb6a59d5f67c3ca4866d305e930e301ce21f6a2405feb8d1516e.png" src="../../../_images/ea69db787e17bb6a59d5f67c3ca4866d305e930e301ce21f6a2405feb8d1516e.png" />
</div>
</div>
<p>The +1 order has a higher sensitivity than -1 order. Next, we normalize the exposure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exptime</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">path_grism_image_c_f</span><span class="p">,</span> <span class="s1">&#39;exptime&#39;</span><span class="p">)</span>
<span class="n">spec_data</span> <span class="o">=</span> <span class="n">grism_image_c_f</span> <span class="o">/</span> <span class="n">exptime</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we plot the spectral traces using an aperture of +/- 30 pixels outside of the y trace.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define aperture windows</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">aperture_min_p1</span> <span class="o">=</span> <span class="n">trace_y_p1</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">n</span>
<span class="n">aperture_max_p1</span> <span class="o">=</span> <span class="n">trace_y_p1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">n</span>
<span class="n">aperture_min_m1</span> <span class="o">=</span> <span class="n">trace_y_m1</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">n</span>
<span class="n">aperture_max_m1</span> <span class="o">=</span> <span class="n">trace_y_m1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">n</span>

<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">spec_data</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">99.95</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

<span class="c1"># Plot +1 order</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_grism_image_c_f</span><span class="si">}</span><span class="s1"> (e-/s) Order </span><span class="si">{</span><span class="n">order_p1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">axs0</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">spec_data</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trace_x_p1</span><span class="p">,</span> <span class="n">trace_y_p1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">trace_x_p1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">trace_x_p1</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">aperture_min_p1</span><span class="p">,</span> <span class="n">aperture_max_p1</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axs0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Plot -1 order</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_grism_image_c_f</span><span class="si">}</span><span class="s1"> (e-/s) Order </span><span class="si">{</span><span class="n">order_m1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">axs1</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">spec_data</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trace_x_m1</span><span class="p">,</span> <span class="n">trace_y_m1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">trace_x_m1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">trace_x_m1</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">aperture_min_m1</span><span class="p">,</span> <span class="n">aperture_max_m1</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axs1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/658a7a1a638b612f74663ca4b2c4195c256030d123cb464c73dc7f8f68317c88.png" src="../../../_images/658a7a1a638b612f74663ca4b2c4195c256030d123cb464c73dc7f8f68317c88.png" />
</div>
</div>
</section>
<section id="g280-spectral-extraction">
<h2>7. G280 Spectral Extraction<a class="headerlink" href="#g280-spectral-extraction" title="Permalink to this heading">#</a></h2>
<p><a id="extraction"></a></p>
<p>With our fitted spectral traces, we extract the 1D stellar spectra within a given aperture window using <code class="docutils literal notranslate"><span class="pre">g280_transit_tools.extract_spectrum</span></code>. In the example below, we use an aperture window that matches the y-axis scale in the plot above. The exact size of this aperture window is a parameter that we can refine and optimize later on in our analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract +1 order spectrum</span>
<span class="n">counts_p1</span><span class="p">,</span> <span class="n">counts_err_p1</span> <span class="o">=</span> <span class="n">g280_transit_tools</span><span class="o">.</span><span class="n">extract_spectrum</span><span class="p">(</span>
    <span class="n">path_grism_image_c_f</span><span class="p">,</span> <span class="n">aperture_min_p1</span><span class="p">,</span> <span class="n">aperture_max_p1</span><span class="p">,</span> <span class="n">trace_x_p1</span>
<span class="p">)</span>

<span class="c1"># Extract -1 order spectrum</span>
<span class="n">counts_m1</span><span class="p">,</span> <span class="n">counts_err_m1</span> <span class="o">=</span> <span class="n">g280_transit_tools</span><span class="o">.</span><span class="n">extract_spectrum</span><span class="p">(</span>
    <span class="n">path_grism_image_c_f</span><span class="p">,</span> <span class="n">aperture_min_m1</span><span class="p">,</span> <span class="n">aperture_max_m1</span><span class="p">,</span> <span class="n">trace_x_m1</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We plot our 1D spectra for the +1 and -1 orders.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_grism_image_c_f</span><span class="si">}</span><span class="s1"> (1D Spectrum)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">wavelength_p1</span><span class="p">,</span> <span class="n">counts_p1</span><span class="p">,</span> <span class="n">counts_err_p1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Order </span><span class="si">{</span><span class="n">order_p1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">wavelength_m1</span><span class="p">,</span> <span class="n">counts_m1</span><span class="p">,</span> <span class="n">counts_err_m1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Order </span><span class="si">{</span><span class="n">order_m1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (Angstroms)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Counts (e-)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f9663757c10&gt;
</pre></div>
</div>
<img alt="../../../_images/a5a2a8fda78c0e9ffc82a4512b5d21df9f41e63e27fc3b481df6460aa57efd1f.png" src="../../../_images/a5a2a8fda78c0e9ffc82a4512b5d21df9f41e63e27fc3b481df6460aa57efd1f.png" />
</div>
</div>
<p>The +1 order has a factor of ~2 higher throughput compared to the -1 order.</p>
</section>
<section id="extracting-1d-time-series-stellar-spectra">
<h2>8. Extracting 1D Time-Series Stellar Spectra<a class="headerlink" href="#extracting-1d-time-series-stellar-spectra" title="Permalink to this heading">#</a></h2>
<p><a id="spectra"></a></p>
<p>Using the spectral trace fitting parameters, we perform spectral extraction for all of the full frame images in the time series using the previous values for <code class="docutils literal notranslate"><span class="pre">aperture_min</span></code> and <code class="docutils literal notranslate"><span class="pre">aperture_max</span></code> for <code class="docutils literal notranslate"><span class="pre">g280_transit_tools.extract_spectrum</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve clean embeded flt paths</span>
<span class="n">paths_c_f_flt</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">flt_full_dir</span><span class="si">}</span><span class="s1">/*&#39;</span><span class="p">))</span>

<span class="c1"># Initialize arrays </span>
<span class="n">time_series_counts_p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_spectra</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace_x_p1</span><span class="p">)))</span>
<span class="n">time_series_counts_err_p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_spectra</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace_x_p1</span><span class="p">)))</span>
<span class="n">time_series_counts_m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_spectra</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace_x_m1</span><span class="p">)))</span>
<span class="n">time_series_counts_err_m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_spectra</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace_x_m1</span><span class="p">)))</span>

<span class="c1"># Loop over all exposures </span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path_c_f</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">paths_c_f_flt</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="n">n_spectra</span><span class="p">):</span>

    <span class="c1"># Extract 1D spectra +1 order</span>
    <span class="n">counts_p1</span><span class="p">,</span> <span class="n">counts_err_p1</span> <span class="o">=</span> <span class="n">g280_transit_tools</span><span class="o">.</span><span class="n">extract_spectrum</span><span class="p">(</span>
        <span class="n">path_c_f</span><span class="p">,</span> <span class="n">aperture_min_p1</span><span class="p">,</span> <span class="n">aperture_max_p1</span><span class="p">,</span> <span class="n">trace_x_p1</span>
    <span class="p">)</span>

    <span class="c1"># Extract 1D spectra -1 order</span>
    <span class="n">counts_m1</span><span class="p">,</span> <span class="n">counts_err_m1</span> <span class="o">=</span> <span class="n">g280_transit_tools</span><span class="o">.</span><span class="n">extract_spectrum</span><span class="p">(</span>
        <span class="n">path_c_f</span><span class="p">,</span> <span class="n">aperture_min_m1</span><span class="p">,</span> <span class="n">aperture_max_m1</span><span class="p">,</span> <span class="n">trace_x_m1</span>
    <span class="p">)</span>

    <span class="c1"># Record data</span>
    <span class="n">time_series_counts_p1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts_p1</span>
    <span class="n">time_series_counts_err_p1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts_err_p1</span>
    <span class="n">time_series_counts_m1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts_m1</span>
    <span class="n">time_series_counts_err_m1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts_err_m1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/54 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 17%|█▋        | 9/54 [00:00&lt;00:00, 89.27it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 33%|███▎      | 18/54 [00:00&lt;00:00, 88.33it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 27/54 [00:00&lt;00:00, 89.04it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 67%|██████▋   | 36/54 [00:00&lt;00:00, 89.01it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 83%|████████▎ | 45/54 [00:00&lt;00:00, 88.33it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 54/54 [00:00&lt;00:00, 87.95it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 54/54 [00:00&lt;00:00, 88.24it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>We also extract the midexposure times and hours from mid-transit of the observations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mjd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">([(</span><span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;expstart&#39;</span><span class="p">),</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;expend&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths_flt</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">hours</span> <span class="o">=</span> <span class="p">(</span><span class="n">mjd</span> <span class="o">-</span> <span class="n">mjd</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">*</span> <span class="mi">24</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we plot the time-series of 1D stellar spectra colored by hours from mid-transit, and the median spectrum colored in black.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure colorbar scale</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">viridis</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">hours</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">hours</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">hours</span><span class="p">))</span>

<span class="c1"># Plot spectra +1 order and median</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time Series of 1D Stellar Spectra Order </span><span class="si">{</span><span class="n">order_p1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">counts_err</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">time_series_counts_p1</span><span class="p">,</span> <span class="n">time_series_counts_err_p1</span><span class="p">)):</span>
    <span class="n">axs0</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">wavelength_p1</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">counts_err</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">counts_median_p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">time_series_counts_p1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">counts_err_median_p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">time_series_counts_err_p1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">wavelength_p1</span><span class="p">,</span> <span class="n">counts_median_p1</span><span class="p">,</span> <span class="n">counts_err_median_p1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (Angstroms)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts (e-)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Plot spectra -1 order and median</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time Series of 1D Stellar Spectra Order </span><span class="si">{</span><span class="n">order_m1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">counts_err</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">time_series_counts_m1</span><span class="p">,</span> <span class="n">time_series_counts_err_m1</span><span class="p">)):</span>
    <span class="n">axs1</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">wavelength_m1</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">counts_err</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">counts_median_m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">time_series_counts_m1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">counts_err_median_m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">time_series_counts_err_m1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">wavelength_m1</span><span class="p">,</span> <span class="n">counts_median_m1</span><span class="p">,</span> <span class="n">counts_err_median_m1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (Angstroms)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts (e-)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Set colorbar</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hours from Mid-transit</span><span class="se">\n</span><span class="s1">$MJD_0$=</span><span class="si">{</span><span class="n">mjd</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/cc7c1f007ce8fbbf912c802d238eac66073a098d5ae2e7d30ec7d629405130a6.png" src="../../../_images/cc7c1f007ce8fbbf912c802d238eac66073a098d5ae2e7d30ec7d629405130a6.png" />
</div>
</div>
</section>
<section id="generating-light-curves">
<h2>9. Generating Light Curves<a class="headerlink" href="#generating-light-curves" title="Permalink to this heading">#</a></h2>
<p><a id="lc"></a></p>
<p>With 1D time series stellar spectra, we generate the broadband (i.e. white light) light curves, which is extracted across the full wavelength range of the G280 grism. We generate the light curve using <code class="docutils literal notranslate"><span class="pre">g280_transit_tools.make_light_curve</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># +1 order</span>
<span class="n">lc_counts_p1</span><span class="p">,</span> <span class="n">lc_counts_err_p1</span> <span class="o">=</span> <span class="n">g280_transit_tools</span><span class="o">.</span><span class="n">make_light_curve</span><span class="p">(</span>
    <span class="n">wavelength_p1</span><span class="p">,</span> <span class="n">time_series_counts_p1</span><span class="p">,</span> <span class="n">wl_min</span><span class="o">=</span><span class="n">wl_min</span><span class="p">,</span> <span class="n">wl_max</span><span class="o">=</span><span class="n">wl_max</span>
<span class="p">)</span>

<span class="c1"># -1 order</span>
<span class="n">lc_counts_m1</span><span class="p">,</span> <span class="n">lc_counts_err_m1</span> <span class="o">=</span> <span class="n">g280_transit_tools</span><span class="o">.</span><span class="n">make_light_curve</span><span class="p">(</span>
    <span class="n">wavelength_m1</span><span class="p">,</span> <span class="n">time_series_counts_m1</span><span class="p">,</span> <span class="n">wl_min</span><span class="o">=</span><span class="n">wl_min</span><span class="p">,</span> <span class="n">wl_max</span><span class="o">=</span><span class="n">wl_max</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we plot the normalized light curves.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normalize counts by mean of first 10 measurements</span>
<span class="n">lc_counts_p1_norm</span> <span class="o">=</span> <span class="n">lc_counts_p1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lc_counts_p1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
<span class="n">lc_counts_m1_norm</span> <span class="o">=</span> <span class="n">lc_counts_m1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lc_counts_m1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;WFC3/UVIS G280 HAT-P-41b Light Curves&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">hours</span><span class="p">,</span> <span class="n">lc_counts_p1_norm</span><span class="p">,</span> <span class="n">lc_counts_err_p1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Order </span><span class="si">{</span><span class="n">order_p1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">hours</span><span class="p">,</span> <span class="n">lc_counts_m1_norm</span><span class="p">,</span> <span class="n">lc_counts_err_m1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Order </span><span class="si">{</span><span class="n">order_m1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hours from Mid-transit </span><span class="se">\n</span><span class="s1">MJD=</span><span class="si">{</span><span class="n">mjd</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f96430d1750&gt;
</pre></div>
</div>
<img alt="../../../_images/6d212a69da22a75781d28e08bcc22f447710e52064d3c52c286503a9439d8a0d.png" src="../../../_images/6d212a69da22a75781d28e08bcc22f447710e52064d3c52c286503a9439d8a0d.png" />
</div>
</div>
<p>The raw white light curves for the +1 and -1 orders look great! We can also use the above function to generate the spectroscopic light curves by changing the <code class="docutils literal notranslate"><span class="pre">wl_min</span></code> and <code class="docutils literal notranslate"><span class="pre">wl_max</span></code> values.</p>
</section>
<section id="conclusions">
<h2>10. Conclusions<a class="headerlink" href="#conclusions" title="Permalink to this heading">#</a></h2>
<p><a id="summary"></a></p>
<p>Thank you for walking through this notebook. With G280 transit observations, you should now be familiar with:</p>
<ul class="simple">
<li><p>Downloading data from MAST.</p></li>
<li><p>Performing cosmic ray correction and background subtraction for the time-series.</p></li>
<li><p>Performing trace fitting and spectral extraction for G280 data.</p></li>
<li><p>Generating white light curves.</p></li>
</ul>
<p>You can now assemble the G280 transmission spectrum for any exoplanet and for any of the spectral orders. Once you have extracted the white light and spectroscopic light curves, you can use various light curve fitting programs (e.g. <a class="reference external" href="https://pacmandocs.readthedocs.io/en/latest/index.html">PACMAN</a>, <a class="reference external" href="https://github.com/kevin218/WFC3">WFC3 Light Curve Fitting</a>, <a class="reference external" href="https://eurekadocs.readthedocs.io/en/latest/index.html">Eureka!</a>, etc.) to measure the transit depths.</p>
<p><strong>Congratulations, you have completed this tutorial for G280 exoplanet transit data!</strong></p>
</section>
<section id="additional-resources">
<h2>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this heading">#</a></h2>
<p><a id="add"></a></p>
<p>Below are some additional resources that may be helpful. Please send any questions through the <a class="reference external" href="https://stsci.service-now.com/hst">HST Help Desk</a>.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.stsci.edu/hst/instrumentation/wfc3">WFC3 Website</a></p>
<ul>
<li><p><a class="reference external" href="https://www.stsci.edu/hst/instrumentation/wfc3/documentation/grism-resources">WFC3 Grism Resources</a></p></li>
<li><p><a class="reference external" href="https://www.stsci.edu/hst/instrumentation/wfc3/documentation/grism-resources/wfc3-g280-calibrations">G280 Calibration &amp; Reference Files</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://hst-docs.stsci.edu/wfc3ihb">WFC3 Instrument Handbook</a></p>
<ul>
<li><p><a class="reference external" href="https://hst-docs.stsci.edu/wfc3ihb/chapter-8-slitless-spectroscopy-with-wfc3">Chapter 8: Slitless Spectroscopy with WFC3</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://hst-docs.stsci.edu/wfc3dhb">WFC3 Data Handbook</a></p>
<ul>
<li><p><a class="reference external" href="https://hst-docs.stsci.edu/wfc3dhb/chapter-9-wfc3-data-analysis/9-3-spectroscopy">Chapter 9.3: Spectroscopy</a></p></li>
</ul>
</li>
<li><p>Papers</p>
<ul>
<li><p><a class="reference external" href="https://arxiv.org/abs/2003.00536">Into the UV: A precise transmission spectrum of HAT-P-41b using Hubble’s WFC3/UVIS G280 grism (Wakeford et al. 2020)</a></p></li>
<li><p><a class="reference external" href="https://arxiv.org/abs/2204.03639">UV Absorption by Silicate Cloud Precursors in Ultra-hot Jupiter WASP-178b (Lothringer et al. 2022)</a></p></li>
<li><p><a class="reference external" href="https://arxiv.org/abs/2410.17368">The HUSTLE Program: The UV to Near-Infrared HST WFC3/UVIS G280 Transmission Spectrum of WASP-127b(Boehm et al. 2024)</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/wfc3/documentation/instrument-science-reports-isrs/_documents/2023/WFC3-ISR-2023-06.pdf">WFC3 ISR 2023-06: The WFC3/UVIS G280 Grism Sky (Pagul et al. 2023)</a></p></li>
<li><p><a class="reference external" href="https://github.com/npirzkal/GRISMCONF/tree/master">GRISMCONF</a></p>
<ul>
<li><p><a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/wfc3/documentation/instrument-science-reports-isrs/_documents/2017/WFC3-2017-01.pdf">WFC3 ISR 2017-01: A more generalized coordinate transformation approach for grisms (Pirzkal and Ryan 2017)</a></p></li>
<li><p><a class="reference external" href="https://github.com/npirzkal/GRISM_WFC3/tree/master">GRISM_WFC3: Configuration files</a></p></li>
</ul>
</li>
</ul>
</section>
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this heading">#</a></h2>
<p><a id="about"></a></p>
<p><strong>Author:</strong> Munazza K. Alam, WFC3 &amp; NIRSpec Instrument Teams</p>
<p><strong>Created On:</strong> 2025-02-28</p>
<p><strong>Updated On:</strong> 2025-03-25; Fred Dauphin, WFC3 Team</p>
</section>
<section id="citations">
<h2>Citations<a class="headerlink" href="#citations" title="Permalink to this heading">#</a></h2>
<p><a id="cite"></a>
If you use the following packages for published research, please cite the authors. The links below contain for more information about citing the following:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/citing-numpy/">Citing <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/stable/project/citing.html">Citing <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.astropy.org/acknowledging.html">Citing <code class="docutils literal notranslate"><span class="pre">astropy</span></code></a></p></li>
<li><p><a class="reference external" href="https://github.com/astropy/astroquery/blob/main/astroquery/CITATION">Citing <code class="docutils literal notranslate"><span class="pre">astroquery</span></code></a></p></li>
<li><p><a class="reference external" href="https://photutils.readthedocs.io/en/latest/getting_started/citation.html">Citing <code class="docutils literal notranslate"><span class="pre">photutils</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/wfc3/documentation/instrument-science-reports-isrs/_documents/2017/WFC3-2017-01.pdf">Citing <code class="docutils literal notranslate"><span class="pre">grismconf</span></code></a></p></li>
</ul>
<hr class="docutils" />
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/hst_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/WFC3/uvis_g280_transit"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../persistence/wfc3_ir_persistence.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Masking Persistence in WFC3/IR Images</p>
      </div>
    </a>
    <a class="right-next"
       href="../ir_tvb.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">WFC3/IR Time Variable Background (TVB)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">1. Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-grism-observations-from-mast">2. Downloading Grism Observations from MAST</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#direct-image">2.1 Direct Image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-g280-spectrum">2.2 Example G280 Spectrum</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examining-the-time-series">2.3 Examining the Time-Series</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background-subtraction">3. Background Subtraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cosmic-ray-correction">4. Cosmic Ray Correction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#embedding-subarrays">5. Embedding Subarrays</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spectral-trace-fitting">6. Spectral Trace Fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#g280-spectral-extraction">7. G280 Spectral Extraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-1d-time-series-stellar-spectra">8. Extracting 1D Time-Series Stellar Spectra</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-light-curves">9. Generating Light Curves</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">10. Conclusions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources">Additional Resources</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>