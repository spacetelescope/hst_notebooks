

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>WFC3/IR IMA Visualization Tools with An Example of Time Variable Background &#8212; HST Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/WFC3/ir_ima_visualization/IR_IMA_Visualization_with_an_Example_of_Time_Variable_Background';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Manual Recalibration with calwf3: Turning off the IR Linear Ramp Fit" href="../calwf3_recalibration/calwf3_recal_tvb.html" />
    <link rel="prev" title="WFC3/IR Time Variable Background (TVB)" href="../ir_tvb.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="HST Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="HST Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    STScI HST Notebook Repository HQ
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">ACS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../ACS/README.html">ACS Notebooks</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_findsat_mrt/acs_findsat_mrt_example.html">Satellite trail detection in ACS/WFC data using acstools.findsat_mrt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_saturation_trails/acs_saturation_trails.html">ACS Linearity with Saturated Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_cte_forward_model/acs_cte_forward_model_example.html">Pixel-based ACS/WFC CTE Forward Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_subarrays/acs_subarrays.html">ACS Image Reduction for Subarray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_sbc_dark_analysis/acs_sbc_dark_analysis.html">SBC Dark Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_reduction/acs_reduction.html">ACS/WFC Image Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_pixel_area_maps/acs_pixel_area_maps.html">Obtaining Pixel Area Maps for ACS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_polarization_tools/acs_polarization_tools.html">Using ACS Polarization Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ACS/acs_focus_diverse_epsfs/acs_focus_diverse_epsfs.html">Focus Diverse ePSFs for ACS/WFC</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">COS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../COS/README.html">COS Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COS/Setup/Setup.html">Setting up your computer environment for working with COS data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/DataDl/DataDl.html">Downloading COS Data</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../COS/ViewData/ViewData.html">Viewing COS Data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/AsnFile/AsnFile.html">Modifying or Creating an Association File</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/CalCOS/CalCOS.html">Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)</a></li>






<li class="toctree-l1"><a class="reference internal" href="../../COS/SplitTag/SplitTag.html">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></a></li>







<li class="toctree-l1"><a class="reference internal" href="../../COS/DayNight/DayNight.html">Filtering out COS Data taken during the Day or Night</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COS/LSF/LSF.html">Working with the COS Line Spread Function (LSF)</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../COS/Extract/Extract.html">Editing the extraction boxes in a spectral extraction file (<code class="docutils literal notranslate"><span class="pre">XTRACTAB</span></code>)</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">DrizzlePac</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/README.html">DrizzlePac Jupyter Notebook Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/Initialization/Initialization.html">DrizzlePac Initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_to_catalogs/align_to_catalogs.html">Aligning HST images to an Absolute Reference Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_mosaics/align_mosaics.html">Aligning HST Mosaics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_multiple_visits/align_multiple_visits.html">Optimizing Image Alignment for Multiple HST Visits</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_sparse_fields/align_sparse_fields.html">Aligning Deep Exposures of Sparse Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/drizzle_wfpc2/drizzle_wfpc2.html">Drizzling WFPC2 Images to use a Single Zeropoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/mask_satellite/mask_satellite.html">Satellite Trail Masking Techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/optimize_image_sampling/optimize_image_sampling.html">Optimizing the Image Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/sky_matching/sky_matching.html">Sky Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/use_ds9_regions_in_tweakreg/use_ds9_regions_in_tweakreg.html">TWEAKREG Tips - Using DS9 Regions for Source Inclusion/Exclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/using_updated_astrometry_solutions/using_updated_astrometry_solutions.html">Using updated astrometry solutions</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HASP</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../HASP/Setup/Setup.html">Installing the Hubble Advanced Spectral Products Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../HASP/CoaddTutorial/CoaddTutorial.html">Inputting User Data using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/FluxScaleTutorial/FluxScaleTutorial.html">Scaling Flux while using the Hubble Advanced Spectral Products Script</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HASP/DataDiagnostic/DataDiagnostics.html">HASP Data Diagnostic Notebook</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NICMOS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html">Programmatic Replacements for NICMOS Units Conversion Form</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">STIS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../STIS/README.html">STIS-Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/cross-correlation/cross-correlation.html">Correcting for Missing Wavecals with Cross-Correlation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/custom_ccd_darks/custom_ccd_darks.html">Custom CCD Darks <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/drizpac_notebook/STIS_DrizzlePac_Tutorial.html">STIS DrizzlePac Tutorial <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/CoronagraphyViz/STIS_Coronagraphy_Visualization_v2.html">STIS Coronagraphy Visualization Tool (v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/calstis/calstis_2d_ccd.html">Calstis 2-D CCD Data Reduction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/target_acquisition/target_acquisition.html">Evaluating STIS Target Acquisitions <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/view_data/view_data.html">Viewing STIS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/extraction/1D_Extraction.html">1D Spectra Extraction <a class="tocSkip"></a></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">WFC3</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../README.html">WFC3 Notebooks</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../general_tools.html">General Tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../image_displayer_analyzer/wfc3_image_displayer_analyzer.html">WFC3 Image Displayer &amp; Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exception_report/wfc3_exception_report.html">Exception Report Checklist - WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calwf3_v1.0_cte/calwf3_with_v1.0_PCTE.html">Processing WFC3/UVIS Data with <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> Using the v1.0 CTE-Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../persistence/wfc3_ir_persistence.html">Masking Persistence in WFC3/IR Images</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../ir_tvb.html">WFC3/IR Time Variable Background (TVB)</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">WFC3/IR IMA Visualization Tools with An Example of Time Variable Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calwf3_recalibration/calwf3_recal_tvb.html">Manual Recalibration with calwf3: Turning off the IR Linear Ramp Fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tvb_flattenramp/TVB_flattenramp_notebook.html">Correcting for Helium Line Emission Background in IR Exposures using the “Flatten-Ramp” Technique</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ir_scattered_light_calwf3_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_Using_calwf3_to_Mask_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Using <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> to Mask Bad Reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ir_scattered_light_manual_corrections/Correcting_for_Scattered_Light_in_IR_Exposures_by_Manually_Subtracting_Bad_Reads.html">Correcting for Scattered Light in WFC3/IR Exposures: Manually Subtracting Bad Reads</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../photometry.html">Photometry</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../filter_transformations/filter_transformations.html">WFC3/UVIS Filter Transformations with stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flux_conversion_tool/flux_conversion_tool.html">Flux Unit Conversions with synphot and stsynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../photometry_examples/phot_examples.html">Synthetic Photometry Examples for WFC3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uvis_time_dependent_photometry/uvis_timedep_phot.html">WFC3/UVIS Time-dependent Photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zeropoints/zeropoints.html">Calculating WFC3 Zeropoints with STSynphot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uvis_pam_corrections/WFC3_UVIS_Pixel_Area_Map_Corrections_for_Subarrays.html">WFC3/UVIS Pixel Area Map Corrections for Subarrays</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../point_spread_function.html">HST WFC3 Point Spread Function Modeling</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../point_spread_function/hst_point_spread_function.html">HST WFC3 Point Spread Function Modeling   </a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/spacetelescope/hst_notebooks/blob/main/notebooks/WFC3/ir_ima_visualization/IR_IMA_Visualization_with_an_Example_of_Time_Variable_Background.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/WFC3/ir_ima_visualization/IR_IMA_Visualization_with_an_Example_of_Time_Variable_Background.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/WFC3/ir_ima_visualization/IR_IMA_Visualization_with_an_Example_of_Time_Variable_Background.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>WFC3/IR IMA Visualization Tools with An Example of Time Variable Background</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-id-intro-a">Introduction <a id="intro"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-a-id-import-a">1. Imports <a id="import"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-data-a-id-main-a">2. Downloading Data <a id="main"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-example-multiaccum-observation-a-id-load-a">2.1 Download Example MULTIACCUM Observation <a id="load"></a></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wfc3-ir-file-information-a-id-file-a">2.2 WFC3/IR File Information <a id="file"></a></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-individual-reads-of-ima-images-a-id-vis-a">3. Visualizing Individual Reads of IMA Images<a id="vis"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#taking-the-difference-between-ima-reads-the-cumulative-rate-a-id-cumulative-a">4. Taking the Difference Between IMA Reads: The Cumulative Rate <a id="cumulative"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-more-accurate-difference-between-reads-the-instantaneous-rate-a-id-instantaneous-a">5. A More Accurate Difference Between Reads: The Instantaneous Rate <a id="instantaneous"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions-a-id-conclusions-a">6.  Conclusions <a id="conclusions"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources-a-id-add-a">Additional Resources <a id="add"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook-a-id-about-a">About this Notebook <a id="about"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations-a-id-cite-a">Citations <a id="cite"></a></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><a id="top"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="wfc3-ir-ima-visualization-tools-with-an-example-of-time-variable-background">
<h1>WFC3/IR IMA Visualization Tools with An Example of Time Variable Background<a class="headerlink" href="#wfc3-ir-ima-visualization-tools-with-an-example-of-time-variable-background" title="Permalink to this heading">#</a></h1>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Permalink to this heading">#</a></h2>
<p>The main purpose of this notebook is to familiarize users with the structure of the WFC3/IR IMA files, to visualize individual reads and the difference between reads, and to plot the cumulative signal and count rate throughout the MULTIACCUM exposure. These visualization tools may be used to identify issues with the data, for example, a <a class="reference external" href="https://archive.stsci.edu/cgi-bin/mastpreview?mission=hst&amp;dataid=ID7002010">guidestar (GS) failure</a>, a <a class="reference external" href="https://archive.stsci.edu/cgi-bin/mastpreview?mission=hst&amp;dataid=IB5X02030">satellite trail</a> in a specific read, or time variable background, which may take the form of scattered light or He I 10830 Å airglow line emission.</p>
<p>This notebook walks through:</p>
<ul class="simple">
<li><p>Exploring WFC3/IR IMA Data Structure;</p></li>
<li><p>How to find and select individual reads in an IMA file;</p></li>
<li><p>How to show individual reads as images;</p></li>
<li><p>Plotting the signal ramp through subsequent reads;</p></li>
<li><p>Plotting the difference in signal between reads using two different methods.</p></li>
</ul>
</section>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">#</a></h2>
<p><span class="xref myst">Introduction</span> <br>
<span class="xref myst">1. Imports</span> <br>
<span class="xref myst">2. Downloading Data</span> <br></p>
<ul class="simple">
<li><p><span class="xref myst">2.1 Download Example MULTIACCUM Observation</span> <br></p></li>
<li><p><span class="xref myst">2.2 WFC3/IR File Information</span> <br></p></li>
</ul>
<p><span class="xref myst">3. Visualizing Individual Reads of IMA Images</span> <br>
<span class="xref myst">4. Taking the Difference Between Reads: The Cumulative Rate</span> <br>
<span class="xref myst">5. A More Accurate Difference Between Reads: The Instantaneous Rate</span> <br></p>
<p><span class="xref myst">6. Conclusions</span><br>
<span class="xref myst">Additional Resources</span> <br>
<span class="xref myst">About this Notebook</span> <br>
<span class="xref myst">Citations</span> <br></p>
</section>
<section id="introduction-a-id-intro-a">
<h2>Introduction <a id="intro"></a><a class="headerlink" href="#introduction-a-id-intro-a" title="Permalink to this heading">#</a></h2>
<p><strong>Observing with the WFC3/IR MULTIACCUM Mode</strong></p>
<p>As discussed in section <a class="reference external" href="https://hst-docs.stsci.edu/wfc3ihb/chapter-7-ir-imaging-with-wfc3/7-7-ir-exposure-and-readout">7.7 of the WFC3 Instrument Handbook</a>, the only observing mode available for the WFC3/IR channel is the MULTIACCUM mode, which samples the signal multiple times as an exposure accumulates. Exposures are taken in “a sequence of non-destructive reads specified by the user from a variety of pre-defined configurations with both constant (SPARS) and increasing (STEP) time intervals between subsequent reads. At the time of each read,
the accumulated charge on each pixel is recorded and this charge accumulation history for
a given exposure — the ‘ramp’ — is recorded in the RAW data files.” The maximum number of reads (following the zero read) during an exposure is 15, which are collected as the signal ramps up.</p>
<p>Multiple readouts in the MULTIACCUM mode are advantageous for three key reasons. First, they increase the dynamic range of the image. The signal in a pixel that is saturated by the end of the exposure is recorded multiple times, including before saturation. Second, cosmic-ray events that occur throughout the exposure can be anaylzed and identified in individual reads and subsequently removed. Finally, by fitting to multiple reads, one can reduce the effective read noise in an observation.</p>
<p>See section <a class="reference external" href="https://hst-docs.stsci.edu/wfc3ihb/chapter-7-ir-imaging-with-wfc3/7-7-ir-exposure-and-readout">7.7 of the WFC3 Instrument Handbook</a> for more details.</p>
<p><strong>Time-Variable Background in the WFC3/IR Channel</strong></p>
<p>In WFC3/IR images, the sky background may be comprised of one or more of the following components: zodiacal light, <a class="reference external" href="https://hst-docs.stsci.edu/wfc3dhb/chapter-7-wfc3-ir-sources-of-error/7-10-time-variable-background">scattered light from the bright Earth limb</a>, and <a class="reference external" href="https://hst-docs.stsci.edu/wfc3dhb/chapter-7-wfc3-ir-sources-of-error/7-10-time-variable-background">He I 10830 Å airglow line emission</a> from helium atoms excited by sunlight in the Earth’s upper atmosphere. The zodiacal light, which depends on the orientation of the target with respect to the sun, varies throughout the year but is effectively constant within a given exposure/orbit/visit. However, the scattered light and line emission components can vary within an orbit and even within a single exposure, leading to a background that varies with time. In this notebook, we will show an example of time-variable background due to Earth limb scattered light (made when HST is pointing near the bright Earth limb), which results in a spatially variable signal with the leftmost (x&lt;400) columns of the detector being subject to background levels up to twice as bright as that on the rest of the chip.</p>
<p>In the following sections, we show how to identify the impacted reads. In future <a class="reference external" href="https://github.com/spacetelescope/WFC3Library">WFC3 Library</a> notebooks, Correcting for Scattered Light in WFC3/IR Exposures: Using <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> to Exclude Bad Reads (O’Connor, in prep.) and Correcting for Scattered Light in IR Exposures: Manually Excluding Bad Reads (O’Connor, in prep.), we show how to reprocess the exposure while excluding those reads. Here, we show how to compute and plot the median background rate (e.g. the difference between IMA reads) and we compare the background in different regions of the detector.</p>
<p>See section <a class="reference external" href="https://hst-docs.stsci.edu/wfc3dhb/chapter-7-wfc3-ir-sources-of-error/7-10-time-variable-background">7.10 of the WFC3 Data Handbook</a> for more details.</p>
</section>
<section id="imports-a-id-import-a">
<h2>1. Imports <a id="import"></a><a class="headerlink" href="#imports-a-id-import-a" title="Permalink to this heading">#</a></h2>
<p>We use the following libraries:</p>
<ul class="simple">
<li><p><em>os</em> for splitting file paths</p></li>
<li><p><em>numpy</em> for handling array functions</p></li>
<li><p><em>matplotlib.pyplot</em> for plotting data</p></li>
<li><p><em>astropy.io fits</em> for accessing FITS files</p></li>
<li><p><em>astroquery</em> for downlaoding data from MAST</p></li>
</ul>
<p>We import the following module:</p>
<ul class="simple">
<li><p><em>ima_visualization_and_differencing</em> to take the difference between reads, plot the ramp, and to visualize the difference in images</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">import</span> <span class="nn">ima_visualization_and_differencing</span> <span class="k">as</span> <span class="nn">diff</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
<section id="downloading-data-a-id-main-a">
<h2>2. Downloading Data <a id="main"></a><a class="headerlink" href="#downloading-data-a-id-main-a" title="Permalink to this heading">#</a></h2>
<section id="download-example-multiaccum-observation-a-id-load-a">
<h3>2.1 Download Example MULTIACCUM Observation <a id="load"></a><a class="headerlink" href="#download-example-multiaccum-observation-a-id-load-a" title="Permalink to this heading">#</a></h3>
<p>Here, we download two consecutive exposures from image association ‘ICQTBB020’ acquired in visit BB of program <a class="reference external" href="https://www.stsci.edu/hst/observing/program-information">14037</a>. This visit consists of two orbits of two exposures each, and we focus on the second orbit which contains two identical images of the target (filter=F140W, SAMP-SEQ=SPARS100, NSAMP=16). The first exposure ‘icqtbbbxq’ was acquired in the first half of the orbit and is strongly contaminated by scattered light. The second exposure ‘icqtbbc0q’ was acquired during the second half of the orbit and allows us to compare what one would see in a nominal image.</p>
<p>When running this notebook, these dataset names may be replaced with your own observations. If running this notebook with just one observation, note that simple changes to each cell will allow you to run the notebook with just one image (these changes are suggested within each cell). We recommend that you step through this notebook first using the example observations given below.</p>
<p>Let’s query for the IR images using MAST, selecting both the IMA and FLT data products from the two exposures: ‘icqtbbbxq’ and ‘icqtbbc0q’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EX_OBS</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">obs_id</span><span class="o">=</span><span class="s1">&#39;ICQTBB020&#39;</span><span class="p">)</span>
<span class="n">EXOBS_Prods</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">EX_OBS</span><span class="p">)</span>
<span class="n">yourProd</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">EXOBS_Prods</span><span class="p">,</span> <span class="n">obs_id</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;icqtbbbxq&#39;</span><span class="p">,</span> <span class="s1">&#39;icqtbbc0q&#39;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;_flt.fits&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yourProd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table masked=True length=4</i>
<table id="table139663625638352" class="table-striped table-bordered table-condensed">
<thead><tr><th>obsID</th><th>obs_collection</th><th>dataproduct_type</th><th>obs_id</th><th>description</th><th>type</th><th>dataURI</th><th>productType</th><th>productGroupDescription</th><th>productSubGroupDescription</th><th>productDocumentationURL</th><th>project</th><th>prvversion</th><th>proposal_id</th><th>productFilename</th><th>size</th><th>parent_obsid</th><th>dataRights</th><th>calib_level</th></tr></thead>
<thead><tr><th>str8</th><th>str3</th><th>str5</th><th>str35</th><th>str62</th><th>str1</th><th>str67</th><th>str9</th><th>str28</th><th>str11</th><th>str1</th><th>str7</th><th>str19</th><th>str5</th><th>str50</th><th>int64</th><th>str8</th><th>str6</th><th>int64</th></tr></thead>
<tr><td>25006494</td><td>HST</td><td>image</td><td>icqtbbbxq</td><td>DADS IMA file - Intermediate Mult-Accum WFC3/NICMOS</td><td>S</td><td>mast:HST/product/icqtbbbxq_ima.fits</td><td>AUXILIARY</td><td>--</td><td>IMA</td><td>--</td><td>CALWF3</td><td>3.7.1 (Oct-18-2023)</td><td>14037</td><td>icqtbbbxq_ima.fits</td><td>168261120</td><td>25007139</td><td>PUBLIC</td><td>2</td></tr>
<tr><td>25006494</td><td>HST</td><td>image</td><td>icqtbbbxq</td><td>DADS FLT file - Calibrated exposure ACS/WFC3/STIS/COS</td><td>S</td><td>mast:HST/product/icqtbbbxq_flt.fits</td><td>SCIENCE</td><td>--</td><td>FLT</td><td>--</td><td>CALWF3</td><td>3.7.1 (Oct-18-2023)</td><td>14037</td><td>icqtbbbxq_flt.fits</td><td>16583040</td><td>25007139</td><td>PUBLIC</td><td>2</td></tr>
<tr><td>25006495</td><td>HST</td><td>image</td><td>icqtbbc0q</td><td>DADS IMA file - Intermediate Mult-Accum WFC3/NICMOS</td><td>S</td><td>mast:HST/product/icqtbbc0q_ima.fits</td><td>AUXILIARY</td><td>--</td><td>IMA</td><td>--</td><td>CALWF3</td><td>3.7.1 (Oct-18-2023)</td><td>14037</td><td>icqtbbc0q_ima.fits</td><td>168261120</td><td>25007139</td><td>PUBLIC</td><td>2</td></tr>
<tr><td>25006495</td><td>HST</td><td>image</td><td>icqtbbc0q</td><td>DADS FLT file - Calibrated exposure ACS/WFC3/STIS/COS</td><td>S</td><td>mast:HST/product/icqtbbc0q_flt.fits</td><td>SCIENCE</td><td>--</td><td>FLT</td><td>--</td><td>CALWF3</td><td>3.7.1 (Oct-18-2023)</td><td>14037</td><td>icqtbbc0q_flt.fits</td><td>16583040</td><td>25007139</td><td>PUBLIC</td><td>2</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">yourProd</span><span class="p">,</span> <span class="n">mrp_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/icqtbbbxq_ima.fits to ./mastDownload/HST/icqtbbbxq/icqtbbbxq_ima.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/icqtbbbxq_flt.fits to ./mastDownload/HST/icqtbbbxq/icqtbbbxq_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/icqtbbc0q_ima.fits to ./mastDownload/HST/icqtbbc0q/icqtbbc0q_ima.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/icqtbbc0q_flt.fits to ./mastDownload/HST/icqtbbc0q/icqtbbc0q_flt.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output text_html"><div><i>Table length=4</i>
<table id="table139664163963344" class="table-striped table-bordered table-condensed">
<thead><tr><th>Local Path</th><th>Status</th><th>Message</th><th>URL</th></tr></thead>
<thead><tr><th>str47</th><th>str8</th><th>object</th><th>object</th></tr></thead>
<tr><td>./mastDownload/HST/icqtbbbxq/icqtbbbxq_ima.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/icqtbbbxq/icqtbbbxq_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/icqtbbc0q/icqtbbc0q_ima.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
<tr><td>./mastDownload/HST/icqtbbc0q/icqtbbc0q_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
</table></div></div></div>
</div>
</section>
<section id="wfc3-ir-file-information-a-id-file-a">
<h3>2.2 WFC3/IR File Information <a id="file"></a><a class="headerlink" href="#wfc3-ir-file-information-a-id-file-a" title="Permalink to this heading">#</a></h3>
<p>The figure below shows the WFC3/IR file structure corresponding to <a class="reference external" href="https://hst-docs.stsci.edu/wfc3dhb/chapter-2-wfc3-data-structure/2-2-wfc3-file-structure">Figure 2.4 of the Data Handbook</a>. Note that for WFC3/IR data, each read or image set (IMSET) consists of five data arrays: SCI, ERR, DQ, SAMP, TIME. Consecutive MULTIACCUM readouts are stored in reverse chronological order, with [SCI,1] corresponding to the final, cumulative exposure.</p>
<img alt="Diagram of WFC3/IR Data Format, consisting of four columns representing each IMA read, made up of a science array, an error array, DQ array, and integration time." src="../../../_images/ir_data_format.png" />
<p>The table below lists the IMSET, SAMPNUM, and SAMPTIME for a WFC3/IR SPARS100 exposure, modified from <a class="reference external" href="https://hst-docs.stsci.edu/wfc3ihb/chapter-7-ir-imaging-with-wfc3/7-7-ir-exposure-and-readout">Section 7.7 of the Instrument Handbook</a>. Note that the image header keyword NSAMP reports a value of 16, but there are actually 15 science reads in the IMA file, following the 0th read (which has an exposure time of 0). While NSAMP keyword is reported in the primary header (extension 0), the SAMPNUM and SAMPTIME keywords may be found in the science header of each read, and these report the read (IMSET) number and the cumulative exposure time of each respective read.</p>
<p>This table is similar to <a class="reference external" href="https://hst-docs.stsci.edu/wfc3ihb/chapter-7-ir-imaging-with-wfc3/7-7-ir-exposure-and-readout#id-7.7IRExposureandReadout-table7.8">Table 7.7</a>, except that the column labelled NSAMP in the handbook is really the SAMPNUM. Note that we have added a row at the top of the table to highlight that IMSET [SCI,16] corresponds to the 0th read.</p>
<img alt="Table detailing the relationship between 'IMSET', SAMPNUM, and integration time for successive reads in an WFC3/IR image taken at a SPARS100 sample sequence." src="../../../_images/SAMPNUM_Table.png" />
</section>
</section>
<section id="visualizing-individual-reads-of-ima-images-a-id-vis-a">
<h2>3. Visualizing Individual Reads of IMA Images<a id="vis"></a><a class="headerlink" href="#visualizing-individual-reads-of-ima-images-a-id-vis-a" title="Permalink to this heading">#</a></h2>
<p>Next, let’s check out the file structure of our WFC3/IR IMA FITS files. We define the paths to our images here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ima_scattered</span> <span class="o">=</span> <span class="s1">&#39;mastDownload/HST/icqtbbbxq/icqtbbbxq_ima.fits&#39;</span>
<span class="n">flt_scattered</span> <span class="o">=</span> <span class="s1">&#39;mastDownload/HST/icqtbbbxq/icqtbbbxq_flt.fits&#39;</span>
<span class="n">ima_nominal</span> <span class="o">=</span> <span class="s1">&#39;mastDownload/HST/icqtbbc0q/icqtbbc0q_ima.fits&#39;</span>
<span class="n">flt_nominal</span> <span class="o">=</span> <span class="s1">&#39;mastDownload/HST/icqtbbc0q/icqtbbc0q_flt.fits&#39;</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ima_scattered</span><span class="p">)</span>
<span class="n">image</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filename: mastDownload/HST/icqtbbbxq/icqtbbbxq_ima.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU     266   ()      
  1  SCI           1 ImageHDU        81   (1024, 1024)   float32   
  2  ERR           1 ImageHDU        43   (1024, 1024)   float32   
  3  DQ            1 ImageHDU        35   (1024, 1024)   int16   
  4  SAMP          1 ImageHDU        30   ()      
  5  TIME          1 ImageHDU        30   ()      
  6  SCI           2 ImageHDU        81   (1024, 1024)   float32   
  7  ERR           2 ImageHDU        43   (1024, 1024)   float32   
  8  DQ            2 ImageHDU        35   (1024, 1024)   int16   
  9  SAMP          2 ImageHDU        30   ()      
 10  TIME          2 ImageHDU        30   ()      
 11  SCI           3 ImageHDU        81   (1024, 1024)   float32   
 12  ERR           3 ImageHDU        43   (1024, 1024)   float32   
 13  DQ            3 ImageHDU        35   (1024, 1024)   int16   
 14  SAMP          3 ImageHDU        30   ()      
 15  TIME          3 ImageHDU        30   ()      
 16  SCI           4 ImageHDU        81   (1024, 1024)   float32   
 17  ERR           4 ImageHDU        43   (1024, 1024)   float32   
 18  DQ            4 ImageHDU        35   (1024, 1024)   int16   
 19  SAMP          4 ImageHDU        30   ()      
 20  TIME          4 ImageHDU        30   ()      
 21  SCI           5 ImageHDU        81   (1024, 1024)   float32   
 22  ERR           5 ImageHDU        43   (1024, 1024)   float32   
 23  DQ            5 ImageHDU        35   (1024, 1024)   int16   
 24  SAMP          5 ImageHDU        30   ()      
 25  TIME          5 ImageHDU        30   ()      
 26  SCI           6 ImageHDU        81   (1024, 1024)   float32   
 27  ERR           6 ImageHDU        43   (1024, 1024)   float32   
 28  DQ            6 ImageHDU        35   (1024, 1024)   int16   
 29  SAMP          6 ImageHDU        30   ()      
 30  TIME          6 ImageHDU        30   ()      
 31  SCI           7 ImageHDU        81   (1024, 1024)   float32   
 32  ERR           7 ImageHDU        43   (1024, 1024)   float32   
 33  DQ            7 ImageHDU        35   (1024, 1024)   int16   
 34  SAMP          7 ImageHDU        30   ()      
 35  TIME          7 ImageHDU        30   ()      
 36  SCI           8 ImageHDU        81   (1024, 1024)   float32   
 37  ERR           8 ImageHDU        43   (1024, 1024)   float32   
 38  DQ            8 ImageHDU        35   (1024, 1024)   int16   
 39  SAMP          8 ImageHDU        30   ()      
 40  TIME          8 ImageHDU        30   ()      
 41  SCI           9 ImageHDU        81   (1024, 1024)   float32   
 42  ERR           9 ImageHDU        43   (1024, 1024)   float32   
 43  DQ            9 ImageHDU        35   (1024, 1024)   int16   
 44  SAMP          9 ImageHDU        30   ()      
 45  TIME          9 ImageHDU        30   ()      
 46  SCI          10 ImageHDU        81   (1024, 1024)   float32   
 47  ERR          10 ImageHDU        43   (1024, 1024)   float32   
 48  DQ           10 ImageHDU        35   (1024, 1024)   int16   
 49  SAMP         10 ImageHDU        30   ()      
 50  TIME         10 ImageHDU        30   ()      
 51  SCI          11 ImageHDU        81   (1024, 1024)   float32   
 52  ERR          11 ImageHDU        43   (1024, 1024)   float32   
 53  DQ           11 ImageHDU        35   (1024, 1024)   int16   
 54  SAMP         11 ImageHDU        30   ()      
 55  TIME         11 ImageHDU        30   ()      
 56  SCI          12 ImageHDU        81   (1024, 1024)   float32   
 57  ERR          12 ImageHDU        43   (1024, 1024)   float32   
 58  DQ           12 ImageHDU        35   (1024, 1024)   int16   
 59  SAMP         12 ImageHDU        30   ()      
 60  TIME         12 ImageHDU        30   ()      
 61  SCI          13 ImageHDU        81   (1024, 1024)   float32   
 62  ERR          13 ImageHDU        43   (1024, 1024)   float32   
 63  DQ           13 ImageHDU        35   (1024, 1024)   int16   
 64  SAMP         13 ImageHDU        30   ()      
 65  TIME         13 ImageHDU        30   ()      
 66  SCI          14 ImageHDU        81   (1024, 1024)   float32   
 67  ERR          14 ImageHDU        43   (1024, 1024)   float32   
 68  DQ           14 ImageHDU        35   (1024, 1024)   int16   
 69  SAMP         14 ImageHDU        30   ()      
 70  TIME         14 ImageHDU        30   ()      
 71  SCI          15 ImageHDU        81   (1024, 1024)   float32   
 72  ERR          15 ImageHDU        43   (1024, 1024)   float32   
 73  DQ           15 ImageHDU        35   (1024, 1024)   int16   
 74  SAMP         15 ImageHDU        30   ()      
 75  TIME         15 ImageHDU        30   ()      
 76  SCI          16 ImageHDU        81   (1024, 1024)   float32   
 77  ERR          16 ImageHDU        43   (1024, 1024)   float32   
 78  DQ           16 ImageHDU        35   (1024, 1024)   int16   
 79  SAMP         16 ImageHDU        30   ()      
 80  TIME         16 ImageHDU        30   ()      
</pre></div>
</div>
</div>
</div>
<p>As we can see, the IMA contains 16 science (SCI) extensions or IMSETS, recorded in <em>reverse chronological</em> order in the file. For this observation, the “0th” read corresponds to the extension 76 or the 16th science extenstion, e.g. [SCI,16]. In the cells below, we show how to query the NSAMP and SAMPNUM keywords in the image headers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prihdr</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
<span class="n">NSAMP</span> <span class="o">=</span> <span class="n">prihdr</span><span class="p">[</span><span class="s1">&#39;NSAMP&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The total number of reads (including the 0th) is </span><span class="si">{</span><span class="n">NSAMP</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The total number of reads (including the 0th) is 16.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sci16hdr</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
<span class="n">SAMPNUM_sci16</span> <span class="o">=</span> <span class="n">sci16hdr</span><span class="p">[</span><span class="s1">&#39;SAMPNUM&#39;</span><span class="p">]</span>
<span class="n">SAMPTIME_sci16</span> <span class="o">=</span> <span class="n">sci16hdr</span><span class="p">[</span><span class="s1">&#39;SAMPTIME&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For sample number </span><span class="si">{</span><span class="n">SAMPNUM_sci16</span><span class="si">}</span><span class="s1">, the exposure time is </span><span class="si">{</span><span class="n">SAMPTIME_sci16</span><span class="si">}</span><span class="s1">s.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For sample number 0, the exposure time is 0.0s.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sci1hdr</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
<span class="n">SAMPNUM_sci1</span> <span class="o">=</span> <span class="n">sci1hdr</span><span class="p">[</span><span class="s1">&#39;SAMPNUM&#39;</span><span class="p">]</span>
<span class="n">SAMPTIME_sci1</span> <span class="o">=</span> <span class="n">sci1hdr</span><span class="p">[</span><span class="s1">&#39;SAMPTIME&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For sample number </span><span class="si">{</span><span class="n">SAMPNUM_sci1</span><span class="si">}</span><span class="s1">, the exposure time is </span><span class="si">{</span><span class="n">SAMPTIME_sci1</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">s.&#39;</span><span class="p">)</span>

<span class="n">image</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For sample number 15, the exposure time is 1402.937s.
</pre></div>
</div>
</div>
</div>
<p>The 0th read [SCI,16] is taken at 0 seconds, while the 1st read [SCI,15] is taken just a few seconds after exposure start. Since it takes a finite time (2.93 sec) to read the full array, this short read represents the time delay between reading the first and last pixel. The rest of the reads are then taken at the time interval specified by the STEP or SPARS sequence. Here, we have chosen a dataset with SPARS100, which has a time interval of 100 seconds between reads.</p>
<p>Let’s compare the final read of the IMA and the corresponding FLT product for each dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
<span class="n">rows</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">columns</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">ima_scattered</span><span class="p">,</span> <span class="n">flt_scattered</span><span class="p">,</span> <span class="n">ima_nominal</span><span class="p">,</span> <span class="n">flt_nominal</span><span class="p">]</span>

<span class="c1"># If only analyzing one image, please remove the second ima,flt pair from the list</span>
<span class="n">subplot_titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scattered&#39;</span><span class="p">,</span> <span class="s1">&#39;nominal&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">image</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">subplot_titles</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Please change the vmin and vmax values to fit your own data</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
            <span class="n">image</span><span class="p">[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys_r&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/fe28cee25ef1ee168fa5edf686e8e0b77f0ea1591a370f1b4aea5a8857d19c25.png" src="../../../_images/fe28cee25ef1ee168fa5edf686e8e0b77f0ea1591a370f1b4aea5a8857d19c25.png" />
</div>
</div>
<p>Here, we see our target field. In the top row, we can see the scattered light in dataset ‘icqtbbbxq’ affecting the left side of both the IMA and FLT product. In the bottom row, we see the nominal IMA and FLT images for dataset ‘icqtbbc0q’.</p>
<p>Note that FLT images differ from IMA images in that they have had cosmic rays removed by the <a class="reference external" href="https://hst-docs.stsci.edu/wfc3dhb/chapter-3-wfc3-data-calibration/3-3-ir-data-calibration-steps#id-3.3IRDataCalibrationSteps-3.3.10"><code class="docutils literal notranslate"><span class="pre">calwf3</span></code> pipeline</a> via the CRCORR step which performs ‘up-the-ramp’ fitting.</p>
<p>To visually inspect each read of the IMA image, we can use the following snippet of code to create a multi-panel display. Each panel is shown with the same scale in electrons/second (e-/s) to highlight the increasing signal-to-noise in each successive read of the MULTIACCUM exposure. Here, we use the <em>read_wfc</em> funtion found in <em>ima_visualization_and_differencing.py</em> to grab the IMA science data from all reads as a data cube and the integration time as an array.</p>
<p>For a second tutorial on visualizing reads of the MULTIACCUM exposure, see the <a class="reference external" href="https://github.com/spacetelescope/WFC3Library">“IMA Viewer”</a> notebook (Marinelli, in prep.) on the WFC3 Library GitHub. This notebook allows the user to create gifs looping through reads as the signal accumulates, which can be useful for quickly diagnosing any issues with the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">diff</span><span class="o">.</span><span class="n">plot_ima_subplots</span><span class="p">(</span><span class="n">ima_filename</span><span class="o">=</span><span class="n">ima_scattered</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No file by this name found&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/a671415bd55cdb68d6a552f7bac78d911b17b95ddb941289aeb208972113305f.png" src="../../../_images/a671415bd55cdb68d6a552f7bac78d911b17b95ddb941289aeb208972113305f.png" />
</div>
</div>
<p>Above, we see scattered light in every read in the cumulative exposure. In reality (as we will see later in this notebook), the scattered light is present only during the first few reads of the exposure. Because we are plotting reads with an accumulating signal, we see the scattered light affecting all reads of the IMA, even when the scattered light is no longer present. We will see this more clearly when visualizing the difference between reads.</p>
<p>Conversely, when we show individual reads from the nominal IMA file, we see no scattered light (as seen below).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">diff</span><span class="o">.</span><span class="n">plot_ima_subplots</span><span class="p">(</span><span class="n">ima_filename</span><span class="o">=</span><span class="n">ima_nominal</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No file by this name found&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/d862abbfc4c02a1c7a8bf5d6e11b7dddfbe4626723b6a83554bff4d26bd9698c.png" src="../../../_images/d862abbfc4c02a1c7a8bf5d6e11b7dddfbe4626723b6a83554bff4d26bd9698c.png" />
</div>
</div>
<p>To get a better sense of how the MULTIACCUM method works, we can plot the median signal accumulation in electrons up the ramp for both images. The median value works well for sparse fields where the majority of the pixels are sky.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">ima_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">ima_scattered</span><span class="p">,</span> <span class="n">ima_nominal</span><span class="p">]</span> 
<span class="c1"># If only using one image, please remove the extraneous image from this list </span>

<span class="n">marker_select</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span>
<span class="n">color_select</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;C0&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ima</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ima_files</span><span class="p">):</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ima</span><span class="p">)</span>

    <span class="n">cube</span><span class="p">,</span> <span class="n">integ_time</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">read_wfc3</span><span class="p">(</span><span class="n">ima</span><span class="p">)</span>
    <span class="n">median_fullframe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">integ_time</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">median_fullframe</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">*</span><span class="n">integ_time</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
             <span class="n">marker</span><span class="o">=</span><span class="n">marker_select</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> 
             <span class="n">color</span><span class="o">=</span><span class="n">color_select</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Integ. Time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;electrons&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparison of Signal Accumulation Ramp in Nominal vs. Scattered Light Images&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/4235a8299046ee912230dd162fbf29e8bc11e4cb63fcbae23aa881db96c08b5a.png" src="../../../_images/4235a8299046ee912230dd162fbf29e8bc11e4cb63fcbae23aa881db96c08b5a.png" />
</div>
</div>
<p>For dataset ‘icqtbbc0q’ (blue), we see the background signal accumulating linearly with time, whereas for dataset ‘icqtbbbxq’ (black), we see a non-linear background in the first portion of the exposure. ‘icqtbbbxq’ becomes linear in the second portion of the exposure and has the same slope as the nominal exposure.</p>
<p>Next we compare sky values in different regions of the detector (left side, right side, and full frame). If you would like to specify your own regions for the left and right sides of your image, you can change the “lhs_region” and “rhs_region” parameters. Each region must be specified as a dictionary including the four “corners” (x0, x1, y0, and y1) of the region you would like to select. You may want to avoid the edges of the detector which have a large number of bad pixels and higher flat field errors.</p>
<p>Here we compare the full frame ramp for each image with the ramp from the left and right sides of the detector. We compute the median signal from the left side, right side, and full frame image using the <em>get_median_fullframe_lhs_rhs</em> function from the <em>ima_visualization_and_differencing.py</em> module.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">fig</span>
<span class="n">rows</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">columns</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ima_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">ima_scattered</span><span class="p">,</span> <span class="n">ima_nominal</span><span class="p">]</span> 
<span class="c1"># If only using one image, please remove the extraneous image from this list </span>

<span class="n">subplot_titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scattered&#39;</span><span class="p">,</span> <span class="s1">&#39;nominal&#39;</span><span class="p">]</span>

<span class="n">lhs_region</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>
<span class="n">rhs_region</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="mi">700</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">})</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ima</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ima_files</span><span class="p">):</span>

    <span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ima</span><span class="p">)</span>

    <span class="n">cube</span><span class="p">,</span> <span class="n">integ_time</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">read_wfc3</span><span class="p">(</span><span class="n">ima</span><span class="p">)</span>

    <span class="n">median_fullframe</span><span class="p">,</span> <span class="n">median_lhs</span><span class="p">,</span> <span class="n">median_rhs</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">get_median_fullframe_lhs_rhs</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span> 
                                                                                 <span class="n">lhs_region</span><span class="o">=</span><span class="n">lhs_region</span><span class="p">,</span> 
                                                                                 <span class="n">rhs_region</span><span class="o">=</span><span class="n">rhs_region</span><span class="p">)</span>
    
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">integ_time</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">median_fullframe</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">*</span><span class="n">integ_time</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> 
            <span class="n">markersize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Full Frame&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">integ_time</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">median_lhs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">*</span><span class="n">integ_time</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> 
            <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LHS&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">integ_time</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">median_rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">*</span><span class="n">integ_time</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> 
            <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RHS&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1800</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Integ. Time (s)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;electrons&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">subplot_titles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> 
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/a527a6048054ae3c17e40025e3790778975b2cff3606927bb9662358152f6755.png" src="../../../_images/a527a6048054ae3c17e40025e3790778975b2cff3606927bb9662358152f6755.png" />
</div>
</div>
<p>The left panel shows the observation affected by scattered light. By comparing the signal from the left side (orange triangles) and right side (green triangles) of our image, we see that the left side is brighter than the right and that the difference in total counts between the two sides is changing over the exposure. In this case, the difference between the two sides of the image is due to scattered light which varies spatially across the detector. We know the time-variable component is only due to Earth limb scattered light because this filter (F140W) is not affected by the He I 10830 Å airglow line emission (see section <a class="reference external" href="https://hst-docs.stsci.edu/wfc3dhb/chapter-7-wfc3-ir-sources-of-error/7-10-time-variable-background">7.10.2 of the WFC3 Data Handbook</a>). In the following sections, we will identify the impacted reads by looking at the difference in count rates between each read.</p>
<p>The right panel shows the ramp plot for the nominal exposure, and we see that the signal from the left side, right side, and full frame are nearly identical.</p>
<p><strong>Note that, in an image with an extended object, there may be a spatial dependence in the ramp plots (e.g. the right side may be higher than the left), but the slope of the ramp would be linear with time.</strong></p>
</section>
<section id="taking-the-difference-between-ima-reads-the-cumulative-rate-a-id-cumulative-a">
<h2>4. Taking the Difference Between IMA Reads: The Cumulative Rate <a id="cumulative"></a><a class="headerlink" href="#taking-the-difference-between-ima-reads-the-cumulative-rate-a-id-cumulative-a" title="Permalink to this heading">#</a></h2>
<p>Our first method of taking the difference between reads is as simple as subtracting each read from the one before,        e.g. <span class="math notranslate nohighlight">\(\mu\)</span> = [SCI,15]-[SCI,14], [SCI,14]-[SCI,13],… where <span class="math notranslate nohighlight">\(\mu\)</span> represents the median difference.  In the panels below, we now plot the the ramps in units of count rate (e-/s) in order to see how the background changes through the exposure. We use the <em>compute_diff_imas</em> function from the <em>ima_visualization_and_differencing.py</em> module, taking the cumulative difference between reads as described above, and the <em>plot_ramp</em> function from the module, which plots the median difference in count rate from the left side, right side, and full frame image.</p>
<p>(Note that we exclude the 0th read [SCI,16] in our difference calculations.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If only using one image, please remove the extraneous image from this list </span>
<span class="n">lhs_region</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>
<span class="n">rhs_region</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="mi">700</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>
<span class="n">diff</span><span class="o">.</span><span class="n">plot_ramp_subplots</span><span class="p">(</span><span class="n">ima_files</span><span class="o">=</span><span class="p">[</span><span class="n">ima_scattered</span><span class="p">,</span> <span class="n">ima_nominal</span><span class="p">],</span> 
                        <span class="n">difference_method</span><span class="o">=</span><span class="s1">&#39;cumulative&#39;</span><span class="p">,</span> 
                        <span class="n">exclude_sources</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">ylims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> 
                        <span class="n">lhs_region</span><span class="o">=</span><span class="n">lhs_region</span><span class="p">,</span> 
                        <span class="n">rhs_region</span><span class="o">=</span><span class="n">rhs_region</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/e74a418f04774b77701b41de04faecbdfbb96a6c5a713dca75c61b65f9ec38e3.png" src="../../../_images/e74a418f04774b77701b41de04faecbdfbb96a6c5a713dca75c61b65f9ec38e3.png" />
</div>
</div>
<p>The left panel shows a large contribution from scattered light on the left side of the image (orange triangles) during the first portion of the exposure. This difference approaches zero toward the end of the exposure.  The right side of the image also has a slighlty elevated count rate early in the exposure, but not as extreme as the left side.</p>
<p>The right panel shows that the difference in count rate is effectively zero for the nominal image, as expected.</p>
<p>Note that the first data point in both plots has a very large error because we are subtracting from the 1st read (~2.9 seconds), which has very little signal and large errors.</p>
<p>To visualize the excess signal in two dimensions, lets make a panel plot of the differences plotted above. First, we will show the image affected by time-variable background which shows the expected spatial and time variation due to scattered light.  Note that each panel is plotted with a unique zscale to highlight large changes in the signal rate with time. We use the <em>panel_plot</em> function from the <em>ima_visualization_and_differencing.py</em> module.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">lhs_region</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>
    <span class="n">rhs_region</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="mi">700</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>
    <span class="n">diff</span><span class="o">.</span><span class="n">plot_ima_difference_subplots</span><span class="p">(</span><span class="n">ima_filename</span><span class="o">=</span><span class="n">ima_scattered</span><span class="p">,</span> 
                                      <span class="n">difference_method</span><span class="o">=</span><span class="s1">&#39;cumulative&#39;</span><span class="p">,</span> 
                                      <span class="n">lhs_region</span><span class="o">=</span><span class="n">lhs_region</span><span class="p">,</span> 
                                      <span class="n">rhs_region</span><span class="o">=</span><span class="n">rhs_region</span><span class="p">)</span>
    
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No file by this name found&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/41f937dbf9dcbe2396ea6702f0462cef6548bf55fda8409bf860a1ee9acae673.png" src="../../../_images/41f937dbf9dcbe2396ea6702f0462cef6548bf55fda8409bf860a1ee9acae673.png" />
</div>
</div>
<p>Above each panel, we print the median difference <span class="math notranslate nohighlight">\(\mu\)</span> in the count rate over the entire image . Below each panel, we list the IMSET difference, along with the time interval between the two IMSETs.</p>
<p>The statistics in orange (on the left and right side of each panel) give the median rate and standard deviation of each side of the image, respectively. The value in green ‘delta’ is the difference between the left and right side of the image. The value in white “Ratio” gives the ratio of the median difference in orange for the left versus the right side.</p>
<p>Note that, because we took the simple difference in reads, the sources are not visible.  This leaves us with only the sky component, making it easy to identify the time-variable background and whether it is due to scattered light or Helium emission. However, since we’ve subtracted off the first read, we lose any information about the background level at the beginning of the exposure where the scattered light was the highest in this example.</p>
<p>We see a large difference in count rate between the two sides of the image in the earlier reads. This difference decreases with time during the exposure because the scattered light is no longer present in later reads.</p>
<p>Next, lets look at the difference images for the nominal exposure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">lhs_region</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>
    <span class="n">rhs_region</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="mi">700</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>
    <span class="n">diff</span><span class="o">.</span><span class="n">plot_ima_difference_subplots</span><span class="p">(</span><span class="n">ima_filename</span><span class="o">=</span><span class="n">ima_nominal</span><span class="p">,</span> 
                                      <span class="n">difference_method</span><span class="o">=</span><span class="s1">&#39;cumulative&#39;</span><span class="p">,</span> 
                                      <span class="n">lhs_region</span><span class="o">=</span><span class="n">lhs_region</span><span class="p">,</span> 
                                      <span class="n">rhs_region</span><span class="o">=</span><span class="n">rhs_region</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No file by this name found&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/ecc0b6b0a31e539a21fc8b61ffcd767e50a5c82fe12b0b1572403745dd02e79d.png" src="../../../_images/ecc0b6b0a31e539a21fc8b61ffcd767e50a5c82fe12b0b1572403745dd02e79d.png" />
</div>
</div>
<p>As we expect, the differences images are blank (with the exception of a speckled pattern showing cosmic rays and differences in noise between reads). Both ‘delta’(<span class="math notranslate nohighlight">\(\Delta\)</span>) and <span class="math notranslate nohighlight">\(\mu\)</span> are effectively zero in this nominal image. The ratio, in this case, is less useful becuase the signal differences between left and right are close to zero.</p>
</section>
<section id="a-more-accurate-difference-between-reads-the-instantaneous-rate-a-id-instantaneous-a">
<h2>5. A More Accurate Difference Between Reads: The Instantaneous Rate <a id="instantaneous"></a><a class="headerlink" href="#a-more-accurate-difference-between-reads-the-instantaneous-rate-a-id-instantaneous-a" title="Permalink to this heading">#</a></h2>
<p>Here we implement a different technique to examine the count rate difference between consecutive reads. In this case, we first convert from count rate (e-/s) back to counts (e-) before taking the difference, as shown in equation 3 from <a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/wfc3/documentation/instrument-science-reports-isrs/_documents/2018/WFC3-2018-05.pdf">WFC3 ISR 2018-05</a>.</p>
<p><img alt="Instantaneous Difference Equation" src="../../../_images/instantaneous_diff.png" /></p>
<p>One advantage of this method is that it does not remove information about the signal levels at the beginning of the exposure, as in the prior method. Thus the ramp plot below shows a median rate of ~1.5 e-/s for the first two differences instead of ~zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If only using one image, please remove the extraneous image from this list </span>
<span class="n">lhs_region</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>
<span class="n">rhs_region</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="mi">700</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>
<span class="n">diff</span><span class="o">.</span><span class="n">plot_ramp_subplots</span><span class="p">(</span><span class="n">ima_files</span><span class="o">=</span><span class="p">[</span><span class="n">ima_scattered</span><span class="p">,</span> <span class="n">ima_nominal</span><span class="p">],</span> 
                        <span class="n">difference_method</span><span class="o">=</span><span class="s1">&#39;instantaneous&#39;</span><span class="p">,</span> 
                        <span class="n">exclude_sources</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                        <span class="n">ylims</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span> 
                        <span class="n">lhs_region</span><span class="o">=</span><span class="n">lhs_region</span><span class="p">,</span> 
                        <span class="n">rhs_region</span><span class="o">=</span><span class="n">rhs_region</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/945111c541a993d22670f60faee6462d97d9065764c49292509b35e5a4b1ce29.png" src="../../../_images/945111c541a993d22670f60faee6462d97d9065764c49292509b35e5a4b1ce29.png" />
</div>
</div>
<p>In our nominal exposure (right), we see a constant background due to zodiacal light at a level of ~0.9e-/s throughout. For our scattered light exposure (left), we see the same zodiacal light at a level of ~0.9e-/s in later reads, with the scattered light component affecting the first several reads where the median count rate for the left side (orange triangles) is larger than the right side (green triangles).</p>
<p>In the panel plot (below), we see that sources (small galaxies) are visible in the difference images using this new method, whereas in the cumulative difference method they are not. Note that this may complicate the analysis of the spatial background (e.g. left versus right) for images with extended targets, such as large galaxies. In this case, users may wish to adjust the regions of the detector used for the ramp plots. We therefore recommend inspecting both the panel plots as well as the ramp fits for diagnosing any issues with the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">lhs_region</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>
    <span class="n">rhs_region</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="mi">700</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>
    <span class="n">diff</span><span class="o">.</span><span class="n">plot_ima_difference_subplots</span><span class="p">(</span><span class="n">ima_filename</span><span class="o">=</span><span class="n">ima_scattered</span><span class="p">,</span> 
                                      <span class="n">difference_method</span><span class="o">=</span><span class="s1">&#39;instantaneous&#39;</span><span class="p">,</span> 
                                      <span class="n">lhs_region</span><span class="o">=</span><span class="n">lhs_region</span><span class="p">,</span> 
                                      <span class="n">rhs_region</span><span class="o">=</span><span class="n">rhs_region</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No file by this name found&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/71ec2a86a1332b02774ff8387f05f318ab8291e4fa1d013185018b9374557015.png" src="../../../_images/71ec2a86a1332b02774ff8387f05f318ab8291e4fa1d013185018b9374557015.png" />
</div>
</div>
<p>In this figure, we see that the ratio of instantaneous rate for the left versus right side of the image is ~1.0 for all but the first few reads.</p>
<p>In a subsequent notebook, Correcting for Scattered Light in IR Exposures by Reprocessing with Calwf3 (O’Connor, in prep.), we show how to exclude these specific reads from the exposure and reprocess the image with <code class="docutils literal notranslate"><span class="pre">calwf3</span></code>. For this dataset, we exlude the first 6 reads, where the ratio is greater than 1.1 e-/s. While this reduces the total exposure from 1403 to 903 seconds, it removes the spatial component from the sky background and allows for a more accurate ‘up-the-ramp’ fit with <code class="docutils literal notranslate"><span class="pre">calwf3</span></code>.</p>
<p>In a separate notebook, Correcting for Scattered Light in IR Exposures by Manually Removing Bad Data(O’Connor, in prep.), we correct the final image product by manually removing bad reads from the IMA file, again exluding reads where the ratio is greater than 1.1 e-/s.</p>
<p>For comparison, we show the difference images for the nominal exposure (below) which do not show any scattered light artifacts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">diff</span><span class="o">.</span><span class="n">plot_ima_difference_subplots</span><span class="p">(</span><span class="n">ima_filename</span><span class="o">=</span><span class="n">ima_nominal</span><span class="p">,</span> 
                                      <span class="n">difference_method</span><span class="o">=</span><span class="s1">&#39;instantaneous&#39;</span><span class="p">,</span> 
                                      <span class="n">lhs_region</span><span class="o">=</span><span class="n">lhs_region</span><span class="p">,</span> 
                                      <span class="n">rhs_region</span><span class="o">=</span><span class="n">rhs_region</span><span class="p">)</span>
    
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No file by this name found&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/33fc20c9e3506fb7effde53ce9efc2ed304ad9085a40475bf586387f21c61129.png" src="../../../_images/33fc20c9e3506fb7effde53ce9efc2ed304ad9085a40475bf586387f21c61129.png" />
</div>
</div>
</section>
<section id="conclusions-a-id-conclusions-a">
<h2>6.  Conclusions <a id="conclusions"></a><a class="headerlink" href="#conclusions-a-id-conclusions-a" title="Permalink to this heading">#</a></h2>
<p><strong>Congratulations, you have completed the notebook.</strong></p>
<p>You should now be familiar with:</p>
<ul class="simple">
<li><p>How to find and select individual reads in an IMA file</p></li>
<li><p>How to display individual reads</p></li>
<li><p>How to plot the signal accumulation ramp of a WFC3/IR IMA file</p></li>
<li><p>How to plot the difference in signal between reads using two different methods</p></li>
</ul>
<p>This notebook can be used to help identify issues with WFC3/IR images, for example time variable backgrounds. To correct for scattered light background in IR exposures, please see the subsequent notebooks Correcting for Scattered Light in WFC3/IR Exposures: Using <code class="docutils literal notranslate"><span class="pre">calwf3</span></code> to Exclude Bad Reads (O’Connor, in prep.) and Correcting for Scattered Light in IR Exposures: Manually Excluding Bad Reads (O’Connor, in prep.), which makes use of the same dataset highlighted in this tutorial.</p>
<p>For a tutorial on how to correct time-variable background due to the He I 10830 Å airglow line background, which has no spatial signature, please see the notebook <a class="reference external" href="https://github.com/spacetelescope/WFC3Library/tree/master/notebooks/tvb_flattenramp">Correcting for Helium Line Emission Background in IR Exposures using the “Flatten-Ramp” Technique</a>.</p>
</section>
<section id="additional-resources-a-id-add-a">
<h2>Additional Resources <a id="add"></a><a class="headerlink" href="#additional-resources-a-id-add-a" title="Permalink to this heading">#</a></h2>
<p>Below are some additional resources that may be helpful. Please send any questions through the <a class="reference external" href="https://stsci.service-now.com/hst">HST Help Desk</a>.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.stsci.edu/hst/instrumentation/wfc3">WFC3 Website</a></p></li>
<li><p><a class="reference external" href="https://hst-docs.stsci.edu/wfc3ihb">WFC3 Instrument Handbook</a></p></li>
<li><p><a class="reference external" href="https://hst-docs.stsci.edu/wfc3dhb">WFC3 Data Handbook</a></p></li>
</ul>
</section>
<section id="about-this-notebook-a-id-about-a">
<h2>About this Notebook <a id="about"></a><a class="headerlink" href="#about-this-notebook-a-id-about-a" title="Permalink to this heading">#</a></h2>
<p><strong>Authors:</strong></p>
<ul class="simple">
<li><p>Anne O’Connor, WFC3 Instrument</p></li>
<li><p>Harish Khandrika, WFC3 Instrument</p></li>
<li><p>Jennifer Mack, WFC3 Instrument</p></li>
<li><p>Annalisa Calamida, WFC3 Instrument</p></li>
</ul>
<p><strong>Updated On:</strong> 2023-05-05</p>
</section>
<section id="citations-a-id-cite-a">
<h2>Citations <a id="cite"></a><a class="headerlink" href="#citations-a-id-cite-a" title="Permalink to this heading">#</a></h2>
<p>If you use <code class="docutils literal notranslate"><span class="pre">numpy</span></code> or <code class="docutils literal notranslate"><span class="pre">astropy</span></code> for published research, please cite the
authors. Follow these links for more information about citing <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and
<code class="docutils literal notranslate"><span class="pre">astropy</span></code>:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/citing-numpy/">Citing <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.astropy.org/acknowledging.html">Citing <code class="docutils literal notranslate"><span class="pre">astropy</span></code></a></p></li>
<li><p><a class="reference external" href="https://astroquery.readthedocs.io/en/latest/">Citing <code class="docutils literal notranslate"><span class="pre">astroquery</span></code></a></p></li>
<li><p><a class="reference external" href="https://wfc3tools.readthedocs.io/en/latest/">Citing <code class="docutils literal notranslate"><span class="pre">wfc3tools</span></code></a></p></li>
<li><p><a class="reference external" href="https://drizzlepac.readthedocs.io/en/latest/LICENSE.html">Citing <code class="docutils literal notranslate"><span class="pre">drizzlepac</span></code></a></p></li>
</ul>
<p>If you use this notebook, or information from the WFC3 Data Handbook, Instrument Handbook,
or WFC3 ISRs for published research, please cite them:</p>
<ul class="simple">
<li><p>Citing this notebook:
Please cite the primary author and year, and hyperlink the notebook or WFC3 Library</p></li>
<li><p><a class="reference external" href="https://hst-docs.stsci.edu/wfc3dhb#:~:text=Citation,%2C%20(Baltimore%3A%20STScI).">Citing the WFC3 Data Handbook</a></p></li>
<li><p><a class="reference external" href="https://hst-docs.stsci.edu/wfc3ihb#:~:text=Citation,14.0%E2%80%9D%20(Baltimore%3A%20STScI)">Citing the WFC3 Instrument Handbook</a></p></li>
<li><p><a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/wfc3/documentation/instrument-science-reports-isrs/_documents/2021/2021-01.pdf">Instrument Science Report WFC3 2021-01</a></p></li>
<li><p><a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/wfc3/documentation/instrument-science-reports-isrs/_documents/2018/WFC3-2018-05.pdf">Instrument Science Report WFC3 2018-05</a></p></li>
</ul>
<hr class="docutils" />
<p><span class="xref myst">Top of Page</span>
<a class="reference internal" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/hst_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/WFC3/ir_ima_visualization"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../ir_tvb.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">WFC3/IR Time Variable Background (TVB)</p>
      </div>
    </a>
    <a class="right-next"
       href="../calwf3_recalibration/calwf3_recal_tvb.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Manual Recalibration with calwf3: Turning off the IR Linear Ramp Fit</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-id-intro-a">Introduction <a id="intro"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-a-id-import-a">1. Imports <a id="import"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-data-a-id-main-a">2. Downloading Data <a id="main"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-example-multiaccum-observation-a-id-load-a">2.1 Download Example MULTIACCUM Observation <a id="load"></a></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wfc3-ir-file-information-a-id-file-a">2.2 WFC3/IR File Information <a id="file"></a></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-individual-reads-of-ima-images-a-id-vis-a">3. Visualizing Individual Reads of IMA Images<a id="vis"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#taking-the-difference-between-ima-reads-the-cumulative-rate-a-id-cumulative-a">4. Taking the Difference Between IMA Reads: The Cumulative Rate <a id="cumulative"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-more-accurate-difference-between-reads-the-instantaneous-rate-a-id-instantaneous-a">5. A More Accurate Difference Between Reads: The Instantaneous Rate <a id="instantaneous"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions-a-id-conclusions-a">6.  Conclusions <a id="conclusions"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources-a-id-add-a">Additional Resources <a id="add"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook-a-id-about-a">About this Notebook <a id="about"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations-a-id-cite-a">Citations <a id="cite"></a></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>