

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>SBC Dark Analysis &#8212; HST Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/ACS/acs_sbc_dark_analysis/acs_sbc_dark_analysis';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="ACS/WFC Image Reduction" href="../acs_reduction/acs_reduction.html" />
    <link rel="prev" title="ACS Image Reduction for Subarray Data" href="../acs_subarrays/acs_subarrays.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    STScI Notebook Repository Template
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">ACS</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../README.html">ACS Notebooks</a></li>


<li class="toctree-l1"><a class="reference internal" href="../acs_findsat_mrt/acs_findsat_mrt_example.html">Satellite trail detection in ACS/WFC data using acstools.findsat_mrt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acs_saturation_trails/acs_saturation_trails.html">ACS Linearity with Saturated Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acs_cte_forward_model/acs_cte_forward_model_example.html">Pixel-based ACS/WFC CTE Forward Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acs_subarrays/acs_subarrays.html">ACS Image Reduction for Subarray Data</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">SBC Dark Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acs_reduction/acs_reduction.html">ACS/WFC Image Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acs_pixel_area_maps/acs_pixel_area_maps.html">Obtaining Pixel Area Maps for ACS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acs_polarization_tools/acs_polarization_tools.html">Using ACS Polarization Tools</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">COS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../COS/README.html">COS Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COS/Setup/Setup.html">Setting up your computer environment for working with COS data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/DataDl/DataDl.html">Downloading COS Data</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../COS/ViewData/ViewData.html">Viewing COS Data</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/AsnFile/AsnFile.html">Modifying or Creating an Association File</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../COS/CalCOS/CalCOS.html">Running the COS Data Pipeline (<code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>)</a></li>






<li class="toctree-l1"><a class="reference internal" href="../../COS/SplitTag/SplitTag.html">Splitting COS Exposures into sub-exposures with <code class="docutils literal notranslate"><span class="pre">splittag</span></code></a></li>







<li class="toctree-l1"><a class="reference internal" href="../../COS/DayNight/DayNight.html">Filtering out COS Data taken during the Day or Night</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COS/LSF/LSF.html">Working with the COS Line Spread Function (LSF)</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../COS/Extract/Extract.html">Editing the extraction boxes in a spectral extraction file (<code class="docutils literal notranslate"><span class="pre">XTRACTAB</span></code>)</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">DrizzlePac</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/README.html">DrizzlePac Jupyter Notebook Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/Initialization/Initialization.html">DrizzlePac Initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_to_catalogs/align_to_catalogs.html">Aligning HST images to an absolute reference catalog</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_multiple_visits/align_multiple_visits.html">Optimizing Image Alignment for Multiple HST Visits</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/align_sparse_fields/align_sparse_fields.html">Aligning Deep Exposures of Sparse Fields</a></li>








<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/drizzle_wfpc2/drizzle_wfpc2.html">Drizzling WFPC2 Images to use a Single Zeropoint</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/mask_satellite/mask_satellite.html">Satellite Trail Masking Techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/optimize_image_sampling/optimize_image_sampling.html">Optimizing the Image Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DrizzlePac/using_updated_astrometry_solutions/using_updated_astrometry_solutions.html">Using updated astrometry solutions</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NICMOS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html">Programmatic Replacements for NICMOS Units Conversion Form</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">STIS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../STIS/README.html">STIS-Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/CoronagraphyViz/STIS_Coronagraphy_Visualization_v2.html">STIS Coronagraphy Visualization Tool (v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/calstis/calstis_2d_ccd.html">Calstis 2-D CCD Data Reduction <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/target_acquisition/target_acquisition.html">Evaluating STIS Target Acquisitions <a class="tocSkip"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/view_data/view_data.html">Viewing STIS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STIS/extraction/1D_Extraction.html">1D Spectra Extraction <a class="tocSkip"></a></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/spacetelescope/hst_notebooks/blob/main/notebooks/ACS/acs_sbc_dark_analysis/acs_sbc_dark_analysis.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/hst_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/ACS/acs_sbc_dark_analysis/acs_sbc_dark_analysis.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/ACS/acs_sbc_dark_analysis/acs_sbc_dark_analysis.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>SBC Dark Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#this-tutorial-will-show-you-how-to">This tutorial will show you how to…</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#identify-images-with-significant-dark-current">1. <span class="xref myst">Identify Images with Significant Dark Current</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#combine-science-images">2. <span class="xref myst">Combine Science Images</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#combined-dark-images">3. <span class="xref myst">Combined Dark Images</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-photometry">4. <span class="xref myst">Perform Photometry</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-the-data">Download the Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#go-proposal-13655-how-lyman-alpha-bites-beats-the-dust">GO Proposal 13655: “How Lyman alpha bites/beats the dust”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#go-proposal-13961-sbc-dark-current-measurement">GO Proposal 13961: “SBC Dark Current Measurement”</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#file-information">File Information</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#association-files">Association Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#raw-files">Raw Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flt-files">FLT Files</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#identify-affected-observations-a-id-identify-a">Identify Affected Observations <a id="_identify"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combine-science-images-a-id-scidrizzle-a">Combine science images<a id="_scidrizzle"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-dark-images-a-id-drkdrizzle-a">Create dark images <a id="_drkdrizzle"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#photometry-a-id-photometry-a">Photometry<a id="_photometry"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-thoughts">Final Thoughts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-more-help">For more help:</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="alert alert-block alert-warning">
<b>REQUIREMENT:</b>
    Before proceeding, install or update your
    <b><a class="divlink" href="https://stenv.readthedocs.io/en/latest/">
    stenv
    </a></b>
    distribution. <b>stenv</b> is the replacement for AstroConda, which is unsupported as of February 2023.
</div><p><a id="titleSbc"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="sbc-dark-analysis">
<h1>SBC Dark Analysis<a class="headerlink" href="#sbc-dark-analysis" title="Permalink to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<hr class="docutils" />
<p>This notebook has been prepared as a demo on how to perform aperture photometry in SBC images that contain an elevated dark rate. This problem arises when the detector temperature goes above ~25 ºC.</p>
<p>More information on the dark rate can be found in <a class="reference external" href="http://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/acs/documentation/instrument-science-reports-isrs/_documents/isr1704.pdf">ISR ACS 2017-04</a> (Avila 2017).</p>
<section id="this-tutorial-will-show-you-how-to">
<h3>This tutorial will show you how to…<a class="headerlink" href="#this-tutorial-will-show-you-how-to" title="Permalink to this heading">#</a></h3>
<section id="identify-images-with-significant-dark-current">
<h4>1. <span class="xref myst">Identify Images with Significant Dark Current</span><a class="headerlink" href="#identify-images-with-significant-dark-current" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Open files and extract information</p></li>
<li><p>Organize information in a table</p></li>
<li><p>Sort table by temperature</p></li>
</ul>
</section>
<section id="combine-science-images">
<h4>2. <span class="xref myst">Combine Science Images</span><a class="headerlink" href="#combine-science-images" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> with ASN files to combine images.</p></li>
</ul>
</section>
<section id="combined-dark-images">
<h4>3. <span class="xref myst">Combined Dark Images</span><a class="headerlink" href="#combined-dark-images" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Identify which dark images to use for your data.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> to combine dark images.</p></li>
</ul>
</section>
<section id="perform-photometry">
<h4>4. <span class="xref myst">Perform Photometry</span><a class="headerlink" href="#perform-photometry" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Subtract dark current from science images using aperture photometry</p></li>
</ul>
</section>
</section>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<hr class="docutils" />
<p>Here we list the Python packages used in this notebook. Links to the documentation for each module is provided for convenience.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Package Name</p></th>
<th class="head text-left"><p>module</p></th>
<th class="head text-center"><p>docs</p></th>
<th class="head text-left"><p>used for</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">os</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">system</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="https://docs.python.org/2/library/os.html#os.system">link</a></p></td>
<td class="text-left"><p>command line input</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">os</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">environ</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="https://docs.python.org/2/library/os.html#os.environ">link</a></p></td>
<td class="text-left"><p>setting environments</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">shutil</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">rmtree</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="https://docs.python.org/2/library/shutil.html#shutil.rmtree">link</a></p></td>
<td class="text-left"><p>remove directory tree</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">glob</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">glob</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="https://docs.python.org/2/library/glob.html#glob.glob">link</a></p></td>
<td class="text-left"><p>search for files based on Unix shell rules</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">pyplot</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.html">link</a></p></td>
<td class="text-left"><p>plotting</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">colors.LogNorm</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="https://matplotlib.org/api/_as_gen/matplotlib.colors.LogNorm.html#matplotlib.colors.LogNorm">link</a></p></td>
<td class="text-left"><p>data normalization used for contrast plotting</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">patches.Rectangle</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="https://matplotlib.org/api/_as_gen/matplotlib.patches.Rectangle.html">link</a></p></td>
<td class="text-left"><p>add rectangle patch to plot</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">_s</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="https://docs.scipy.org/doc/numpy-1.13.0/reference/generated/numpy.s_.html">link</a></p></td>
<td class="text-left"><p>construct array slice object</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">astroquery.mast</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Observations</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="https://astroquery.readthedocs.io/en/latest/mast/mast.html">link</a></p></td>
<td class="text-left"><p>download data from MAST</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">drizzlepac</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">astrodrizzle</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="https://drizzlepac.readthedocs.io/en/deployment/astrodrizzle.html">link</a></p></td>
<td class="text-left"><p>drizzle combine images</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">astropy.io</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">fits</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="http://docs.astropy.org/en/stable/io/fits/">link</a></p></td>
<td class="text-left"><p>access and update fits files</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">astropy.table</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Table</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="http://docs.astropy.org/en/stable/table/">link</a></p></td>
<td class="text-left"><p>constructing and editing in a tabular format</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">astropy.wcs</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">WCS</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="http://docs.astropy.org/en/stable/api/astropy.wcs.WCS.html#astropy.wcs.WCS">link</a></p></td>
<td class="text-left"><p>extract WCS information from header</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">photutils</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">EllipticalAperture</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="https://photutils.readthedocs.io/en/stable/api/photutils.EllipticalAperture.html">link</a></p></td>
<td class="text-left"><p>construct aperture object for plotting</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">photutils</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">aperture_photometry</span></code></p></td>
<td class="text-center"><p><a class="divlink" href="https://photutils.readthedocs.io/en/stable/api/photutils.aperture_photometry.html#photutils.aperture_photometry">link</a></p></td>
<td class="text-left"><p>extract counts from aperture</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">from</span> <span class="nn">drizzlepac.astrodrizzle</span> <span class="kn">import</span> <span class="n">AstroDrizzle</span> <span class="k">as</span> <span class="n">adriz</span>

<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>


<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Rectangle</span>

<span class="kn">from</span> <span class="nn">photutils</span> <span class="kn">import</span> <span class="n">EllipticalAperture</span>
<span class="kn">from</span> <span class="nn">photutils</span> <span class="kn">import</span> <span class="n">aperture_photometry</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-the-data">
<h2>Download the Data<a class="headerlink" href="#download-the-data" title="Permalink to this heading">#</a></h2>
<hr class="docutils" />
<p>Here we download all of the data required for this notebook. This is an important step! Some of the image processing steps require all relevant files to be in the working directory. We recommend working with a brand new directory for every new set of data.</p>
<p>Using the python package <code class="docutils literal notranslate"><span class="pre">astroquery</span></code>, we can retreive files from the <a class="reference external" href="http://archive.stsci.edu">MAST</a> archive.</p>
<section id="go-proposal-13655-how-lyman-alpha-bites-beats-the-dust">
<h3><a class="reference external" href="https://stdatu.stsci.edu/proposal_search.php?mission=hst&amp;id=13655">GO Proposal 13655</a>: “How Lyman alpha bites/beats the dust”<a class="headerlink" href="#go-proposal-13655-how-lyman-alpha-bites-beats-the-dust" title="Permalink to this heading">#</a></h3>
<p>First, we will grab the FLT and ASN files from program 13655. For this example, we only want to retreive the files from visit 11 of this program. We will specify program ID ‘JCMC’ along with observation set ID ‘11’.</p>
<div class="alert alert-danger">
<b>MAY CHANGE:</b> The argument "mrp_only" stands for "minimum recommended products only". It currently needs to be set to False, although in the future, False is intended to be set as the default and can be left out.
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">science_list</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">proposal_id</span><span class="o">=</span><span class="s1">&#39;13655&#39;</span><span class="p">,</span> <span class="n">obs_id</span><span class="o">=</span><span class="s1">&#39;JCMC11*&#39;</span><span class="p">)</span>

<span class="n">sci_dl_table</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">science_list</span><span class="p">[</span><span class="s1">&#39;obsid&#39;</span><span class="p">],</span> 
                                              <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ASN&#39;</span><span class="p">,</span> <span class="s1">&#39;FLT&#39;</span><span class="p">],</span>
                                              <span class="n">mrp_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="go-proposal-13961-sbc-dark-current-measurement">
<h3><a class="reference external" href="https://stdatu.stsci.edu/proposal_search.php?mission=hst&amp;id=13961">GO Proposal 13961</a>: “SBC Dark Current Measurement”<a class="headerlink" href="#go-proposal-13961-sbc-dark-current-measurement" title="Permalink to this heading">#</a></h3>
<p>Now we need a set of dark calibration images. You can use any calibration set as long as the dark rate in the image matches that of your science image (discussed later in this notebook). For convenience, here we download the RAW dark frames from one calibration program: GO Proposal 13961.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">darks_list</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">proposal_id</span><span class="o">=</span><span class="s1">&#39;13961&#39;</span><span class="p">,</span> <span class="n">obstype</span><span class="o">=</span><span class="s1">&#39;cal&#39;</span><span class="p">)</span>

<span class="n">drk_dl_table</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">darks_list</span><span class="p">[</span><span class="s1">&#39;obsid&#39;</span><span class="p">],</span>
                                              <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RAW&#39;</span><span class="p">],</span>
                                              <span class="n">mrp_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll use the packages <code class="docutils literal notranslate"><span class="pre">os</span></code> and <code class="docutils literal notranslate"><span class="pre">shutil</span></code> to put all of these files in our working directory for convenience and do a little housekeeping. Now let’s place those images in the same directory as this notebook…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">dl_table</span> <span class="ow">in</span> <span class="p">[</span><span class="n">sci_dl_table</span><span class="p">,</span> <span class="n">drk_dl_table</span><span class="p">]:</span>
    
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dl_table</span><span class="p">:</span>
        <span class="n">oldfname</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Local Path&#39;</span><span class="p">]</span>
        <span class="n">newfname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">oldfname</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">oldfname</span><span class="p">,</span> <span class="n">newfname</span><span class="p">)</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;mastDownload/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Below we define our filenames with variables for convenience using <code class="docutils literal notranslate"><span class="pre">glob.glob</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asn_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*_asn.fits&#39;</span><span class="p">)</span>
<span class="n">flt_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*_flt.fits&#39;</span><span class="p">)</span>
<span class="n">drk_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*_raw.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="file-information">
<h2>File Information<a class="headerlink" href="#file-information" title="Permalink to this heading">#</a></h2>
<hr class="docutils" />
<p>The structure of the fits files from ACS may be different depending on what kind of observation was made. For more information, refer to Section 2.2 of the <a class="reference external" href="http://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/acs/documentation/other-documents/_documents/acs_dhb.pdf">ACS Data Handbook</a>.</p>
<section id="association-files">
<h3>Association Files<a class="headerlink" href="#association-files" title="Permalink to this heading">#</a></h3>
<p>Association files only contain one extension which lists associated files and their types.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Ext</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head text-left"><p>Contains</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><b>0</b></p></td>
<td><p>PRIMARY</p></td>
<td><p>(PrimaryHDU)</p></td>
<td class="text-left"><p>Meta-data related to the entire file.</p></td>
</tr>
<tr class="row-odd"><td><p><b>1</b></p></td>
<td><p>ASN (Association)</p></td>
<td><p>(BinTableHDU)</p></td>
<td class="text-left"><p>Table of files associated with this group.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="raw-files">
<h3>Raw Files<a class="headerlink" href="#raw-files" title="Permalink to this heading">#</a></h3>
<p>A standard raw image file from the SBC has the same structure as you’d expect from full frame observation from ACS.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Ext</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head text-left"><p>Contains</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><b>0</b></p></td>
<td><p>PRIMARY</p></td>
<td><p>(PrimaryHDU)</p></td>
<td class="text-left"><p>Meta-data related to the entire file.</p></td>
</tr>
<tr class="row-odd"><td><p><b>1</b></p></td>
<td><p>SCI (Image)</p></td>
<td><p>(ImageHDU)</p></td>
<td class="text-left"><p>Raw image data.</p></td>
</tr>
<tr class="row-even"><td><p><b>2</b></p></td>
<td><p>ERR (Error)</p></td>
<td><p>(ImageHDU)</p></td>
<td class="text-left"><p>Error array.</p></td>
</tr>
<tr class="row-odd"><td><p><b>3</b></p></td>
<td><p>DQ (Data Quality)</p></td>
<td><p>(ImageHDU)</p></td>
<td class="text-left"><p>Data quality array.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="flt-files">
<h3>FLT Files<a class="headerlink" href="#flt-files" title="Permalink to this heading">#</a></h3>
<p>SBC flat-fielded files have the same structure as the raw files, with additional HDUs for WCS corrections.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Ext</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head text-left"><p>Contains</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><b>0</b></p></td>
<td><p>PRIMARY</p></td>
<td><p>(PrimaryHDU)</p></td>
<td class="text-left"><p>Meta-data related to the entire file.</p></td>
</tr>
<tr class="row-odd"><td><p><b>1</b></p></td>
<td><p>SCI (Image)</p></td>
<td><p>(ImageHDU)</p></td>
<td class="text-left"><p>Raw image data.</p></td>
</tr>
<tr class="row-even"><td><p><b>2</b></p></td>
<td><p>ERR (Error)</p></td>
<td><p>(ImageHDU)</p></td>
<td class="text-left"><p>Error array.</p></td>
</tr>
<tr class="row-odd"><td><p><b>3</b></p></td>
<td><p>DQ (Data Quality)</p></td>
<td><p>(ImageHDU)</p></td>
<td class="text-left"><p>Data quality array.</p></td>
</tr>
<tr class="row-even"><td><p><b>4-5</b></p></td>
<td><p>WCSDVARR (WCS)</p></td>
<td><p>(ImageHDU)</p></td>
<td class="text-left"><p>Filter-dependent non-polynomial distortion corrections.</p></td>
</tr>
<tr class="row-odd"><td><p><b>6</b></p></td>
<td><p>WCSCORR (WCS)</p></td>
<td><p>(BinTableHDU)</p></td>
<td class="text-left"><p>History of changes to the WCS solution.</p></td>
</tr>
</tbody>
</table>
<p>You can always use <code class="docutils literal notranslate"><span class="pre">.info()</span></code> on an HDUlist for an overview of the structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">drk_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">as</span> <span class="n">hdulist</span><span class="p">:</span>
    <span class="n">hdulist</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="identify-affected-observations-a-id-identify-a">
<h2>Identify Affected Observations <a id="_identify"></a><a class="headerlink" href="#identify-affected-observations-a-id-identify-a" title="Permalink to this heading">#</a></h2>
<hr class="docutils" />
<p>Let’s take a look at some information from our science images. We want to find observations with an average temperature greater than 25<span class="math notranslate nohighlight">\(^o\)</span>C. We can organize the information in a <code class="docutils literal notranslate"><span class="pre">Table</span></code> object from <code class="docutils literal notranslate"><span class="pre">astropy.table</span></code> for convenience. Here, we define a table with column names and respective data types.</p>
<p><b>Note:</b> The FITS header keywords <code class="docutils literal notranslate"><span class="pre">mdecodt1</span></code> and <code class="docutils literal notranslate"><span class="pre">mdecodt2</span></code> refer to the temperature at the beginning and end of the exposure respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flt_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;filter1&#39;</span><span class="p">,</span> <span class="s1">&#39;mdecodt1&#39;</span><span class="p">,</span> <span class="s1">&#39;mdecodt2&#39;</span><span class="p">,</span> <span class="s1">&#39;avgtemp&#39;</span><span class="p">),</span>
                  <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;S64&#39;</span><span class="p">,</span> <span class="s1">&#39;S19&#39;</span><span class="p">,</span> <span class="s1">&#39;S6&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now we need to obtain information from the headers. The temperatures are stored in the science extensions, while observation information is found in the primary header.</p>
<div class="alert alert-block alert-info"><b>Pro-Tip</b>: Adding rows to a table is a slow way to construct a table. For larger sets of data, consider
<a class="divlink" href="http://docs.astropy.org/en/stable/table/construct_table.html#empty-array-of-a-known-size">
    constructing a table of known size.
</a> </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">flt_list</span><span class="p">:</span>
    <span class="n">filt</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;FILTER1&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;DATE-OBS&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;TIME-OBS&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">t1</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;MDECODT1&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;MDECODT2&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">starttime</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="s1">&#39;T&#39;</span> <span class="o">+</span> <span class="n">time</span>
    <span class="n">avgtemp</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span><span class="o">+</span><span class="n">t2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        
    <span class="n">flt_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">((</span><span class="n">file</span><span class="p">,</span> <span class="n">starttime</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">avgtemp</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">flt_table</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can sort the table by column value for analysis. Since we are interested in temperature, we’ll sort this table by the column ‘avgtemp’</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flt_table</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;avgtemp&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flt_table</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Sorting the table by average temperature gives us a sense of how temperature of the SBC behaves over time. Only the last image was affected by a temperature of over 25<span class="math notranslate nohighlight">\(^o\)</span>C, and therefore the only image to be affected by elevated dark current.</p>
<p>The table shows us that this image was taken with the filter F165LP- which is also same filter that the first image was taken with. This is not a coincidence! Take a moment to consider the time-based symmetry of the images, and what that means for the dark current of the combined images.</p>
</section>
<section id="combine-science-images-a-id-scidrizzle-a">
<h2>Combine science images<a id="_scidrizzle"></a><a class="headerlink" href="#combine-science-images-a-id-scidrizzle-a" title="Permalink to this heading">#</a></h2>
<hr class="docutils" />
<p>Let’s make drizzled products for each filter. We do this by using the ASN files for each filter. The ASN files will tell AstroDrizzle which flat images to combine for a given filter.  Steps 1-6 of the drizzling procedure have been turned off since their purpose is to identify and mask cosmic rays, which do not affect SBC images.</p>
<p>The drizzle keyword parameters below are the appropriate ones for SBC data. For “final_scale” we use the pixel scale of SBC, 0.025 arcseconds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">driz_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;runfile&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
               <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s1">&#39;build&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s1">&#39;preserve&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s1">&#39;clean&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s1">&#39;static&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s1">&#39;skysub&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s1">&#39;driz_separate&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s1">&#39;blot&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s1">&#39;driz_cr&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s1">&#39;driz_combine&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s1">&#39;final_wcs&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s1">&#39;final_scale&#39;</span><span class="p">:</span> <span class="mf">0.025</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now we’ll run AstroDrizzle on our list of association files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">asn_list</span><span class="p">:</span>
    <span class="n">output_name</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="s1">&#39;asn_id&#39;</span><span class="p">]</span>
    <span class="n">adriz</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output_name</span><span class="p">,</span> <span class="o">**</span><span class="n">driz_kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-dark-images-a-id-drkdrizzle-a">
<h2>Create dark images <a id="_drkdrizzle"></a><a class="headerlink" href="#create-dark-images-a-id-drkdrizzle-a" title="Permalink to this heading">#</a></h2>
<hr class="docutils" />
<p>We want to use dark frames to make a drizzled product that will be used to approximate the dark rate to be subtracted from the science product. The dark rate above 25C varies. We need to find the dark frame that contains a <em>dark rate</em> similar to your affected image.</p>
<p>Below we open the two F165LP science frames, one being a high temperature image and the other being a lower temperature image with negligible dark current.</p>
<p>To measure the dark rate, we will take the sum of the pixels within a 200x200 box. The box will be placed off-center of our SBC image where dark rate is low and consistent, at (y, x) = (750, 680). We will measure this sum for our science images as well as all of the dark frames.</p>
<p>With the array handling package <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, we can define a 2D array slice to use for later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cutter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">s_</span><span class="p">[</span><span class="mi">650</span><span class="p">:</span><span class="mi">850</span><span class="p">,</span> <span class="mi">580</span><span class="p">:</span><span class="mi">780</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can print out the sum of the pixels in each image cut out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sci_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jcmc11ctq_flt.fits&#39;</span><span class="p">,</span>
            <span class="s1">&#39;jcmc11e6q_flt.fits&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Box Sums for Science Data:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">sci_list</span><span class="p">:</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">img_slice</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">cutter</span><span class="p">]</span>
    <span class="n">neatname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> --&gt; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">neatname</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">img_slice</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">----------------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Box Sums for Dark Frames:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">drk_list</span><span class="p">:</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">img_slice</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">cutter</span><span class="p">]</span>
    <span class="n">neatname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> --&gt; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">neatname</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">img_slice</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>It looks like the two dark frames that come closest to the science frames are <strong>jcrx01iqq</strong> and <strong>jcrx01iyq</strong>. We will use those to make a combined master dark frame. Note that for programs with more exposures, you will need to do this for each input image in the combined mosaic.</p>
<p>For better visualization, let’s take a look at one of our science images and matching dark frame. We will also highlight the dark rate extraction box in each plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;norm&#39;</span><span class="p">:</span> <span class="n">LogNorm</span><span class="p">(),</span>
              <span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
              <span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="s1">&#39;plasma&#39;</span><span class="p">,</span>
              <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;lower&#39;</span><span class="p">}</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="n">science</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;jcmc11ctq_flt.fits&#39;</span><span class="p">)</span>
<span class="n">dark</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;jcrx01iqq_raw.fits&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Science Data&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Dark Frame&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">science</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_kwargs</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dark</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_kwargs</span><span class="p">)</span>

<span class="c1"># Must define twice since artist objects can only be used once.</span>
<span class="n">patch0</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">((</span><span class="mi">680</span><span class="p">,</span> <span class="mi">750</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">patch1</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">((</span><span class="mi">680</span><span class="p">,</span> <span class="mi">750</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To preserve important information in the header specific to the science image, such as the WCS solution, we will insert the data of the dark images into copies of the science images. We also must remember to adjust the exposure time of the copies of the science frames to that of the dark frames so that the drizzled products have the correct count rates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flt_file</span> <span class="o">=</span> <span class="s1">&#39;jcmc11ctq_flt.fits&#39;</span>
<span class="n">drk_file</span> <span class="o">=</span> <span class="s1">&#39;jcrx01iiq_raw.fits&#39;</span>
<span class="n">new_file</span> <span class="o">=</span> <span class="s1">&#39;dark1.fits&#39;</span>

<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp </span><span class="si">{:}</span><span class="s1"> </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flt_file</span><span class="p">,</span> <span class="n">new_file</span><span class="p">))</span>

<span class="n">darkdat</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">drk_file</span><span class="p">)</span>
<span class="n">exptime</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">drk_file</span><span class="p">,</span> <span class="s1">&#39;exptime&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">new_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdu</span><span class="p">:</span>
    
    <span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">darkdat</span>
    <span class="n">hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;exptime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exptime</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flt_file</span> <span class="o">=</span> <span class="s1">&#39;jcmc11e6q_flt.fits&#39;</span>
<span class="n">drk_file</span> <span class="o">=</span> <span class="s1">&#39;jcrx01iyq_raw.fits&#39;</span>
<span class="n">new_file</span> <span class="o">=</span> <span class="s1">&#39;dark2.fits&#39;</span>

<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp </span><span class="si">{:}</span><span class="s1"> </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flt_file</span><span class="p">,</span> <span class="n">new_file</span><span class="p">))</span>

<span class="n">darkdat</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">drk_file</span><span class="p">)</span>
<span class="n">exptime</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">drk_file</span><span class="p">,</span> <span class="s1">&#39;exptime&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">new_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdu</span><span class="p">:</span>
    
    <span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">darkdat</span>
    <span class="n">hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;exptime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exptime</span>
</pre></div>
</div>
</div>
</div>
<p>We can now make the drizzled dark frame using the two individual dark frames we just made as inputs. The drizzle parameters are the same as the ones used to make the science drizzled products.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adriz_output</span> <span class="o">=</span> <span class="n">adriz</span><span class="p">([</span><span class="s1">&#39;dark1.fits&#39;</span><span class="p">,</span> <span class="s1">&#39;dark2.fits&#39;</span><span class="p">],</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;masterdark&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">driz_kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will now display the images to confirm that they show similar elevated dark rates. You might want do display them in DS9 (or any other viewer) outside of this notebook so you can play with the stretch a bit and so you can see bigger versions of the images.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Some plotting parameters</span>
<span class="n">plt_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;norm&#39;</span><span class="p">:</span> <span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
              <span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
              <span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="s1">&#39;plasma&#39;</span><span class="p">,</span>
              <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;lower&#39;</span><span class="p">}</span>

<span class="n">f165lp</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;jcmc11010_drz_sci.fits&#39;</span><span class="p">)</span>
<span class="n">masterdark</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;masterdark_drz_sci.fits&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Drizzled Science Data&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Drizzled Dark Frame&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f165lp</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_kwargs</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">masterdark</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The images look comparable. We will now proceed to performing some photometric analysis to estimate the dark current in the source.</p>
</section>
<section id="photometry-a-id-photometry-a">
<h2>Photometry<a id="_photometry"></a><a class="headerlink" href="#photometry-a-id-photometry-a" title="Permalink to this heading">#</a></h2>
<hr class="docutils" />
<p>Now we will use the <code class="docutils literal notranslate"><span class="pre">photutils</span></code> package to set up the two apertures. We will use these apertures to measure the flux of different regions in the images.</p>
<p>The first aperture is centered on our target at (735, 710), and is shaped as an elliptical to encompass all of the flux from the source. The other aperture will be the same exact shape, but located near the edge of the detector at (200, 200).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aper</span> <span class="o">=</span> <span class="n">EllipticalAperture</span><span class="p">([(</span><span class="mi">735</span><span class="p">,</span> <span class="mi">710</span><span class="p">),</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)],</span> <span class="n">a</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s overplot the two apertures in the images so you can see their locations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Drizzled Science Data&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Drizzled Dark Frames&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f165lp</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_kwargs</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">masterdark</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_kwargs</span><span class="p">)</span>

<span class="n">aper</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">aper</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we do the photometry using the two apertures on both images. We print out the tables to see the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f165lp_phot</span> <span class="o">=</span> <span class="n">aperture_photometry</span><span class="p">(</span><span class="n">f165lp</span><span class="p">,</span> <span class="n">aper</span><span class="p">)</span>
<span class="n">masterdark_phot</span> <span class="o">=</span> <span class="n">aperture_photometry</span><span class="p">(</span><span class="n">masterdark</span><span class="p">,</span> <span class="n">aper</span><span class="p">)</span>

<span class="n">sumdiff</span> <span class="o">=</span> <span class="n">f165lp_phot</span><span class="p">[</span><span class="s1">&#39;aperture_sum&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">masterdark_phot</span><span class="p">[</span><span class="s1">&#39;aperture_sum&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Science data photometry:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f165lp_phot</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dark frame photometry:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">masterdark_phot</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Difference of aperture sums (science - dark):</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sumdiff</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The target aperture has 2.89 cts/sec, while the same aperture in the dark frame has 0.322 cts/sec. That means that ~11% of the flux in your source comes from dark current and should be subtracted out, leaving a flux for you source of 2.564 cts/sec.</p>
</section>
<section id="final-thoughts">
<h2>Final Thoughts<a class="headerlink" href="#final-thoughts" title="Permalink to this heading">#</a></h2>
<hr class="docutils" />
<ol class="arabic simple">
<li><p>The difference in flux in the second aperture (the one in the lower left portion of the image) shows that there is a small residual background of ~0.02 cts/sec in the science frame. This could be real background from the sky (and not dark current from the detector that you might want to account for properly in your flux and error budget.</p></li>
<li><p>The dark frame we created does not have the exact same dark count rate as we measured in the science frame. You could try searching for other darks that more closely resemble your science frame.</p></li>
<li><p>These problems can be avoided using a few strategies detailed in <a class="reference external" href="http://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/acs/documentation/instrument-science-reports-isrs/_documents/isr1807.pdf">ISR ACS 2018-07</a> (Avila 2018).</p></li>
</ol>
<section id="for-more-help">
<h3>For more help:<a class="headerlink" href="#for-more-help" title="Permalink to this heading">#</a></h3>
<p>More details may be found on the <a class="reference external" href="http://www.stsci.edu/hst/instrumentation/acs">ACS website</a> and in the <a class="reference external" href="https://hst-docs.stsci.edu/display/ACSIHB">ACS Instrument</a> and <a class="reference external" href="http://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/acs/documentation/other-documents/_documents/acs_dhb.pdf">Data Handbooks</a>.</p>
<p>Please visit the <a class="reference external" href="http://hsthelp.stsci.edu">HST Help Desk</a>. Through the help desk portal, you can explore the <em>HST</em> Knowledge Base and request additional help from experts.</p>
<hr class="docutils" />
<p><span class="xref myst">Top of Page</span>
<img style="float: right;" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" alt="Space Telescope Logo" width="200px"/>
<br></br>
<br></br></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/hst_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/ACS/acs_sbc_dark_analysis"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../acs_subarrays/acs_subarrays.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">ACS Image Reduction for Subarray Data</p>
      </div>
    </a>
    <a class="right-next"
       href="../acs_reduction/acs_reduction.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">ACS/WFC Image Reduction</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#this-tutorial-will-show-you-how-to">This tutorial will show you how to…</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#identify-images-with-significant-dark-current">1. <span class="xref myst">Identify Images with Significant Dark Current</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#combine-science-images">2. <span class="xref myst">Combine Science Images</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#combined-dark-images">3. <span class="xref myst">Combined Dark Images</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-photometry">4. <span class="xref myst">Perform Photometry</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-the-data">Download the Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#go-proposal-13655-how-lyman-alpha-bites-beats-the-dust">GO Proposal 13655: “How Lyman alpha bites/beats the dust”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#go-proposal-13961-sbc-dark-current-measurement">GO Proposal 13961: “SBC Dark Current Measurement”</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#file-information">File Information</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#association-files">Association Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#raw-files">Raw Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flt-files">FLT Files</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#identify-affected-observations-a-id-identify-a">Identify Affected Observations <a id="_identify"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combine-science-images-a-id-scidrizzle-a">Combine science images<a id="_scidrizzle"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-dark-images-a-id-drkdrizzle-a">Create dark images <a id="_drkdrizzle"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#photometry-a-id-photometry-a">Photometry<a id="_photometry"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-thoughts">Final Thoughts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-more-help">For more help:</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>